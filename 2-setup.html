<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>‚öôÔ∏è 2 Setup &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="next" title="üëæ 3 Graphics" href="3-graphics.html" >
	<link rel="prev" title="üëã 1 Introduction" href="1-introduction.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	function updatePlatform()
	{
	var platform = Cookies.get("platform");
	console.log("updatePlatform(), platform = " + platform);
	if (typeof platform == 'undefined')
	{
		platform = "linux"; // Set default here.
	}
	var selectd3d11=document.getElementById("selectd3d11");
	var selectd3d12=document.getElementById("selectd3d12");
	var selectopengles=document.getElementById("selectopengles");
	var selectvulkan=document.getElementById("selectvulkan");
	var selectopengl=document.getElementById("selectopengl");
	$(".linux").hide();
	$(".android").hide();
	$(".windows").hide();
	if (platform == "windows")
	{
	$(".windows").show();
	if(selectd3d11)
		selectd3d11.disabled = false;
	if(selectd3d12)
		selectd3d12.disabled = false;
	if(selectopengles)
		selectopengles.disabled = true;
	if(selectvulkan)
		selectvulkan.disabled = false;
	if(selectopengl)
		selectopengl.disabled = false;
	}
	if (platform == "linux")
	{
	$(".linux").show();
	if(selectd3d11)
		selectd3d11.disabled = true;
	if(selectd3d12)
		selectd3d12.disabled = true;
	if(selectopengles)
		selectopengles.disabled = true;
	if(selectvulkan)
		selectvulkan.disabled = false;
	if(selectopengl)
		selectopengl.disabled = false;
	}
	if (platform == "android")
	{
	$(".android").show();
	if(selectd3d11)
		selectd3d11.disabled = true;
	if(selectd3d12)
		selectd3d12.disabled = true;
	if(selectopengles)
		selectopengles.disabled = false;
	if(selectvulkan)
		selectvulkan.disabled = false;
	if(selectopengl)
		selectopengl.disabled = true;
	}
	var oldelements = document.querySelectorAll(".selected-platform");
	console.log("selected-platform on "+oldelements.length+" elements.");
	while (oldelements.length > 0)
	{
		var el=oldelements.item(0);
		el.classList.remove('selected-platform');
		console.log("Removing selected-platform from "+el.id);
		oldelements = document.querySelectorAll(".selected-platform");
	}
	var element = document.getElementById('select' + platform);
	if(element)
	{
		element.classList.add('selected-platform');
		console.log("Adding selected-platform to "+element.id);
	}
	var element2 = document.getElementById('select' + platform + "-inline");
	if(element2)
	{
		element2.classList.add('selected-platform');
		console.log("Adding selected-platform to "+element2.id);
	}
	else
	{
		console.log('select' + platform + "-inline not found");
	}
	if(limitAPIChoice())
		updateGraphicsAPI();
	window.updatePlatform=updatePlatform;
	}
	
	function limitAPIChoice()
	{
		var platform = Cookies.get("platform");
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("limitAPIChoice(), platform = " + platform+", graphicsApi = "+graphicsApi);
		window.limitAPIChoice=limitAPIChoice;
		var newApi=graphicsApi;
		if (platform == "windows")
		{
			if (graphicsApi == "opengles"||graphicsApi==undefined)
				newApi="vulkan";
		}
		if (platform == "linux")
		{
			if (graphicsApi == "opengles"||graphicsApi=="d3d11"||graphicsApi=="d3d12"||graphicsApi==undefined)
				newApi="vulkan";
		}
		if (platform == "android"||graphicsApi==undefined)
		{
			if (graphicsApi != "opengles"&&graphicsApi!="vulkan")
				newApi="vulkan";
		}
		console.log("newApi = "+newApi);
		if (newApi != graphicsApi)
		{
			console.log("setting graphicsapi = "+newApi);
			Cookies.set('graphicsapi', newApi,{ expires: 365})
			graphicsApi=newApi;
			return true;
		}
		return false;
		}
	function makeLinksOpenInNewWindow()
	{ 
		var download_hrefs = document.getElementsByClassName('reference download internal');
		[].forEach.call(download_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			console.log("Adding target blank to "+el.id);
		});
		window.makeLinksOpenInNewWindow=makeLinksOpenInNewWindow;
	}
	function updateGraphicsAPI()
	{
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("graphicsapi = " + graphicsApi);
		if (typeof graphicsApi == 'undefined')
		{
			graphicsApi = "vulkan"; // Set default here.
		}
		// first, hide all the api's
		$(".d3d11").hide();
		$(".d3d12").hide();
		$(".opengl").hide();
		$(".opengles").hide();
		$(".vulkan").hide();
		// Now, show the wanted api's. In this way, divs with more than one will be shown, even if they have one that is hidden.
		if (graphicsApi == "d3d11") {
			$(".d3d11").show();
		}
		if (graphicsApi == "d3d12") {
			$(".d3d12").show();
		}
		if (graphicsApi == "opengl") {
			$(".opengl").show();
		}
		if (graphicsApi == "opengles") {
			$(".opengles").show();
		}
		if (graphicsApi == "vulkan") {
			$(".vulkan").show();
		}
		var oldelements = document.querySelectorAll(".selected-graphics-api");
		console.log("selected-platform on "+oldelements.length+" elements.");
		while (oldelements.length > 0)
		{
			var el=oldelements.item(0);
			el.classList.remove('selected-graphics-api');
			console.log("Removing selected-graphics-api from "+el.id);
			oldelements = document.querySelectorAll(".selected-graphics-api");
		}
		var element = document.getElementById('select' + graphicsApi);
		if(element)
		{
			element.classList.add('selected-graphics-api');
		}
		var element2 = document.getElementById('select' + graphicsApi +"-inline");
		if (element2)
		{
			element2.classList.add('selected-graphics-api');
		}
		window.updateGraphicsAPI=updateGraphicsAPI;
	}</script>
	<script >
	var graphicsApi = Cookies.get("graphicsapi")
	if (graphicsApi==undefined) {
		Cookies.set('graphicsapi', 'vulkan',{ expires: 365})
		graphicsApi='vulkan';
	}
	</script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onload="updatePlatform(); updateGraphicsAPI(); makeLinksOpenInNewWindow();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">üëã 1 Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">‚öôÔ∏è 2 Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-setup">Project Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cmake-and-project-files">CMake and Project Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-files">Common Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#debugoutput">DebugOutput</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helperfunctions">HelperFunctions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#openxrdebugutils">OpenXRDebugUtils</a></li>
<li class="toctree-l4"><a class="reference internal" href="#openxrhelper">OpenXRHelper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#graphicsapi">GraphicsAPI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#openxrtutorial-and-main">OpenXRTutorial and Main</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-run">Build and Run</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrinstance-xrgetsystem">2.1 Creating an XrInstance / xrGetSystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrinstance">2.1.1 XrInstance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsystemid">2.1.2 XrSystemId</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrsession">2.2 Creating an XrSession</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrsession">2.2.1 XrSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">2.2.2 GraphicsAPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#polling-the-event-loop">2.3 Polling the Event Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrpollevent">2.3.1 xrPollEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsessionstate">2.3.2 XrSessionState</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrbeginsession-and-xrendsession">2.3.3 xrBeginSession and xrEndSession</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">üëæ 3 Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-actions.html">üïπ 4 Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">‚ú® 5 Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">‚öôÔ∏è 2 Setup</li>
	  <li class="wy-breadcrumbs-aside">
		  <div id='selectplatform'>
	<button class="select-platform" id='selectwindows' onclick="choosePlatform('windows')">
		<img class="platform-tab-img" src="_static/css/windows-colour.svg" alt="Windows" />
	</button>
	<button class="select-platform" id='selectlinux' onclick="choosePlatform('linux')">
		<img class="platform-tab-img" src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
	</button>
	<button class="select-platform" id='selectandroid' onclick="choosePlatform('android')">
		<img class="platform-tab-img" src="_static/css/android-colour.svg" alt="Android" />
	</button>
</div>
<script>
	function choosePlatform(platformName)
	{
		var platform = Cookies.get('platform')
		Cookies.set('platform', platformName, { expires: 365 })
		updatePlatform();
	};
</script>

<div id='selectgraphicsapi'>
	<button class="select-graphics-api" id='selectd3d11' onclick="chooseGraphicsAPI('d3d11')">
		<img class="api-tab-img" src="_static/css/d3d11.png" alt="DirectX 11" />
	</button>
	<button class="select-graphics-api" id='selectd3d12' onclick="chooseGraphicsAPI('d3d12')">
		<img class="api-tab-img" src="_static/css/d3d12.png" alt="DirectX 12" />
	</button>
	<button class="select-graphics-api" id='selectopengl' onclick="chooseGraphicsAPI('opengl')">
		<img class="api-tab-img" src="_static/css/opengl.png" alt="OpenGL" />
	</button>
	<button class="select-graphics-api" id='selectopengles' onclick="chooseGraphicsAPI('opengles')">
		<img class="api-tab-img" src="_static/css/opengles.png" alt="OpenGL ES" />
	</button>
	<button class="select-graphics-api" id='selectvulkan' onclick="chooseGraphicsAPI('vulkan')">
		<img class="api-tab-img" src="_static/css/vulkan.png" alt="Vulkan" />
	</button>
</div>
<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		Cookies.set('graphicsapi', graphicsApiName, { expires: 365 })
		var graphicsApi = Cookies.get('graphicsapi')
		updateGraphicsAPI();
		limitAPIChoice();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
						<div itemprop="articleBody">
							
  <section id="setup">
<h1>‚öôÔ∏è 2 Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¬∂</a></h1>
<p>Select your platform, as the instructions are different depending on your selection.</p>
<div class='select-platform-container-inline'>
	<button class="select-platform-inline" id='selectwindows-inline' onclick="choosePlatform('windows')">
		<img src="_static/css/windows-mono.svg" alt="Windows" />
		Windows
	</button>
	<button class="select-platform-inline" id='selectlinux-inline' onclick="choosePlatform('linux')">
		<img src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
		Linux
	</button>
	<button class="select-platform-inline" id='selectandroid-inline' onclick="choosePlatform('android')">
		<img src="_static/css/android-original.svg" alt="Android" />
		Android
	</button>
</div>
<div class='select-graphics-api-container-inline'></div>
	<button class="select-graphics-api-inline" id='selectd3d11-inline' onclick="chooseGraphicsAPI('d3d11')">
		<img src="_static/css/d3d11.png" alt="DirectX 11" />
		DirectX 11
	</button>
	<button class="select-graphics-api-inline" id='selectd3d12-inline' onclick="chooseGraphicsAPI('d3d12')">
		<img src="_static/css/d3d12.png" alt="DirectX 12" />
		DirectX 12
	</button>
	<button class="select-graphics-api-inline" id='selectopengl-inline' onclick="chooseGraphicsAPI('opengl')">
		<img src="_static/css/opengl.png" alt="OpenGL" />
		OpenGL
	</button>
	<button class="select-graphics-api-inline" id='selectopengles-inline' onclick="chooseGraphicsAPI('opengles')">
		<img src="_static/css/opengles.png" alt="OpenGL ES" />
		OpenGL ES
	</button>
	<button class="select-graphics-api-inline" id='selectvulkan-inline' onclick="chooseGraphicsAPI('vulkan')">
		<img src="_static/css/vulkan.png" alt="Vulkan" />
		Vulkan
	</button>
</div>

<section id="project-setup">
<h2>Project Setup<a class="headerlink" href="#project-setup" title="Permalink to this heading">¬∂</a></h2>
<section id="cmake-and-project-files">
<h3>CMake and Project Files<a class="headerlink" href="#cmake-and-project-files" title="Permalink to this heading">¬∂</a></h3>
<div class="windows docutils container" id="windows-id-1">
<p>For the Microsoft Windows OpenXR project, we‚Äôll use CMake to create the solution and project files for Visual Studio.
First, create a directory where the code will go, we‚Äôll call this the <em>workspace</em> directory.</p>
</div>
<div class="linux docutils container" id="linux-id-1">
<p>You are free to use any code editor and/or compiler; this tutorial will use Visual Studio Code.
For the Linux OpenXR project, we‚Äôll use CMake alongside Visual Studio Code to build the project.
First, create a directory where the code will go, we‚Äôll call this the <em>workspace</em> directory. Open Visual Studio Code and from the File menu, select ‚ÄúOpen Folder‚Ä¶‚Äù</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/linux-vscode-open-folder.png"><img alt="The File menu of Visual Studio Code is shown, with the command &quot;Open Folder...&quot; selected." src="_images/linux-vscode-open-folder.png" style="width: 391.05px; height: 234.3px;" /></a>
</figure>
<p>Select your <em>workspace</em> folder, which is currently empty.</p>
<p>If you haven‚Äôt previously done so, install the CMake extension for Visual Studio Code.</p>
</div>
<div class="windows linux docutils container" id="windows-linux-id-1">
<p>Now, create a text file in the <em>workspace</em> folder called <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and in it, put the following code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.15</span><span class="p">)</span>

<span class="nb">project</span><span class="p">(</span><span class="s">openxr-tutorial</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CONFIGURATION_TYPES</span><span class="w"> </span><span class="s2">&quot;Debug;Release&quot;</span><span class="p">)</span>

<span class="c"># Optional selected runtime</span>
<span class="nb">set</span><span class="p">(</span><span class="s">XR_RUNTIME_JSON</span><span class="w"> </span><span class="s2">&quot;$ENV{XR_RUNTIME_JSON}&quot;</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">PATH</span><span class="w"> </span><span class="s2">&quot;Optional location of a specific OpenXR runtime configuration file.&quot;</span><span class="p">)</span>
<span class="w">	</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">tutorial</span><span class="p">)</span>
<span class="hll"><span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">Chapter2</span><span class="p">)</span>
</span><span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">Chapter3</span><span class="p">)</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">Chapter4</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we specify the CMake version, project name and the configurations types, which we limit to just Debug and Release.
You can use <code class="docutils literal notranslate"><span class="pre">XR_RUNTIME_JSON</span></code> to specify an optional runtime. The one provided by your hardware vendor will be automatically used, though this feature is helpful for debugging on different runtimes.
Finally, we specify CMake to continue the build into the Chapter2 directory with <code class="docutils literal notranslate"><span class="pre">add_subdirectory()</span></code>.</p>
<p>Let‚Äôs create that <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> folder, and in it create another <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.
This one contains the following code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.22.1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># For FetchContent_Declare() and FetchContent_MakeAvailable()</span>
<span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span>

<span class="c"># openxr_loader - From github.com/KhronosGroup</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_ALL_EXTENSIONS</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build loader and layers with all extensions&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build tests&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_CONFORMANCE_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build conformance tests&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_API_LAYERS</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Use OpenXR layers&quot;</span><span class="p">)</span>
<span class="nb">FetchContent_Declare</span><span class="p">(</span>
<span class="w">        </span><span class="s">OpenXR</span>
<span class="w">        </span><span class="s">URL_HASH</span><span class="w"> </span><span class="s">MD5=390455e9395a92d6b730afb8f23fac8e</span>
<span class="w">        </span><span class="s">URL</span><span class="w"> </span><span class="s">https://github.com/KhronosGroup/OpenXR-SDK-Source/archive/refs/tags/release-1.0.27.zip</span>
<span class="w">        </span><span class="s">SOURCE_DIR</span><span class="w"> </span><span class="s">openxr</span><span class="p">)</span>
<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">OpenXR</span><span class="p">)</span>
</pre></div>
</div>
<p>After setting our CMake version, we include <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> and use it to get the OpenXR-SDK from Khronos‚Äôs GitHub page.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># Files</span>
<span class="nb">set</span><span class="p">(</span><span class="s">SOURCES</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;main.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D11.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D12.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL_ES.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_Vulkan.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRDebugUtils.cpp&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">HEADERS</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;../Common/DebugOutput.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D11.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D12.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_Vulkan.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/HelperFunctions.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRDebugUtils.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRHelper.h&quot;</span><span class="w"> </span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here, we include all the files needed for our project. First, we‚Äôll create our source file called <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> in the <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> directory. All files with <code class="docutils literal notranslate"><span class="pre">../Common/*.*</span></code> are available to download from this tutorial website. Below are the links and discussion of their usage within this tutorial and with OpenXR.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="o">${</span><span class="nv">SOURCES</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">HEADERS</span><span class="o">}</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s2">&quot;${XR_RUNTIME_JSON}&quot;</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set_target_properties</span><span class="p">(</span><span class="w"> </span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">VS_DEBUGGER_ENVIRONMENT</span><span class="w"> </span><span class="s2">&quot;XR_RUNTIME_JSON=${XR_RUNTIME_JSON}&quot;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s2">&quot;../Common/&quot;</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">openxr_loader</span><span class="p">)</span>

<span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">WIN32</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;d3d11.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;d3d12.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;dxgi.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;d3dcompiler.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">Vulkan</span><span class="p">)</span>
<span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">Vulkan_FOUND</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">Vulkan_INCLUDE_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="o">${</span><span class="nv">Vulkan_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c"># Fix redirection to a different project&#39;s build folder</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span><span class="s">/../Chapter2/openxr/src/common</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">openxr-gfxwrapper</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we set up the project file by adding an executable with the <code class="docutils literal notranslate"><span class="pre">${SOURCES}</span></code> and <code class="docutils literal notranslate"><span class="pre">${HEADERS}</span></code>. Next, we optionally set a the <code class="docutils literal notranslate"><span class="pre">XR_RUNTIME_JSON</span></code> in the debugger environment. We add the <code class="docutils literal notranslate"><span class="pre">../Common</span></code> folder as an include directory and link <code class="docutils literal notranslate"><span class="pre">openxr_loader</span></code> from <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>. We don‚Äôt have to add OpenXR as a include directory; as we specified them to be located in the CMake Build directory under <code class="docutils literal notranslate"><span class="pre">openxr/</span></code> when using <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>, so we just include the OpenXR headers from the CMake Build directory.</p>
<p>Next, is the include directories and linkage for the graphics APIs.
For Microsoft Windows, we link <code class="docutils literal notranslate"><span class="pre">d3d11.lib</span></code>, <code class="docutils literal notranslate"><span class="pre">d3d12.lib</span></code>, <code class="docutils literal notranslate"><span class="pre">dxgi.lib</span></code> and <code class="docutils literal notranslate"><span class="pre">d3dcompiler.lib</span></code>, so that we can use Direct3D 11, Direct3D 12, the DirectX Graphics Infrastructure and the D3D Compiler. The headers are automatically included as part of the Visual Studio project.
If you have the Vulkan SDK installed, we try to find that package, add the include directories and link the Vulkan libraries.
As a default, we add gfxwrapper for OpenGL, we add the include directories and link the gfxwrapper libraries from the OpenXR-SDK.</p>
<p>That‚Äôs all we need for CMake, we need for this project.</p>
</div>
<div class="android docutils container" id="android-id-1">
<p>Here, We‚Äôll show how to hand build an Android Studio project that runs a C++ Native Activity.
Fisrt, we will create a <em>workspace</em> folder and in that folder create that <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> folder,
Open Android Studio, select New Project and choose an Empty Activity. Set the Name to ‚ÄòOpenXR Tutorial Chapter 2‚Äô, the Package name to ‚Äòcom.simul.OpenXRTutorialChapter2‚Äô and save location to that <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> folder. The language can be ignored here as we are using C++, and we can set the Minimum SDK to API 24: Android 7.0(Nougat). Complete the set up.</p>
<figure class="align-left">
<img alt="Android Studio - New Project - Empty Activity." src="_images/android-studio-newproject.png" />
</figure>
<p class="rubric">CMake</p>
<p>With the Android Studio project now set up, we need to modify some of the files and folders so as to set up the project to support the C++ Native Activity.
Under the <code class="docutils literal notranslate"><span class="pre">app</span></code> folder, you can delete the <code class="docutils literal notranslate"><span class="pre">libs</span></code> folder, and under the <code class="docutils literal notranslate"><span class="pre">app/src</span></code> you can also delete the <code class="docutils literal notranslate"><span class="pre">androidTest</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> folders. Finally under <code class="docutils literal notranslate"><span class="pre">app/src/main</span></code>, delete the <code class="docutils literal notranslate"><span class="pre">java</span></code> folder and add a <code class="docutils literal notranslate"><span class="pre">cpp</span></code> folder. Under the <code class="docutils literal notranslate"><span class="pre">app/src/main/res</span></code>, delete the <code class="docutils literal notranslate"><span class="pre">values-night</span></code> and <code class="docutils literal notranslate"><span class="pre">xml</span></code> folders. Under the <code class="docutils literal notranslate"><span class="pre">values</span></code> modify <code class="docutils literal notranslate"><span class="pre">colors.xml</span></code>.</p>
<p class="rubric">colors.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimary&quot;</span><span class="nt">&gt;</span>#008577<span class="nt">&lt;/color&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimaryDark&quot;</span><span class="nt">&gt;</span>#00574B<span class="nt">&lt;/color&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorAccent&quot;</span><span class="nt">&gt;</span>#D81B60<span class="nt">&lt;/color&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</pre></div>
</div>
<p>Delete <code class="docutils literal notranslate"><span class="pre">themes.xml</span></code> and add <code class="docutils literal notranslate"><span class="pre">styles.xml</span></code> as shown.</p>
<p class="rubric">styles.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;resources&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Base application theme. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;style</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AppTheme&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;Theme.AppCompat.Light.DarkActionBar&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Customize your theme here. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimary&quot;</span><span class="nt">&gt;</span>@color/colorPrimary<span class="nt">&lt;/item&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimaryDark&quot;</span><span class="nt">&gt;</span>@color/colorPrimaryDark<span class="nt">&lt;/item&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorAccent&quot;</span><span class="nt">&gt;</span>@color/colorAccent<span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;/resources&gt;</span>
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in the <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> directory for compatiblity with other platforms. We will use this file to specific how our Native C++ code will be built. This <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file will be invoked by Android Studio‚Äôs Gradle build system and we will point Gradle to this CMake file.</p>
<p class="rubric">CMakeLists.txt</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.22.1</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;OpenXRTutorialChapter2&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># Needed for Android</span>
</pre></div>
</div>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># For FetchContent_Declare() and FetchContent_MakeAvailable()</span>
<span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span>

<span class="c"># openxr_loader - From github.com/KhronosGroup</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_ALL_EXTENSIONS</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build loader and layers with all extensions&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build tests&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_CONFORMANCE_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build conformance tests&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_API_LAYERS</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Use OpenXR layers&quot;</span><span class="p">)</span>
<span class="nb">FetchContent_Declare</span><span class="p">(</span>
<span class="w">        </span><span class="s">OpenXR</span>
<span class="w">        </span><span class="s">URL_HASH</span><span class="w"> </span><span class="s">MD5=390455e9395a92d6b730afb8f23fac8e</span>
<span class="w">        </span><span class="s">URL</span><span class="w"> </span><span class="s">https://github.com/KhronosGroup/OpenXR-SDK-Source/archive/refs/tags/release-1.0.27.zip</span>
<span class="w">        </span><span class="s">SOURCE_DIR</span><span class="w"> </span><span class="s">openxr</span><span class="p">)</span>
<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">OpenXR</span><span class="p">)</span>
</pre></div>
</div>
<p>After setting our CMake version to 3.22.1 and the project‚Äôs name, we include <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> and use it to get the OpenXR-SDK from Khronos‚Äôs GitHub page.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># Files</span>
<span class="nb">set</span><span class="p">(</span><span class="s">SOURCES</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;main.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D11.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D12.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL_ES.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_Vulkan.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRDebugUtils.cpp&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">HEADERS</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;../Common/DebugOutput.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D11.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D12.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_Vulkan.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/HelperFunctions.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRDebugUtils.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRHelper.h&quot;</span><span class="w"> </span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here, we include all the files needed for our project. First, we‚Äôll create our source file called <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> in the <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> directory. All files with <code class="docutils literal notranslate"><span class="pre">../Common/*.*</span></code> are available to download from this tutorial website. Below are the links and discussion of their usage within this tutorial and with OpenXR.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_SHARED_LINKER_FLAGS</span><span class="w"> </span><span class="s2">&quot;${CMAKE_SHARED_LINKER_FLAGS} -u ANativeActivity_onCreate&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># export ANativeActivity_onCreate for java to call.</span>
<span class="nb">add_library</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">SHARED</span><span class="w"> </span><span class="o">${</span><span class="nv">SOURCES</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">HEADERS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s2">&quot;../Common/&quot;</span><span class="p">)</span>

<span class="c"># native_app_glue</span>
<span class="nb">include</span><span class="p">(</span><span class="s">AndroidNdkModules</span><span class="p">)</span>
<span class="nb">android_ndk_import_module_native_app_glue</span><span class="p">()</span>

<span class="c"># vulkan - Found in the NDK</span>
<span class="nb">find_library</span><span class="p">(</span><span class="s">vulkan-lib</span><span class="w"> </span><span class="s">vulkan</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">ANDROID_NDK</span><span class="o">}</span><span class="s">/sources/third_party/vulkan/src/include</span><span class="p">)</span>

<span class="c"># openxr-gfxwrapper - Manually build from OpenXR for OpenGL ES</span>
<span class="nb">add_library</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">STATIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/src/common/gfxwrapper_opengl.c</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/src/common/gfxwrapper_opengl.h</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/external/include</span><span class="p">)</span>
<span class="nb">find_library</span><span class="p">(</span><span class="s">GLES3-lib</span><span class="w"> </span><span class="s">GLESv3</span><span class="p">)</span>
<span class="nb">find_library</span><span class="p">(</span><span class="s">EGL-lib</span><span class="w"> </span><span class="s">EGL</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">GLES3-lib</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">EGL-lib</span><span class="o">}</span><span class="p">)</span>

<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/src/common</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/external/include</span><span class="p">)</span>

<span class="c"># Final link</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span>
<span class="w">        </span><span class="s">android</span>
<span class="w">        </span><span class="s">native_app_glue</span>
<span class="w">        </span><span class="s">openxr_loader</span>
<span class="w">        </span><span class="o">${</span><span class="nv">vulkan-lib</span><span class="o">}</span>
<span class="w">        </span><span class="s">openxr-gfxwrapper</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we can set things up by adding a shared library with the <code class="docutils literal notranslate"><span class="pre">${SOURCES}</span></code> and <code class="docutils literal notranslate"><span class="pre">${HEADERS}</span></code>. We add the <code class="docutils literal notranslate"><span class="pre">../Common</span></code> folder as an include directory too. Just above that we need to set the <code class="docutils literal notranslate"><span class="pre">CMAKE_SHARED_LINKER_FLAGS</span></code> so that <code class="docutils literal notranslate"><span class="pre">ANativeActivity_onCreate()</span></code> is exported for the Java Virtual Machine to call. This is used by a static library called <code class="docutils literal notranslate"><span class="pre">native_app_glue</span></code>, which allows us to interface between the Java Virtual Machine and our C++ code. Ultimately, it allows us to use the <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">android_main(struct</span> <span class="pre">android_app*)</span></code> entry point.  We add <code class="docutils literal notranslate"><span class="pre">native_app_glue</span></code> to our project by including <code class="docutils literal notranslate"><span class="pre">AndroidNdkModules</span></code> and calling <code class="docutils literal notranslate"><span class="pre">android_ndk_import_module_native_app_glue()</span></code>.</p>
<p>Next, we find the Vulkan library in the NDK and include the directory to the Android Vulkan headers. We also add a static library called <code class="docutils literal notranslate"><span class="pre">openxr-gfxwrapper</span></code>, which will allow us to use OpenGL ES. We compile the library the C and header file in <code class="docutils literal notranslate"><span class="pre">${openxr_SOURCE_DIR}/src/common/gfxwrapper_opengl.*</span></code> and add this <code class="docutils literal notranslate"><span class="pre">${openxr_SOURCE_DIR}/external/include</span></code> as an include directory. Next, we find the <code class="docutils literal notranslate"><span class="pre">GLESv3</span></code> and <code class="docutils literal notranslate"><span class="pre">EGL</span></code> libraries and link them to <code class="docutils literal notranslate"><span class="pre">openxr-gfxwrapper</span></code>. We add the <code class="docutils literal notranslate"><span class="pre">${openxr_SOURCE_DIR}/src/common</span></code> and <code class="docutils literal notranslate"><span class="pre">${openxr_SOURCE_DIR}/external/include</span></code> folder as include directories to <code class="docutils literal notranslate"><span class="pre">OpenXRTutorialChapter2</span></code> as well.</p>
<p>Finally we link the <code class="docutils literal notranslate"><span class="pre">android</span></code>, <code class="docutils literal notranslate"><span class="pre">native_app_glue</span></code>, <code class="docutils literal notranslate"><span class="pre">openxr_loader</span></code>, <code class="docutils literal notranslate"><span class="pre">vulkan</span></code> and <code class="docutils literal notranslate"><span class="pre">openxr-gfxwrapper</span></code> libraries to our <code class="docutils literal notranslate"><span class="pre">OpenXRTutorialChapter2</span></code> library. Our <code class="docutils literal notranslate"><span class="pre">libOpenXRTutorialChapter2</span> <span class="pre">.so</span></code> will packaged inside our .apk along with any shared libraries that we have linked.</p>
<p class="rubric">AndroidManifest.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<span class="w">    </span><span class="na">package=</span><span class="s">&quot;com.simul.OpenXRTutorialChapter2&quot;</span>
<span class="w">    </span><span class="na">android:versionCode=</span><span class="s">&quot;1&quot;</span>
<span class="w">    </span><span class="na">android:versionName=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;uses-feature</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.hardware.vr.headtracking&quot;</span><span class="w"> </span><span class="na">android:required=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:allowBackup=</span><span class="s">&quot;false&quot;</span>
<span class="w">        </span><span class="na">android:fullBackupContent=</span><span class="s">&quot;false&quot;</span>
<span class="w">        </span><span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
<span class="w">        </span><span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
<span class="w">        </span><span class="na">android:hasCode=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;activity</span>
<span class="w">            </span><span class="na">android:name=</span><span class="s">&quot;android.app.NativeActivity&quot;</span>
<span class="w">            </span><span class="na">android:configChanges=</span><span class="s">&quot;orientation|keyboardHidden&quot;</span>
<span class="w">            </span><span class="na">android:debuggable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;meta-data</span>
<span class="w">                </span><span class="na">android:name=</span><span class="s">&quot;android.app.lib_name&quot;</span>
<span class="w">                </span><span class="na">android:value=</span><span class="s">&quot;OpenXRTutorialChapter2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">            </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;com.oculus.intent.category.VR&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;org.khronos.openxr.intent.category.IMMERSIVE_HMD&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/activity&gt;</span>
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</div>
<p>We need to modify our <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> file to allow our application to use the XR hardware:</p>
<ul class="simple">
<li><p>First, we remove <code class="docutils literal notranslate"><span class="pre">xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span></code> and replace it  with <code class="docutils literal notranslate"><span class="pre">package=&quot;com.simul.OpenXRTutorialChapter2&quot;</span> <span class="pre">android:versionCode=&quot;1&quot;</span> <span class="pre">android:versionName=&quot;1.0&quot;</span></code>.</p></li>
<li><p>Next, we add <code class="docutils literal notranslate"><span class="pre">&lt;uses-feature</span> <span class="pre">android:name=&quot;android.hardware.vr.headtracking&quot;</span> <span class="pre">android:required=&quot;true&quot;</span> <span class="pre">/&gt;</span></code> to specify that the application is using VR headtracking.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">android</span></code> section, update <code class="docutils literal notranslate"><span class="pre">android:allowBackup</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;false&quot;</span></code>, remove <code class="docutils literal notranslate"><span class="pre">android:dataExtractionRules</span></code> and update <code class="docutils literal notranslate"><span class="pre">android:fullBackupContent</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;false&quot;</span></code>. Remove <code class="docutils literal notranslate"><span class="pre">android:supportsRtl</span></code>, <code class="docutils literal notranslate"><span class="pre">android:theme</span></code> and <code class="docutils literal notranslate"><span class="pre">tools:targetApi</span></code>, and replace them with <code class="docutils literal notranslate"><span class="pre">android:hasCode=&quot;false&quot;</span></code>. This one state that there is no Java or Kotlin code in the application.</p></li>
<li><p>We also need to modify this file to tell Android to run this application as a Native Activity. We set <code class="docutils literal notranslate"><span class="pre">android:name</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;android.app.NativeActivity&quot;</span></code> and update <code class="docutils literal notranslate"><span class="pre">android:configChanges</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;orientation|keyboardHidden&quot;</span></code> so as to not close the activity on those changes. Remove <code class="docutils literal notranslate"><span class="pre">android:exported=&quot;true&quot;</span></code> and add <code class="docutils literal notranslate"><span class="pre">android:debuggable=&quot;true&quot;</span></code> to allow debugging.</p></li>
<li><p>Next under the <code class="docutils literal notranslate"><span class="pre">meta-data</span></code> section, we add these values: <code class="docutils literal notranslate"><span class="pre">android:name=&quot;android.app.lib_name&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">android:value=&quot;OpenXRTutorialChapter2&quot;</span></code>, where <code class="docutils literal notranslate"><span class="pre">android:value</span></code> is name of the library we created in the CMakeLists, thus pointing our NativeActivity to the correct library.</p></li>
<li><p>Also, set this in the <code class="docutils literal notranslate"><span class="pre">intent-filer</span></code> section: <code class="docutils literal notranslate"><span class="pre">&lt;category</span> <span class="pre">android:name=&quot;android.intent.category.DEFAULT&quot;</span> <span class="pre">/&gt;</span></code>.</p></li>
<li><p>Finally, We need to tell the app that it should take over rendering when active, rather than appearing in a window. Set <code class="docutils literal notranslate"><span class="pre">&lt;category</span> <span class="pre">android:name=&quot;org.khronos.openxr.intent.category.IMMERSIVE_HMD&quot;</span> <span class="pre">/&gt;</span></code>. Note: not all devices yet support this <code class="docutils literal notranslate"><span class="pre">category</span></code>. For example, for Oculus Quest devices you will need <code class="docutils literal notranslate"><span class="pre">&lt;category</span> <span class="pre">android:name=&quot;com.oculus.intent.category.VR&quot;</span> <span class="pre">/&gt;</span></code> for the same purpose.</p></li>
</ul>
<p class="rubric">Gradle</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">apply</span><span class="w"> </span><span class="nl">plugin:</span><span class="w"> </span><span class="s1">&#39;com.android.application&#39;</span>

<span class="n">android</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">compileSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ndkVersion</span><span class="w"> </span><span class="s1">&#39;23.1.7779620&#39;</span>

<span class="w">    </span><span class="n">defaultConfig</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">applicationId</span><span class="w"> </span><span class="s2">&quot;com.simul.OpenXRTutorialChapter2&quot;</span>
<span class="w">        </span><span class="n">minSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="n">targetSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="n">versionCode</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">versionName</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">buildFeatures</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">prefab</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">buildTypes</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">release</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">minifyEnabled</span><span class="w"> </span><span class="kc">false</span>
<span class="w">            </span><span class="n">proguardFiles</span><span class="w"> </span><span class="n">getDefaultProguardFile</span><span class="o">(</span><span class="s1">&#39;proguard-android-optimize.txt&#39;</span><span class="o">),</span><span class="w"> </span><span class="s1">&#39;proguard-rules.pro&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="n">debug</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">jniDebuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">debuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">renderscriptDebuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">minifyEnabled</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">externalNativeBuild</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">cmake</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">version</span><span class="w"> </span><span class="s1">&#39;3.22.1&#39;</span>
<span class="w">            </span><span class="n">path</span><span class="w"> </span><span class="s1">&#39;../CMakeLists.txt&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span><span class="c1">// enable prefab support for the OpenXR AAR</span>
<span class="w">    </span><span class="c1">//buildFeatures {</span>
<span class="w">    </span><span class="c1">//    prefab true</span>
<span class="w">    </span><span class="c1">//}</span>
<span class="o">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="n">fileTree</span><span class="o">(</span><span class="nl">dir:</span><span class="w"> </span><span class="s1">&#39;libs&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">include:</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;*.jar&#39;</span><span class="o">])</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;androidx.appcompat:appcompat:1.0.2&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;org.khronos.openxr:openxr_loader_for_android:1.0.27&#39;</span>
<span class="w">    </span><span class="c1">//implementation files(&#39;../../thirdparty/openxr_loader_manifest_only-1.0.27.aar&#39;)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, we can config our <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file in the``app`` folder to remove any references to Java, Kotlin and to testing. We also want to specify the the we are doing a <code class="docutils literal notranslate"><span class="pre">externalNativeBuild</span></code>  with CMake, the CMake version and the location of the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> that we created earlier. We also specify the <code class="docutils literal notranslate"><span class="pre">ndkVersion</span></code>.</p>
<ul class="simple">
<li><p>First replace <code class="docutils literal notranslate"><span class="pre">plugins</span> <span class="pre">{...}</span></code> with <code class="docutils literal notranslate"><span class="pre">apply</span> <span class="pre">plugin:</span> <span class="pre">'com.android.application'</span></code>.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">android</span></code> section, remove the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> and <code class="docutils literal notranslate"><span class="pre">compileSdk</span></code> members and add <code class="docutils literal notranslate"><span class="pre">compileSdkVersion</span> <span class="pre">29</span></code> and <code class="docutils literal notranslate"><span class="pre">ndkVersion</span> <span class="pre">'23.1.7779620'</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">minSdk</span></code> with <code class="docutils literal notranslate"><span class="pre">minSdkVersion</span></code> and <code class="docutils literal notranslate"><span class="pre">targetSdk</span></code> with <code class="docutils literal notranslate"><span class="pre">targetSdkVersion</span></code>. We specify <code class="docutils literal notranslate"><span class="pre">29</span></code> for the version, but any value great than or equal to <code class="docutils literal notranslate"><span class="pre">24</span></code> will work.</p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">testInstrumentationRunner</span> <span class="pre">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span></code>.</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">android</span></code>, add <code class="docutils literal notranslate"><span class="pre">buildFeatures</span> <span class="pre">{</span> <span class="pre">prefab</span> <span class="pre">true</span> <span class="pre">}</span></code>. This allow any prefabs to be used in build.</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">buildTypes</span></code>, add <code class="docutils literal notranslate"><span class="pre">debug</span> <span class="pre">{</span> <span class="pre">jniDebuggable</span> <span class="pre">true</span> <span class="pre">debuggable</span> <span class="pre">true</span> <span class="pre">renderscriptDebuggable</span> <span class="pre">true</span> <span class="pre">minifyEnabled</span> <span class="pre">false</span> <span class="pre">}</span></code>. This allow us to debugging the code, and to debug the <code class="docutils literal notranslate"><span class="pre">JNI</span></code>.</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">android</span></code> again, add <code class="docutils literal notranslate"><span class="pre">externalNativeBuild</span> <span class="pre">{</span> <span class="pre">cmake</span> <span class="pre">{</span> <span class="pre">version</span> <span class="pre">'3.22.1'</span> <span class="pre">path</span> <span class="pre">'../CMakeLists.txt'</span> <span class="pre">}</span> <span class="pre">}</span></code>. This specifies that we want to do an external native build with CMake and further specifying the version and the path to our <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>, remove all <code class="docutils literal notranslate"><span class="pre">testImplementation</span></code> and <code class="docutils literal notranslate"><span class="pre">androidTestImplementation</span></code> entries, also remove <code class="docutils literal notranslate"><span class="pre">implementation</span> <span class="pre">'androidx.core:core-ktx:...'</span></code> and <code class="docutils literal notranslate"><span class="pre">implementation</span> <span class="pre">'com.google.android.material:material:...'</span></code> as we don‚Äôt need the Kotlin or Android materials. Add <code class="docutils literal notranslate"><span class="pre">implementation</span> <span class="pre">fileTree(dir:</span> <span class="pre">'libs',</span> <span class="pre">include:</span> <span class="pre">['*.jar'])</span></code> for any <code class="docutils literal notranslate"><span class="pre">*.jar</span></code> libraries.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">implementation</span> <span class="pre">'org.khronos.openxr:openxr_loader_for_android:1.0.27'</span></code> to access specifically the <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> file that includes the required uses-permissions, authorising the OpenXR runtime broker and states the intent to use the <code class="docutils literal notranslate"><span class="pre">OpenXRRuntimeService</span></code> and the <code class="docutils literal notranslate"><span class="pre">OpenXRApiLayerService</span></code>.</p></li>
</ul>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="c1">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
<span class="n">buildscript</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="o">{</span>
<span class="w">       </span><span class="n">google</span><span class="o">()</span>
<span class="w">       </span><span class="n">mavenCentral</span><span class="o">()</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">classpath</span><span class="w"> </span><span class="s1">&#39;com.android.tools.build:gradle:7.4.2&#39;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">allprojects</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">google</span><span class="o">()</span>
<span class="w">        </span><span class="n">mavenCentral</span><span class="o">()</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span><span class="w"> </span><span class="nf">clean</span><span class="o">(</span><span class="nl">type:</span><span class="w"> </span><span class="n">Delete</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">delete</span><span class="w"> </span><span class="n">rootProject</span><span class="o">.</span><span class="na">buildDir</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, we can config our <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file in the <code class="docutils literal notranslate"><span class="pre">/Chapter2</span></code> folder. This is a complete replacement the default one provided by Android Studio. This file stipulates the repositories and gradle version to be used.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">settings.gradle</span></code> can be reduce to just: <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">':app'</span></code>, and in the <code class="docutils literal notranslate"><span class="pre">gradle.properties</span></code> we need to remove <code class="docutils literal notranslate"><span class="pre">kotlin.code.style=official</span></code> and <code class="docutils literal notranslate"><span class="pre">android.nonTransitiveRClass=true</span></code> and their comments. Update <code class="docutils literal notranslate"><span class="pre">org.gradle.jvmargs</span></code> to <code class="docutils literal notranslate"><span class="pre">-Xmx1536m</span></code> and add <code class="docutils literal notranslate"><span class="pre">android.enableJetifier=false</span></code> to speed up builds.</p>
<p>With that completed, we should now be able to sync the Gradle file and build the project.</p>
</div>
</section>
<section id="common-files">
<h3>Common Files<a class="headerlink" href="#common-files" title="Permalink to this heading">¬∂</a></h3>
<p>Now, that we have set up the project and source file. We will create a few files in a <code class="docutils literal notranslate"><span class="pre">/Common</span></code> directory in the <em>workspace</em> folder. Below are all the files available to download:</p>
<section id="debugoutput">
<h4>DebugOutput<a class="headerlink" href="#debugoutput" title="Permalink to this heading">¬∂</a></h4>
<p><a class="reference download internal" download="" href="_downloads/a668d9f10e44c7f46a041356e11e3d9e/DebugOutput.h"><code class="xref download docutils literal notranslate"><span class="pre">DebugOutput.h</span></code></a></p>
<p><code class="docutils literal notranslate"><span class="pre">DebugOutput</span></code> is a class that redirects <code class="docutils literal notranslate"><span class="pre">std::cout</span></code> and <code class="docutils literal notranslate"><span class="pre">std::cerr</span></code> to the output window in your IDE.</p>
<div class="windows linux docutils container" id="id1">
<p><code class="docutils literal notranslate"><span class="pre">DebugOutput</span></code> inherites from <code class="docutils literal notranslate"><span class="pre">vsBufferedStringStreamBuf</span></code>, which inherites from <code class="docutils literal notranslate"><span class="pre">std::streambuf</span></code>. <code class="docutils literal notranslate"><span class="pre">vsBufferedStringStreamBuf</span></code> queues the data from the redirected <code class="docutils literal notranslate"><span class="pre">std::streambuf</span></code> and calls <code class="docutils literal notranslate"><span class="pre">virtual</span> <span class="pre">void</span> <span class="pre">writeString(const</span> <span class="pre">std::string</span> <span class="pre">&amp;)</span></code>, which <code class="docutils literal notranslate"><span class="pre">DebugOutput</span></code> inplements as a call to <code class="docutils literal notranslate"><span class="pre">OutputDebugStringA()</span></code>.</p>
</div>
<div class="android docutils container" id="id2">
<p><code class="docutils literal notranslate"><span class="pre">DebugOutput</span></code> inherites from <code class="docutils literal notranslate"><span class="pre">AndroidStreambuf</span></code>, which inherites from <code class="docutils literal notranslate"><span class="pre">std::streambuf</span></code>. <code class="docutils literal notranslate"><span class="pre">vsBufferedStringStreamBuf</span></code> queues the data from the redirected <code class="docutils literal notranslate"><span class="pre">std::streambuf</span></code> and calls <code class="docutils literal notranslate"><span class="pre">__android_log_write()</span></code> to log the message to Android Logcat.</p>
</div>
</section>
<section id="helperfunctions">
<h4>HelperFunctions<a class="headerlink" href="#helperfunctions" title="Permalink to this heading">¬∂</a></h4>
<p><a class="reference download internal" download="" href="_downloads/09fde4dd830aa0c1ae2771d8eff634c4/HelperFunctions.h"><code class="xref download docutils literal notranslate"><span class="pre">HelperFunctions.h</span></code></a></p>
<p>A simple header file for boilerplate code for the various platforms</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// C/C++ Headers</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
</pre></div>
</div>
<p>Includes for various C/C++ standard header.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Debugbreak</span>
<span class="cp">#if defined(_MSC_VER)</span>
<span class="cp">#define DEBUG_BREAK __debugbreak()</span>
<span class="cp">#else</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="cp">#define DEBUG_BREAK raise(SIGTRAP)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>This code above defines the macro <code class="docutils literal notranslate"><span class="pre">DEBUG_BREAK</span></code>, according to which platform we‚Äôre building for. This macro will stop execution of your program when an error occurs, so you can see where it happened and fix it. We use this macro in the <code class="docutils literal notranslate"><span class="pre">OpenXRMessageCallbackFunction()</span></code> function, which is discussed in detail in <a class="reference internal" href="5-extensions.html"><span class="doc">Chapter 5.2.</span></a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsStringInVector</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">item</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">found</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">checkValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">checkValue</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">checkValue</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifdef _MSC_VER</span>
<span class="cp">#define strncpy(dst, src, count) strcpy_s(dst, count, src);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">IsStringInVector()</span></code> and <code class="docutils literal notranslate"><span class="pre">BitwiseCheck()</span></code> are just simple wrappers over commonly used code.</p>
</section>
<section id="openxrdebugutils">
<h4>OpenXRDebugUtils<a class="headerlink" href="#openxrdebugutils" title="Permalink to this heading">¬∂</a></h4>
<p><a class="reference download internal" download="" href="_downloads/25292376df5afce45fe1df04d91fea9f/OpenXRDebugUtils.h"><code class="xref download docutils literal notranslate"><span class="pre">OpenXRDebugUtils.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/f206e1c8599e8788f3b84b60d65b3396/OpenXRDebugUtils.cpp"><code class="xref download docutils literal notranslate"><span class="pre">OpenXRDebugUtils.cpp</span></code></a></p>
<p>A header and cpp file pair helps in setting up the DebugUtilsMessenger. <code class="docutils literal notranslate"><span class="pre">XR_EXT_debug_utils</span></code> in an OpenXR instance extension that can intercept call made to OpenXR and provide extra information or report warning and errors, if the usage of the API or the current state of OpenXR is not valid. As you go through this tutorial it is highly recommended to have this enable to help with debugging. This is discussed in detail in <a class="reference internal" href="5-extensions.html"><span class="doc">Chapter 5.2.</span></a>, but in general <code class="docutils literal notranslate"><span class="pre">CreateOpenXRDebugUtilsMessenger()</span></code> creates and <code class="docutils literal notranslate"><span class="pre">DestroyOpenXRDebugUtilsMessenger()</span></code> destroys an <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerEXT</span></code>. <code class="docutils literal notranslate"><span class="pre">OpenXRMessageCallbackFunction()</span></code> is a called function specified at object creation, which is used to call when OpenXR raises an issue.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HelperFunctions.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;OpenXRHelper.h&quot;</span>

<span class="n">XrBool32</span><span class="w"> </span><span class="nf">OpenXRMessageCallbackFunction</span><span class="p">(</span><span class="n">XrDebugUtilsMessageSeverityFlagsEXT</span><span class="w"> </span><span class="n">messageSeverity</span><span class="p">,</span><span class="w"> </span><span class="n">XrDebugUtilsMessageTypeFlagsEXT</span><span class="w"> </span><span class="n">messageType</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XrDebugUtilsMessengerCallbackDataEXT</span><span class="w"> </span><span class="o">*</span><span class="n">pCallbackData</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">pUserData</span><span class="p">);</span>

<span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="nf">CreateOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">DestroyOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">debugUtilsMessenger</span><span class="p">);</span>
</pre></div>
</div>
<p>The header declares the functions and the cpp defines them.</p>
</section>
<section id="openxrhelper">
<h4>OpenXRHelper<a class="headerlink" href="#openxrhelper" title="Permalink to this heading">¬∂</a></h4>
<p><a class="reference download internal" download="" href="_downloads/07ed85d64fa8eeb958885d2b14115e3f/OpenXRHelper.h"><code class="xref download docutils literal notranslate"><span class="pre">OpenXRHelper.h</span></code></a></p>
<p>A header for including all the neeeded header files and helper functions.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define any XR_USE_PLATFORM_... / XR_USE_GRAPHICS_API_... before this header file.</span>

<span class="c1">// OpenXR Headers</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;openxr/openxr.h&quot;</span>
<span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;openxr/openxr_platform.h&quot;</span>
</span></pre></div>
</div>
<p>Here, we include the main OpenXR header file <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code> and the OpenXR platform header file <code class="docutils literal notranslate"><span class="pre">openxr_platform.h</span></code>.
For the OpenXR platform header file, note the comment about using the preceding <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_...</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macros. When enabled, we gain access to functionality that interact with the chosen graphics API and/or platform. These macros are automatically set by <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OpenXRDebugBreak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Breakpoint here to debug.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">GetXRErrorString</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrResult</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">string</span><span class="p">[</span><span class="n">XR_MAX_RESULT_STRING_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">xrResultToString</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define OPENXR_CHECK(x, y)                                                                                                                                  \</span>
<span class="cp">    {                                                                                                                                                       \</span>
<span class="cp">        XrResult result = (x);                                                                                                                              \</span>
<span class="cp">        if (!XR_SUCCEEDED(result)) {                                                                                                                        \</span>
<span class="cp">            std::cerr &lt;&lt; &quot;ERROR: OPENXR: &quot; &lt;&lt; int(result) &lt;&lt; &quot;(&quot; &lt;&lt; (m_xrInstance ? GetXRErrorString(m_xrInstance, result) : &quot;&quot;) &lt;&lt; &quot;) &quot; &lt;&lt; y &lt;&lt; std::endl; \</span>
<span class="cp">            OpenXRDebugBreak();                                                                                                                             \</span>
<span class="cp">        }                                                                                                                                                   \</span>
<span class="cp">    }</span>
</pre></div>
</div>
<p>This defines the macro <code class="docutils literal notranslate"><span class="pre">OPENXR_CHECK</span></code>. Many OpenXR functions return a <code class="docutils literal notranslate"><span class="pre">XrResult</span></code>. This macro will check if the call has failed and logs a message to <code class="docutils literal notranslate"><span class="pre">std::cerr</span></code>. This can be modified to suit your needs. There are two additional functions <code class="docutils literal notranslate"><span class="pre">GetXRErrorString()</span></code> and <code class="docutils literal notranslate"><span class="pre">OpenXRDebugBreak()</span></code>, which are used to convert the <code class="docutils literal notranslate"><span class="pre">XrResult</span></code> to a string and as a breakpoint function respectively.</p>
</section>
<section id="graphicsapi">
<h4>GraphicsAPI<a class="headerlink" href="#graphicsapi" title="Permalink to this heading">¬∂</a></h4>
<p>This tutorial uses polymorphic classes; <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> derives from the base <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class. The drived class is based on your graphics API selection. Include both the header and cpp files for both <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> and <code class="docutils literal notranslate"><span class="pre">GraphicsAPI...</span></code>. <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code> includes the headers and macros needed to set up your platform and grapchis API.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HelperFunctions.h&quot;</span>

<span class="c1">// Platform headers</span>
<span class="cp">#if defined(_WIN32)</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Windows.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;unknwn.h&quot;</span>
<span class="cp">#define XR_USE_PLATFORM_WIN32</span>

<span class="cp">#define XR_USE_GRAPHICS_API_D3D11</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D12</span>
<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(__LINIX__)</span>
<span class="cp">#define XR_USE_PLATFORM_XLIB</span>
<span class="cp">#define XR_USE_PLATFORM_XCB</span>
<span class="cp">#define XR_USE_PLATFORM_WAYLAND</span>

<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(__ANDROID__)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;android_native_app_glue.h&quot;</span>
<span class="cp">#define XR_USE_PLATFORM_ANDROID</span>

<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL_ES</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>

<span class="c1">// Graphic APIs headers</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D11)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;d3d11.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;d3dcompiler.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D12)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;d3d12.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dxgi1_6.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;d3dcompiler.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL)</span>
<span class="c1">// gfxwrapper will redefine these macros</span>
<span class="cp">#undef XR_USE_PLATFORM_WIN32</span>
<span class="cp">#undef XR_USE_PLATFORM_XLIB</span>
<span class="cp">#undef XR_USE_PLATFORM_XCB</span>
<span class="cp">#undef XR_USE_PLATFORM_WAYLAND</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gfxwrapper_opengl.h&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL_ES)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gfxwrapper_opengl.h&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(XR_USE_GRAPHICS_API_VULKAN)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vulkan/vulkan.h&quot;</span>
<span class="cp">#endif</span>

<span class="c1">// OpenXR</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;OpenXRHelper.h&quot;</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="_downloads/ee7900b1ff1ef2d947bd578e417c62db/GraphicsAPI.h"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/c4b96771e22873e9c1d09d729dea1bd2/GraphicsAPI.cpp"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI.cpp</span></code></a></p>
<div class="d3d11 docutils container" id="d3d11-id-1">
<p class="rubric">DirectX 11</p>
<p><a class="reference download internal" download="" href="_downloads/bda9ce781466ec0c60e8787d9185fe07/GraphicsAPI_D3D11.h"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_D3D11.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/f8f459fcb383e571f9e8ec353b26ac2c/GraphicsAPI_D3D11.cpp"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_D3D11.cpp</span></code></a></p>
</div>
<div class="d3d12 docutils container" id="d3d12-id-1">
<p class="rubric">DirectX 12</p>
<p><a class="reference download internal" download="" href="_downloads/3842d2de6eb1b2797b794ec09fd778aa/GraphicsAPI_D3D12.h"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_D3D12.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/e083cc61d81b06c1405b149812da5240/GraphicsAPI_D3D12.cpp"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_D3D12.cpp</span></code></a></p>
</div>
<div class="opengl docutils container" id="opengl-id-1">
<p class="rubric">OpenGL</p>
<p><a class="reference download internal" download="" href="_downloads/6ecf914e43c32a3fbf68265b4c70d1b6/GraphicsAPI_OpenGL.h"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_OpenGL.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/4ab2a28ab4cc788086acc7ac599bcbe3/GraphicsAPI_OpenGL.cpp"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_OpenGL.cpp</span></code></a></p>
</div>
<div class="opengles docutils container" id="opengles-id-1">
<p class="rubric">OpenGL ES</p>
<p><a class="reference download internal" download="" href="_downloads/18dfa0ecf88e53b145e4bf884b70ce69/GraphicsAPI_OpenGL_ES.h"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_OpenGL_ES.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/15d84956ee41d048b0020d480a776d56/GraphicsAPI_OpenGL_ES.cpp"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_OpenGL_ES.cpp</span></code></a></p>
</div>
<div class="vulkan docutils container" id="vulkan-id-1">
<p class="rubric">Vulkan</p>
<p><a class="reference download internal" download="" href="_downloads/7e1287eebafcf47fda72c8aaf562283d/GraphicsAPI_Vulkan.h"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_Vulkan.h</span></code></a></p>
<p><a class="reference download internal" download="" href="_downloads/ac69bef9a1770690c3db93d34147b297/GraphicsAPI_Vulkan.cpp"><code class="xref download docutils literal notranslate"><span class="pre">GraphicsAPI_Vulkan.cpp</span></code></a></p>
</div>
</section>
</section>
<section id="openxrtutorial-and-main">
<h3>OpenXRTutorial and Main<a class="headerlink" href="#openxrtutorial-and-main" title="Permalink to this heading">¬∂</a></h3>
<p>We can now start adding code to our <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> file. First, we add <code class="docutils literal notranslate"><span class="pre">DebugOutput.h</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DebugOutput.h&quot;</span>
</pre></div>
</div>
<p>Next, we add the <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_....h</span></code> header to include the Graphics API code of your chosen graphics API. This will in turn include <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code>, <code class="docutils literal notranslate"><span class="pre">HelperFunctions.h</span></code>  and <code class="docutils literal notranslate"><span class="pre">OpenXRHelper.h</span></code>. In this tutorial, we include all of them, though you would only be picking one.</p>
<div class="d3d11 docutils container" id="id3">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D11.h&quot;</span>
</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D12.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_Vulkan.h&quot;</span>
</pre></div>
</div>
</div>
<div class="d3d12 docutils container" id="id4">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D11.h&quot;</span>
<span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D12.h&quot;</span>
</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_Vulkan.h&quot;</span>
</pre></div>
</div>
</div>
<div class="opengl docutils container" id="id5">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D11.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D12.h&quot;</span>
<span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL.h&quot;</span>
</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_Vulkan.h&quot;</span>
</pre></div>
</div>
</div>
<div class="opengles docutils container" id="id6">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D11.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D12.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL.h&quot;</span>
<span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL_ES.h&quot;</span>
</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_Vulkan.h&quot;</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container" id="id7">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D11.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_D3D12.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GraphicsAPI_Vulkan.h&quot;</span>
</span></pre></div>
</div>
</div>
<p>You can also include <code class="docutils literal notranslate"><span class="pre">OpenXRDebugUtils.h</span></code> to help with set up of <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerEXT</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;OpenXRDebugUtils.h&quot;</span>
</pre></div>
</div>
<p>Now we will define the main class <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> of the application. It‚Äôs just a stub for now, with an empty <code class="docutils literal notranslate"><span class="pre">Run()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">         </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">         </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Finally, let‚Äôs add the main function for the application. It will look slightly different, depending on your
chosen platform. We first create a ‚Äòpseudo-main function‚Äô called <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Main()</span></code>, in which we create an instance of our <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class, taking a <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_Type</span></code> parameter, and call the <code class="docutils literal notranslate"><span class="pre">Run()``method.</span> <span class="pre">``GraphicsAPI_Type</span></code> can be changed to suit the graphics API that you have chosen.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">OpenXRTutorial_Main</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DebugOutput</span><span class="w"> </span><span class="n">debugOutput</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="n">OpenXRTutorial</span><span class="w"> </span><span class="n">app</span><span class="p">(</span><span class="n">apiType</span><span class="p">);</span>
<span class="w">    </span><span class="n">app</span><span class="p">.</span><span class="n">Run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, we create the actual platform specific main function (our entry point to the application), which will call <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Main()</span></code> with our <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_Type</span></code> parameter:</p>
<div class="windows linux docutils container" id="id8">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OpenXRTutorial_Main</span><span class="p">(</span><span class="n">OPENGL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="android docutils container" id="id9">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">OpenXRTutorial</span><span class="o">::</span><span class="n">androidApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">OpenXRTutorial</span><span class="o">::</span><span class="n">AndroidAppState</span><span class="w"> </span><span class="n">OpenXRTutorial</span><span class="o">::</span><span class="n">androidAppState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">android_main</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Allow interaction with JNI and the JVM on this thread.</span>
<span class="w">    </span><span class="c1">// https://developer.android.com/training/articles/perf-jni#threads</span>
<span class="w">    </span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">;</span>
<span class="w">    </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">vm</span><span class="o">-&gt;</span><span class="n">AttachCurrentThread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_NULL_HANDLE</span><span class="p">;</span><span class="w">  </span><span class="c1">// Dummy XrInstance variable for OPENXR_CHECK macro.</span>
<span class="w">    </span><span class="n">PFN_xrInitializeLoaderKHR</span><span class="w"> </span><span class="n">xrInitializeLoaderKHR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">XR_NULL_HANDLE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrInitializeLoaderKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrInitializeLoaderKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">xrInitializeLoaderKHR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">XrLoaderInitInfoAndroidKHR</span><span class="w"> </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">{</span><span class="n">XR_TYPE_LOADER_INIT_INFO_ANDROID_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">applicationVM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">vm</span><span class="p">;</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">clazz</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrInitializeLoaderKHR</span><span class="p">((</span><span class="n">XrLoaderInitInfoBaseHeaderKHR</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">loaderInitializeInfoAndroid</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to initialise Loader for Android.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">OpenXRTutorial</span><span class="o">::</span><span class="n">androidAppState</span><span class="p">;</span>
<span class="w">    </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">onAppCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OpenXRTutorial</span><span class="o">::</span><span class="n">AndroidAppHandleCmd</span><span class="p">;</span>

<span class="w">    </span><span class="n">OpenXRTutorial</span><span class="o">::</span><span class="n">androidApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">;</span>
<span class="w">    </span><span class="n">OpenXRTutorial_Main</span><span class="p">(</span><span class="n">OPENGL_ES</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Android requires a few extra additions to the class. Namely, <code class="docutils literal notranslate"><span class="pre">android_app</span> <span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">AndroidAppState</span></code> and <code class="docutils literal notranslate"><span class="pre">AndroidAppHandleCmd</span></code>, which are used in getting updates from the Android Operating System and keep our application functioning.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">androidApp</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Modified from https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/d6b6d7a10bdcf8d4fe806b4f415fde3dd5726878/src/tests/hello_xr/main.cpp#L133C1-L189C2</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">AndroidAppState</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANativeWindow</span><span class="w"> </span><span class="o">*</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">resumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">AndroidAppState</span><span class="w"> </span><span class="n">androidAppState</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Process the next main command.</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AndroidAppHandleCmd</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AndroidAppState</span><span class="w"> </span><span class="o">*</span><span class="n">appState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AndroidAppState</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">app</span><span class="o">-&gt;</span><span class="n">userData</span><span class="p">;</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// There is no APP_CMD_CREATE. The ANativeActivity creates the application thread from onCreate().</span>
<span class="w">        </span><span class="c1">// The application thread then calls android_main().</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_START</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_RESUME</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">resumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_PAUSE</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">resumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_STOP</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_DESTROY</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_INIT_WINDOW</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_TERM_WINDOW</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">PollSystemEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">destroyRequested</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">struct</span><span class="w"> </span><span class="nc">android_poll_source</span><span class="w"> </span><span class="o">*</span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timeoutMilliseconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">androidAppState</span><span class="p">.</span><span class="n">resumed</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">destroyRequested</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ALooper_pollAll</span><span class="p">(</span><span class="n">timeoutMilliseconds</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">source</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">source</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">androidApp</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Before we can use OpenXR for Android, we need to initialise the loader based the application‚Äôs context and virtual machine. We retrieve the function pointer to <code class="docutils literal notranslate"><span class="pre">xrInitializeLoaderKHR</span></code>, and with the <code class="docutils literal notranslate"><span class="pre">XrLoaderInitInfoAndroidKHR</span></code> filled out call that function to initialise OpenXR for our use. At this point, we also attach the current thread to the Java Virtual Machine. We assign our <code class="docutils literal notranslate"><span class="pre">AndroidAppState</span></code> static member and our <code class="docutils literal notranslate"><span class="pre">AndroidAppHandleCmd()</span></code> static method to the <code class="docutils literal notranslate"><span class="pre">android_app</span> <span class="pre">*</span></code> and save it to a static member in the class.</p>
</div>
</section>
<section id="build-and-run">
<h3>Build and Run<a class="headerlink" href="#build-and-run" title="Permalink to this heading">¬∂</a></h3>
<div class="windows docutils container" id="id10">
<p>Now launch CMake GUI, and point the ‚ÄúWhere is the source code‚Äù box to the root of your solution <em>workspace</em> directory,
where your original <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> is located. Point the ‚ÄúWhere to build the binaries‚Äù box to a subdirectory called <code class="docutils literal notranslate"><span class="pre">build</span></code>,
click Configure, ‚ÄúYes‚Äù to create the build folder, and ‚ÄúOK‚Äù to accept the default Generator.</p>
<p>You can now build and run your program. It should compile and link with no errors or warnings.</p>
</div>
<div class="linux docutils container" id="id11">
<p>You now have the files and folders, laid out as follows:</p>
<figure class="align-default">
<img alt="Initial files in VS Code" src="_images/linux-vscode-initial-files.png" />
</figure>
<p>Having installed the CMake extension for Visual Studio Code, you can now right-click on the main <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file (the one in the root <em>workspace</em> folder). We can select ‚ÄúConfigure and Build All‚Äù from the right-click menu of the main <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
<figure class="align-default">
<img alt="Select" src="_images/linux-vscode-cmake-configure.png" />
</figure>
<p>To enable debugging, select the Run/Debug panel in Visual Studio Code. You will now need to create a debugging configuration.
Click the ‚ÄúGear‚Äù icon to edit the file launch.json, and enter the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cppdbg&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chapter2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}/build/Chapter2/Chapter2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="s2">&quot;${workspaceFolder}/Chapter2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;externalConsole&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="android docutils container" id="id12">
<p>With all the source and build systems set up, we can now build the Android project. In upper right of Android Studio, you should find the toolbar below. Click the green hammer icon to build the project, if all is successful you should see ‚ÄúBUILD SUCCESSFUL in [‚Ä¶]s‚Äù in the Build Output window.
It is also recommended to sync the gradle files too.</p>
<p>Next to the green hammer icon is the Run/Debug configuration dropdown menu. If that isn‚Äôt populated, create a configuration called app.</p>
<p>Turn on and connect your Android device. Set up any requirments for USB debugging and adb. You device should appear in the dropdown. Here, I am using a Oculus Quest 2.</p>
<figure class="align-default">
<img alt="Build/Run Toolbar" src="_images/android-studio-build-run-toolbar.png" />
</figure>
<p>To debug/run the application click the green bug icon.</p>
</div>
<p>Now that we have a basic application up and running with the OpenXR header files and libraries, we can start to set up the core aspects of OpenXR. As a modern Khronos API, the OpenXR is heavily influcencd by the Vulkan API. So those who are familiar with the style of the Vulkan API will find OpenXR easy to follow.</p>
</section>
</section>
<section id="creating-an-xrinstance-xrgetsystem">
<h2>2.1 Creating an XrInstance / xrGetSystem<a class="headerlink" href="#creating-an-xrinstance-xrgetsystem" title="Permalink to this heading">¬∂</a></h2>
<p>Firstly, add to the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class the methods: <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetSystemID()</span></code> and <code class="docutils literal notranslate"><span class="pre">DestroyInstance()</span></code>. Update <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> to call those methods in that order and add to the class in a private section the following members.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="xrinstance">
<h3>2.1.1 XrInstance<a class="headerlink" href="#xrinstance" title="Permalink to this heading">¬∂</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> is the foundational object that we need to create first. The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> encompasses the application setup state, OpenXR API version and any layers and extensions. So inside the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, we will first look at the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrApplicationInfo</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">applicationName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_APPLICATION_NAME_SIZE</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">engineName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_ENGINE_NAME_SIZE</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">AI</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_CURRENT_API_VERSION</span><span class="p">;</span>
</pre></div>
</div>
<p>This structure allows you specify both the name and the version for your application and engine. These members are solely for your use as the application developer. The main member here is the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::apiVersion</span></code>. Here we use the <code class="docutils literal notranslate"><span class="pre">XR_CURRENT_API_VERSION</span></code> macro to specific the OpenXR version that we want to run. Also note here the use of <code class="docutils literal notranslate"><span class="pre">strncpy()</span></code> to set the applicationName and engineName. If you look at <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::applicationName</span></code> and <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::engineName</span></code> members, they are of type <code class="docutils literal notranslate"><span class="pre">char[]</span></code>, hence you must copy your string into that <code class="docutils literal notranslate"><span class="pre">char[]</span></code> and you must also by aware of the allowable length.</p>
<p>Similar to Vulkan, OpenXR allows applications to extend functionality past what is provided by the core specification. The functionality could be hardware/vendor specific. Most vital of course is which Graphics API to use with OpenXR. OpenXR supports D3D11, D3D12, Vulkan, OpenGL and OpenGL ES. Due the extensible nature of specification, it allows newer Graphics APIs and hardware functionality to be added with ease.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">);</span>
<span class="n">m_instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">GetGraphicsAPIInstanceExtensionString</span><span class="p">(</span><span class="n">m_apiType</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, we store in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code> the extension names that we would like to use. <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> is a macro of a string defined in <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code>. The XR_EXT_debug_utils is extension that checks the validity of calls made to OpenXR, and can use a call back function to handle any raised errors. We will explore this extension more in <a class="reference internal" href="5-extensions.html"><span class="doc">Chapter 5.2.</span></a> Depending on which <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macro that you have defined, this code will add the relevant extension.</p>
<p>Not all API layers and extensions are available to use, so we much check which ones can use. We will use <code class="docutils literal notranslate"><span class="pre">xrEnumerateApiLayerProperties()</span></code> and <code class="docutils literal notranslate"><span class="pre">xrEnumerateInstanceExtensionProperties()</span></code> to check which ones the runtime can provide.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">apiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrApiLayerProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_API_LAYER_PROPERTIES</span><span class="p">});</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestLayer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">layerProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">layerProperty</span><span class="p">.</span><span class="n">layerName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="n">extensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_EXTENSION_PROPERTIES</span><span class="p">});</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These functions are called twice. The first time is to get the count of the API layers or extensions and the second is to fill out the array of structures. Before the second call, we need set <code class="docutils literal notranslate"><span class="pre">XrApiLayerProperties::type</span></code> or <code class="docutils literal notranslate"><span class="pre">XrExtensionProperties::type</span></code> to the correct value, so that the second call can correctly fill out the data. After we have enumerated the API layers and extensions, we use a nested loop to check to see whether an API layers or extensions is availble and add it to the activeAPILayers and/or activeInstanceExtensions respectively. Note the activeAPILayers and activeInstanceExtensions are of type <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code>. This will help us when fill out the next structure <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_CREATE_INFO</span><span class="p">};</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">applicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This section is fairly simple, as we now just collect data from before and assign them to members in the <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> structure. Finally, we get to call <code class="docutils literal notranslate"><span class="pre">xrCreateInstance()</span></code> where we take pointers to the stack <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> objects. If the function succeeded, the result will be <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> will be non-null.</p>
<p>At the end of the application, we should destroy the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>. This is simple done with the function <code class="docutils literal notranslate"><span class="pre">xrDestroyInstance()</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">DestroyInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroyInstance</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Instance.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Whilst we have an <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, let‚Äôs check its properties. We fill out the type and next members of the structure <code class="docutils literal notranslate"><span class="pre">XrInstanceProperties</span></code> and pass it along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetInstanceProperties()</span></code>. This function will fill out the rest of that structure for us to use. Here, we simply log to stdout the runtime‚Äôs name, and with the use of the <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MAJOR</span></code>, <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MINOR</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_VERSION_PATCH</span></code> macros, we parse and log the runtime version.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GetInstanceProperties</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrInstanceProperties</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_PROPERTIES</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProperties</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProperties.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Runtime: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_PATCH</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="xrsystemid">
<h3>2.1.2 XrSystemId<a class="headerlink" href="#xrsystemid" title="Permalink to this heading">¬∂</a></h3>
<p>The next object that we want to get is the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>. OpenXR ‚Äòseparates the concept of physical systems of XR devices from the logical objects that applications interact with directly. A system represents a collection of related devices in the runtime, often made up of several individual hardware components working together to enable XR experiences‚Äô.
<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#system">OpenXR Specification 5. System</a>.</p>
<p>So, a <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> could represent VR headset and a pair of contollers, or perhaps mobile device with video pass-through for AR. So we need to decide what type of <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code> we are wanting to use, as some runtimes support multiple form factors. Here, we are selecting <code class="docutils literal notranslate"><span class="pre">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span></code>, which is initialised in the class, for a Meta Quest or Pico Neo. OpenXR currently offers two option for the <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrFormFactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HANDHELD_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrFormFactor</span><span class="p">;</span>
</pre></div>
</div>
<p>We fill out the <code class="docutils literal notranslate"><span class="pre">XrSystemGetInfo</span></code> structure as desired and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and a pointer to the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetSystem()</span></code>. If successful, we should now have a non-null <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GetSystemID</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrSystemGetInfo</span><span class="w"> </span><span class="n">systemGI</span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_GET_INFO</span><span class="p">};</span>
<span class="w">    </span><span class="n">systemGI</span><span class="p">.</span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_formFactor</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystem</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemGI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_systemID</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemID.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrSystemProperties</span><span class="w"> </span><span class="n">systemProperties</span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_PROPERTIES</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystemProperties</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemProperties.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now also get the system‚Äôs properties. We partially fill out a <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetSystemProperties()</span></code>. This function will fill out the rest of the <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure; detailing the vendor‚Äôs ID, system‚Äôs name and the system‚Äôs graphics and tracking properties.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemGraphicsProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageHeight</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxLayerCount</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemGraphicsProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemTrackingProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">orientationTracking</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">positionTracking</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemTrackingProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">               </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">            </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemId</span><span class="w">                    </span><span class="n">systemId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">                      </span><span class="n">vendorId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w">                          </span><span class="n">systemName</span><span class="p">[</span><span class="n">XR_MAX_SYSTEM_NAME_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XrSystemGraphicsProperties</span><span class="w">    </span><span class="n">graphicsProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemTrackingProperties</span><span class="w">    </span><span class="n">trackingProperties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemProperties</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-an-xrsession">
<h2>2.2 Creating an XrSession<a class="headerlink" href="#creating-an-xrsession" title="Permalink to this heading">¬∂</a></h2>
<p>The next major component of OpenXR that needs to be created in an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. An <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> encapulates the state of application from the perspective of OpenXR. When an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> is created, it starts in the <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_IDLE</span></code>. It is upto the runtime to provide any updates to the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> and for the appliaction to query them and react to them. We will explore this in <span class="xref std std-doc">Chapter 2.3.</span></p>
<p>For now, we are just going to create an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. At this point, you‚Äôll need to select which Graphics API you wish to use. Only one Graphics API can be used with an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. This tutorial demostrates how to use D3D11, D3D12, OpenGL, OpenGL ES and Vulkan in conjunction with OpenXR for the purpose of rendering graphics to the provided views. Ultimately, you will most likely be bringing your own rendering solution to this tutorial, therefore the code examples provided for the Graphics APIs are <cite>placeholders</cite> for you own code base; demostrating in this sub-chapter what objects are needed from your Graphics API in order to create an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. This tutorial uses polymorphic classes; <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> derives from the base <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class. There are both compile and runtime checks to select the requested Graphics API, and we construct an apropriate derived classes throught the use of <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;&gt;</span></code>.</p>
<p>Update the Constructor and <code class="docutils literal notranslate"><span class="pre">Run()</span></code> method as shown and add the following members:
<code class="docutils literal notranslate"><span class="pre">CheckGraphicsAPI_TypeIsValidForPlatform()</span></code> is declared in <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">api</span><span class="p">)</span>
<span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">apiType</span><span class="p">(</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CheckGraphicsAPI_TypeIsValidForPlatform</span><span class="p">(</span><span class="n">apiType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: The provided Graphics API is not valid for this platform.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// [...]</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GraphicsAPI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>

<span class="w">        </span><span class="n">XrSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="xrsession">
<h3>2.2.1 XrSession<a class="headerlink" href="#xrsession" title="Permalink to this heading">¬∂</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateSession</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrSessionCreateInfo</span><span class="w"> </span><span class="n">sessionCI</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_CREATE_INFO</span><span class="p">};</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D11)</span>
<span class="w">            </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D12)</span>
<span class="w">            </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL)</span>
<span class="w">            </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL_ES</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL_ES)</span>
<span class="w">            </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">VULKAN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_VULKAN)</span>
<span class="w">            </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_Vulkan</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Unknown Graphics API.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sessionCI</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetGraphicsBinding</span><span class="p">();</span>
<span class="w">        </span><span class="n">sessionCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">sessionCI</span><span class="p">.</span><span class="n">systemId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">;</span>

<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSession</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DestroySession</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroySession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Above is the code for creating and destroying an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. <code class="docutils literal notranslate"><span class="pre">xrDestroySession()</span></code> will destroy the <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> when we have finished and shutting down the application. <code class="docutils literal notranslate"><span class="pre">xrCreateSession()</span></code> takes the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> return object. If the function call was successful, <code class="docutils literal notranslate"><span class="pre">xrCreateSession()</span></code> will return <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> will be non-null. The <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo</span></code> structure is deceptively simple. <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::createFlags</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::systemId</span></code> are easily filled in, but we need to specify which Graphics APIs we wish to use. This is achieved via the use of the <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code> void pointer. Following the Vulkan API‚Äôs style of extensibility, structures for creating objects can be extended to enable extra functionality. In our case, the extension is required and thus <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code> can not be a nullptr. That pointer must point to ‚Äòexactly one graphics API binding structure (a structure whose name begins with ‚ÄúXrGraphicsBinding‚Äù)‚Äô (<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo(3) Manual Page</a>).</p>
</section>
<section id="id13">
<h3>2.2.2 GraphicsAPI<a class="headerlink" href="#id13" title="Permalink to this heading">¬∂</a></h3>
<div class="d3d11 docutils container" id="id14">
<p class="rubric">DirectX 11</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D11</span><span class="o">::</span><span class="n">GraphicsAPI_D3D11</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D11GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D11.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory1</span><span class="p">(</span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">D3D11CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">D3D_DRIVER_TYPE_UNKNOWN</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_CREATE_DEVICE_DEBUG</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_SDK_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">immediateContext</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D11 Device.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D11</span><span class="o">::~</span><span class="n">GraphicsAPI_D3D11</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">immediateContext</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable <code class="docutils literal notranslate"><span class="pre">ID3D11Device</span> <span class="pre">*</span></code>. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetD3D11GraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D11KHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">LUID</span><span class="w">                  </span><span class="n">adapterLuid</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D_FEATURE_LEVEL</span><span class="w">     </span><span class="n">minFeatureLevel</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="p">;</span>
</pre></div>
</div>
<p>From this structure, we use the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> to find the approiate <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter</span> <span class="pre">*</span></code>. We create a <code class="docutils literal notranslate"><span class="pre">IDXGIFactory1</span> <span class="pre">*</span></code> and then call <code class="docutils literal notranslate"><span class="pre">IDXGIFactory1::EnumAdapters()</span></code> and <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter::GetDesc()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">DXGI_ADAPTER_DESC</span></code>, so that we can compare the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> values.</p>
<p>Finally, we call <code class="docutils literal notranslate"><span class="pre">D3D11CreateDevice</span></code> with found adapter and the <code class="docutils literal notranslate"><span class="pre">minFeatureLevel</span></code> from <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D11KHR</span></code>, if successful the function will return <code class="docutils literal notranslate"><span class="pre">S_OK</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D11Device</span> <span class="pre">*</span></code> is non-null.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_D3D11::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingD3D11KHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="d3d12 docutils container" id="id15">
<p class="rubric">DirectX 12</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D12</span><span class="o">::</span><span class="n">GraphicsAPI_D3D12</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D12GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D12.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter1</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">D3D12CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Device.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_COMMAND_QUEUE_DESC</span><span class="w"> </span><span class="n">commandQueueDesc</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_LIST_TYPE_DIRECT</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_QUEUE_FLAG_NONE</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">NodeMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateCommandQueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">commandQueueDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Command Queue.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D12</span><span class="w"> </span><span class="o">::~</span><span class="n">GraphicsAPI_D3D12</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable <code class="docutils literal notranslate"><span class="pre">ID3D12Device</span> <span class="pre">*</span></code>  and <code class="docutils literal notranslate"><span class="pre">ID3D12CommandQueue</span> <span class="pre">*</span></code>. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetD3D12GraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D12KHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">LUID</span><span class="w">                  </span><span class="n">adapterLuid</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D_FEATURE_LEVEL</span><span class="w">     </span><span class="n">minFeatureLevel</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="p">;</span>
</pre></div>
</div>
<p>From this structure, we use the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> to find the approiate <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter1</span> <span class="pre">*</span></code>. We create a <code class="docutils literal notranslate"><span class="pre">IDXGIFactory4</span> <span class="pre">*</span></code> and then call <code class="docutils literal notranslate"><span class="pre">IDXGIFactory4::EnumAdapters1()</span></code> and <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter1::GetDesc()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">DXGI_ADAPTER_DESC</span></code>, so that we can compare the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> values.</p>
<p>Finally, we call <code class="docutils literal notranslate"><span class="pre">D3D12CreateDevice</span></code> with found adapter and the <code class="docutils literal notranslate"><span class="pre">minFeatureLevel</span></code> from <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D12KHR</span></code>, if successful the function will return <code class="docutils literal notranslate"><span class="pre">S_OK</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D12Device</span> <span class="pre">*</span></code> is non-null. Next, we create a simple a <code class="docutils literal notranslate"><span class="pre">ID3D12CommandQueue</span> <span class="pre">*</span></code> of type <code class="docutils literal notranslate"><span class="pre">D3D12_COMMAND_LIST_TYPE_DIRECT</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_D3D12::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingD3D12KHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="opengl docutils container" id="id16">
<p class="rubric">OpenGL</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGL.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L103-L121</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="o">=</span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="o">=</span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: The created OpenGL version &quot;</span><span class="o">&lt;&lt;</span><span class="n">glMajorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot;.&quot;</span><span class="o">&lt;&lt;</span><span class="n">glMinorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot; doesn&#39;t meet the minimum requried API version &quot;</span><span class="o">&lt;&lt;</span><span class="n">requiredMajorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot;.&quot;</span><span class="o">&lt;&lt;</span><span class="n">requiredMinorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">GraphicsAPI_OpenGL</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable OpenGL context. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetOpenGLGraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="p">;</span>
</pre></div>
</div>
<p>In this tutorial, we are using the ‚Äògfxwrapper‚Äô for the OpenGL API found as a part of the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a> reposity under <code class="docutils literal notranslate"><span class="pre">src/common/</span></code>. Originally developed by Oculus VR, LLC and The Brenwill Workshop Ltd.; this wrapper is written against the <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/gl/glspec43.core.pdf">OpenGL 4.3</a> and <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/es/3.1/es_spec_3.1.withchanges.pdf">OpenGL ES 3.1</a> specifications.</p>
<p>Here, we call <code class="docutils literal notranslate"><span class="pre">ksGpuWindow_Create()</span></code> and pass the required parameters to setup the OpenGL context. Next, we query the OpenGL version with <code class="docutils literal notranslate"><span class="pre">glGetIntegerv()</span></code> with <code class="docutils literal notranslate"><span class="pre">GL_MAJOR_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">GL_MINOR_VERSION</span></code>. With these values, we can contruct a <code class="docutils literal notranslate"><span class="pre">XrVersion</span></code> value to compare with <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLKHR::minApiVersionSupported</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_OpenGL::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L123-L144</span>
<span class="cp">#if defined(XR_USE_PLATFORM_WIN32)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_WIN32_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">hDC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">hDC</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">hGLRC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">hGLRC</span><span class="p">;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_XLIB)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_XLIB_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">xDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">xDisplay</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">visualid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">visualid</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxFBConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxFBConfig</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxDrawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxDrawable</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxContext</span><span class="p">;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_XCB)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_XCB_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// TODO: Still missing the platform adapter, and some items to make this usable.</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">connection</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.screenNumber = window.context.screenNumber;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.fbconfigid = window.context.fbconfigid;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">visualid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">visualid</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxDrawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxDrawable</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.glxContext = window.context.glxContext;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_WAYLAND)</span>
<span class="w">    </span><span class="c1">// TODO: Just need something other than NULL here for now (for validation).  Eventually need</span>
<span class="w">    </span><span class="c1">//       to correctly put in a valid pointer to an wl_display</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_WAYLAND</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">wl_display</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because OpenGL is very closely integrated with the platform‚Äôs windowing system. We have different <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGL[...]KHR</span></code> structures - one per platform. At present, there are four: <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLXcbKHR</span></code>, <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLXlibKHR</span></code>, <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLWaylandKHR</span></code> and <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLWin32KHR</span></code>. Depending on the platform, we fill out the relevant structure and return a pointer to that class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="opengles docutils container" id="id17">
<p class="rubric">OpenGL ES</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLESGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_ES_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGLES.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengles.cpp#L101-L119</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: The created OpenGL ES version doesn&#39;t meet the minimum requried API version for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable OpenGL ES context. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetOpenGLESGraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLESKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="p">;</span>
</pre></div>
</div>
<p>In this tutorial, we are using the ‚Äògfxwrapper‚Äô for the OpenGL ES API found as a part of the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a> reposity under <code class="docutils literal notranslate"><span class="pre">src/common/</span></code>. Originally developed by Oculus VR, LLC and The Brenwill Workshop Ltd.; this wrapper is written against the <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/gl/glspec43.core.pdf">OpenGL 4.3</a> and <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/es/3.1/es_spec_3.1.withchanges.pdf">OpenGL ES 3.1</a> specifications.</p>
<p>Here, we call <code class="docutils literal notranslate"><span class="pre">ksGpuWindow_Create()</span></code> and pass the required parameters to setup the OpenGL ES context. Next, we query the OpenGL ES version with <code class="docutils literal notranslate"><span class="pre">glGetIntegerv()</span></code> with <code class="docutils literal notranslate"><span class="pre">GL_MAJOR_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">GL_MINOR_VERSION</span></code>. With these values, we can contruct a <code class="docutils literal notranslate"><span class="pre">XrVersion</span></code> value to compare with <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLESKHR::minApiVersionSupported</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_OpenGL_ES::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_ES_ANDROID_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">display</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">config</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLESAndroidKHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>. Note: This <code class="docutils literal notranslate"><span class="pre">XrGraphicsBinding...</span></code> structure differs from the others as it specifically tailored to the Android platform.</p>
</div>
<div class="vulkan docutils container" id="id21">
<p class="rubric">Vulkan</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Instance</span>
<span class="w">    </span><span class="n">LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for Vulkan.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkApplicationInfo</span><span class="w"> </span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pApplicationName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pEngineName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan Engine&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">;</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">instanceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">instanceExtensionCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrInstanceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrInstanceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pApplicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Vulkan Instance.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Physical Device</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">physicalDeviceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkPhysicalDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">physicalDeviceCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkPhysicalDevice</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceFromXR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Device for Vulkan.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">physicalDeviceFromXR_it</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Vulkan: Failed to find PhysicalDevice for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Select the first available device.</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Device</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkQueueFamilyProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">queueFamilyPropertiesCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyPropertiesCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkDeviceQueueCreateInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">;</span>
<span class="w">    </span><span class="n">queuePriorities</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>

<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pQueuePriorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFlags</span><span class="p">,</span><span class="w"> </span><span class="n">VkQueueFlags</span><span class="p">(</span><span class="n">VK_QUEUE_GRAPHICS_BIT</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">deviceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">deviceExtensionCount</span><span class="p">);</span>

<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrDeviceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrDeviceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkPhysicalDeviceFeatures</span><span class="w"> </span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceFeatures</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkDeviceCreateInfo</span><span class="w"> </span><span class="n">deviceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">queueCreateInfoCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pQueueCreateInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pEnabledFeatures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateDevice</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Device.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_Vulkan</span><span class="o">::~</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">vkDestroyDevice</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable Vulkan Instance and Device. First, we call helper method that loads in the pointers for the following functions:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsRequirementsKHR</span></code>: Used to fill out a <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR</span></code> structure containing the minimum and maximum supported API version.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR</span></code>: To retrieve a list of required <code class="docutils literal notranslate"><span class="pre">VkInstance</span></code> extensions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanDeviceExtensionsKHR</span></code>: To retrieve a list of required <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code> extensions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsDeviceKHR</span></code>:  To get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> requested by OpenXR.</p></li>
</ul>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GraphicsAPI_Vulkan::LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanInstanceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanDeviceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsDeviceKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now call <code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsRequirementsKHR()</span></code> and fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, we fill out a <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo</span></code> where we assign <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo::apiVersion</span></code> the value in <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR::minApiVersionSupported</span></code>. We can now enumerate the Instance extensions and fill out array of structures. We use nested for-loops to find all the requested extensions push them back into a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code> called <code class="docutils literal notranslate"><span class="pre">activeInstanceExtensions</span></code>.
<code class="docutils literal notranslate"><span class="pre">GetInstanceExtensionsForOpenXR()</span></code> is another helper method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR()</span></code> is called twice, first to get the size of the <code class="docutils literal notranslate"><span class="pre">char</span></code> buffer and the second to fill in the data. We use <code class="docutils literal notranslate"><span class="pre">std::stringstream</span></code> and <code class="docutils literal notranslate"><span class="pre">std::getline()</span></code> with a deliminator of <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to break up the string and copy that subcontexts to an element in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code>, which we use when setting the instance extensions.</p>
<p>We fill out the <code class="docutils literal notranslate"><span class="pre">VkInstanceCreateInfo</span></code> structure and call <code class="docutils literal notranslate"><span class="pre">vkCreateInstance()</span></code>, which if successful will return <code class="docutils literal notranslate"><span class="pre">VK_SUCCESS</span></code> and the <code class="docutils literal notranslate"><span class="pre">VkInstance</span></code> will be non-null.</p>
<p>Next, we enumerate the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> s. Once we have array of all the physical devices in the system, we can call <code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsDeviceKHR()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> that OpenXR has requested. We can check the requested physical device against the array of physical devices to select the correct one.</p>
<p>With a <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> selected, we can now create a <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code>. We get the <code class="docutils literal notranslate"><span class="pre">VkQueueFamilyProperties</span></code> from the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> and fill an array of <code class="docutils literal notranslate"><span class="pre">VkDeviceQueueCreateInfo</span></code>. We find the first queue family that supports graphics operations and select its index as the <code class="docutils literal notranslate"><span class="pre">queueFamilyIndex</span></code> and we also select the first queue in that family too. We can now enumerate the Device extensions and fill out array of structures. We use nested for-loops to find all the requested extensions push them back into a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code> called <code class="docutils literal notranslate"><span class="pre">activeDeviceExtensions</span></code>.
<code class="docutils literal notranslate"><span class="pre">GetDeviceExtensionsForOpenXR()</span></code> is another helper method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Like with <code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR()</span></code>, <code class="docutils literal notranslate"><span class="pre">xrGetVulkanDeviceExtensionsKHR()</span></code> is called twice, first to get the size of the <code class="docutils literal notranslate"><span class="pre">char</span></code> buffer and the second to fill in the data. We use <code class="docutils literal notranslate"><span class="pre">std::stringstream</span></code> and <code class="docutils literal notranslate"><span class="pre">std::getline()</span></code> with a deliminator of <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to break up the string and copy that subcontexts into an element in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code>, which we use when setting the device extensions.</p>
<p>Finally, we get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDeviceFeatures</span></code> by calling <code class="docutils literal notranslate"><span class="pre">vkGetPhysicalDeviceFeatures()</span></code> and we can fill in the <code class="docutils literal notranslate"><span class="pre">VkDeviceCreateInfo</span></code>. We call <code class="docutils literal notranslate"><span class="pre">vkCreateDevice()</span></code>, which if successful will return <code class="docutils literal notranslate"><span class="pre">VK_SUCCESS</span></code> and the <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code> will be non-null.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_Vulkan::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevice</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingVulkanKHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
</section>
</section>
<section id="polling-the-event-loop">
<h2>2.3 Polling the Event Loop<a class="headerlink" href="#polling-the-event-loop" title="Permalink to this heading">¬∂</a></h2>
<p>OpenXR uses an event based system to describes changes with the XR system. It‚Äôs the application‚Äôs responsibility to poll these events and react to them. The polling of events is done by the function <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code>. The application should continually call this function throughout its lifetime. Within a single XR frame, the application should continuously call <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> until the internal event queue is ‚Äòdrained‚Äô; multiple events can occurs across the XR frame and the application needs to handle and respond to each accordingly.</p>
<p>Firstly, we will update the class to add the new methods and members.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>

<span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">applicationRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">PollSystemEvents</span><span class="p">();</span>
<span class="w">                        </span><span class="n">PollEvents</span><span class="p">();</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="c1">// Draw Frame.</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="n">XrViewConfigurationType</span><span class="w"> </span><span class="n">viewConfiguration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="n">XrSessionState</span><span class="w"> </span><span class="n">sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="xrpollevent">
<h3>2.3.1 xrPollEvent<a class="headerlink" href="#xrpollevent" title="Permalink to this heading">¬∂</a></h3>
<p>Next, we will define the <code class="docutils literal notranslate"><span class="pre">PollEvents()</span></code> method. Here, we use a do-while loop to the check the result of <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> - whilst that function returns <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code>, there are events for us to process. <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> will fill in the <code class="docutils literal notranslate"><span class="pre">XrEventDataBuffer</span></code> structure that we pass to the function call. <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> will update the member variable <code class="docutils literal notranslate"><span class="pre">type</span></code> and from this we can use a switch statement to select the appropriate code path. Depending on the updated type, we can use a <code class="docutils literal notranslate"><span class="pre">reinterpret_cast&lt;&gt;()</span></code> to get the actual data that <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> returned.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">PollEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataBuffer</span><span class="w"> </span><span class="n">eventData</span><span class="p">{</span><span class="n">XR_TYPE_EVENT_DATA_BUFFER</span><span class="p">};</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrPollEvent</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">eventData</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_EVENTS_LOST</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*</span><span class="n">eventsLost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Events Lost: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eventsLost</span><span class="o">-&gt;</span><span class="n">lostEventCount</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*</span><span class="n">instanceLossPending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Instance Loss Pending at: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceLossPending</span><span class="o">-&gt;</span><span class="n">lossTime</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*</span><span class="n">interactionProfileChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Interaction Profile changed for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interactionProfileChanged</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*</span><span class="n">referenceSpaceChangePending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Reference Space Change pending for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">referenceSpaceChangePending</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*</span><span class="n">sessionStateChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">                </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="p">;</span>
<span class="w">                </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">m_sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The description of the events come from <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#_xrpollevent">2.22.1. Event Polling of the OpenXR specification</a>.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Event Structure Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_EVENTS_LOST</p></td>
<td><p>XrEventDataEventsLost</p></td>
<td><p>The event queue has overflowed and some events were lost.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</p></td>
<td><p>XrEventDataInstanceLossPending</p></td>
<td><p>The application is about to lose the instance.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</p></td>
<td><p>XrEventDataInteractionProfileChanged</p></td>
<td><p>The active input form factor for one or more top level user paths has changed.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</p></td>
<td><p>XrEventDataReferenceSpaceChangePending</p></td>
<td><p>The runtime will begin operating with updated space bounds.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</p></td>
<td><p>XrEventDataSessionStateChanged</p></td>
<td><p>The application has changed its lifecycle state.</p></td>
</tr>
</tbody>
</table>
<p>As described in the table above, most event are transparent in their intensions and how the application should react to them. For the <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span></code> state, the application may want to try re-creating the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> in a loop, after the specified <code class="docutils literal notranslate"><span class="pre">lossTime</span></code>, until it can create a new instance successfully. <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span></code> are used for updating how the user interacts with the application and whether a new space change has been detected respectively.</p>
</section>
<section id="xrsessionstate">
<h3>2.3.2 XrSessionState<a class="headerlink" href="#xrsessionstate" title="Permalink to this heading">¬∂</a></h3>
<p>The final one, <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span></code>, is what we will focus on for the rest of this chapter. There are currently nine valid <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> s described:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrSessionState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_IDLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_READY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_SYNCHRONIZED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_VISIBLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_FOCUSED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_LOSS_PENDING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSessionState</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_UNKNOWN</p></td>
<td><p>This is an unknown, pseudo-default state and should not be returned by the runtime.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_IDLE</p></td>
<td><p>This is an inital state after creating or after ending the session.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_READY</p></td>
<td><p>This state, raised from the runtime, indicates that the session is ready to begin.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_SYNCHRONIZED</p></td>
<td><p>The application has synced its frame loop with the runtime, but isn‚Äôt displaying its contents.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_VISIBLE</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_FOCUSED</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents and can receive XR inputs.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_STOPPING</p></td>
<td><p>The runtime is requesting that the application stop it frame loop rendering and end the session.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_LOSS_PENDING</p></td>
<td><p>The runtime is indicating that current session is no longer valid and should be destroyed. (*)</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_EXITING</p></td>
<td><p>The runtime is requesting that the application to destroy the session, usually from the user‚Äôs request.</p></td>
</tr>
</tbody>
</table>
<p>(*) Applications may wish to re-create objects like <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>, if hardware changes were detected.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/openxr-session-life-cycle.svg"><img alt="OpenXR Session Life-Cycle" src="_images/openxr-session-life-cycle.svg" width="99%" /></a>
</figure>
</section>
<section id="xrbeginsession-and-xrendsession">
<h3>2.3.3 xrBeginSession and xrEndSession<a class="headerlink" href="#xrbeginsession-and-xrendsession" title="Permalink to this heading">¬∂</a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> is <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_READY</span></code>, the application can call <code class="docutils literal notranslate"><span class="pre">xrBeginSession()</span></code>.
In the <code class="docutils literal notranslate"><span class="pre">XrSessionBeginInfo</span></code> structure, we assign to <code class="docutils literal notranslate"><span class="pre">XrSessionBeginInfo::primaryViewConfigurationType</span></code> the <code class="docutils literal notranslate"><span class="pre">m_viewConfiguration</span></code> from the class, which in our case is <code class="docutils literal notranslate"><span class="pre">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span></code>. This specifies the view configuration of the form factor‚Äôs primary display - For Head Mounted Displays, it is two views (one per eye).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">    </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> is <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_STOPPING</span></code>, the application should call <code class="docutils literal notranslate"><span class="pre">xrEndSession()</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


						</div>
					</div>
					<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1-introduction.html" class="btn btn-neutral float-left" title="üëã 1 Introduction" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3-graphics.html" class="btn btn-neutral float-right" title="üëæ 3 Graphics" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>&#169; Copyright &#34;OpenXR&#34; and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom.</p>
  </div> 

</footer>
				</div>
			</div>
		</div>
	</div>
  <script></script> 

</body>
</html>