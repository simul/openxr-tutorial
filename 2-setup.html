<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>‚öôÔ∏è 2 Setup &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="next" title="üëæ 3 Graphics" href="3-graphics.html" >
	<link rel="prev" title="üëã 1 Introduction" href="1-introduction.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	function updatePlatform()
	{
		var platform = Cookies.get("platform")
		console.log("platform = " + platform);
		if (typeof platform == 'undefined')
		platform="linux";
		if (platform == "windows") {
			$(".linux").hide();
			$(".android").hide();
			$(".windows").show();
			$(".windows-linux").show();
		}
		if (platform == "linux") {
			$(".linux").show();
			$(".android").hide();
			$(".windows").hide();
			$(".windows-linux").show();
		}
		if (platform == "android") {
			$(".linux").hide();
			$(".android").show();
			$(".windows").hide();
			$(".windows-linux").hide();
		}
		var oldelements = document.getElementsByClassName('selected-platform');
		for (i = 0; i < oldelements.length; ++i)
		{
			oldelements[i].classList.remove('selected-platform');
		}
		var element = document.getElementById('select' + platform);
		if(element)
		{
			element.classList.add('selected-platform');
		}
		var element2 = document.getElementById('select' + platform + "-inline");
		if(element2)
		{
			element2.classList.add('selected-platform');
		}
		window.updatePlatform=updatePlatform;
	}</script>
	<script >
	var platform = Cookies.get("platform")
	if (platform==undefined) {
	Cookies.set('platform', 'windows',{ expires: 365})
	platform='windows';
	}
	</script>
	<script defer src="_static/js/updatePlatform.js"></script>
	<script>
	function updateGraphicsAPI()
	{
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("graphicsapi = " + graphicsApi);
		if (typeof graphicsApi == 'undefined')
			platform="vulkan";
		if (graphicsApi == "d3d11") {
			$(".d3d11").show();
			$(".d3d12").hide();
			$(".opengl").hide();
			$(".opengles").hide();
			$(".vulkan").hide();
		}
		if (graphicsApi == "d3d12") {
			$(".d3d11").hide();
			$(".d3d12").show();
			$(".opengl").hide();
			$(".opengles").hide();
			$(".vulkan").hide();
		}
		if (graphicsApi == "opengl") {
			$(".d3d11").hide();
			$(".d3d12").hide();
			$(".opengl").show();
			$(".opengles").hide();
			$(".vulkan").hide();
		}
		if (graphicsApi == "opengles") {
			$(".d3d11").hide();
			$(".d3d12").hide();
			$(".opengl").hide();
			$(".opengles").show();
			$(".vulkan").hide();
		}
		if (graphicsApi == "vulkan") {
			$(".d3d11").hide();
			$(".d3d12").hide();
			$(".opengl").hide();
			$(".opengles").hide();
			$(".vulkan").show();
		}
		var oldelements = document.getElementsByClassName('selected-graphics-api');
		for (i = 0; i < oldelements.length; ++i)
		{
			oldelements[i].classList.remove('selected-graphics-api');
		}
		var element = document.getElementById('select' + graphicsApi);
		if(element)
		{
			element.classList.add('selected-graphics-api');
		}
		var element2 = document.getElementById('select' + graphicsApi +"-inline");
		if (element2)
		{
			element2.classList.add('selected-graphics-api');
		}
		window.updateGraphicsAPI=updateGraphicsAPI;
	}</script>
	<script >
	var graphicsApi = Cookies.get("graphicsapi")
	if (graphicsApi==undefined) {
		Cookies.set('graphicsapi', 'vulkan',{ expires: 365})
		platform='vulkan';
	}
	</script>
	<script defer src="_static/js/updateGraphicsAPI.js"></script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onload="updatePlatform();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">üëã 1 Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">‚öôÔ∏è 2 Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrinstance-xrgetsystem">Creating an XrInstance / xrGetSystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrinstance">XrInstance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsystemid">XrSystemId</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrsession">Creating an XrSession</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrsession">XrSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphicsapi">GraphicsAPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#polling-the-event-loop">Polling the Event Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrpollevent">xrPollEvent()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsessionstate">XrSessionState</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrbeginsession-and-xrendsession">xrBeginSession() and xrEndSession()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">üëæ 3 Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-actions.html">üïπ 4 Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">5 Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">‚öôÔ∏è 2 Setup</li>
	  <li class="wy-breadcrumbs-aside">
		  <div id='selectplatform'>
	<button class="select-platform" id='selectwindows' onclick="choosePlatform('windows')">
		<img class="platform-tab-img" src="_static/css/windows-mono.svg" alt="Windows" />
	</button>
	<button class="select-platform" id='selectlinux' onclick="choosePlatform('linux')">
		<img class="platform-tab-img" src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
	</button>
	<button class="select-platform" id='selectandroid' onclick="choosePlatform('android')">
		<img class="platform-tab-img" src="_static/css/android-original.svg" alt="Android" />
	</button>
</div>
<script>
	function choosePlatform(platformName)
	{
		var platform = Cookies.get('platform')
		Cookies.set('platform', platformName, { expires: 365 })
		updatePlatform();
	};
</script>

<div id='selectgraphicsapi'>
	<button class="select-graphics-api" id='selectd3d11' onclick="chooseGraphicsAPI('d3d11')">
		<img class="api-tab-img" src="_static/css/d3d11.png" alt="DirectX 11" />
	</button>
	<button class="select-graphics-api" id='selectd3d12' onclick="chooseGraphicsAPI('d3d12')">
		<img class="api-tab-img" src="_static/css/d3d12.png" alt="DirectX 12" />
	</button>
	<button class="select-graphics-api" id='selectopengl' onclick="chooseGraphicsAPI('opengl')">
		<img class="api-tab-img" src="_static/css/opengl.png" alt="OpenGL" />
	</button>
	<button class="select-graphics-api" id='selectopengles' onclick="chooseGraphicsAPI('opengles')">
		<img class="api-tab-img" src="_static/css/opengles.png" alt="OpenGL ES" />
	</button>
	<button class="select-graphics-api" id='selectvulkan' onclick="chooseGraphicsAPI('vulkan')">
		<img class="api-tab-img" src="_static/css/vulkan.png" alt="Vulkan" />
	</button>
</div>
<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		Cookies.set('graphicsapi', graphicsApiName, { expires: 365 })
		var graphicsApi = Cookies.get('graphicsapi')
		updateGraphicsAPI();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
						<div itemprop="articleBody">
							
  <section id="setup">
<h1>‚öôÔ∏è 2 Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¬∂</a></h1>
<p>Select your platform, as the instructions are different depending on your selection.</p>
<div class='select-platform-container-inline'>
	<button class="select-platform-inline" id='selectwindows-inline' onclick="choosePlatform('windows')">
		<img src="_static/css/windows-mono.svg" alt="Windows" />
		<p>Windows</p>
	</button>
	<button class="select-platform-inline" id='selectlinux-inline' onclick="choosePlatform('linux')">
		<img src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
		<p>Linux</p>
	</button>
	<button class="select-platform-inline" id='selectandroid-inline' onclick="choosePlatform('android')">
		<img src="_static/css/android-original.svg" alt="Android" />
		<p>Android</p>
	</button>
</div>
<div class='select-graphics-api-container-inline'></div>
	<button class="select-graphics-api-inline" id='selectd3d11-inline' onclick="chooseGraphicsAPI('d3d11')">
		<img src="_static/css/d3d11.png" alt="DirectX 11" />
		<p>DirectX 11</p>
	</button>
	<button class="select-graphics-api-inline" id='selectd3d12-inline' onclick="chooseGraphicsAPI('d3d12')">
		<img src="_static/css/d3d12.png" alt="DirectX 12" />
		<p>DirectX 12</p>
	</button>
	<button class="select-graphics-api-inline" id='selectopengl-inline' onclick="chooseGraphicsAPI('opengl')">
		<img src="_static/css/opengl.png" alt="OpenGL" />
		<p>OpenGL</p>
	</button>
	<button class="select-graphics-api-inline" id='selectopengles-inline' onclick="chooseGraphicsAPI('opengles')">
		<img src="_static/css/opengles.png" alt="OpenGL ES" />
		<p>OpenGL ES</p>
	</button>
	<button class="select-graphics-api-inline" id='selectvulkan-inline' onclick="chooseGraphicsAPI('vulkan')">
		<img src="_static/css/vulkan.png" alt="Vulkan" />
		<p>Vulkan</p>
	</button>
</div>

<div class="windows docutils container" id="windows-id-1">
<p class="rubric">Windows</p>
<p>For the Windows OpenXR project, we‚Äôll use CMake to create some project files for Visual Studio.
First, create a directory where the code will go, we‚Äôll call this the <em>workspace</em> directory.</p>
</div>
<div class="linux docutils container" id="linux-id-1">
<p class="rubric">Linux</p>
<p>You are free to use any code editor and/or compiler; this tutorial will use Visual Studio Code.
For the Linux OpenXR project, we‚Äôll use CMake alongside Visual Studio Code to build the project.
First, Create a directory where the code will go, we‚Äôll call this the <em>workspace</em> directory. Open Visual Studio Code and from the File menu, select ‚ÄúOpen Folder‚Ä¶‚Äù</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/linux-vscode-open-folder.png"><img alt="The File menu of Visual Studio Code is shown, with the command &quot;Open Folder...&quot; selected." src="_images/linux-vscode-open-folder.png" style="width: 391.05px; height: 234.3px;" /></a>
</figure>
<p>The File menu of Visual Studio Code, with the command ‚ÄúOpen Folder‚Ä¶‚Äù selected</p>
<p>Select your <em>workspace</em> folder, which is now empty.
If you haven‚Äôt previously done so, install the CMake extension for Visual Studio Code.</p>
</div>
<div class="windows-linux docutils container" id="windows-linux-id-1">
<p class="rubric">Windows and Linux</p>
<p>Now, create a text file in the <em>workspace</em> folder called <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and in it, put the following code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.15</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">openxr-tutorial</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CONFIGURATION_TYPES</span><span class="w"> </span><span class="s2">&quot;Debug;Release&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">OPENXR_DIR</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">PATH</span><span class="w"> </span><span class="s2">&quot;Location of OpenXR-SDK repository.&quot;</span><span class="p">)</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">Chapter_2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let‚Äôs create a folder called Chapter_2, and in it create another <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.
This one contains the following code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">file</span><span class="p">(</span><span class="s">GLOB</span><span class="w"> </span><span class="s">SOURCES</span><span class="w"> </span><span class="s2">&quot;main.cpp&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">Chapter_2</span><span class="w"> </span><span class="o">${</span><span class="nv">SOURCES</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="w"> </span><span class="s">Chapter_2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">OPENXR_DIR</span><span class="o">}</span><span class="s">/include</span><span class="w"> </span><span class="p">)</span>
<span class="nb">target_link_directories</span><span class="p">(</span><span class="w"> </span><span class="s">Chapter_2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">OPENXR_DIR</span><span class="o">}</span><span class="s">/build/src/loader/Debug</span><span class="w"> </span><span class="o">${</span><span class="nv">OPENXR_DIR</span><span class="o">}</span><span class="s">/build/src/loader/Release</span><span class="w"> </span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="w"> </span><span class="s">Chapter_2</span><span class="w"> </span><span class="s">openxr_loader</span><span class="o">$&lt;</span><span class="nv">$&lt;CONFIG:Debug</span><span class="o">&gt;</span><span class="s">:d&gt;</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
<p>That‚Äôs all we need for CMake, we need for this project.
Now, we‚Äôll create our source file. Create a new text file called <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> in the Chapter2 directory.</p>
</div>
<div class="android docutils container" id="android-id-1">
<p class="rubric">Android</p>
<p>Here, We‚Äôll show how to hand build an Android Studio project that runs a C++ Native Activity.
Open Android Studio, select New Project and choose an Empty Activity. Set the names and save location. The language can be ignored here as we are using C++, and we can set the Minimum SDK to API 24: Android 7.0(Nougat). Complete set up.</p>
<figure class="align-left">
<img alt="Android Studio - New Project - Empty Activity." src="_images/android-studio-newproject.png" />
</figure>
<p class="rubric">CMake</p>
<p>With the Android Studio project now set up, we need to modify some of the files and folders so as to set up the project to support the C++ Native Activity.
Under the <code class="docutils literal notranslate"><span class="pre">app</span></code> folder, you can delete the <code class="docutils literal notranslate"><span class="pre">libs</span></code> folder, and under the <code class="docutils literal notranslate"><span class="pre">app/src</span></code> you can also delete the <code class="docutils literal notranslate"><span class="pre">androidTest</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> folders. Finally under <code class="docutils literal notranslate"><span class="pre">app/src/main</span></code>, delete the <code class="docutils literal notranslate"><span class="pre">java</span></code> folder and add a <code class="docutils literal notranslate"><span class="pre">cpp</span></code> folder. Under the <code class="docutils literal notranslate"><span class="pre">app/src/main/res</span></code>, delete the <code class="docutils literal notranslate"><span class="pre">values-night</span></code> and <code class="docutils literal notranslate"><span class="pre">xml</span></code> folders. Under the <code class="docutils literal notranslate"><span class="pre">values</span></code> modify <code class="docutils literal notranslate"><span class="pre">colors.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">styles.xml</span></code> as shown.</p>
<p class="rubric">colors.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimary&quot;</span><span class="nt">&gt;</span>#008577<span class="nt">&lt;/color&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimaryDark&quot;</span><span class="nt">&gt;</span>#00574B<span class="nt">&lt;/color&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorAccent&quot;</span><span class="nt">&gt;</span>#D81B60<span class="nt">&lt;/color&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</pre></div>
</div>
<p class="rubric">styles.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;resources&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Base application theme. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;style</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AppTheme&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;Theme.AppCompat.Light.DarkActionBar&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Customize your theme here. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimary&quot;</span><span class="nt">&gt;</span>@color/colorPrimary<span class="nt">&lt;/item&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimaryDark&quot;</span><span class="nt">&gt;</span>@color/colorPrimaryDark<span class="nt">&lt;/item&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorAccent&quot;</span><span class="nt">&gt;</span>@color/colorAccent<span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;/resources&gt;</span>
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in the directory above for compatiblity with other platforms. We will use this file to specific how our Native C++ code will be built. This <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file will be invoked by Android Studio‚Äôs Gradle build system and we will point Gradle to this CMake file.</p>
<p class="rubric">CMakeLists.txt</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.22.1</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;OpenXRTutorialChapter2&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># Needed for Android</span>

<span class="c"># For FetchContent_Declare() and FetchContent_MakeAvailable()</span>
<span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span>

<span class="c"># openxr_loader - From github.com/KhronosGroup</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_ALL_EXTENSIONS</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build loader and layers with all extensions&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build tests&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_CONFORMANCE_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build conformance tests&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_API_LAYERS</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Use OpenXR layers&quot;</span><span class="p">)</span>
<span class="nb">FetchContent_Declare</span><span class="p">(</span>
<span class="w">        </span><span class="s">OpenXR</span>
<span class="w">        </span><span class="s">URL_HASH</span><span class="w"> </span><span class="s">MD5=390455e9395a92d6b730afb8f23fac8e</span>
<span class="w">        </span><span class="s">URL</span><span class="w"> </span><span class="s">https://github.com/KhronosGroup/OpenXR-SDK-Source/archive/refs/tags/release-1.0.27.zip</span>
<span class="w">        </span><span class="s">SOURCE_DIR</span><span class="w"> </span><span class="s">openxr</span><span class="p">)</span>
<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">OpenXR</span><span class="p">)</span>

<span class="c"># Files</span>
<span class="nb">set</span><span class="p">(</span><span class="s">SOURCES</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;main.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D11.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D12.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL_ES.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_Vulkan.cpp&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRDebugUtils.cpp&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">HEADERS</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRHelper.h&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPIs.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D11.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_D3D12.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_OpenGL_ES.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/GraphicsAPI_Vulkan.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/HelperFunctions.h&quot;</span>
<span class="w">    </span><span class="s2">&quot;../Common/OpenXRDebugUtils.h&quot;</span>
<span class="p">)</span>

<span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">ANDROID</span><span class="p">)</span>
<span class="w">    </span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_SHARED_LINKER_FLAGS</span><span class="w"> </span><span class="s2">&quot;${CMAKE_SHARED_LINKER_FLAGS} -u ANativeActivity_onCreate&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># export ANativeActivity_onCreate for java to call.</span>
<span class="w">    </span><span class="nb">add_library</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">SHARED</span><span class="w"> </span><span class="o">${</span><span class="nv">SOURCES</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">HEADERS</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s2">&quot;../Common/&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c"># native_app_glue</span>
<span class="w">    </span><span class="nb">include</span><span class="p">(</span><span class="s">AndroidNdkModules</span><span class="p">)</span>
<span class="w">    </span><span class="nb">android_ndk_import_module_native_app_glue</span><span class="p">()</span>

<span class="w">    </span><span class="c"># vulkan - Found in the NDK</span>
<span class="w">    </span><span class="nb">find_library</span><span class="p">(</span><span class="s">vulkan-lib</span><span class="w"> </span><span class="s">vulkan</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">ANDROID_NDK</span><span class="o">}</span><span class="s">/sources/third_party/vulkan/src/include</span><span class="p">)</span>

<span class="w">    </span><span class="c"># openxr-gfxwrapper - Manually build from OpenXR for OpenGL ES</span>
<span class="w">    </span><span class="nb">add_library</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">STATIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/src/common/gfxwrapper_opengl.c</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/src/common/gfxwrapper_opengl.h</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/external/include</span><span class="p">)</span>
<span class="w">    </span><span class="nb">find_library</span><span class="p">(</span><span class="s">GLES3-lib</span><span class="w"> </span><span class="s">GLESv3</span><span class="p">)</span>
<span class="w">    </span><span class="nb">find_library</span><span class="p">(</span><span class="s">EGL-lib</span><span class="w"> </span><span class="s">EGL</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">GLES3-lib</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">openxr-gfxwrapper</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">EGL-lib</span><span class="o">}</span><span class="p">)</span>

<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/src/common</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">openxr_SOURCE_DIR</span><span class="o">}</span><span class="s">/external/include</span><span class="p">)</span>

<span class="w">    </span><span class="c"># Final link</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span>
<span class="w">            </span><span class="s">android</span>
<span class="w">            </span><span class="s">native_app_glue</span>
<span class="w">            </span><span class="s">openxr_loader</span>
<span class="w">            </span><span class="o">${</span><span class="nv">vulkan-lib</span><span class="o">}</span>
<span class="w">            </span><span class="s">openxr-gfxwrapper</span><span class="p">)</span>

<span class="nb">else</span><span class="p">()</span>
<span class="w">    </span><span class="nb">add_executable</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="o">${</span><span class="nv">SOURCES</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">HEADERS</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s2">&quot;../Common/&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">openxr_loader</span><span class="p">)</span>

<span class="w">    </span><span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">WIN32</span><span class="p">)</span>
<span class="w">        </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;d3d11.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;d3d12.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s2">&quot;dxgi.lib&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nb">endif</span><span class="p">()</span>

<span class="w">    </span><span class="nb">find_package</span><span class="p">(</span><span class="s">Vulkan</span><span class="p">)</span>
<span class="w">    </span><span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">Vulkan_FOUND</span><span class="p">)</span>
<span class="w">        </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">Vulkan_INCLUDE_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="w">        </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="o">${</span><span class="nv">Vulkan_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">endif</span><span class="p">()</span>

<span class="w">    </span><span class="c"># Fix redirection to a different project&#39;s build folder</span>
<span class="w">    </span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span><span class="s">/../Chapter2/openxr/src/common</span><span class="p">)</span>
<span class="w">    </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">OpenXRTutorialChapter2</span><span class="w"> </span><span class="s">openxr-gfxwrapper</span><span class="p">)</span>

<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>First, we set the minimum required cmake version, here we are using 3.22.1 and the project‚Äôs name. Next, we need to add a static library called native_app_glue. The native_app_glue library is compiled from a single source file <code class="docutils literal notranslate"><span class="pre">android_native_app_glue.c</span></code>. This interfaces between the Java Virtual Machine and our C++ code. Ultimately, it allows us to use the <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">android_main(struct</span> <span class="pre">android_app*)</span></code> entry point. We also include that directory as we need access to the android_native_app_glue.h header file. Next, we need to set the <code class="docutils literal notranslate"><span class="pre">CMAKE_SHARED_LINKER_FLAGS</span></code> so that <code class="docutils literal notranslate"><span class="pre">ANativeActivity_onCreate()</span></code> is exported for the Java Virtual Machine to call. Next, we add our shared library openxrtutorialch2 that houses our code. Here, I have a relative path to our single C++ file.</p>
<p>Now, we import the openxr_loader library. We need to do this, because it‚Äôs external to the NDK library, and won‚Äôt be automatically picked up. We call <code class="docutils literal notranslate"><span class="pre">set_target_properties()</span></code> to specific the location of <code class="docutils literal notranslate"><span class="pre">libopenxr_loader.so</span></code>. We also include the directory to the OpenXR headers. Next, we find the Vulkan library in the NDK and include the directory to the Android Vulkan headers. At this time, we also find the log library. Finally we link the android, native_app_glue, openxr_loader, vulkan and log libraries to our openxrtutorialch2 library. Our <code class="docutils literal notranslate"><span class="pre">libopenxrtutorialch2.so</span></code> will packageed inside our .apk along with any shared libraries that we have linked.</p>
<p class="rubric">AndroidManifest.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<span class="w">    </span><span class="na">package=</span><span class="s">&quot;com.simul.OpenXRTutorialChapter2&quot;</span>
<span class="w">    </span><span class="na">android:versionCode=</span><span class="s">&quot;1&quot;</span>
<span class="w">    </span><span class="na">android:versionName=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;uses-feature</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.hardware.vr.headtracking&quot;</span><span class="w"> </span><span class="na">android:required=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:allowBackup=</span><span class="s">&quot;false&quot;</span>
<span class="w">        </span><span class="na">android:fullBackupContent=</span><span class="s">&quot;false&quot;</span>
<span class="w">        </span><span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
<span class="w">        </span><span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
<span class="w">        </span><span class="na">android:hasCode=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;activity</span>
<span class="w">            </span><span class="na">android:name=</span><span class="s">&quot;android.app.NativeActivity&quot;</span>
<span class="w">            </span><span class="na">android:configChanges=</span><span class="s">&quot;orientation|keyboardHidden&quot;</span>
<span class="w">            </span><span class="na">android:debuggable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;meta-data</span>
<span class="w">                </span><span class="na">android:name=</span><span class="s">&quot;android.app.lib_name&quot;</span>
<span class="w">                </span><span class="na">android:value=</span><span class="s">&quot;OpenXRTutorialChapter2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">            </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;com.oculus.intent.category.VR&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;org.khronos.openxr.intent.category.IMMERSIVE_HMD&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/activity&gt;</span>
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</div>
<p>We now need to modify our <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> file to tell Android to run a Native Activity. We set <code class="docutils literal notranslate"><span class="pre">android:name</span></code> to ‚Äúandroid.app.NativeActivity‚Äù and update <code class="docutils literal notranslate"><span class="pre">android:configChanges</span></code> to ‚Äúorientation|keyboardHidden‚Äù to not close the activity on those changes. Next under the meta-data section, we set these values: <code class="docutils literal notranslate"><span class="pre">android:name</span></code> to ‚Äúandroid.app.lib_name‚Äù and <code class="docutils literal notranslate"><span class="pre">android:value</span></code> to ‚Äúopenxrtutorialch2‚Äù, where <code class="docutils literal notranslate"><span class="pre">android:value</span></code> is name of the library we created in the CMakeLists, thus pointing our NativeActivity to the correct library.</p>
<p>We need to tell the app that it should take over rendering when active, rather than appearing in a window. Set <code class="docutils literal notranslate"><span class="pre">&lt;category</span> <span class="pre">android:name=&quot;org.khronos.openxr.intent.category.IMMERSIVE_HMD&quot;</span> <span class="pre">/&gt;</span></code>.
Note: not all devices yet support this category. For example, for Oculus Quest devices you will need <code class="docutils literal notranslate"><span class="pre">&lt;category</span> <span class="pre">android:name=&quot;com.oculus.intent.category.VR&quot;</span> <span class="pre">/&gt;</span></code> for the same purpose.</p>
<p class="rubric">Gradle</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">apply</span><span class="w"> </span><span class="nl">plugin:</span><span class="w"> </span><span class="s1">&#39;com.android.application&#39;</span>

<span class="n">android</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">compileSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ndkVersion</span><span class="w"> </span><span class="s1">&#39;23.1.7779620&#39;</span>

<span class="w">    </span><span class="n">defaultConfig</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">applicationId</span><span class="w"> </span><span class="s2">&quot;com.simul.OpenXRTutorialChapter2&quot;</span>
<span class="w">        </span><span class="n">minSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="n">targetSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="n">versionCode</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">versionName</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">buildFeatures</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">prefab</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">buildTypes</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">release</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">minifyEnabled</span><span class="w"> </span><span class="kc">false</span>
<span class="w">            </span><span class="n">proguardFiles</span><span class="w"> </span><span class="n">getDefaultProguardFile</span><span class="o">(</span><span class="s1">&#39;proguard-android-optimize.txt&#39;</span><span class="o">),</span><span class="w"> </span><span class="s1">&#39;proguard-rules.pro&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="n">debug</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">jniDebuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">debuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">renderscriptDebuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">minifyEnabled</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">externalNativeBuild</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">cmake</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">version</span><span class="w"> </span><span class="s1">&#39;3.22.1&#39;</span>
<span class="w">            </span><span class="n">path</span><span class="w"> </span><span class="s1">&#39;../CMakeLists.txt&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span><span class="c1">// enable prefab support for the OpenXR AAR</span>
<span class="w">    </span><span class="c1">//buildFeatures {</span>
<span class="w">    </span><span class="c1">//    prefab true</span>
<span class="w">    </span><span class="c1">//}</span>
<span class="o">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="n">fileTree</span><span class="o">(</span><span class="nl">dir:</span><span class="w"> </span><span class="s1">&#39;libs&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">include:</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;*.jar&#39;</span><span class="o">])</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;androidx.appcompat:appcompat:1.0.2&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;org.khronos.openxr:openxr_loader_for_android:1.0.27&#39;</span>
<span class="w">    </span><span class="c1">//implementation files(&#39;../../thirdparty/openxr_loader_manifest_only-1.0.27.aar&#39;)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, we can config our <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file in the <code class="docutils literal notranslate"><span class="pre">app</span></code> folder. First remove any references to Java, Kotlin and to testing. Next add in the <code class="docutils literal notranslate"><span class="pre">externalNativeBuild</span></code> section specifying CMake, its version and the location of the CMakeLists.txt that we created earlier. Also specify under the <code class="docutils literal notranslate"><span class="pre">ndk</span></code> section the <code class="docutils literal notranslate"><span class="pre">abiFilters</span></code>. We will just be using arm64-v8a in this tutorial. <code class="docutils literal notranslate"><span class="pre">ndkVersion</span></code> should also be specified.</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="c1">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
<span class="n">buildscript</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="o">{</span>
<span class="w">       </span><span class="n">google</span><span class="o">()</span>
<span class="w">       </span><span class="n">mavenCentral</span><span class="o">()</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">classpath</span><span class="w"> </span><span class="s1">&#39;com.android.tools.build:gradle:7.4.2&#39;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">allprojects</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">google</span><span class="o">()</span>
<span class="w">        </span><span class="n">mavenCentral</span><span class="o">()</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span><span class="w"> </span><span class="nf">clean</span><span class="o">(</span><span class="nl">type:</span><span class="w"> </span><span class="n">Delete</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">delete</span><span class="w"> </span><span class="n">rootProject</span><span class="o">.</span><span class="na">buildDir</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, we can config our <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file in the root folder of the project. This is a complete replacement the default one provided by Android Studio. This file stipulates the repositories and gradle version to be used.
The settings.gradle can be reduce to just: <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">':app'</span></code>, and in the <code class="docutils literal notranslate"><span class="pre">gradle.properties</span></code> we need to remove <code class="docutils literal notranslate"><span class="pre">kotlin.code.style=official</span></code> and <code class="docutils literal notranslate"><span class="pre">android.nonTransitiveRClass=true</span></code>.</p>
<p>With that completed, we should now be able to sync the Gradle file and build the project.</p>
<p>Now, we‚Äôll create our source file. Create a new text file called <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> in the Chapter2 directory.
This file will be referenced in the CMakeLists file we created, so ensure the path is correct.</p>
</div>
<p>Now, that we have set up the project and source file. We will create two header files in a <code class="docutils literal notranslate"><span class="pre">/Common</span></code> directory called <code class="docutils literal notranslate"><span class="pre">HelperFunctions.h</span></code> and <code class="docutils literal notranslate"><span class="pre">OpenXRHelper.h</span></code>
Open the header files and add the following code to <code class="docutils literal notranslate"><span class="pre">Helperfunctions.h</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// C Headers</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
</pre></div>
</div>
<p>This is boilerplate for the various platforms. Next, we‚Äôll add the header files related to OpenXR to <code class="docutils literal notranslate"><span class="pre">OpenXRHelper.h</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// OpenXR Headers</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;openxr/openxr.h&quot;</span>
<span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;openxr/openxr_platform.h&quot;</span>
</span></pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__ANDROID__)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;android_native_app_glue.h&quot;</span>
<span class="cp">#define XR_USE_PLATFORM_ANDROID</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Here, we include the main OpenXR header file <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code> and the OpenXR platform header file <code class="docutils literal notranslate"><span class="pre">openxr_platform.h</span></code>.
For the OpenXR platform header file, note the preceding XR_USE_ macros. When enabled, we gain access to functionality that interact with the chosen graphics API and/or platform. We will enable one of these graphics ones later in the tutorial.
For Android, we include our <code class="docutils literal notranslate"><span class="pre">android_native_app_glue.h</span></code> header file as well as defining the <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_ANDROID</span></code> macro, which we will need to initialise the load the OpenXR loader.</p>
<p>Next, we‚Äôll add the DEBUG_BREAK macro to <code class="docutils literal notranslate"><span class="pre">HelperFunctions.h</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Debugbreak</span>
<span class="cp">#if defined(_MSC_VER)</span>
<span class="cp">#define DEBUG_BREAK __debugbreak()</span>
<span class="cp">#else</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="cp">#define DEBUG_BREAK raise(SIGTRAP)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>This defines the macro <code class="docutils literal notranslate"><span class="pre">DEBUG_BREAK</span></code>, according to which platform we‚Äôre building for. This macro will
stop execution of your program when an error occurs, so you can see where it happened and fix it.
We use this macro in the <code class="docutils literal notranslate"><span class="pre">OpenXRMessageCallbackFunction()</span></code> function, which we will discuss in <a class="reference internal" href="5-extensions.html"><span class="doc">Chapter 5.2.</span></a></p>
<p>In <code class="docutils literal notranslate"><span class="pre">OpenXRHelper.h</span></code>, add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define OPENXR_CHECK1(x, y)                                                                                                                           \</span>
<span class="cp">    {                                                                                                                                                   \</span>
<span class="cp">        XrResult result = (x);                                                                                                                          \</span>
<span class="cp">        if (!XR_SUCCEEDED(result)) {                                                                                                                    \</span>
<span class="cp">            std::cout &lt;&lt; &quot;ERROR: OPENXR: &quot; &lt;&lt; int(result) &lt;&lt; &quot;(&quot; &lt;&lt; result &lt;&lt; &quot;) &quot; &lt;&lt; y &lt;&lt; std::endl; \</span>
<span class="cp">        }                                                                                                                                               \</span>
<span class="cp">    }</span>

<span class="cp">#define OPENXR_CHECK(x, y)                                                                                                                              \</span>
<span class="cp">    {                                                                                                                                                   \</span>
<span class="cp">        XrResult result = (x);                                                                                                                          \</span>
<span class="cp">        if (!XR_SUCCEEDED(result)) {                                                                                                                    \</span>
<span class="cp">            std::cout &lt;&lt; &quot;ERROR: OPENXR: &quot; &lt;&lt; int(result) &lt;&lt; &quot;(&quot; &lt;&lt; (xrInstance ? GetXRErrorString(xrInstance, result) : &quot;&quot;) &lt;&lt; &quot;) &quot; &lt;&lt; y &lt;&lt; std::endl; \</span>
<span class="cp">        }                                                                                                                                               \</span>
<span class="cp">    }</span>

<span class="kr">inline</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">GetXRErrorString</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xr_instance</span><span class="p">,</span><span class="w"> </span><span class="n">XrResult</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">XR_MAX_RESULT_STRING_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">xrResultToString</span><span class="p">(</span><span class="n">xr_instance</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and in <code class="docutils literal notranslate"><span class="pre">Helperfunctions.h</span></code>, add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsStringInVector</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">item</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">found</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">checkValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">checkValue</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">checkValue</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This defines the macro <code class="docutils literal notranslate"><span class="pre">OPENXR_CHECK</span></code>. Many OpenXR functions return a <code class="docutils literal notranslate"><span class="pre">XrResult</span></code>. This macro will check if the call has failed and logs a message to stdout. This can be modified to suit your needs. There are three additional functions <code class="docutils literal notranslate"><span class="pre">GetXRErrorString()</span></code>, <code class="docutils literal notranslate"><span class="pre">IsStringInVector()</span></code> and <code class="docutils literal notranslate"><span class="pre">BitwiseCheck()</span></code>, which are just simple wrappers over commonly used code.</p>
<p>We can add the <code class="docutils literal notranslate"><span class="pre">GraphicsAPIs.h</span></code> header to include in turn all the Graphics API code along with the <code class="docutils literal notranslate"><span class="pre">OpenXRHelper.h</span></code> and <code class="docutils literal notranslate"><span class="pre">HelperFunctions.h</span></code> files. You can also include <code class="docutils literal notranslate"><span class="pre">OpenXRDebugUtils.h</span></code> to help with set up of <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerEXT</span></code>.</p>
<p>Now we will define the main class of the application. It‚Äôs just a stub for now, with an empty <code class="docutils literal notranslate"><span class="pre">Run()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorialChapter2</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorialChapter2</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorialChapter2</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Finally, let‚Äôs add the main function for the application. It will look slightly different, depending on your
chosen platform. We first create a ‚Äòpseudo-main function‚Äô called <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Main()</span></code>, in which we create an instance of our <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Ch2_1</span></code> class, and call the <a href="#id1"><span class="problematic" id="id2">``</span></a>Run()``method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">OpenXRTutorial_Main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DebugOutput</span><span class="w"> </span><span class="n">debugOutput</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="n">OpenXRTutorialChapter2</span><span class="w"> </span><span class="n">app</span><span class="p">(</span><span class="n">VULKAN</span><span class="p">);</span>
<span class="w">    </span><span class="n">app</span><span class="p">.</span><span class="n">Run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, we create the actual platform specific main function (our entry point to the application), which will call <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Main()</span></code>:</p>
<div class="windows-linux docutils container" id="id3">
<p class="rubric">Windows and Linux</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OpenXRTutorial_Main</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="android docutils container" id="id4">
<p class="rubric">Android</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">OpenXRTutorialChapter2</span><span class="o">::</span><span class="n">androidApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">OpenXRTutorialChapter2</span><span class="o">::</span><span class="n">AndroidAppState</span><span class="w"> </span><span class="n">OpenXRTutorialChapter2</span><span class="o">::</span><span class="n">androidAppState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">android_main</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Allow interaction with JNI and the JVM on this thread.</span>
<span class="w">    </span><span class="c1">// https://developer.android.com/training/articles/perf-jni#threads</span>
<span class="w">    </span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">;</span>
<span class="w">    </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">vm</span><span class="o">-&gt;</span><span class="n">AttachCurrentThread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>

<span class="w">    </span><span class="n">PFN_xrInitializeLoaderKHR</span><span class="w"> </span><span class="n">xrInitializeLoaderKHR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">XR_NULL_HANDLE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrInitializeLoaderKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrInitializeLoaderKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">xrInitializeLoaderKHR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">XrLoaderInitInfoAndroidKHR</span><span class="w"> </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">{</span><span class="n">XR_TYPE_LOADER_INIT_INFO_ANDROID_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">applicationVM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">vm</span><span class="p">;</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">clazz</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrInitializeLoaderKHR</span><span class="p">((</span><span class="n">XrLoaderInitInfoBaseHeaderKHR</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">loaderInitializeInfoAndroid</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to initialise Loader for Android.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">OpenXRTutorialChapter2</span><span class="o">::</span><span class="n">androidAppState</span><span class="p">;</span>
<span class="w">    </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">onAppCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OpenXRTutorialChapter2</span><span class="o">::</span><span class="n">AndroidAppHandleCmd</span><span class="p">;</span>

<span class="w">    </span><span class="n">OpenXRTutorialChapter2</span><span class="o">::</span><span class="n">androidApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">;</span>
<span class="w">    </span><span class="n">OpenXRTutorial_Main</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">androidApp</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Modified from https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/d6b6d7a10bdcf8d4fe806b4f415fde3dd5726878/src/tests/hello_xr/main.cpp#L133C1-L189C2</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">AndroidAppState</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANativeWindow</span><span class="w"> </span><span class="o">*</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">resumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">AndroidAppState</span><span class="w"> </span><span class="n">androidAppState</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Process the next main command.</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AndroidAppHandleCmd</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AndroidAppState</span><span class="w"> </span><span class="o">*</span><span class="n">appState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AndroidAppState</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">app</span><span class="o">-&gt;</span><span class="n">userData</span><span class="p">;</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// There is no APP_CMD_CREATE. The ANativeActivity creates the application thread from onCreate().</span>
<span class="w">        </span><span class="c1">// The application thread then calls android_main().</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_START</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_RESUME</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">resumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_PAUSE</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">resumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_STOP</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_DESTROY</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_INIT_WINDOW</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">APP_CMD_TERM_WINDOW</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">appState</span><span class="o">-&gt;</span><span class="n">nativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">PollSystemEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">destroyRequested</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">struct</span><span class="w"> </span><span class="nc">android_poll_source</span><span class="w"> </span><span class="o">*</span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timeoutMilliseconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">androidAppState</span><span class="p">.</span><span class="n">resumed</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">destroyRequested</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ALooper_pollAll</span><span class="p">(</span><span class="n">timeoutMilliseconds</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">source</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">source</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">androidApp</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Before we can use OpenXR for Android, we need to initialise the loader based the application‚Äôs context and virtual machine. We retrieve the function pointer to <code class="docutils literal notranslate"><span class="pre">xrInitializeLoaderKHR</span></code>, and with the <code class="docutils literal notranslate"><span class="pre">XrLoaderInitInfoAndroidKHR</span></code> filled out call that function to initialise OpenXR for our use. At this point, we also attach the current thread to the Java Virtual Machine. We assign our <code class="docutils literal notranslate"><span class="pre">AndroidAppState</span></code> static member and our <code class="docutils literal notranslate"><span class="pre">AndroidAppHandleCmd()</span></code> static method to the <code class="docutils literal notranslate"><span class="pre">android_app</span> <span class="pre">*</span></code> and save it to a static member in the class.</p>
</div>
<div class="windows docutils container" id="id5">
<p class="rubric">Windows</p>
<p>Now launch CMake GUI, and point the ‚ÄúWhere is the source code‚Äù box to the root of your solution <em>workspace</em> directory,
where your original <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> is located. Point the ‚ÄúWhere to build the binaries‚Äù box to a subdirectory called <code class="docutils literal notranslate"><span class="pre">build</span></code>,
click Configure, ‚ÄúYes‚Äù to create the build folder, and ‚ÄúOK‚Äù to accept the default Generator.</p>
<figure class="align-left">
<img alt="Select" src="_images/cmake-tutorial2-1.png" />
</figure>
<p>Now, we must tell the tutorial project where to find the OpenXR-SDK, which we built in Section 1.
Click on the variable <code class="docutils literal notranslate"><span class="pre">OPENXR_DIR</span></code> and type in or browse to the location of the OpenXR-SDK repository you downloaded
previously, the click ‚ÄúGenerate‚Äù. When the projects have been generated, open your new project, by clicking
‚ÄúOpen Project‚Äù, or by finding the file Tutorial.sln in your build folder and open it.</p>
</div>
<div class="linux docutils container" id="id6">
<p class="rubric">Linux</p>
<p>You now have three files, laid out as follows:</p>
<figure class="align-default">
<img alt="Initial files in VS Code" src="_images/linux-vscode-initial-files.png" />
</figure>
<p>Having installed the CMake extension for Visual Studio Code, you can now right-click on the main <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file (the one in the root <em>workspace</em> folder) and select ‚ÄúConfigure All Projects‚Äù:</p>
<figure class="align-default">
<img alt="Select" src="_images/linux-vscode-cmake-configure.png" />
</figure>
<p>Now the CMake panel will be available by clicking its icon on the leftmost panel. Hover your mouse over the ‚ÄúProject Outline‚Äù
and click the three dots at the right. An option to ‚ÄúEdit CMake Cache‚Äù will appear, click this and you‚Äôll see the Cache Editor
page.</p>
<figure class="align-default">
<img alt="Select" src="_images/linux-vscode-cmake-more-actions.png" />
</figure>
<figure class="align-default">
<img alt="Select" src="_images/linux-vscode-cmake-cache.png" />
</figure>
<p>NOTE: It‚Äôs possible to use CMake GUI in Linux, but using Visual Studio Code‚Äôs integrated tools works better with Visual Studio Code.</p>
<p>In the CMake Cache editor, find <code class="docutils literal notranslate"><span class="pre">OPENXR_DIR</span></code> and enter the directory where you downloaded OpenXR-SDK in Chapter 1.
We can now select ‚ÄúConfigure and Build All‚Äù from the right-click menu of the main <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
</div>
<div class="windows docutils container" id="id7">
<p class="rubric">Windows</p>
<p>You can now build and run your program. It should compile and link with no errors or warnings.</p>
</div>
<div class="linux docutils container" id="id8">
<p class="rubric">Linux</p>
<p>To enable debugging, select the Run/Debug panel in Visual Studio Code. You will now need to create a debugging configuration.
Click the ‚ÄúGear‚Äù icon to edit the file launch.json, and enter the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cppdbg&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chapter_2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}/build/Chapter_2/Chapter_2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="s2">&quot;${workspaceFolder}/Chapter_2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;externalConsole&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="android docutils container" id="id9">
<p>With all the source and build systems set up, we can now build the Android project. In upper right of Android Studio, you should find the toolbar below. Click the green hammer icon to build the project, if all is successful you should see ‚ÄúBUILD SUCCESSFUL in [‚Ä¶]s‚Äù in the Build Output window.</p>
<p>Next to the green hammer icon is the Run/Debug configuration dropdown menu. If that isn‚Äôt populated, create a configuration called app.</p>
<p>Turn on and connect your Android device. Set up any requirments for USB debugging and adb. You device should appear in the dropdown. Here, I am using a Oculus Quest 2.</p>
<figure class="align-default">
<img alt="Build/Run Toolbar" src="_images/android-studio-build-run-toolbar.png" />
</figure>
<p>To debug/run the application click the green bug icon.</p>
</div>
<p>Now that we have a basic application up and running with the OpenXR header files and libraries, we can start to set up the core aspects of OpenXR. As a modern Khronos API, the OpenXR is heavily influcencd by the Vulkan API. So those who are familiar with the style of the Vulkan API will find OpenXR easy to follow.</p>
<section id="creating-an-xrinstance-xrgetsystem">
<h2>Creating an XrInstance / xrGetSystem<a class="headerlink" href="#creating-an-xrinstance-xrgetsystem" title="Permalink to this heading">¬∂</a></h2>
<p>Firstly, add to the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class the methods: <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetSystemID()</span></code> and <code class="docutils literal notranslate"><span class="pre">DestroyInstance()</span></code>. Update <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> to call those methods in that order and add to the class in a private section the following members.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorialChapter2</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorialChapter2</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorialChapter2</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="xrinstance">
<h3>XrInstance<a class="headerlink" href="#xrinstance" title="Permalink to this heading">¬∂</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> is the foundational object that we need to create first. The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> encompasses the application setup state, OpenXR API version and any layers and extensions. So inside the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, we will first look at the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrApplicationInfo</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">applicationName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2&quot;</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">engineName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Engine&quot;</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">AI</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_CURRENT_API_VERSION</span><span class="p">;</span>
</pre></div>
</div>
<p>This structure allows you specify both the name and the version for your application and engine. These members are solely for your use as the application developer. The main member here is the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::apiVersion</span></code>. Here we use the <code class="docutils literal notranslate"><span class="pre">XR_CURRENT_API_VERSION</span></code> macro to specific the OpenXR version that we want to run. Also note here the use of <code class="docutils literal notranslate"><span class="pre">strcpy()</span></code> to set the applicationName and engineName. If you look at <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::applicationName</span></code> and <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::engineName</span></code> members, they are of type <code class="docutils literal notranslate"><span class="pre">char[]</span></code>, hence you must copy your string into that <code class="docutils literal notranslate"><span class="pre">char[]</span></code> and you must also by aware of the allowable length.</p>
<p>Similar to Vulkan, OpenXR allows applications to extend functionality past what is provided by the core specification. The functionality could be hardware/vendor specific. Most vital of course is which Graphics API to use with OpenXR. OpenXR supports D3D11, D3D12, Vulkan, OpenGL and OpenGL ES. Due the extensible nature of specification, it allows newer Graphics APIs and hardware functionality to be added with ease.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">);</span>
<span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">GetGraphicsAPIInstanceExtensionString</span><span class="p">(</span><span class="n">apiType</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, we store in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code> the extension names that we would like to use. <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> is a macro of a string defined in <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code>. The XR_EXT_debug_utils is extension that checks the validity of calls made to OpenXR, and can use a call back function to handle any raised errors. We will explore this extension more in <a class="reference internal" href="5-extensions.html"><span class="doc">Chapter 5.2.</span></a> Depending on which <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macro that you have defined, this code will add the relevant extension.</p>
<p>Not all API layers and extensions are available to use, so we much check which ones can use. We will use <code class="docutils literal notranslate"><span class="pre">xrEnumerateApiLayerProperties()</span></code> and <code class="docutils literal notranslate"><span class="pre">xrEnumerateInstanceExtensionProperties()</span></code> to check which ones the runtime can provide.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">apiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrApiLayerProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_API_LAYER_PROPERTIES</span><span class="p">});</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestLayer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">layerProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">layerProperty</span><span class="p">.</span><span class="n">layerName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">activeAPILayers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="n">extensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_EXTENSION_PROPERTIES</span><span class="p">});</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instanceExtensions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These functions are called twice. The first time is to get the count of the API layers or extensions and the second is to fill out the array of structures. Before the second call, we need set <code class="docutils literal notranslate"><span class="pre">XrApiLayerProperties::type</span></code> or <code class="docutils literal notranslate"><span class="pre">XrExtensionProperties::type</span></code> to the correct value, so that the second call can correctly fill out the data. After we have enumerated the API layers and extensions, we use a nested loop to check to see whether an API layers or extensions is availble and add it to the activeAPILayers and/or activeInstanceExtensions respectively. Note the activeAPILayers and activeInstanceExtensions are of type <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code>. This will help us when fill out the next structure <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_CREATE_INFO</span><span class="p">};</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">applicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeAPILayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeAPILayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This section is fairly simple, as we now just collect data from before and assign them to members in the <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> structure. Finally, we get to call <code class="docutils literal notranslate"><span class="pre">xrCreateInstance()</span></code> where we take pointers to the stack <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> objects. If the function succeeded, the result will be <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> will be non-null.</p>
<p>At the end of the application, we should destroy the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>. This is simple done with the function <code class="docutils literal notranslate"><span class="pre">xrDestroyInstance()</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">DestroyInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroyInstance</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Instance.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Whilst we have an <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, let‚Äôs check its properties. We fill out the type and next members of the structure <code class="docutils literal notranslate"><span class="pre">XrInstanceProperties</span></code> and pass it along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetInstanceProperties()</span></code>. This function will fill out the rest of that structure for us to use. Here, we simply log to stdout the runtime‚Äôs name, and with the use of the <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MAJOR</span></code>, <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MINOR</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_VERSION_PATCH</span></code> macros, we parse and log the runtime version.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GetInstanceProperties</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrInstanceProperties</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_PROPERTIES</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProperties</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProperties.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Runtime: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_PATCH</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="xrsystemid">
<h3>XrSystemId<a class="headerlink" href="#xrsystemid" title="Permalink to this heading">¬∂</a></h3>
<p>The next object that we want to get is the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>. OpenXR ‚Äòseparates the concept of physical systems of XR devices from the logical objects that applications interact with directly. A system represents a collection of related devices in the runtime, often made up of several individual hardware components working together to enable XR experiences‚Äô.
<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#system">OpenXR Specification 5. System</a>.</p>
<p>So, a <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> could represent VR headset and a pair of contollers, or perhaps mobile device with video pass-through for AR. So we need to decide what type of <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code> we are wanting to use, as some runtimes support multiple form factors. Here, we are selecting <code class="docutils literal notranslate"><span class="pre">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span></code>, which is initialised in the class, for a Meta Quest or Pico Neo. OpenXR currently offers two option for the <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrFormFactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HANDHELD_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrFormFactor</span><span class="p">;</span>
</pre></div>
</div>
<p>We fill out the <code class="docutils literal notranslate"><span class="pre">XrSystemGetInfo</span></code> structure as desired and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and a pointer to the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetSystem()</span></code>. If successful, we should now have a non-null <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GetSystemID</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrSystemGetInfo</span><span class="w"> </span><span class="n">systemGI</span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_GET_INFO</span><span class="p">};</span>
<span class="w">    </span><span class="n">systemGI</span><span class="p">.</span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formFactor</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystem</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemGI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemID</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemID.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrSystemProperties</span><span class="w"> </span><span class="n">systemProperties</span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_PROPERTIES</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystemProperties</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemProperties.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now also get the system‚Äôs properties. We partially fill out a <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetSystemProperties()</span></code>. This function will fill out the rest of the <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure; detailing the vendor‚Äôs ID, system‚Äôs name and the system‚Äôs graphics and tracking properties.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemGraphicsProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageHeight</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxLayerCount</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemGraphicsProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemTrackingProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">orientationTracking</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">positionTracking</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemTrackingProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">               </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">            </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemId</span><span class="w">                    </span><span class="n">systemId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">                      </span><span class="n">vendorId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w">                          </span><span class="n">systemName</span><span class="p">[</span><span class="n">XR_MAX_SYSTEM_NAME_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XrSystemGraphicsProperties</span><span class="w">    </span><span class="n">graphicsProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemTrackingProperties</span><span class="w">    </span><span class="n">trackingProperties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemProperties</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-an-xrsession">
<h2>Creating an XrSession<a class="headerlink" href="#creating-an-xrsession" title="Permalink to this heading">¬∂</a></h2>
<p>The next major component of OpenXR that needs to be created in an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. An <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> encapulates the state of application from the perspective of OpenXR. When an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> is created, it starts in the <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_IDLE</span></code>. It is upto the runtime to provide any updates to the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> and for the appliaction to query them and react to them. We will explore this in <span class="xref std std-doc">Chapter 2.3.</span></p>
<p>For now, we are just going to create an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. At this point, you‚Äôll need to select which Graphics API you wish to use. Only one Graphics API can be used with an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. This tutorial demostrates how to use D3D11, D3D12, OpenGL, OpenGL ES and Vulkan in conjunction with OpenXR for the purpose of rendering graphics to the provided views. Ultimately, you will most likely be bringing your own rendering solution to this tutorial, therefore the code examples provided for the Graphics APIs are <cite>placeholders</cite> for you own code base; demostrating in this sub-chapter what objects are needed from your Graphics API in order to create an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. This tutorial uses polymorphic classes <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> which derives from <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code>. There are both compile and runtime checks to select the requested Graphics API, and we construct an apropriate derived classes throught the use of <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;&gt;</span></code>.</p>
<p>Update the Constructor and <code class="docutils literal notranslate"><span class="pre">Run()</span></code> method as shown and add the following members:
<code class="docutils literal notranslate"><span class="pre">CheckGraphicsAPI_TypeIsValidForPlatform()</span></code> is declared in <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorialChapter2</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorialChapter2</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">api</span><span class="p">)</span>
<span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">apiType</span><span class="p">(</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CheckGraphicsAPI_TypeIsValidForPlatform</span><span class="p">(</span><span class="n">apiType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: The provided Graphics API is not valid for this platform.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// [...]</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GraphicsAPI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>

<span class="w">        </span><span class="n">XrSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="xrsession">
<h3>XrSession<a class="headerlink" href="#xrsession" title="Permalink to this heading">¬∂</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateSession</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrSessionCreateInfo</span><span class="w"> </span><span class="n">sessionCI</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_CREATE_INFO</span><span class="p">};</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D11)</span>
<span class="w">            </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D12)</span>
<span class="w">            </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL)</span>
<span class="w">            </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL_ES</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL_ES)</span>
<span class="w">            </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">VULKAN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(XR_USE_GRAPHICS_API_VULKAN)</span>
<span class="w">            </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_Vulkan</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Unknown Graphics API.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sessionCI</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetGraphicsBinding</span><span class="p">();</span>
<span class="w">        </span><span class="n">sessionCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">sessionCI</span><span class="p">.</span><span class="n">systemId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">systemID</span><span class="p">;</span>

<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSession</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DestroySession</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroySession</span><span class="p">(</span><span class="n">session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Above is the code for creating and destroying an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. <code class="docutils literal notranslate"><span class="pre">xrDestroySession()</span></code> will destroy the <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> when we have finished and shutting down the application. <code class="docutils literal notranslate"><span class="pre">xrCreateSession()</span></code> takes the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> return object. If the function call was successful, <code class="docutils literal notranslate"><span class="pre">xrCreateSession()</span></code> will return <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> will be non-null. The <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo</span></code> structure is deceptively simple. <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::createFlags</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::systemId</span></code> are easily filled in, but we need to specify which Graphics APIs we wish to use. This is achieved via the use of the <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code> void pointer. Following the Vulkan API‚Äôs style of extensibility, structures for creating objects can be extended to enable extra functionality. In our case, the extension is required and thus <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code> can not be a nullptr. That pointer must point to ‚Äòexactly one graphics API binding structure (a structure whose name begins with ‚ÄúXrGraphicsBinding‚Äù)‚Äô (<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo(3) Manual Page</a>).</p>
</section>
<section id="graphicsapi">
<h3>GraphicsAPI<a class="headerlink" href="#graphicsapi" title="Permalink to this heading">¬∂</a></h3>
<div class="d3d11 docutils container" id="d3d11-id-1">
<p class="rubric">DirectX 11</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D11</span><span class="o">::</span><span class="n">GraphicsAPI_D3D11</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D11GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D11.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory1</span><span class="p">(</span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">D3D11CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">D3D_DRIVER_TYPE_UNKNOWN</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_CREATE_DEVICE_DEBUG</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_SDK_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">immediateContext</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D11 Device.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D11</span><span class="o">::~</span><span class="n">GraphicsAPI_D3D11</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">immediateContext</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable <code class="docutils literal notranslate"><span class="pre">ID3D11Device</span> <span class="pre">*</span></code>. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetD3D11GraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D11KHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">LUID</span><span class="w">                  </span><span class="n">adapterLuid</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D_FEATURE_LEVEL</span><span class="w">     </span><span class="n">minFeatureLevel</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="p">;</span>
</pre></div>
</div>
<p>From this structure, we use the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> to find the approiate <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter</span> <span class="pre">*</span></code>. We create a <code class="docutils literal notranslate"><span class="pre">IDXGIFactory1</span> <span class="pre">*</span></code> and then call <code class="docutils literal notranslate"><span class="pre">IDXGIFactory1::EnumAdapters()</span></code> and <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter::GetDesc()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">DXGI_ADAPTER_DESC</span></code>, so that we can compare the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> values.</p>
<p>Finally, we call <code class="docutils literal notranslate"><span class="pre">D3D11CreateDevice</span></code> with found adapter and the <code class="docutils literal notranslate"><span class="pre">minFeatureLevel</span></code> from <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D11KHR</span></code>, if successful the function will return <code class="docutils literal notranslate"><span class="pre">S_OK</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D11Device</span> <span class="pre">*</span></code> is non-null.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_D3D11::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingD3D11KHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="d3d12 docutils container" id="d3d12-id-1">
<p class="rubric">DirectX 12</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D12</span><span class="o">::</span><span class="n">GraphicsAPI_D3D12</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D12GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D12.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter1</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">LowPart</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">.</span><span class="n">HighPart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">D3D12CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Device.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_COMMAND_QUEUE_DESC</span><span class="w"> </span><span class="n">commandQueueDesc</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_LIST_TYPE_DIRECT</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_QUEUE_FLAG_NONE</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">NodeMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateCommandQueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">commandQueueDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Command Queue.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D12</span><span class="w"> </span><span class="o">::~</span><span class="n">GraphicsAPI_D3D12</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable <code class="docutils literal notranslate"><span class="pre">ID3D12Device</span> <span class="pre">*</span></code>  and <code class="docutils literal notranslate"><span class="pre">ID3D12CommandQueue</span> <span class="pre">*</span></code>. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetD3D12GraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D12KHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">LUID</span><span class="w">                  </span><span class="n">adapterLuid</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D_FEATURE_LEVEL</span><span class="w">     </span><span class="n">minFeatureLevel</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="p">;</span>
</pre></div>
</div>
<p>From this structure, we use the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> to find the approiate <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter1</span> <span class="pre">*</span></code>. We create a <code class="docutils literal notranslate"><span class="pre">IDXGIFactory4</span> <span class="pre">*</span></code> and then call <code class="docutils literal notranslate"><span class="pre">IDXGIFactory4::EnumAdapters1()</span></code> and <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter1::GetDesc()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">DXGI_ADAPTER_DESC</span></code>, so that we can compare the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> values.</p>
<p>Finally, we call <code class="docutils literal notranslate"><span class="pre">D3D12CreateDevice</span></code> with found adapter and the <code class="docutils literal notranslate"><span class="pre">minFeatureLevel</span></code> from <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D12KHR</span></code>, if successful the function will return <code class="docutils literal notranslate"><span class="pre">S_OK</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D12Device</span> <span class="pre">*</span></code> is non-null. Next, we create a simple a <code class="docutils literal notranslate"><span class="pre">ID3D12CommandQueue</span> <span class="pre">*</span></code> of type <code class="docutils literal notranslate"><span class="pre">D3D12_COMMAND_LIST_TYPE_DIRECT</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_D3D12::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingD3D12KHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="opengl docutils container" id="opengl-id-1">
<p class="rubric">OpenGL</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGL.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L103-L121</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="o">=</span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="o">=</span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: The created OpenGL version &quot;</span><span class="o">&lt;&lt;</span><span class="n">glMajorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot;.&quot;</span><span class="o">&lt;&lt;</span><span class="n">glMinorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot; doesn&#39;t meet the minimum requried API version &quot;</span><span class="o">&lt;&lt;</span><span class="n">requiredMajorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot;.&quot;</span><span class="o">&lt;&lt;</span><span class="n">requiredMinorVersion</span><span class="o">&lt;&lt;</span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">GraphicsAPI_OpenGL</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable OpenGL context. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetOpenGLGraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="p">;</span>
</pre></div>
</div>
<p>In this tutorial, we are using the ‚Äògfxwrapper‚Äô for the OpenGL API found as a part of the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a> reposity under <code class="docutils literal notranslate"><span class="pre">src/common/</span></code>. Originally developed by Oculus VR, LLC and The Brenwill Workshop Ltd.; this wrapper is written against the <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/gl/glspec43.core.pdf">OpenGL 4.3</a> and <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/es/3.1/es_spec_3.1.withchanges.pdf">OpenGL ES 3.1</a> specifications.</p>
<p>Here, we call <code class="docutils literal notranslate"><span class="pre">ksGpuWindow_Create()</span></code> and pass the required parameters to setup the OpenGL context. Next, we query the OpenGL version with <code class="docutils literal notranslate"><span class="pre">glGetIntegerv()</span></code> with <code class="docutils literal notranslate"><span class="pre">GL_MAJOR_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">GL_MINOR_VERSION</span></code>. With these values, we can contruct a <code class="docutils literal notranslate"><span class="pre">XrVersion</span></code> value to compare with <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLKHR::minApiVersionSupported</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_OpenGL::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L123-L144</span>
<span class="cp">#if defined(XR_USE_PLATFORM_WIN32)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_WIN32_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">hDC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">hDC</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">hGLRC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">hGLRC</span><span class="p">;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_XLIB)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_XLIB_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">xDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">xDisplay</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">visualid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">visualid</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxFBConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxFBConfig</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxDrawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxDrawable</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxContext</span><span class="p">;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_XCB)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_XCB_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// TODO: Still missing the platform adapter, and some items to make this usable.</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">connection</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.screenNumber = window.context.screenNumber;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.fbconfigid = window.context.fbconfigid;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">visualid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">visualid</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxDrawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxDrawable</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.glxContext = window.context.glxContext;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_WAYLAND)</span>
<span class="w">    </span><span class="c1">// TODO: Just need something other than NULL here for now (for validation).  Eventually need</span>
<span class="w">    </span><span class="c1">//       to correctly put in a valid pointer to an wl_display</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_WAYLAND</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">wl_display</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because OpenGL is very closely integrated with the platform‚Äôs windowing system. We have different <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGL[...]KHR</span></code> structures - one per platform. At present, there are four: <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLXcbKHR</span></code>, <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLXlibKHR</span></code>, <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLWaylandKHR</span></code> and <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLWin32KHR</span></code>. Depending on the platform, we fill out the relevant structure and return a pointer to that class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="opengles docutils container" id="opengles-id-1">
<p class="rubric">OpenGL ES</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLESGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_ES_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGLES.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengles.cpp#L101-L119</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: The created OpenGL ES version doesn&#39;t meet the minimum requried API version for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable OpenGL ES context. First, we need to get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetOpenGLESGraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLESKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="p">;</span>
</pre></div>
</div>
<p>In this tutorial, we are using the ‚Äògfxwrapper‚Äô for the OpenGL ES API found as a part of the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a> reposity under <code class="docutils literal notranslate"><span class="pre">src/common/</span></code>. Originally developed by Oculus VR, LLC and The Brenwill Workshop Ltd.; this wrapper is written against the <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/gl/glspec43.core.pdf">OpenGL 4.3</a> and <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/es/3.1/es_spec_3.1.withchanges.pdf">OpenGL ES 3.1</a> specifications.</p>
<p>Here, we call <code class="docutils literal notranslate"><span class="pre">ksGpuWindow_Create()</span></code> and pass the required parameters to setup the OpenGL ES context. Next, we query the OpenGL ES version with <code class="docutils literal notranslate"><span class="pre">glGetIntegerv()</span></code> with <code class="docutils literal notranslate"><span class="pre">GL_MAJOR_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">GL_MINOR_VERSION</span></code>. With these values, we can contruct a <code class="docutils literal notranslate"><span class="pre">XrVersion</span></code> value to compare with <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLESKHR::minApiVersionSupported</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_OpenGL_ES::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_ES_ANDROID_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">display</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">config</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLESAndroidKHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>. Note: This <code class="docutils literal notranslate"><span class="pre">XrGraphicsBinding...</span></code> structure differs from the others as it specifically tailored to the Android platform.</p>
</div>
<div class="vulkan docutils container" id="vulkan-id-1">
<p class="rubric">Vulkan</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Instance</span>
<span class="w">    </span><span class="n">LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for Vulkan.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkApplicationInfo</span><span class="w"> </span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pApplicationName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pEngineName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan Engine&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">;</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">instanceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">instanceExtensionCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrInstanceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrInstanceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pApplicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Vulkan Instance.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Physical Device</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">physicalDeviceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkPhysicalDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">physicalDeviceCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkPhysicalDevice</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceFromXR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Device for Vulkan.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">physicalDeviceFromXR_it</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Vulkan: Failed to find PhysicalDevice for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Select the first available device.</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Device</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkQueueFamilyProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">queueFamilyPropertiesCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyPropertiesCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkDeviceQueueCreateInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">;</span>
<span class="w">    </span><span class="n">queuePriorities</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>

<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pQueuePriorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFlags</span><span class="p">,</span><span class="w"> </span><span class="n">VkQueueFlags</span><span class="p">(</span><span class="n">VK_QUEUE_GRAPHICS_BIT</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">deviceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">deviceExtensionCount</span><span class="p">);</span>

<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrDeviceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrDeviceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkPhysicalDeviceFeatures</span><span class="w"> </span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceFeatures</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkDeviceCreateInfo</span><span class="w"> </span><span class="n">deviceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">queueCreateInfoCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pQueueCreateInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pEnabledFeatures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateDevice</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Device.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_Vulkan</span><span class="o">::~</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">vkDestroyDevice</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above is the minimum code needed to create a suitable Vulkan Instance and Device. First, we call helper method that loads in the pointers for the following functions:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsRequirementsKHR</span></code>: Used to fill out a <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR</span></code> structure containing the minimum and maximum supported API version.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR</span></code>: To retrieve a list of required <code class="docutils literal notranslate"><span class="pre">VkInstance</span></code> extensions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanDeviceExtensionsKHR</span></code>: To retrieve a list of required <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code> extensions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsDeviceKHR</span></code>:  To get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> requested by OpenXR.</p></li>
</ul>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GraphicsAPI_Vulkan::LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanInstanceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanDeviceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsDeviceKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now call <code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsRequirementsKHR()</span></code> and fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, we fill out a <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo</span></code> where we assign <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo::apiVersion</span></code> the value in <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR::minApiVersionSupported</span></code>. We can now enumerate the Instance extensions and fill out array of structures. We use nested for-loops to find all the requested extensions push them back into a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code> called <code class="docutils literal notranslate"><span class="pre">activeInstanceExtensions</span></code>.
<code class="docutils literal notranslate"><span class="pre">GetInstanceExtensionsForOpenXR()</span></code> is another helper method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR()</span></code> is called twice, first to get the size of the <code class="docutils literal notranslate"><span class="pre">char</span></code> buffer and the second to fill in the data. We use <code class="docutils literal notranslate"><span class="pre">std::stringstream</span></code> and <code class="docutils literal notranslate"><span class="pre">std::getline()</span></code> with a deliminator of <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to break up the string and copy that subcontexts to an element in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code>, which we use when setting the instance extensions.</p>
<p>We fill out the <code class="docutils literal notranslate"><span class="pre">VkInstanceCreateInfo</span></code> structure and call <code class="docutils literal notranslate"><span class="pre">vkCreateInstance()</span></code>, which if successful will return <code class="docutils literal notranslate"><span class="pre">VK_SUCCESS</span></code> and the <code class="docutils literal notranslate"><span class="pre">VkInstance</span></code> will be non-null.</p>
<p>Next, we enumerate the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> s. Once we have array of all the physical devices in the system, we can call <code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsDeviceKHR()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> that OpenXR has requested. We can check the requested physical device against the array of physical devices to select the correct one.</p>
<p>With a <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> selected, we can now create a <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code>. We get the <code class="docutils literal notranslate"><span class="pre">VkQueueFamilyProperties</span></code> from the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> and fill an array of <code class="docutils literal notranslate"><span class="pre">VkDeviceQueueCreateInfo</span></code>. We find the first queue family that supports graphics operations and select its index as the <code class="docutils literal notranslate"><span class="pre">queueFamilyIndex</span></code> and we also select the first queue in that family too. We can now enumerate the Device extensions and fill out array of structures. We use nested for-loops to find all the requested extensions push them back into a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code> called <code class="docutils literal notranslate"><span class="pre">activeDeviceExtensions</span></code>.
<code class="docutils literal notranslate"><span class="pre">GetDeviceExtensionsForOpenXR()</span></code> is another helper method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Like with <code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR()</span></code>, <code class="docutils literal notranslate"><span class="pre">xrGetVulkanDeviceExtensionsKHR()</span></code> is called twice, first to get the size of the <code class="docutils literal notranslate"><span class="pre">char</span></code> buffer and the second to fill in the data. We use <code class="docutils literal notranslate"><span class="pre">std::stringstream</span></code> and <code class="docutils literal notranslate"><span class="pre">std::getline()</span></code> with a deliminator of <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to break up the string and copy that subcontexts into an element in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code>, which we use when setting the device extensions.</p>
<p>Finally, we get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDeviceFeatures</span></code> by calling <code class="docutils literal notranslate"><span class="pre">vkGetPhysicalDeviceFeatures()</span></code> and we can fill in the <code class="docutils literal notranslate"><span class="pre">VkDeviceCreateInfo</span></code>. We call <code class="docutils literal notranslate"><span class="pre">vkCreateDevice()</span></code>, which if successful will return <code class="docutils literal notranslate"><span class="pre">VK_SUCCESS</span></code> and the <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code> will be non-null.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_Vulkan::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevice</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingVulkanKHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
</section>
</section>
<section id="polling-the-event-loop">
<h2>Polling the Event Loop<a class="headerlink" href="#polling-the-event-loop" title="Permalink to this heading">¬∂</a></h2>
<p>OpenXR uses an event based system to describes changes with the XR system. It‚Äôs the application‚Äôs responsibility to poll these events and react to them. The polling of events is done by the function <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code>. The application should continually call this function throughout its lifetime. Within a single XR frame, the application should continuously call <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> until the internal event queue is ‚Äòdrained‚Äô; multiple events can occurs across the XR frame and the application needs to handle and respond to each accordingly.</p>
<p>Firstly, we will update the class to add the new methods and members.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorialChapter2</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>

<span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">applicationRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">PollSystemEvents</span><span class="p">();</span>
<span class="w">                        </span><span class="n">PollEvents</span><span class="p">();</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="c1">// Draw Frame.</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="n">XrViewConfigurationType</span><span class="w"> </span><span class="n">viewConfiguration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// [...]</span>

<span class="w">        </span><span class="n">XrSessionState</span><span class="w"> </span><span class="n">sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="xrpollevent">
<h3>xrPollEvent()<a class="headerlink" href="#xrpollevent" title="Permalink to this heading">¬∂</a></h3>
<p>Next, we will define the <code class="docutils literal notranslate"><span class="pre">PollEvents()</span></code> method. Here, we use a do-while loop to the check the result of <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> - whilst that function returns <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code>, there are events for us to process. <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> will fill in the <code class="docutils literal notranslate"><span class="pre">XrEventDataBuffer</span></code> structure that we pass to the function call. <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> will update the member variable <code class="docutils literal notranslate"><span class="pre">type</span></code> and from this we can use a switch statement to select the appropriate code path. Depending on the updated type, we can use a <code class="docutils literal notranslate"><span class="pre">reinterpret_cast&lt;&gt;()</span></code> to get the actual data that <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> returned.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">PollEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrEventDataBuffer</span><span class="w"> </span><span class="n">eventData</span><span class="p">{</span><span class="n">XR_TYPE_EVENT_DATA_BUFFER</span><span class="p">};</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrPollEvent</span><span class="p">(</span><span class="n">xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>

<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">eventData</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_EVENTS_LOST</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*</span><span class="n">eventsLost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Events Lost: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eventsLost</span><span class="o">-&gt;</span><span class="n">lostEventCount</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*</span><span class="n">instanceLossPending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Instance Loss Pending at: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceLossPending</span><span class="o">-&gt;</span><span class="n">lossTime</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="n">applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*</span><span class="n">interactionProfileChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Interaction Profile changed for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interactionProfileChanged</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*</span><span class="n">referenceSpaceChangePending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARN: OPENXR: Reference Space Change pending for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">referenceSpaceChangePending</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*</span><span class="n">sessionStateChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">                    </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfiguration</span><span class="p">;</span>
<span class="w">                    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                    </span><span class="n">applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>The description of the events come from <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#_xrpollevent">2.22.1. Event Polling of the OpenXR specification</a>.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Event Structure Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_EVENTS_LOST</p></td>
<td><p>XrEventDataEventsLost</p></td>
<td><p>The event queue has overflowed and some events were lost.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</p></td>
<td><p>XrEventDataInstanceLossPending</p></td>
<td><p>The application is about to lose the instance.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</p></td>
<td><p>XrEventDataInteractionProfileChanged</p></td>
<td><p>The active input form factor for one or more top level user paths has changed.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</p></td>
<td><p>XrEventDataReferenceSpaceChangePending</p></td>
<td><p>The runtime will begin operating with updated space bounds.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</p></td>
<td><p>XrEventDataSessionStateChanged</p></td>
<td><p>The application has changed its lifecycle state.</p></td>
</tr>
</tbody>
</table>
<p>As described in the table above, most event are transparent in their intensions and how the application should react to them. For the <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span></code> state, the application may want to try re-creating the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> in a loop, after the specified <code class="docutils literal notranslate"><span class="pre">lossTime</span></code>, until it can create a new instance successfully. <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span></code> are used for updating how the user interacts with the application and whether a new space change has been detected respectively.</p>
</section>
<section id="xrsessionstate">
<h3>XrSessionState<a class="headerlink" href="#xrsessionstate" title="Permalink to this heading">¬∂</a></h3>
<p>The final one, <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span></code>, is what we will focus on for the rest of this chapter. There are currently nine valid <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> s described:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrSessionState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_IDLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_READY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_SYNCHRONIZED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_VISIBLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_FOCUSED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_LOSS_PENDING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSessionState</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_UNKNOWN</p></td>
<td><p>This is an unknown, pseudo-default state and should not be returned by the runtime.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_IDLE</p></td>
<td><p>This is an inital state after creating or after ending the session.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_READY</p></td>
<td><p>This state, raised from the runtime, indicates that the session is ready to begin.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_SYNCHRONIZED</p></td>
<td><p>The application has synced its frame loop with the runtime, but isn‚Äôt displaying its contents.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_VISIBLE</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_FOCUSED</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents and can receive XR inputs.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_STOPPING</p></td>
<td><p>The runtime is requesting that the application stop it frame loop rendering and end the session.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_LOSS_PENDING</p></td>
<td><p>The runtime is indicating that current session is no longer valid and should be destroyed. (*)</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_EXITING</p></td>
<td><p>The runtime is requesting that the application to destroy the session, usually from the user‚Äôs request.</p></td>
</tr>
</tbody>
</table>
<p>(*) Applications may wish to re-create objects like <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>, if hardware changes were detected.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/openxr-session-life-cycle.svg"><img alt="OpenXR Session Life-Cycle" src="_images/openxr-session-life-cycle.svg" width="99%" /></a>
</figure>
</section>
<section id="xrbeginsession-and-xrendsession">
<h3>xrBeginSession() and xrEndSession()<a class="headerlink" href="#xrbeginsession-and-xrendsession" title="Permalink to this heading">¬∂</a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> is <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_READY</span></code>, the application can call <code class="docutils literal notranslate"><span class="pre">xrBeginSession()</span></code>.
In the <code class="docutils literal notranslate"><span class="pre">XrSessionBeginInfo</span></code> structure, we assign to <code class="docutils literal notranslate"><span class="pre">XrSessionBeginInfo::primaryViewConfigurationType</span></code> the <code class="docutils literal notranslate"><span class="pre">viewConfiguration</span></code> from the class, which in our case is <code class="docutils literal notranslate"><span class="pre">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span></code>. This specifies the view configuration of the form factor‚Äôs primary display - For Head Mounted Displays, it is two views (one per eye).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">                    </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfiguration</span><span class="p">;</span>
<span class="w">                    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> is <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_STOPPING</span></code>, the application should call <code class="docutils literal notranslate"><span class="pre">xrEndSession()</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="n">sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


						</div>
					</div>
					<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1-introduction.html" class="btn btn-neutral float-left" title="üëã 1 Introduction" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3-graphics.html" class="btn btn-neutral float-right" title="üëæ 3 Graphics" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>&#169; Copyright &#34;OpenXR&#34; and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom.</p>
  </div> 

</footer>
				</div>
			</div>
		</div>
	</div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>