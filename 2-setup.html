<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>2 OpenXR Setup &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="stylesheet" href="_static/copybutton.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<link rel="canonical" href="https://openxr-tutorial.simul.co/2-setup.html" >
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="_static/clipboard.min.js"></script>
	<script src="_static/copybutton.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="next" title="3 Graphics" href="3-graphics.html" >
	<link rel="prev" title="1 Introduction" href="1-introduction.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	var currentPlatform="all";
	var currentAPI="all";
	function setPlatform(pl)
	{
		currentPlatform=pl;
		if(navigator.cookieEnabled)
			Cookies.set('platform', pl, { expires: 365,sameSite: "strict"});
	}
	function setGraphicsAPI(a)
	{
		currentAPI=a;
		if(navigator.cookieEnabled)
			Cookies.set('graphicsapi', a, { expires: 365,sameSite: "strict"});
	}
	function getPlatform()
	{
		if(currentPlatform=="all"&&navigator.cookieEnabled)
		{
			currentPlatform=Cookies.get("platform");
			if (typeof currentPlatform == 'undefined')
			{
				currentPlatform = "windows"; // Default if cookies are enabled.
				console.log("getPlatform() defaulted to: "+windows);
			}
			else
				console.log("getPlatform() from cookie: "+currentPlatform);
		}
		console.log("getPlatform() returned: "+currentPlatform);
		return currentPlatform;
	}
	function getGraphicsAPI()
	{
		if(currentAPI=="all"&&navigator.cookieEnabled)
		{
			currentAPI=Cookies.get("graphicsapi");
			if (typeof currentAPI == 'undefined')
			{
				currentAPI = "vulkan"; // Default if cookies are enabled.
				console.log("getGraphicsAPI() defaulted to: "+currentAPI);
			}
			else
				console.log("getGraphicsAPI() from cookie: "+currentAPI);
		}
		console.log("getGraphicsAPI() returned: "+currentAPI);
		return currentAPI;
	}


	//https://stackoverflow.com/questions/8562613/how-to-add-url-parameter-to-the-current-url
	function addUrlParameter(addr,name, value)
	{
		//console.log("add url parameter to : "+addr)
		url=new URL(addr);
		url.searchParams.set(name,value);
		return url.toString();
	}

	function getUrlParameter(name)
	{
		const urlParams = new URLSearchParams(window.location.search);
		return urlParams.get(name);
	}

	function getUrlParameterWithCheck(name, checkValues, defaultValue)
	{
		const urlParameter = getUrlParameter(name);
		ok = false;
		for (i = 0; i < checkValues.length; i++)
		{
			ok |= (urlParameter == checkValues[i]);
		}
		return ok ? urlParameter : defaultValue;
	}

	function updatePlatformFromURL()
	{
		var platform = getUrlParameterWithCheck('platform', ['windows', 'linux', 'android'], getPlatform());
		if (typeof platform == 'undefined')
		{
			platform = "linux"; // Set default here.
		}
		setPlatform(platform);
		updatePlatform();
	}

	function updatePlatformFromTab()
	{
		var platform = getPlatform();
		if (typeof platform == 'undefined')
		{
			platform = "linux"; // Set default here.
		}
		setPlatform(platform);
		updatePlatform();
	}

	function updatePlatform()
	{
		var platform = getPlatform();
		console.log('updatePlatform() = ' + platform);
		$(".linux").hide();
		$(".android").hide();
		$(".windows").hide();
		if (platform == "windows"||platform == "all")
		{
		$(".windows").show();
			$(".selectd3d11").removeAttr("disabled");
			$(".selectd3d12").removeAttr("disabled");
			$(".selectopengles").attr("disabled", true);
			$(".selectvulkan").removeAttr("disabled");
			$(".selectopengl").removeAttr("disabled");
		}
		if (platform == "linux"||platform == "all")
		{
			$(".linux").show();
			$(".selectd3d11").attr("disabled", true);
			$(".selectd3d12").attr("disabled", true);
			$(".selectopengles").attr("disabled", true);
			$(".selectvulkan").removeAttr("disabled");
			$(".selectopengl").removeAttr("disabled");
		}
		if (platform == "android"||platform == "all")
		{
			//console.log("platform  " + platform + ".");
			$(".android").show();
			$(".selectd3d11").attr("disabled", true);
			$(".selectd3d12").attr("disabled", true);
			$(".selectopengles").removeAttr("disabled");
			$(".selectvulkan").removeAttr("disabled");
			$(".selectopengl").attr("disabled", true);
		}
		var oldelements = document.querySelectorAll(".selected-platform");
		while (oldelements.length > 0)
		{
			var el=oldelements.item(0);
			el.classList.remove('selected-platform');
			////console.log("Removing selected-platform from "+el.id);
			oldelements = document.querySelectorAll(".selected-platform");
		}
		var element = document.getElementById('select' + platform);
		if(element)
		{
			element.classList.add('selected-platform');
		////console.log("Adding selected-platform to "+element.id);
		}
		var element2 = document.getElementById('select' + platform + "-inline");
		if(element2)
		{
			element2.classList.add('selected-platform');
		////console.log("Adding selected-platform to "+element2.id);
		}
		if(limitAPIChoice())
			updateGraphicsAPI();
		window.updatePlatform=updatePlatform;
	}

	function limitAPIChoice()
	{
		var platform = getPlatform();
		var graphicsApi = getGraphicsAPI();
		////console.log("limitAPIChoice(), platform = " + platform+", graphicsApi = "+graphicsApi);
		window.limitAPIChoice=limitAPIChoice;
		var newApi=graphicsApi;
		if (platform == "windows")
		{
			if (graphicsApi == "opengles"||graphicsApi==undefined)
			newApi="d3d11";
		}
		if (platform == "linux")
		{
			if (graphicsApi == "opengles"||graphicsApi=="d3d11"||graphicsApi=="d3d12"||graphicsApi==undefined)
			newApi="vulkan";
		}
		if (platform == "android"||graphicsApi==undefined)
		{
			if (graphicsApi != "opengles"&&graphicsApi!="vulkan")
			newApi="vulkan";
		}
		////console.log("newApi = "+newApi);
		if (newApi != graphicsApi)
		{
			////console.log("setting graphicsapi = "+newApi);
			setGraphicsAPI(newApi);
			graphicsApi=newApi;
			return true;
		}
		return false;
	}
	function makeLinksOpenInNewWindow()
	{
		////console.log("makeLinksOpenInNewWindow ");
		var download_hrefs = document.getElementsByClassName('reference download internal');
		[].forEach.call(download_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			////console.log("Adding target blank to "+el.id);
		});
		link_hrefs = document.getElementsByClassName('reference external');
		[].forEach.call(link_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			////console.log("Adding target blank to "+el.id);
		});
		window.makeLinksOpenInNewWindow=makeLinksOpenInNewWindow;
	}
	function addIconsToToctree()
	{
		var toctreeheadings = document.getElementsByClassName('toctree-l1');
		var i = 0;
		const heading_ids = ["toc_introduction", "toc_setup", "toc_graphics","toc_interactions","toc_extensions","toc_nextsteps"];
		const heading_anchors = ["introduction", "openxr-setup", "graphics","interactions","extensions","nextsteps"];
		[].forEach.call(toctreeheadings, function(el) {
		el.id =heading_ids[i];
		el.children[0].href=el.children[0].href.replace('#','')+"#"+heading_anchors[i];
		i++;
		////console.log("Adding id "+heading_ids[i]+" to toctree heading "+i);
		});
	}
	function copyLinkToThisPage()
	{
		var graphicsapi =getGraphicsAPI();
		var platform	=getPlatform();
		var url			=window.location.href;
		url				=addUrlParameter(url,"platform",platform);
		url				=addUrlParameter(url,"graphicsapi",graphicsapi);
		navigator.clipboard.writeText(url);
		var dlg = document.getElementById("copied-link-dialog");
		document.getElementById("copied-link-text").innerHTML  = "Copied:<br>" + url + "<br>to the clipboard.";
		dlg.style.visibility = 'visible';
		var sharepagetooltip = document.getElementById('share-page-tooltiptext');
		//sharepagetooltip.style.opacity = 0;
		setTimeout(() =>
		{
		const dlg = document.getElementById("copied-link-dialog");
		dlg.style.visibility = 'hidden';
		}, 2500);

	// Alert the copied text
	//alert("Copied the link: " + url+" to the clipboard.");
	}
	function updateGraphicsAPIFromURL()
	{
		var graphicsApi = getUrlParameterWithCheck('graphicsapi', ['d3d11', 'd3d12', 'opengl', 'opengles', 'vulkan'], getGraphicsAPI());
		setGraphicsAPI(graphicsApi);
		updateGraphicsAPI();
	}

	function updateGraphicsAPIFromTab()
	{
		var graphicsApi = getGraphicsAPI();
		if (typeof graphicsApi == 'undefined')
		{
			graphicsApi = "vulkan"; // Set default here.
		}
		setGraphicsAPI(graphicsApi);
		updateGraphicsAPI();
	}

	function updateGraphicsAPI()
	{
		var graphicsApi = getGraphicsAPI();
		//console.log('updateGraphicsAPI() = ' + graphicsApi);

		// first, hide all the api's
		$(".d3d11").hide();
		$(".d3d12").hide();
		$(".opengl").hide();
		$(".opengles").hide();
		$(".vulkan").hide();
		// Now, show the wanted api's. In this way, divs with more than one will be shown, even if they have one that is hidden.
		if (graphicsApi == "d3d11"||graphicsApi == "all") {
		$(".d3d11").show();
		}
		if (graphicsApi == "d3d12"||graphicsApi == "all") {
		$(".d3d12").show();
		}
		if (graphicsApi == "opengl"||graphicsApi == "all") {
		$(".opengl").show();
		}
		if (graphicsApi == "opengles"||graphicsApi == "all") {
		$(".opengles").show();
		}
		if (graphicsApi == "vulkan"||graphicsApi == "all") {
		$(".vulkan").show();
		}
			var oldelements = document.querySelectorAll(".selected-graphics-api");
			////console.log("selected-platform on "+oldelements.length+" elements.");
			while (oldelements.length > 0)
			{
				var el=oldelements.item(0);
				el.classList.remove('selected-graphics-api');
				////console.log("Removing selected-graphics-api from "+el.id);
				oldelements = document.querySelectorAll(".selected-graphics-api");
			}
			var element = document.getElementById('select' + graphicsApi);
			if(element)
			{
				element.classList.add('selected-graphics-api');
			}
			var element2 = document.getElementById('select' + graphicsApi +"-inline");
			if (element2)
			{
				element2.classList.add('selected-graphics-api');
			}
			window.updateGraphicsAPI=updateGraphicsAPI;
		}</script>
		<script >
		var graphicsApi = getGraphicsAPI();
		if (graphicsApi==undefined) {
			setGraphicsAPI(a);
			graphicsApi='vulkan';
		}
	</script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onpageshow="updatePlatformFromURL(); updateGraphicsAPIFromURL();" onload="makeLinksOpenInNewWindow(); addIconsToToctree();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">1 Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2 OpenXR Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-instance">2.1 Creating an Instance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-openxr-instance">2.1.1 The OpenXR Instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xr-ext-debug-utils">2.1.2 XR_EXT_debug_utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-the-system-id">2.1.3 Obtaining the System Id</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-session">2.2 Creating a Session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrsession">2.2.1 XrSession</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#polling-the-event-loop">2.3 Polling the Event Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrpollevent">2.3.1 xrPollEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsessionstate">2.3.2 XrSessionState</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrbeginsession-and-xrendsession">2.3.3 xrBeginSession and xrEndSession</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#summary">2.4 Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">3 Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-actions.html">4 Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">5 Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-next-steps.html">6 Next Steps</a></li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">2 OpenXR Setup</li>
	  <li class="wy-breadcrumbs-aside">
		  <div id='selectplatform'>
	<button class="select-platform" id='selectwindows' onclick="choosePlatform('windows')">
		<img class="platform-tab-img" src="_static/css/windows-mono.svg" alt="Windows" />
	</button>
	<button class="select-platform" id='selectlinux' onclick="choosePlatform('linux')">
		<img class="platform-tab-img" src="_static/css/tux-mono.svg" alt="Linux" />
	</button>
	<button class="select-platform" id='selectandroid' onclick="choosePlatform('android')">
		<img class="platform-tab-img" src="_static/css/android-mono.svg" alt="Android" />
	</button>
</div>
<script>
	function choosePlatform(platformName)
	{
		setPlatform(platformName);
		updatePlatformFromTab();
	};
</script>

<div id='selectgraphicsapi'>
	<button class="select-graphics-api selectd3d11" id='selectd3d11' onclick="chooseGraphicsAPI('d3d11')">
		<img class="api-tab-img" src="_static/css/DirectX11_Black_Aligned.svg" alt="DirectX 11" />
	</button><button class="select-graphics-api selectd3d12" id='selectd3d12' onclick="chooseGraphicsAPI('d3d12')">
		<img class="api-tab-img" src="_static/css/DirectX12_Black_Aligned.svg" alt="DirectX 12" />
	</button><button class="select-graphics-api selectopengl" id='selectopengl' onclick="chooseGraphicsAPI('opengl')">
		<img class="api-tab-img" src="_static/css/OpenGL_Black_Aligned.svg" alt="OpenGL" />
	</button><button class="select-graphics-api selectopengles" id='selectopengles' onclick="chooseGraphicsAPI('opengles')">
		<img class="api-tab-img" src="_static/css/OpenGLES_Black_Aligned.svg" alt="OpenGL ES" />
	</button><button class="select-graphics-api selectvulkan" id='selectvulkan' onclick="chooseGraphicsAPI('vulkan')">
		<img class="api-tab-img" src="_static/css/Vulkan_Black_Aligned.svg" alt="Vulkan" />
	</button>
</div>
<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		setGraphicsAPI(graphicsApiName);
		updateGraphicsAPIFromTab();
		limitAPIChoice();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<dic class="share-page-container">
						<button class="share-this-page" id='share-this-page' onclick="copyLinkToThisPage()">
							<img class="api-tab-img" src="_static/css/icons/share_FILL0_wght400_GRAD0_opsz24.svg" alt="Copy link to this page" />
						</button>
						<div id="copied-link-dialog">
							<p id="copied-link-text"></p>
						</div>
						<div id="share-page-tooltiptext">Copy link to this page</div>
</div>
				<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
					<div itemprop="articleBody">
						
  <section id="openxr-setup">
<h1>2 OpenXR Setup<a class="headerlink" href="#openxr-setup" title="Permalink to this heading">¶</a></h1>
<p>With your project created and your application building and running, we can start to use OpenXR. The goal of this chapter is to create an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> and an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>, and setup the OpenXR event loop. This OpenXR code is needed to setup the core functionality of an OpenXR application to have that application interact with the OpenXR runtime and your graphics API correctly.</p>
<section id="creating-an-instance">
<h2>2.1 Creating an Instance<a class="headerlink" href="#creating-an-instance" title="Permalink to this heading">¶</a></h2>
<p>We will continue to use the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class in <code class="docutils literal notranslate"><span class="pre">Chapter2/main.cpp</span></code> that we created in <a class="reference internal" href="1-introduction.html#project-setup"><span class="std std-ref">Chapter 1.4</span></a>.</p>
<p>Here, we will add the following highlighted text to the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="p">)</span>
<span class="hll"><span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">m_apiType</span><span class="p">(</span><span class="n">apiType</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
</span><span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll"><span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll"><span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
</span><span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateDebugMessenger</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyDebugMessenger</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">PollSystemEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="hll"><span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">m_formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">m_systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">XrSystemProperties</span><span class="w"> </span><span class="n">m_systemProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_PROPERTIES</span><span class="p">};</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">m_apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>First, we updated <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> to call the new methods <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetSystemID()</span></code> and <code class="docutils literal notranslate"><span class="pre">DestroyInstance()</span></code> in that order. Finally, we added those methods and the following members to the class within their separate private sections.</p>
<section id="the-openxr-instance">
<h3>2.1.1 The OpenXR Instance<a class="headerlink" href="#the-openxr-instance" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> is the foundational object that we need to create first. The <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> encompasses the application setup state, OpenXR API version and any layers and extensions. So inside the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, we will first add the code for the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApplicationInfo.html">XrApplicationInfo</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrApplicationInfo</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">applicationName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_APPLICATION_NAME_SIZE</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">engineName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_ENGINE_NAME_SIZE</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">AI</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_CURRENT_API_VERSION</span><span class="p">;</span>
</pre></div>
</div>
<p>This structure allows you to specify both the name and the version for your application and engine. These members are solely for your use as the application developer. The main member here is the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApplicationInfo.html">XrApplicationInfo</a> <code class="docutils literal notranslate"><span class="pre">::apiVersion</span></code>. Here we use the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XR_CURRENT_API_VERSION.html">XR_CURRENT_API_VERSION</a> macro to specify the OpenXR version that we want to run. Also, note here the use of <code class="docutils literal notranslate"><span class="pre">strncpy()</span></code> to set the name strings. If you look at <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApplicationInfo.html">XrApplicationInfo</a> <code class="docutils literal notranslate"><span class="pre">::applicationName</span></code> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApplicationInfo.html">XrApplicationInfo</a> <code class="docutils literal notranslate"><span class="pre">::engineName</span></code> members, they are of type <code class="docutils literal notranslate"><span class="pre">char[]</span></code>, so you must copy your string into that buffer. Also, be aware of the allowable length. <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApplicationInfo.html">XrApplicationInfo</a> will be used later when we will fill out <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a>.</p>
<div class="vulkan docutils container">
<p>Note the slight difference in the approach the OpenXR API takes compared to the Vulkan API. In OpenXR, name strings are explicitly copied into structures like <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApplicationInfo.html">XrApplicationInfo</a>, which contain fixed-size string buffers, whereas in Vulkan, structures such as <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo</span></code> take pointers to C strings of arbitrary size.</p>
</div>
<p id="instanceextensions">Similarly to Vulkan, OpenXR allows applications to extend functionality past what is provided by the core specification. The added functionality could be hardware/vendor specific. Most vital of course is which Graphics API to use with OpenXR. OpenXR supports D3D11, D3D12, Vulkan, OpenGL and OpenGL ES. Due to the extensible nature of specification, it allows newer Graphics APIs and hardware functionality to be added with ease. Following on from the previous code in the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, add the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">);</span>
<span class="c1">// Ensure m_apiType is already defined when we call this line.</span>
<span class="n">m_instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">GetGraphicsAPIInstanceExtensionString</span><span class="p">(</span><span class="n">m_apiType</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, we store in a vector of strings the extension names that we would like to use. <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> is a macro of a string defined in <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code>. The XR_EXT_debug_utils is an extension that checks the validity of calls made to OpenXR and can use a callback function to handle any raised errors. We will explore this extension more in <a class="reference internal" href="#xr-ext-debug-utils"><span class="std std-ref">Chapter 2.1</span></a>. Depending on which <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macro you defined, this code will add the relevant extension.</p>
<p>Not all API layers and extensions are available to use, so we must check which ones are available when OpenXR is initialized. We will use <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateApiLayerProperties.html">xrEnumerateApiLayerProperties</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateInstanceExtensionProperties.html">xrEnumerateInstanceExtensionProperties</a> to check which ones the runtime can provide. Let’s do this now by adding the following code to the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get all the API Layers from the OpenXR runtime.</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">apiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrApiLayerProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_API_LAYER_PROPERTIES</span><span class="p">});</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>

<span class="c1">// Check the requested API layers against the ones from the OpenXR. If found add it to the Active API Layers.</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestLayer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">layerProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// strcmp returns 0 if the strings match.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">layerProperty</span><span class="p">.</span><span class="n">layerName</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Get all the Instance Extensions from the OpenXR instance.</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="n">extensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_EXTENSION_PROPERTIES</span><span class="p">});</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>

<span class="c1">// Check the requested Instance Extensions against the ones from the OpenXR runtime.</span>
<span class="c1">// If an extension is found add it to Active Instance Extensions.</span>
<span class="c1">// Log error if the Instance Extension is not found.</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestedInstanceExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// strcmp returns 0 if the strings match.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestedInstanceExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestedInstanceExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XR_TUT_LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Failed to find OpenXR instance extension: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requestedInstanceExtension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These functions are called twice. The first time is to get the count of the API layers or extensions and the second is to fill out the array of structures - this is called the “two-call idiom”. Before the second call, we need to set <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrApiLayerProperties.html">XrApiLayerProperties</a> <code class="docutils literal notranslate"><span class="pre">::type</span></code> or <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrExtensionProperties.html">XrExtensionProperties</a> <code class="docutils literal notranslate"><span class="pre">::type</span></code> to the correct value, so that the second call can correctly fill out the data. After we have enumerated the API layer and extension, we use a nested loop to check to see whether an API layers or extensions is available and add it to the <code class="docutils literal notranslate"><span class="pre">m_activeAPILayers</span></code> and/or <code class="docutils literal notranslate"><span class="pre">m_activeInstanceExtensions</span></code> respectively.</p>
<p>In OpenXR, we provide an explicit input capacity to both <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateApiLayerProperties.html">xrEnumerateApiLayerProperties</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateInstanceExtensionProperties.html">xrEnumerateInstanceExtensionProperties</a>, which provides an additional layer of memory-safety. <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateInstanceExtensionProperties.html">xrEnumerateInstanceExtensionProperties</a> also allows you to query instance extensions by API layer name. In this tutorial, we just query the non-layer extensions that are implicitly loaded by the runtime.</p>
<div class="vulkan docutils container">
<p>This is a subtle difference here from the two-call idiom in the Vulkan API.</p>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">m_activeAPILayers</span></code> and <code class="docutils literal notranslate"><span class="pre">m_activeInstanceExtensions</span></code> are of type <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code>. This will help us when fill out the next structure <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a>.</p>
<p>Now that we’ve assembled all of the information needed we will fill the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a> structure, and add the following to the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_CREATE_INFO</span><span class="p">};</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">applicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This section is fairly simple: we have used the previously collected data and assigned it to the members in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a> structure. Then, we called <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrCreateInstance.html">xrCreateInstance</a> where we took pointers to the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> objects. When the function is called, if successful, it returns <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> will be non-null (i.e. not equal to <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XR_NULL_HANDLE.html">XR_NULL_HANDLE</a>).</p>
<p>At the end of the app, we should destroy the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> with <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrDestroyInstance.html">xrDestroyInstance</a>. Add the following to the <code class="docutils literal notranslate"><span class="pre">DestroyInstance()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroyInstance</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>While we do have an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a>, let’s check its properties. Add the following code to the <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrInstanceProperties</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_PROPERTIES</span><span class="p">};</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProperties</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProperties.&quot;</span><span class="p">);</span>

<span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;OpenXR Runtime: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span>
<span class="w">                            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span>
<span class="w">                            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span>
<span class="w">                            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_PATCH</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, we have initialized the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceProperties.html">XrInstanceProperties</a> with the correct <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrStructureType.html">XrStructureType</a> and passed it along with the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> to <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrGetInstanceProperties.html">xrGetInstanceProperties</a>. This will fill the rest of that structure. Next, we logged out the runtime’s name, and using the <code class="docutils literal notranslate"><span class="pre">XR_VERSION_...</span></code> macros, we parsed and logged the runtime version.</p>
</section>
<section id="xr-ext-debug-utils">
<h3>2.1.2 XR_EXT_debug_utils<a class="headerlink" href="#xr-ext-debug-utils" title="Permalink to this heading">¶</a></h3>
<p>XR_EXT_debug_utils is an instance extension for OpenXR, which allows the application to get more information on errors, warnings and messages raised by the runtime. You can specify which message severities and types will checked. If a debug message is raised, it is passed to the callback function, which can optionally use the user data pointer provided in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrDebugUtilsMessengerCreateInfoEXT.html">XrDebugUtilsMessengerCreateInfoEXT</a> structure.</p>
<dl class="simple">
<dt>The message severities are:</dt><dd><ul class="simple">
<li><p>Verbose: Output all messages.</p></li>
<li><p>Info: Output at least information messages helpful in debugging.</p></li>
<li><p>Warning: Output at least messages that could suggest an application bug and that need reviewing.</p></li>
<li><p>Error: Output messages from errors that may cause undefined behavior and/or crashes.</p></li>
</ul>
</dd>
<dt>The message types are:</dt><dd><ul class="simple">
<li><p>General: General information.</p></li>
<li><p>Validation: indicates possibly invalid usage of OpenXR.</p></li>
<li><p>Performance: indicates possible non-optimal usage of OpenXR.</p></li>
<li><p>Conformance: indicates a non-conformant OpenXR result from the runtime.</p></li>
</ul>
</dd>
</dl>
<p>See also <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#debug-message-categorization">Debug Message Categorization</a> in the OpenXR Specification.</p>
<p>Copy the following code into <code class="docutils literal notranslate"><span class="pre">CreateDebugMessenger()</span></code> and <code class="docutils literal notranslate"><span class="pre">DestroyDebugMessenger()</span></code> respectively:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Check that &quot;XR_EXT_debug_utils&quot; is in the active Instance Extensions before creating an XrDebugUtilsMessengerEXT.</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsStringInVector</span><span class="p">(</span><span class="n">m_activeInstanceExtensions</span><span class="p">,</span><span class="w"> </span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">);</span><span class="w">  </span><span class="c1">// From OpenXRDebugUtils.h.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Check that &quot;XR_EXT_debug_utils&quot; is in the active Instance Extensions before destroying the XrDebugUtilsMessengerEXT.</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">XR_NULL_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DestroyOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="p">);</span><span class="w">  </span><span class="c1">// From OpenXRDebugUtils.h.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above, we first check that <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> or <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XR_EXT_debug_utils.html">XR_EXT_debug_utils</a> is in <code class="docutils literal notranslate"><span class="pre">activeInstanceExtensions</span></code>, which we used to create the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a>. Next, we call the <code class="docutils literal notranslate"><span class="pre">CreateOpenXRDebugUtilsMessenger()</span></code> function. At the end of the application, we call <code class="docutils literal notranslate"><span class="pre">DestroyOpenXRDebugUtilsMessenger()</span></code> to release the resource.</p>
<p>Another feature of OpenXR is the API Layers, which may also assist you in debugging. You can read more about them in <a class="reference internal" href="6-next-steps.html#openxr-api-layers"><span class="std std-ref">Chapter 6.3</span></a>.</p>
</section>
<section id="obtaining-the-system-id">
<h3>2.1.3 Obtaining the System Id<a class="headerlink" href="#obtaining-the-system-id" title="Permalink to this heading">¶</a></h3>
<p>The next object we want to get is the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a>. According to <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#system">System</a> in the OpenXR spec, OpenXR ‘separates the concept of physical systems of XR devices from the logical objects that applications interact with directly. A system represents a collection of related devices in the runtime, often made up of several individual hardware components working together to enable XR experiences. So, an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a> could represent a VR headset and a pair of controllers, or perhaps a mobile device with video pass-through for AR. So we need to decide what type of <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrFormFactor.html">XrFormFactor</a> we want to use, as some runtimes support multiple form factors. Here, we are selecting <code class="docutils literal notranslate"><span class="pre">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span></code>. OpenXR currently offers two options for the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrFormFactor.html">XrFormFactor</a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrFormFactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HANDHELD_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrFormFactor</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr.h</em></p>
<p>Add the following code to the <code class="docutils literal notranslate"><span class="pre">GetSystemID()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get the XrSystemId from the instance and the supplied XrFormFactor.</span>
<span class="n">XrSystemGetInfo</span><span class="w"> </span><span class="n">systemGI</span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_GET_INFO</span><span class="p">};</span>
<span class="n">systemGI</span><span class="p">.</span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_formFactor</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystem</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemGI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_systemID</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemID.&quot;</span><span class="p">);</span>

<span class="c1">// Get the System&#39;s properties for some general information about the hardware and the vendor.</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystemProperties</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_systemProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemProperties.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Here, we have filled out the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemGetInfo.html">XrSystemGetInfo</a> structure with the desired <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrFormFactor.html">XrFormFactor</a> and passed it as a pointer along with the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> and a pointer to the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a> to the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrGetSystem.html">xrGetSystem</a> function. When the function is called, if successful, <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a> will be non-null.</p>
<p>With the above code, we have also got the system’s properties. We partially filled out a <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemProperties.html">XrSystemProperties</a> structure and passed it as a pointer along with the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> and the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a> to the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrGetSystemProperties.html">xrGetSystemProperties</a> function. This function will fill out the rest of the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemProperties.html">XrSystemProperties</a> structure; detailing the vendor’s ID, the system’s name and the system’s graphics and tracking properties.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemGraphicsProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageHeight</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxLayerCount</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemGraphicsProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemTrackingProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">orientationTracking</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">positionTracking</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemTrackingProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">               </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">            </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemId</span><span class="w">                    </span><span class="n">systemId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">                      </span><span class="n">vendorId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w">                          </span><span class="n">systemName</span><span class="p">[</span><span class="n">XR_MAX_SYSTEM_NAME_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XrSystemGraphicsProperties</span><span class="w">    </span><span class="n">graphicsProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemTrackingProperties</span><span class="w">    </span><span class="n">trackingProperties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemProperties</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr.h</em></p>
<p>You can now run the application to check that you have a valid <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a>.</p>
<div class="linux docutils container">
<p>Make sure your Monado service is running prior to running your app.</p>
</div>
</section>
</section>
<section id="creating-a-session">
<h2>2.2 Creating a Session<a class="headerlink" href="#creating-a-session" title="Permalink to this heading">¶</a></h2>
<p>The next major component of OpenXR that needs to be created in an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>. An <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> encapsulates the state of the application from the perspective of OpenXR. When an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> is created, it starts in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionState.html">XrSessionState</a> <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_IDLE</span></code>. It is up to the runtime to provide any updates to the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionState.html">XrSessionState</a> and for the application to query them and react to them. We will explore this in <a class="reference internal" href="#polling-the-event-loop"><span class="std std-ref">Chapter 2.3</span></a>.</p>
<p>For now, we are just going to create an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>. At this point, you’ll need to select which Graphics API you wish to use. Only one Graphics API can be used with an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>. This tutorial demonstrates how to use D3D11, D3D12, OpenGL, OpenGL ES and Vulkan in conjunction with OpenXR to render graphics to the provided views. Ultimately, you will most likely be bringing your own rendering solution to this tutorial, therefore the code examples provided for the Graphics APIs are <cite>placeholders</cite> for your own code base; demonstrating in this sub-chapter what objects are needed from your Graphics API to create an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>. This tutorial uses polymorphic classes; <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> derives from the base <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class. There are both compile and runtime checks to select the requested Graphics API, and we construct an appropriate derived class through the use of <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;&gt;</span></code>.</p>
<p>Update the constructor of the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class, the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> method and also add the definitions of the new methods and the members to their separate private sections. All the new code is highlighted code below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="p">)</span>
<span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">m_apiType</span><span class="p">(</span><span class="n">apiType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CheckGraphicsAPI_TypeIsValidForPlatform</span><span class="p">(</span><span class="n">m_apiType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: The provided Graphics API is not valid for this platform.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll"><span class="w">                        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
</span><span class="hll"><span class="w">                </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="hll"><span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>
</span>
<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateSession</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroySession</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">PollSystemEvents</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>


<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">m_formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">m_systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">XrSystemProperties</span><span class="w"> </span><span class="n">m_systemProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_PROPERTIES</span><span class="p">};</span>

<span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">m_apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
<span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GraphicsAPI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrSession</span><span class="w"> </span><span class="n">m_session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_NULL_HANDLE</span><span class="p">;</span>
</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="xrsession">
<h3>2.2.1 XrSession<a class="headerlink" href="#xrsession" title="Permalink to this heading">¶</a></h3>
<p>Copy the following code into the <code class="docutils literal notranslate"><span class="pre">CreateSession()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrSessionCreateInfo</span><span class="w"> </span><span class="n">sessionCI</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_CREATE_INFO</span><span class="p">};</span>
</pre></div>
</div>
<div class="d3d11 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="d3d12 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="opengl docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="opengles docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_Vulkan</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
<p>When creating the Vulkan Instance, developers should be aware of any Vulkan layers that they may have externally activated.</p>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sessionCI</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetGraphicsBinding</span><span class="p">();</span>
<span class="n">sessionCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">sessionCI</span><span class="p">.</span><span class="n">systemId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">;</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSession</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Session.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">DestroySession()</span></code> method, add the following code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroySession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Session.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Above is the code for creating and destroying an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>. <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrDestroySession.html">xrDestroySession</a> will destroy the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> when we are finished and shutting down the application. <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrCreateSession.html">xrCreateSession</a> takes the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a>, <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo</a> and a <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> return. If the function call is successful, <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrCreateSession.html">xrCreateSession</a> will return <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">m_session</span></code> will be non-null.</p>
<p>In the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo</a> structure, <code class="docutils literal notranslate"><span class="pre">createFlags</span></code> and <code class="docutils literal notranslate"><span class="pre">systemId</span></code> are specified, and we need to specify which Graphics API we wish to use. This is achieved via the use of the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo</a> <code class="docutils literal notranslate"><span class="pre">::next</span></code> void pointer. Following the Vulkan style of extensibility, structures for creating objects can be extended to enable extra functionality. In our case, the extension is required and thus <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo</a> <code class="docutils literal notranslate"><span class="pre">::next</span></code> can not be a nullptr. That pointer must point to ‘exactly one graphics API binding structure (a structure whose name begins with “XrGraphicsBinding”)’ (<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo(3) Manual Page</a>). We get a pointer to the correct <em>Graphics Binding</em> structure by calling <code class="docutils literal notranslate"><span class="pre">GraphicsAPI::GetGraphicsBinding();</span></code>.</p>
</section>
</section>
<section id="polling-the-event-loop">
<h2>2.3 Polling the Event Loop<a class="headerlink" href="#polling-the-event-loop" title="Permalink to this heading">¶</a></h2>
<p>OpenXR uses an event-based system to describe changes within the XR system. It’s the application’s responsibility to poll these events and react to them. The polling of events is done by the function <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrPollEvent.html">xrPollEvent</a>. The application should continually call this function throughout its lifetime. Within a single XR frame, the application should continuously call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrPollEvent.html">xrPollEvent</a> until the internal event queue is ‘drained’; multiple events can occur across the XR frame and the application needs to handle and respond to each accordingly.</p>
<p>Firstly, we will update the class. In the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> method add the highlighted code below. Also, add the highlighted code for the new methods and members in their separate private sections.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="p">)</span>
<span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">m_apiType</span><span class="p">(</span><span class="n">apiType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CheckGraphicsAPI_TypeIsValidForPlatform</span><span class="p">(</span><span class="n">m_apiType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                         </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: The provided Graphics API is not valid for this platform.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>

<span class="hll"><span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">m_applicationRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                        </span><span class="n">PollSystemEvents</span><span class="p">();</span>
</span><span class="hll"><span class="w">                        </span><span class="n">PollEvents</span><span class="p">();</span>
</span><span class="hll"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_sessionRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                                </span><span class="c1">// Draw Frame.</span>
</span><span class="hll"><span class="w">                        </span><span class="p">}</span>
</span><span class="hll"><span class="w">                </span><span class="p">}</span>
</span>
<span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateSession</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroySession</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">PollEvents</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">PollSystemEvents</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">m_formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">m_systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">XrSystemProperties</span><span class="w"> </span><span class="n">m_systemProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_PROPERTIES</span><span class="p">};</span>

<span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">m_apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GraphicsAPI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>

<span class="w">        </span><span class="n">XrSession</span><span class="w"> </span><span class="n">m_session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_NULL_HANDLE</span><span class="p">;</span>
<span class="hll"><span class="w">        </span><span class="n">XrSessionState</span><span class="w"> </span><span class="n">m_sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="p">;</span>
</span><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="xrpollevent">
<h3>2.3.1 xrPollEvent<a class="headerlink" href="#xrpollevent" title="Permalink to this heading">¶</a></h3>
<p>Copy the following code into the <code class="docutils literal notranslate"><span class="pre">PollEvents()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Poll OpenXR for a new event.</span>
<span class="n">XrEventDataBuffer</span><span class="w"> </span><span class="n">eventData</span><span class="p">{</span><span class="n">XR_TYPE_EVENT_DATA_BUFFER</span><span class="p">};</span>
<span class="k">auto</span><span class="w"> </span><span class="n">XrPollEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">eventData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_EVENT_DATA_BUFFER</span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">xrPollEvent</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">XrPollEvents</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">eventData</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Log the number of lost events from the runtime.</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_EVENTS_LOST</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*</span><span class="n">eventsLost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;OPENXR: Events Lost: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eventsLost</span><span class="o">-&gt;</span><span class="n">lostEventCount</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Log that an instance loss is pending and shutdown the application.</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*</span><span class="n">instanceLossPending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;OPENXR: Instance Loss Pending at: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceLossPending</span><span class="o">-&gt;</span><span class="n">lossTime</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Log that the interaction profile has changed.</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*</span><span class="n">interactionProfileChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;OPENXR: Interaction Profile changed for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interactionProfileChanged</span><span class="o">-&gt;</span><span class="n">session</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">interactionProfileChanged</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m_session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;XrEventDataInteractionProfileChanged for unknown Session&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Log that there&#39;s a reference space change pending.</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*</span><span class="n">referenceSpaceChangePending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;OPENXR: Reference Space Change pending for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">referenceSpaceChangePending</span><span class="o">-&gt;</span><span class="n">session</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">referenceSpaceChangePending</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m_session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;XrEventDataReferenceSpaceChangePending for unknown Session&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Session State changes:</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*</span><span class="n">sessionStateChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m_session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;XrEventDataSessionStateChanged for unknown Session&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// SessionState is ready. Begin the XrSession using the XrViewConfigurationType.</span>
<span class="w">            </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">            </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span><span class="p">;</span>
<span class="w">            </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// SessionState is stopping. End the XrSession.</span>
<span class="w">            </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// SessionState is exiting. Exit the application.</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_LOSS_PENDING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// SessionState is loss pending. Exit the application.</span>
<span class="w">            </span><span class="c1">// It&#39;s possible to try a reestablish an XrInstance and XrSession, but we will simply exit here.</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Store state for reference across the application.</span>
<span class="w">        </span><span class="n">m_sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Above, we have defined the <code class="docutils literal notranslate"><span class="pre">PollEvents()</span></code> method. Here, we use a lambda to call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrPollEvent.html">xrPollEvent</a>. This call will fill in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrEventDataBuffer.html">XrEventDataBuffer</a> structure that we pass to the function call, which we use later in this method. We also check that returned <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrResult.html">XrResult</a> is <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code>. Whilst that function returns <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code>, there are events for us to process, and therefore we use a while loop to continually check for new events. <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrPollEvent.html">xrPollEvent</a> will update the member variable <code class="docutils literal notranslate"><span class="pre">type</span></code> and from this, we use a switch statement to select the appropriate code path. Depending on the updated type, we use a <code class="docutils literal notranslate"><span class="pre">reinterpret_cast&lt;&gt;()</span></code> to get the actual data that <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrPollEvent.html">xrPollEvent</a> returned. In certain cases, we also check that the returned <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> matches the one we created.</p>
<p>The description of the events comes from <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#_xrpollevent">2.22.1. Event Polling of the OpenXR specification</a>.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_EVENTS_LOST</p></td>
<td><p>The event queue has overflowed and some events were lost.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</p></td>
<td><p>The application is about to lose the instance.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</p></td>
<td><p>The active input form factor for one or more top-level user paths has changed.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</p></td>
<td><p>The runtime will begin operating with updated space bounds.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</p></td>
<td><p>The application has changed its lifecycle state.</p></td>
</tr>
</tbody>
</table>
<p>As described in the table above, most events are transparent in their intentions and how the application should react to them. For the <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span></code> state, the application may want to try re-creating the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a> in a loop, and after the specified <code class="docutils literal notranslate"><span class="pre">lossTime</span></code>, until it can create a new instance successfully.
<code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span></code> are used for updating how the user interacts with the application and whether a new space change has been detected respectively. <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSpace.html">XrSpace</a> s are discussed in detail in <a class="reference internal" href="3-graphics.html#reference-spaces"><span class="std std-ref">Chapter 3.2.2</span></a></p>
</section>
<section id="xrsessionstate">
<h3>2.3.2 XrSessionState<a class="headerlink" href="#xrsessionstate" title="Permalink to this heading">¶</a></h3>
<p>The final event type, <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span></code>, in the above code and table, is what we will focus on for the rest of this chapter. There are currently nine valid states:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrSessionState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_IDLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_READY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_SYNCHRONIZED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_VISIBLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_FOCUSED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_LOSS_PENDING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSessionState</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr.h</em></p>
<p>Below is a table describing the states of <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionState.html">XrSessionState</a>:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_UNKNOWN</p></td>
<td><p>This is an unknown, pseudo-default state and should not be returned by the runtime.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_IDLE</p></td>
<td><p>This is an initial state after creating or after ending the session.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_READY</p></td>
<td><p>This state, raised from the runtime, indicates that the session is ready to begin.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_SYNCHRONIZED</p></td>
<td><p>The application has synced its frame loop with the runtime but isn’t displaying its contents.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_VISIBLE</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_FOCUSED</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents and can receive XR inputs.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_STOPPING</p></td>
<td><p>The runtime is requesting that the application stop its frame loop rendering and end the session.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_LOSS_PENDING</p></td>
<td><p>The runtime is indicating that the current session is no longer valid and should be destroyed. (*)</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_EXITING</p></td>
<td><p>The runtime is requesting that the application to destroy the session, usually from the user’s request.</p></td>
</tr>
</tbody>
</table>
<p>(*) Applications may wish to re-create objects like <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSystemId.html">XrSystemId</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> if hardware changes are detected.</p>
<p>Developers should also be aware of the lifecycle of an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>. Certain <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionState.html">XrSessionState</a> s can only lead to certain others under the correct circumstances. Below is a diagram showing the lifecycle of an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a> within an OpenXR application.</p>
<figure class="align-default" id="id1">
<img alt="OpenXR Session Life-Cycle" src="_images/openxr-session-life-cycle.svg" /><figcaption>
<p><span class="caption-text">OpenXR Session Life-Cycle</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="xrbeginsession-and-xrendsession">
<h3>2.3.3 xrBeginSession and xrEndSession<a class="headerlink" href="#xrbeginsession-and-xrendsession" title="Permalink to this heading">¶</a></h3>
<p>As the application runs, if the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionState.html">XrSessionState</a> changes to <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_READY</span></code>, the application can call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrBeginSession.html">xrBeginSession</a> to begin the session and synchronize the application with the runtime’s frame hook.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// SessionState is ready. Begin the XrSession using the XrViewConfigurationType.</span>
<span class="w">    </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="hll"><span class="w">    </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span><span class="p">;</span>
</span><span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>From the code that we copied in <a class="reference internal" href="#xrpollevent"><span class="std std-ref">Chapter 2.3.1</span></a>, we’ve assigned to <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionBeginInfo.html">XrSessionBeginInfo</a> <code class="docutils literal notranslate"><span class="pre">::primaryViewConfigurationType</span></code> the value of <code class="docutils literal notranslate"><span class="pre">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span></code>. This specifies the view configuration of the form factor’s primary display - For Head Mounted Displays, it is two views (one per eye). For the time being, we have defaulted to <code class="docutils literal notranslate"><span class="pre">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span></code>. In <a class="reference internal" href="3-graphics.html#view-configurations"><span class="std std-ref">Chapter 3.1.1</span></a>, we enumerate all the system’s view configurations to pick a suitable one.</p>
<p>If the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionState.html">XrSessionState</a> changes to <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_STOPPING</span></code>, the application should call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEndSession.html">xrEndSession</a>. This means that the runtime has stopped the session either from a user’s input or from some other reason, our application should respond by ending the session and freeing any resources. Below is a small excerpt from the code that we copied in <a class="reference internal" href="#xrpollevent"><span class="std std-ref">Chapter 2.3.1</span></a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// SessionState is stopping. End the XrSession.</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="summary">
<h2>2.4 Summary<a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>We have now created an XR application that can begin and stop an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSession.html">XrSession</a>, next we will look to add graphics to our application!</p>
<p>Below is a download link to a zip archive for this chapter containing all the C++ and CMake code for all platform and graphics APIs.</p>
<p><a class="reference external" href="https://github.com/KhronosGroup/OpenXR-Tutorials/releases/download/v0.0.0/Chapter2.zip">Chapter2.zip</a></p>
<p>Version: v0.0.0</p>
</section>
</section>


					</div>
				</div>
				<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1-introduction.html" class="btn btn-neutral float-left" title="1 Introduction" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3-graphics.html" class="btn btn-neutral float-right" title="3 Graphics" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
      <div class="legal-notice">
      <h3>Legal Notice</h3>
      <p>
      </p>
      <p>
        &#169; 2023, The Khronos Group. <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons International 4.0 BY Attribution</a>. Code is licensed as <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>.
      </p>
      <p>
        "OpenXR" and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom. Vulkan and the Vulkan logo are registered trademarks of the Khronos Group Inc.
      </p>
      <p>
        OpenGL&reg; and the oval logo are trademarks or registered trademarks of Hewlett Packard Enterprise in the United States and/or other countries worldwide. OpenGL is a registered trademark and the OpenGL ES logo is a trademark of Hewlett Packard Enterprise used by permission by Khronos.
      </p>
      <p>
        Microsoft DirectX, Microsoft DirectX11, and Microsoft DirectX12 are trademarks owned by Microsoft.
      </p>
        
      <p>
        The OpenXR Tutorial is owned and operated by The Khronos Group Inc. Khronos <a href="https://www.khronos.org/legal/" rel="nofollow">Legal Notices</a>, <a href="https://www.khronos.org/legal/privacy" rel="nofollow">Privacy Policy</a>, and <a href="https://www.khronos.org/about/code-of-conduct" rel="nofollow">Code of Conduct</a> apply.
      </p>
      <p></p>
      </div>
  </div> 

</footer>
			</div>
			</div>
		</div>
	</div>
  <script></script> 

</body>
</html>