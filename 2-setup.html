<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>‚öôÔ∏è 2 Setup &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="stylesheet" href="_static/copybutton.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="_static/clipboard.min.js"></script>
	<script src="_static/copybutton.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="next" title="üëæ 3 Graphics" href="3-graphics.html" >
	<link rel="prev" title="üëã 1 Introduction" href="1-introduction.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	function updatePlatform()
	{
	var platform = Cookies.get("platform");
	console.log("updatePlatform(), platform = " + platform);
	if (typeof platform == 'undefined')
	{
		platform = "windows"; // Set default here.
	}
	$(".linux").hide();
	$(".android").hide();
	$(".windows").hide();
	if (platform == "windows")
	{
		$(".windows").show();
		$(".selectd3d11").disabled = false;
		$(".selectd3d12").disabled = false;
		$(".selectopengles").disabled = true;
		$(".selectvulkan").disabled = false;
		$(".selectopengl").disabled = false;
	}
	if (platform == "linux")
	{
		$(".linux").show();
		$(".selectd3d11").disabled = true;
		$(".selectd3d12").disabled = true;
		$(".selectopengles").disabled = true;
		$(".selectvulkan").disabled = false;
		$(".selectopengl").disabled = false;
	}
	if (platform == "android")
	{
		$(".android").show();
		$(".selectd3d11").disabled = true;
		$(".selectd3d12").disabled = true;
		$(".selectopengles").disabled = false;
		$(".selectvulkan").disabled = false;
		$(".selectopengl").disabled = true;
	}
	var oldelements = document.querySelectorAll(".selected-platform");
	console.log("selected-platform on "+oldelements.length+" elements.");
	while (oldelements.length > 0)
	{
		var el=oldelements.item(0);
		el.classList.remove('selected-platform');
		console.log("Removing selected-platform from "+el.id);
		oldelements = document.querySelectorAll(".selected-platform");
	}
	var element = document.getElementById('select' + platform);
	if(element)
	{
		element.classList.add('selected-platform');
		console.log("Adding selected-platform to "+element.id);
	}
	var element2 = document.getElementById('select' + platform + "-inline");
	if(element2)
	{
		element2.classList.add('selected-platform');
		console.log("Adding selected-platform to "+element2.id);
	}
	else
	{
		console.log('select' + platform + "-inline not found");
	}
	if(limitAPIChoice())
		updateGraphicsAPI();
	window.updatePlatform=updatePlatform;
	}
	
	function limitAPIChoice()
	{
		var platform = Cookies.get("platform");
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("limitAPIChoice(), platform = " + platform+", graphicsApi = "+graphicsApi);
		window.limitAPIChoice=limitAPIChoice;
		var newApi=graphicsApi;
		if (platform == "windows")
		{
			if (graphicsApi == "opengles"||graphicsApi==undefined)
				newApi="d3d11";
		}
		if (platform == "linux")
		{
			if (graphicsApi == "opengles"||graphicsApi=="d3d11"||graphicsApi=="d3d12"||graphicsApi==undefined)
				newApi="vulkan";
		}
		if (platform == "android"||graphicsApi==undefined)
		{
			if (graphicsApi != "opengles"&&graphicsApi!="vulkan")
				newApi="vulkan";
		}
		console.log("newApi = "+newApi);
		if (newApi != graphicsApi)
		{
			console.log("setting graphicsapi = "+newApi);
			Cookies.set('graphicsapi', newApi,{ expires: 365})
			graphicsApi=newApi;
			return true;
		}
		return false;
	}
	function makeLinksOpenInNewWindow()
	{ 
		console.log("makeLinksOpenInNewWindow ");
		var download_hrefs = document.getElementsByClassName('reference download internal');
		[].forEach.call(download_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			console.log("Adding target blank to "+el.id);
		});
		link_hrefs = document.getElementsByClassName('reference external');
		[].forEach.call(link_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			console.log("Adding target blank to "+el.id);
		});
		window.makeLinksOpenInNewWindow=makeLinksOpenInNewWindow;
	}
	function updateGraphicsAPI()
	{
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("graphicsapi = " + graphicsApi);
		if (typeof graphicsApi == 'undefined')
		{
			graphicsApi = "vulkan"; // Set default here.
		}
		// first, hide all the api's
		$(".d3d11").hide();
		$(".d3d12").hide();
		$(".opengl").hide();
		$(".opengles").hide();
		$(".vulkan").hide();
		// Now, show the wanted api's. In this way, divs with more than one will be shown, even if they have one that is hidden.
		if (graphicsApi == "d3d11") {
			$(".d3d11").show();
		}
		if (graphicsApi == "d3d12") {
			$(".d3d12").show();
		}
		if (graphicsApi == "opengl") {
			$(".opengl").show();
		}
		if (graphicsApi == "opengles") {
			$(".opengles").show();
		}
		if (graphicsApi == "vulkan") {
			$(".vulkan").show();
		}
		var oldelements = document.querySelectorAll(".selected-graphics-api");
		console.log("selected-platform on "+oldelements.length+" elements.");
		while (oldelements.length > 0)
		{
			var el=oldelements.item(0);
			el.classList.remove('selected-graphics-api');
			console.log("Removing selected-graphics-api from "+el.id);
			oldelements = document.querySelectorAll(".selected-graphics-api");
		}
		var element = document.getElementById('select' + graphicsApi);
		if(element)
		{
			element.classList.add('selected-graphics-api');
		}
		var element2 = document.getElementById('select' + graphicsApi +"-inline");
		if (element2)
		{
			element2.classList.add('selected-graphics-api');
		}
		window.updateGraphicsAPI=updateGraphicsAPI;
	}</script>
	<script >
	var graphicsApi = Cookies.get("graphicsapi")
	if (graphicsApi==undefined) {
		Cookies.set('graphicsapi', 'vulkan',{ expires: 365})
		graphicsApi='vulkan';
	}
	</script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onload="updatePlatform(); updateGraphicsAPI(); makeLinksOpenInNewWindow();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">üëã 1 Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">‚öôÔ∏è 2 Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrinstance-xrgetsystem">2.1 Creating an XrInstance / xrGetSystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrinstance">2.1.1 XrInstance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xr-ext-debug-utils">2.1.2 XR_EXT_debug_utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsystemid">2.1.3 XrSystemId</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrsession">2.2 Creating an XrSession</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrsession">2.2.1 XrSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphicsapi">2.2.2 GraphicsAPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#polling-the-event-loop">2.3 Polling the Event Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrpollevent">2.3.1 xrPollEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsessionstate">2.3.2 XrSessionState</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrbeginsession-and-xrendsession">2.3.3 xrBeginSession and xrEndSession</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">üëæ 3 Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-actions.html">üïπ 4 Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">‚ú® 5 Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">‚öôÔ∏è 2 Setup</li>
	  <li class="disclaimer">Disclaimer: Work in Progress. This site is in progress and is not ready for use.</li>
	  <li class="wy-breadcrumbs-aside">
		  <div id='selectplatform'>
	<button class="select-platform" id='selectwindows' onclick="choosePlatform('windows')">
		<img class="platform-tab-img" src="_static/css/windows-colour.svg" alt="Windows" />
	</button>
	<button class="select-platform" id='selectlinux' onclick="choosePlatform('linux')">
		<img class="platform-tab-img" src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
	</button>
	<button class="select-platform" id='selectandroid' onclick="choosePlatform('android')">
		<img class="platform-tab-img" src="_static/css/android-colour.svg" alt="Android" />
	</button>
</div>
<script>
	function choosePlatform(platformName)
	{
		var platform = Cookies.get('platform')
		Cookies.set('platform', platformName, { expires: 365 })
		updatePlatform();
	};
</script>

<div id='selectgraphicsapi'>
	<button class="select-graphics-api selectd3d11" id='selectd3d11' onclick="chooseGraphicsAPI('d3d11')">
		<img class="api-tab-img" src="_static/css/directx11-logo.jpg" alt="DirectX 11" />
	</button>
	<button class="select-graphics-api selectd3d12" id='selectd3d12' onclick="chooseGraphicsAPI('d3d12')">
		<img class="api-tab-img" src="_static/css/directx12-logo.jpg" alt="DirectX 12" />
	</button>
	<button class="select-graphics-api selectopengl" id='selectopengl' onclick="chooseGraphicsAPI('opengl')">
		<img class="api-tab-img" src="_static/css/OpenGL_RGB_June16.svg" alt="OpenGL" />
	</button>
	<button class="select-graphics-api selectopengles" id='selectopengles' onclick="chooseGraphicsAPI('opengles')">
		<img class="api-tab-img" src="_static/css/OpenGL ES_RGB_Nov19.svg" alt="OpenGL ES" />
	</button>
	<button class="select-graphics-api selectvulkan" id='selectvulkan' onclick="chooseGraphicsAPI('vulkan')">
		<img class="api-tab-img" src="_static/css/Vulkan_RGB_Dec16.svg" alt="Vulkan" />
	</button>
</div>
<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		Cookies.set('graphicsapi', graphicsApiName, { expires: 365 })
		var graphicsApi = Cookies.get('graphicsapi')
		updateGraphicsAPI();
		limitAPIChoice();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
						<div itemprop="articleBody">
							
  <section id="setup">
<h1>‚öôÔ∏è 2 Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¬∂</a></h1>
<p>Select your platform, as the instructions are different depending on your selection.</p>
<div class='select-platform-container-inline'>
	<button class="select-platform-inline" id='selectwindows-inline' onclick="choosePlatform('windows')">
		<img src="_static/css/windows-mono.svg" alt="Windows" />
		Windows
	</button>
	<button class="select-platform-inline" id='selectlinux-inline' onclick="choosePlatform('linux')">
		<img src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
		Linux
	</button>
	<button class="select-platform-inline" id='selectandroid-inline' onclick="choosePlatform('android')">
		<img src="_static/css/android-original.svg" alt="Android" />
		Android
	</button>
</div>
<div class='select-graphics-api-container-inline'>
	<button class="select-graphics-api-inline selectd3d11" id='selectd3d11-inline' onclick="chooseGraphicsAPI('d3d11')">
		Direct3D 11
	</button>
	<button class="select-graphics-api-inline selectd3d12" id='selectd3d12-inline' onclick="chooseGraphicsAPI('d3d12')">
		Direct3D 12
	</button>
	<button class="select-graphics-api-inline selectopengl" id='selectopengl-inline' onclick="chooseGraphicsAPI('opengl')">
		OpenGL
	</button>
	<button class="select-graphics-api-inline selectopengles" id='selectopengles-inline' onclick="chooseGraphicsAPI('opengles')">
		OpenGL ES
	</button>
	<button class="select-graphics-api-inline selectvulkan" id='selectvulkan-inline' onclick="chooseGraphicsAPI('vulkan')">
		Vulkan
	</button>
</div>

<p>With your project setup and your application building and running, we can start to use OpenXR to create our application.
The goal of this chapter is to create an <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>, and setup the OpenXR event loop. This OpenXR code is needed to setup the core functionality of an OpenXR application to have that application interact with the OpenXR runtime and your graphics API correctly.</p>
<section id="creating-an-xrinstance-xrgetsystem">
<h2>2.1 Creating an XrInstance / xrGetSystem<a class="headerlink" href="#creating-an-xrinstance-xrgetsystem" title="Permalink to this heading">¬∂</a></h2>
<p>We will continue to use the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class in <code class="docutils literal notranslate"><span class="pre">Chapter2/main.cpp</span></code> that we created in <a class="reference internal" href="1-introduction.html#project-setup"><span class="std std-ref">Chapter 1.4</span></a>.</p>
<p>Here, we will add the following highlighted text to the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">apiType</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="hll"><span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll"><span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll"><span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
</span><span class="w">        </span><span class="p">}</span>

<span class="hll"><span class="k">private</span><span class="o">:</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateDebugMessenger</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyDebugMessenger</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll">
</span><span class="hll"><span class="k">private</span><span class="o">:</span>
</span><span class="hll"><span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">m_formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">m_systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="p">};</span>
</pre></div>
</div>
<p>First, we updated <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> to call the new methods <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetSystemID()``and</span> <span class="pre">``DestroyInstance()</span></code> in that order. Finally, we added those methods and the following members to the class within thier separate private sections.</p>
<section id="xrinstance">
<h3>2.1.1 XrInstance<a class="headerlink" href="#xrinstance" title="Permalink to this heading">¬∂</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> is the foundational object that we need to create first. The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> encompasses the application setup state, OpenXR API version and any layers and extensions. So inside the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, we will first add at the code for the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrApplicationInfo</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">applicationName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_APPLICATION_NAME_SIZE</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">engineName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_ENGINE_NAME_SIZE</span><span class="p">);</span>
<span class="n">AI</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">AI</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_CURRENT_API_VERSION</span><span class="p">;</span>
</pre></div>
</div>
<p>This structure allows you specify both the name and the version for your application and engine. These members are solely for your use as the application developer. The main member here is the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::apiVersion</span></code>. Here we use the <code class="docutils literal notranslate"><span class="pre">XR_CURRENT_API_VERSION</span></code> macro to specific the OpenXR version that we want to run. Also note here the use of <code class="docutils literal notranslate"><span class="pre">strncpy()</span></code> to set the applicationName and engineName. If you look at <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::applicationName</span></code> and <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::engineName</span></code> members, they are of type <code class="docutils literal notranslate"><span class="pre">char[]</span></code>, hence you must copy your string into that <code class="docutils literal notranslate"><span class="pre">char[]</span></code> and you must also by aware of the allowable length.</p>
<p id="instanceextensions">Similar to Vulkan, OpenXR allows applications to extend functionality past what is provided by the core specification. The functionality could be hardware/vendor specific. Most vital of course is which Graphics API to use with OpenXR. OpenXR supports D3D11, D3D12, Vulkan, OpenGL and OpenGL ES. Due the extensible nature of specification, it allows newer Graphics APIs and hardware functionality to be added with ease. Following on from the previous code in the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, add the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">);</span>
<span class="n">m_instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">GetGraphicsAPIInstanceExtensionString</span><span class="p">(</span><span class="n">m_apiType</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, we store in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code> the extension names that we would like to use. <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> is a macro of a string defined in <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code>. The XR_EXT_debug_utils is extension that checks the validity of calls made to OpenXR, and can use a call back function to handle any raised errors. We will explore this extension more in <a class="reference internal" href="#xr-ext-debug-utils"><span class="std std-ref">Chapter 2.1</span></a>. Depending on which <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macro that you have defined, this code will add the relevant extension.</p>
<p>Not all API layers and extensions are available to use, so we much check which ones can use. We will use <code class="docutils literal notranslate"><span class="pre">xrEnumerateApiLayerProperties()</span></code> and <code class="docutils literal notranslate"><span class="pre">xrEnumerateInstanceExtensionProperties()</span></code> to check which ones the runtime can provide. We will do this by adding the following code to the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">apiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrApiLayerProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_API_LAYER_PROPERTIES</span><span class="p">});</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestLayer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">layerProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">layerProperty</span><span class="p">.</span><span class="n">layerName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="n">extensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_EXTENSION_PROPERTIES</span><span class="p">});</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to find OpenXR instance extension: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requestExtension</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These functions are called twice. The first time is to get the count of the API layers or extensions and the second is to fill out the array of structures. Before the second call, we need set <code class="docutils literal notranslate"><span class="pre">XrApiLayerProperties::type</span></code> or <code class="docutils literal notranslate"><span class="pre">XrExtensionProperties::type</span></code> to the correct value, so that the second call can correctly fill out the data. After we have enumerated the API layers and extensions, we use a nested loop to check to see whether an API layers or extensions is available and add it to the <code class="docutils literal notranslate"><span class="pre">m_activeAPILayers</span></code> and/or <code class="docutils literal notranslate"><span class="pre">m_activeInstanceExtensions</span></code> respectively.</p>
<p>Note the <code class="docutils literal notranslate"><span class="pre">m_activeAPILayers</span></code> and <code class="docutils literal notranslate"><span class="pre">m_activeInstanceExtensions</span></code> are of type <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code>. This will help us when fill out the next structure <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code>.</p>
<p>Now that we have assembled all of the information need we can go ahead and fill out the <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> structure. Add the following code to the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_CREATE_INFO</span><span class="p">};</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">applicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledApiLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This section is fairly simple, as we have used the previously collected data and assigned it to the members in the <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> structure. Then, we called <code class="docutils literal notranslate"><span class="pre">xrCreateInstance()</span></code> where we took pointers to the <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> objects. When the function is called, if successful, it will return a value of <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code>, and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> will be non-null.</p>
<p>At the end of the application, we should destroy the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>. This is simple done with the function <code class="docutils literal notranslate"><span class="pre">xrDestroyInstance()</span></code>. Add the following code to the <code class="docutils literal notranslate"><span class="pre">DestroyInstance()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroyInstance</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Whilst we have an <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, let‚Äôs check its properties. Add the following code to the <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrInstanceProperties</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">{</span><span class="n">XR_TYPE_INSTANCE_PROPERTIES</span><span class="p">};</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProperties</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProperties.&quot;</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Runtime: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_PATCH</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, we have initialized the <code class="docutils literal notranslate"><span class="pre">XrInstanceProperties</span></code> structure with the correct <code class="docutils literal notranslate"><span class="pre">XrStructureType</span></code> and passed it along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> to the <code class="docutils literal notranslate"><span class="pre">xrGetInstanceProperties()</span></code> function. This function will fill out the rest of that structure for us to use. Next, we have loggod to stdout the runtime‚Äôs name, and with the use of the <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MAJOR</span></code>, <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MINOR</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_VERSION_PATCH</span></code> macros, we have parsed and logged the runtime version.</p>
</section>
<section id="xr-ext-debug-utils">
<h3>2.1.2 XR_EXT_debug_utils<a class="headerlink" href="#xr-ext-debug-utils" title="Permalink to this heading">¬∂</a></h3>
<p>XR_EXT_debug_utils is an instance extension for OpenXR, which allows the application to get more information on any errors or warnings etc. raised by the runtime. You can specify which message severities and types will checked. If a debug message raised, it is passed to the callback function, which can optionally use the user data pointer provided in the <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerCreateInfoEXT</span></code> structure.</p>
<dl class="simple">
<dt>Message Severities:</dt><dd><ul class="simple">
<li><p>Verbose: Output all diagnostic messages.</p></li>
<li><p>Info: Output information messages helpful in debugging.</p></li>
<li><p>Warning: Output messages that could suggest an application bug and that need reviewing.</p></li>
<li><p>Error: Output messages from errors that may cause undefined behavior and/or crashes.</p></li>
</ul>
</dd>
<dt>Message Types:</dt><dd><ul class="simple">
<li><p>General: An event type for general information.</p></li>
<li><p>Validation: An event type that may indicate invalid usage of OpenXR.</p></li>
<li><p>Performance: An event type that may indicate non-optimal usage of OpenXR.</p></li>
<li><p>Conformance: An event type that indicating a non-conformant OpenXR result from the runtime.</p></li>
</ul>
</dd>
</dl>
<p><a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#debug-message-categorization">OpenXR Specification 12.26.3. Debug Message Categorization</a>.</p>
<p>Copy the following code into <code class="docutils literal notranslate"><span class="pre">CreateDebugMessenger()</span></code> and <code class="docutils literal notranslate"><span class="pre">DestroyDebugMessenger()</span></code> respectively:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsStringInVector</span><span class="p">(</span><span class="n">m_activeInstanceExtensions</span><span class="p">,</span><span class="w"> </span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the code above, we first check that <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;XR_EXT_debug_utils&quot;</span></code> is in <code class="docutils literal notranslate"><span class="pre">activeInstanceExtensions</span></code>, which we used to create the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>. Next, we call the <code class="docutils literal notranslate"><span class="pre">CreateOpenXRDebugUtilsMessenger()</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsStringInVector</span><span class="p">(</span><span class="n">m_activeInstanceExtensions</span><span class="p">,</span><span class="w"> </span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DestroyOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At the end of the program, we should destroy the <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerEXT</span></code> by calling <code class="docutils literal notranslate"><span class="pre">DestroyOpenXRDebugUtilsMessenger</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="nf">CreateOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrDebugUtilsMessengerCreateInfoEXT</span><span class="w"> </span><span class="n">debugUtilsMessengerCI</span><span class="p">{</span><span class="n">XR_TYPE_DEBUG_UTILS_MESSENGER_CREATE_INFO_EXT</span><span class="p">};</span>
<span class="w">    </span><span class="n">debugUtilsMessengerCI</span><span class="p">.</span><span class="n">messageSeverities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT</span><span class="p">;</span>
<span class="w">    </span><span class="n">debugUtilsMessengerCI</span><span class="p">.</span><span class="n">messageTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_CONFORMANCE_BIT_EXT</span><span class="p">;</span>
<span class="w">    </span><span class="n">debugUtilsMessengerCI</span><span class="p">.</span><span class="n">userCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrDebugUtilsMessengerCallbackEXT</span><span class="p">)</span><span class="n">OpenXRMessageCallbackFunction</span><span class="p">;</span>
<span class="w">    </span><span class="n">debugUtilsMessengerCI</span><span class="p">.</span><span class="n">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>

<span class="w">    </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">debugUtilsMessenger</span><span class="p">{};</span>
<span class="w">    </span><span class="n">PFN_xrCreateDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">xrCreateDebugUtilsMessengerEXT</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrCreateDebugUtilsMessengerEXT&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrCreateDebugUtilsMessengerEXT</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateDebugUtilsMessengerEXT</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">debugUtilsMessengerCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">debugUtilsMessenger</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create DebugUtilsMessenger.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">debugUtilsMessenger</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">DestroyOpenXRDebugUtilsMessenger</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">debugUtilsMessenger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PFN_xrDestroyDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">xrDestroyDebugUtilsMessengerEXT</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrDestroyDebugUtilsMessengerEXT&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrDestroyDebugUtilsMessengerEXT</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroyDebugUtilsMessengerEXT</span><span class="p">(</span><span class="n">debugUtilsMessenger</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy DebugUtilsMessenger.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/OpenXRDebugUtils.cpp</em></p>
<p>In <code class="docutils literal notranslate"><span class="pre">CreateOpenXRDebugUtilsMessenger()</span></code>, we use a <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerCreateInfoEXT</span></code> structure to specify which message severities and types will checked. Next, we set the callback function that we want to use, and it must match the <code class="docutils literal notranslate"><span class="pre">PFN_xrDebugUtilsMessengerCallbackEXT</span></code> signature. Optionally, you can set a <code class="docutils literal notranslate"><span class="pre">userData</span></code> pointer, perhaps to a class, but here we have set it to <code class="docutils literal notranslate"><span class="pre">nullptr</span></code> in this example.</p>
<p>XR_EXT_debug_utils is an extension and as such its functions are not loaded by default by the OpenXR loader. Therefore, we need to get the address of the function through the use of <code class="docutils literal notranslate"><span class="pre">xrGetInstanceProcAddr()</span></code>. We pass the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and a string of the function we want to get, along with a pointer to a function pointer variable. We need to cast that pointer to a function pointer variable to a <code class="docutils literal notranslate"><span class="pre">PFN_xrVoidFunction*</span></code> type. Once we have the <code class="docutils literal notranslate"><span class="pre">xrCreateDebugUtilsMessengerEXT()</span></code> function, we call it by passing the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, a pointer to our <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerCreateInfoEXT</span></code> structure and a pointer to our <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerEXT</span></code>. If all is successful, we have set up the DebugUtilsMessenger callback.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">DestroyOpenXRDebugUtilsMessenger()</span></code>, the <code class="docutils literal notranslate"><span class="pre">xrDestroyDebugUtilsMessengerEXT()</span></code> function also needs to be loaded through the use of <code class="docutils literal notranslate"><span class="pre">xrGetInstanceProcAddr()</span></code>. Once loaded, we can call the function and pass the <code class="docutils literal notranslate"><span class="pre">XrDebugUtilsMessengerEXT</span></code> and thus destroying it.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrBool32</span><span class="w"> </span><span class="nf">OpenXRMessageCallbackFunction</span><span class="p">(</span><span class="n">XrDebugUtilsMessageSeverityFlagsEXT</span><span class="w"> </span><span class="n">messageSeverity</span><span class="p">,</span><span class="w"> </span><span class="n">XrDebugUtilsMessageTypeFlagsEXT</span><span class="w"> </span><span class="n">messageType</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XrDebugUtilsMessengerCallbackDataEXT</span><span class="w"> </span><span class="o">*</span><span class="n">pCallbackData</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">pUserData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">GetMessageSeverityString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">XrDebugUtilsMessageSeverityFlagsEXT</span><span class="w"> </span><span class="n">messageSeverity</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg_flags</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageSeverity</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;VERBOSE&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageSeverity</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
<span class="w">                </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageSeverity</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
<span class="w">                </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;WARN&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageSeverity</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
<span class="w">                </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg_flags</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">GetMessageTypeString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">XrDebugUtilsMessageTypeFlagsEXT</span><span class="w"> </span><span class="n">messageType</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg_flags</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageType</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;GEN&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageType</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
<span class="w">                </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;SPEC&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">messageType</span><span class="p">,</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
<span class="w">                </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">msg_flags</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;PERF&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg_flags</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">functionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pCallbackData</span><span class="o">-&gt;</span><span class="n">functionName</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pCallbackData</span><span class="o">-&gt;</span><span class="n">functionName</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">messageSeverityStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMessageSeverityString</span><span class="p">(</span><span class="n">messageSeverity</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">messageTypeStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMessageTypeString</span><span class="p">(</span><span class="n">messageType</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">messageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pCallbackData</span><span class="o">-&gt;</span><span class="n">messageId</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pCallbackData</span><span class="o">-&gt;</span><span class="n">messageId</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pCallbackData</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pCallbackData</span><span class="o">-&gt;</span><span class="n">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">;</span>
<span class="w">    </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">functionName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">messageSeverityStr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; / &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">messageTypeStr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;): msgNum: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">messageId</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">messageSeverity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XrBool32</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/OpenXRDebugUtils.cpp</em></p>
<p>Above is an example of a OpenXR DebugUtilsMessenger Callback function. This function can be completely customised to your liking, but here we simply convert the message‚Äôs severity and type to strings, and create a string to log to stdout. We also add a <code class="docutils literal notranslate"><span class="pre">DEBUG_BREAK</span></code> if the severity is an error. Just one thing to note: Applications should always return <code class="docutils literal notranslate"><span class="pre">XR_FALSE</span></code> from this function.</p>
</section>
<section id="xrsystemid">
<h3>2.1.3 XrSystemId<a class="headerlink" href="#xrsystemid" title="Permalink to this heading">¬∂</a></h3>
<p>The next object that we want to get is the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>. OpenXR ‚Äòseparates the concept of physical systems of XR devices from the logical objects that applications interact with directly. A system represents a collection of related devices in the runtime, often made up of several individual hardware components working together to enable XR experiences‚Äô.
<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#system">OpenXR Specification 5. System</a>.</p>
<p>So, a <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> could represent VR headset and a pair of controllers, or perhaps mobile device with video pass-through for AR. So we need to decide what type of <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code> we are wanting to use, as some runtimes support multiple form factors. Here, we are selecting <code class="docutils literal notranslate"><span class="pre">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span></code>, which is initialised in the class, for a Meta Quest or Pico Neo. OpenXR currently offers two option for the <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrFormFactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HANDHELD_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrFormFactor</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr.h</em></p>
<p>Add the following code to the <code class="docutils literal notranslate"><span class="pre">GetSystemID()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrSystemGetInfo</span><span class="w"> </span><span class="n">systemGI</span><span class="p">{</span><span class="n">XR_TYPE_SYSTEM_GET_INFO</span><span class="p">};</span>
<span class="n">systemGI</span><span class="p">.</span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_formFactor</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystem</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemGI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_systemID</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemID.&quot;</span><span class="p">);</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystemProperties</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemProperties.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Here, we have filled out the <code class="docutils literal notranslate"><span class="pre">XrSystemGetInfo</span></code> structure with the desired <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code> and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and a pointer to the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to the <code class="docutils literal notranslate"><span class="pre">xrGetSystem()</span></code> function. When the function is called, if successful, <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> will be non-null.</p>
<p>With the above code, we have also got the system‚Äôs properties. We partially filled out a <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure and passed it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to the <code class="docutils literal notranslate"><span class="pre">xrGetSystemProperties()</span></code> function. This function will fill out the rest of the <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure; detailing the vendor‚Äôs ID, system‚Äôs name and the system‚Äôs graphics and tracking properties.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemGraphicsProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageHeight</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxLayerCount</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemGraphicsProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemTrackingProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">orientationTracking</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">positionTracking</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemTrackingProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">               </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">            </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemId</span><span class="w">                    </span><span class="n">systemId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">                      </span><span class="n">vendorId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w">                          </span><span class="n">systemName</span><span class="p">[</span><span class="n">XR_MAX_SYSTEM_NAME_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XrSystemGraphicsProperties</span><span class="w">    </span><span class="n">graphicsProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemTrackingProperties</span><span class="w">    </span><span class="n">trackingProperties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemProperties</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr.h</em></p>
<p>You can now run the application to check that you have a valid <code class="docutils literal notranslate"><span class="pre">XrInstnace</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>.</p>
</section>
</section>
<section id="creating-an-xrsession">
<h2>2.2 Creating an XrSession<a class="headerlink" href="#creating-an-xrsession" title="Permalink to this heading">¬∂</a></h2>
<p>The next major component of OpenXR that needs to be created in an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. An <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> encapulates the state of application from the perspective of OpenXR. When an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> is created, it starts in the <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_IDLE</span></code>. It is upto the runtime to provide any updates to the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> and for the application to query them and react to them. We will explore this in <a class="reference internal" href="#polling-the-event-loop"><span class="std std-ref">Chapter 2.3</span></a>.</p>
<p>For now, we are just going to create an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. At this point, you‚Äôll need to select which Graphics API you wish to use. Only one Graphics API can be used with an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. This tutorial demonstrates how to use D3D11, D3D12, OpenGL, OpenGL ES and Vulkan in conjunction with OpenXR for the purpose of rendering graphics to the provided views. Ultimately, you will most likely be bringing your own rendering solution to this tutorial, therefore the code examples provided for the Graphics APIs are <cite>placeholders</cite> for you own code base; demonstrating in this sub-chapter what objects are needed from your Graphics API in order to create an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. This tutorial uses polymorphic classes; <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> derives from the base <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class. There are both compile and runtime checks to select the requested Graphics API, and we construct an appropriate derived classes through the use of <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;&gt;</span></code>.</p>
<p>Update the constructor of the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class, the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> method and also add in the definitions of the new methods and the members to their separate private sections. All the new code is highlighted code below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">api</span><span class="p">)</span>
<span class="hll"><span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">apiType</span><span class="p">(</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CheckGraphicsAPI_TypeIsValidForPlatform</span><span class="p">(</span><span class="n">apiType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: The provided Graphics API is not valid for this platform.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll"><span class="w">                        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
</span><span class="hll"><span class="w">                </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="hll"><span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>
</span>
<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateSession</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroySession</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">m_formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">m_systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="hll"><span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">m_apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GraphicsAPI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrSession</span><span class="w"> </span><span class="n">m_session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="p">};</span>
</pre></div>
</div>
<section id="xrsession">
<h3>2.2.1 XrSession<a class="headerlink" href="#xrsession" title="Permalink to this heading">¬∂</a></h3>
<p>Copy the following code into the <code class="docutils literal notranslate"><span class="pre">CreateSession()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrSessionCreateInfo</span><span class="w"> </span><span class="n">sessionCI</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_CREATE_INFO</span><span class="p">};</span>
</pre></div>
</div>
<div class="d3d11 docutils container" id="d3d11-id-0">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="d3d12 docutils container" id="d3d12-id-0">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_D3D12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="opengl docutils container" id="opengl-id-0">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="opengles docutils container" id="opengles-id-0">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container" id="vulkan-id-0">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">GraphicsAPI_Vulkan</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sessionCI</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetGraphicsBinding</span><span class="p">();</span>
<span class="n">sessionCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">sessionCI</span><span class="p">.</span><span class="n">systemId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_systemID</span><span class="p">;</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSession</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Session.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">DestroySession()</span></code> method, add the following code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroySession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Session.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Above is the code for creating and destroying an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. <code class="docutils literal notranslate"><span class="pre">xrDestroySession()</span></code> will destroy the <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> when we are finished and shutting down the application. <code class="docutils literal notranslate"><span class="pre">xrCreateSession()</span></code> takes the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> return object. If the function call was successful, <code class="docutils literal notranslate"><span class="pre">xrCreateSession()</span></code> will return <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code> will be non-null.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo</span></code> structure is deceptively simple. <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::createFlags</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::systemId</span></code> are easily filled in, but we need to specify which Graphics API we wish to use. This is achieved via the use of the <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code> void pointer. Following Vulkan API‚Äôs style of extensibility, structures for creating objects can be extended to enable extra functionality. In our case, the extension is required and thus <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code> can not be a nullptr. That pointer must point to ‚Äòexactly one graphics API binding structure (a structure whose name begins with ‚ÄúXrGraphicsBinding‚Äù)‚Äô (<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSessionCreateInfo.html">XrSessionCreateInfo(3) Manual Page</a>). We get a pointer to the correct <em>Graphics Binding</em> structure by calling <code class="docutils literal notranslate"><span class="pre">GraphicsAPI::GetGraphicsBinding();</span></code>.</p>
</section>
<section id="graphicsapi">
<h3>2.2.2 GraphicsAPI<a class="headerlink" href="#graphicsapi" title="Permalink to this heading">¬∂</a></h3>
<p>Below are code excerpts from <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> and <code class="docutils literal notranslate"><span class="pre">openxr_platform.h</span></code> based on your selected graphics APIs, and you don‚Äôt need to copy this code into project. The excerpts demonstrate the interaction of OpenXR with your selected graphics API.</p>
<div class="d3d11 docutils container" id="d3d11-id-1">
<p class="rubric">DirectX 11</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D11</span><span class="o">::</span><span class="n">GraphicsAPI_D3D11</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D11GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D11.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory1</span><span class="p">(</span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">LUID</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">D3D11CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">D3D_DRIVER_TYPE_UNKNOWN</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_CREATE_DEVICE_DEBUG</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_SDK_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">immediateContext</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D11 Device.&quot;</span><span class="p">);</span>

<span class="w">	</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="p">(</span><span class="w"> </span><span class="n">__uuidof</span><span class="p">(</span><span class="n">ID3D11Debug</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">d3dDebug</span><span class="w"> </span><span class="p">);</span>
<span class="w">	</span><span class="n">d3dDebug</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="p">(</span><span class="w"> </span><span class="n">__uuidof</span><span class="p">(</span><span class="n">ID3D11InfoQueue</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">infoQueue</span><span class="w"> </span><span class="p">);</span>
<span class="w">	</span><span class="n">infoQueue</span><span class="o">-&gt;</span><span class="n">SetBreakOnSeverity</span><span class="p">(</span><span class="n">D3D11_MESSAGE_SEVERITY_WARNING</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">	</span><span class="n">infoQueue</span><span class="o">-&gt;</span><span class="n">SetBreakOnSeverity</span><span class="p">(</span><span class="n">D3D11_MESSAGE_SEVERITY_ERROR</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D11</span><span class="o">::~</span><span class="n">GraphicsAPI_D3D11</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">immediateContext</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_D3D11.cpp</em></p>
<p>Above is the minimum code needed to create a suitable <code class="docutils literal notranslate"><span class="pre">ID3D11Device</span> <span class="pre">*</span></code>. First, we get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetD3D11GraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D11KHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">LUID</span><span class="w">                  </span><span class="n">adapterLuid</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D_FEATURE_LEVEL</span><span class="w">     </span><span class="n">minFeatureLevel</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr_platform.h</em></p>
<p>From this structure, we used the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> to find the appropriate <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter</span> <span class="pre">*</span></code>. We created a <code class="docutils literal notranslate"><span class="pre">IDXGIFactory1</span> <span class="pre">*</span></code> and then called <code class="docutils literal notranslate"><span class="pre">IDXGIFactory1::EnumAdapters()</span></code> and <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter::GetDesc()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">DXGI_ADAPTER_DESC</span></code>, so that we could compare the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> values.</p>
<p>Finally, we called <code class="docutils literal notranslate"><span class="pre">D3D11CreateDevice</span></code> with the found adapter and the <code class="docutils literal notranslate"><span class="pre">minFeatureLevel</span></code> from <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D11KHR</span></code>, if successful, the function returned <code class="docutils literal notranslate"><span class="pre">S_OK</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D11Device</span> <span class="pre">*</span></code> is non-null.</p>
<p>We also create <code class="docutils literal notranslate"><span class="pre">ID3D11Debug</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D11InfoQueue</span></code> for debugging.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_D3D11::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_D3D11.cpp</em></p>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingD3D11KHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="d3d12 docutils container" id="d3d12-id-1">
<p class="rubric">DirectX 12</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D12</span><span class="o">::</span><span class="n">GraphicsAPI_D3D12</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D12GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D12.&quot;</span><span class="p">);</span>
<span class="w">	</span><span class="k">if</span><span class="p">(</span><span class="n">debugAPI</span><span class="p">)</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">D3D12GetDebugInterface</span><span class="p">(</span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">debug</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to get DebugInterface.&quot;</span><span class="p">);</span>
<span class="w">		</span><span class="n">debug</span><span class="o">-&gt;</span><span class="n">EnableDebugLayer</span><span class="p">();</span>
<span class="w">		</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">ID3D12Debug1</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">SetEnableGPUBasedValidation</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter1</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">LUID</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">D3D12CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Device.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_COMMAND_QUEUE_DESC</span><span class="w"> </span><span class="n">commandQueueDesc</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_LIST_TYPE_DIRECT</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_QUEUE_FLAG_NONE</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">NodeMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateCommandQueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">commandQueueDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Command Queue.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_FEATURE_DATA_D3D12_OPTIONS</span><span class="w"> </span><span class="n">d3d12Options</span><span class="p">{};</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CheckFeatureSupport</span><span class="p">(</span><span class="n">D3D12_FEATURE_D3D12_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d3d12Options</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">d3d12Options</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Unable to CheckFeatureSupport for D3D12_FEATURE_D3D12_OPTIONS.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ResourceBindingCapabilities</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxDescriptorCount</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxCBVsPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxSRVsPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxUAVsPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxSamplersPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxSamplerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2048</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">resourceBindingCapabilities</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">d3d12Options</span><span class="p">.</span><span class="n">ResourceBindingTier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">D3D12_RESOURCE_BINDING_TIER_3</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resourceBindingCapabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">D3D12_RESOURCE_BINDING_TIER_2</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resourceBindingCapabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">D3D12_RESOURCE_BINDING_TIER_1</span><span class="p">:</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxUAVsPerStage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*D3D_FEATURE_LEVEL_11_0*/</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span>
<span class="w">        </span><span class="n">resourceBindingCapabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="n">maxUAVsPerStage</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D12_DESCRIPTOR_HEAP_DESC</span><span class="w"> </span><span class="n">DescriptorHeapDesc</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_DESCRIPTOR_HEAP_TYPE_CBV_SRV_UAV</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">NumDescriptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceBindingCapabilities</span><span class="p">.</span><span class="n">maxDescriptorCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_DESCRIPTOR_HEAP_FLAG_SHADER_VISIBLE</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">NodeMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateDescriptorHeap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DescriptorHeapDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CBV_SRV_UAV_DescriptorHeap</span><span class="p">));</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_DESCRIPTOR_HEAP_TYPE_SAMPLER</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">NumDescriptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceBindingCapabilities</span><span class="p">.</span><span class="n">maxSamplerCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateDescriptorHeap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DescriptorHeapDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SAMPLER_DescriptorHeap</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D12</span><span class="w"> </span><span class="o">::~</span><span class="n">GraphicsAPI_D3D12</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">SAMPLER_DescriptorHeap</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">CBV_SRV_UAV_DescriptorHeap</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_D3D12.cpp</em></p>
<p>Above is the minimum code needed to create a suitable <code class="docutils literal notranslate"><span class="pre">ID3D12Device</span> <span class="pre">*</span></code>  and <code class="docutils literal notranslate"><span class="pre">ID3D12CommandQueue</span> <span class="pre">*</span></code>. First, we get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetD3D12GraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D12KHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">LUID</span><span class="w">                  </span><span class="n">adapterLuid</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D_FEATURE_LEVEL</span><span class="w">     </span><span class="n">minFeatureLevel</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr_platform.h</em></p>
<p>From this structure, we used the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> to find the appropriate <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter1</span> <span class="pre">*</span></code>. We created a <code class="docutils literal notranslate"><span class="pre">IDXGIFactory4</span> <span class="pre">*</span></code> and then called <code class="docutils literal notranslate"><span class="pre">IDXGIFactory4::EnumAdapters1()</span></code> and <code class="docutils literal notranslate"><span class="pre">IDXGIAdapter1::GetDesc()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">DXGI_ADAPTER_DESC</span></code>, so that we could compare the <code class="docutils literal notranslate"><span class="pre">adapterLuid</span></code> values.</p>
<p>Finally, we called <code class="docutils literal notranslate"><span class="pre">D3D12CreateDevice</span></code> with the found adapter and the <code class="docutils literal notranslate"><span class="pre">minFeatureLevel</span></code> from <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsD3D12KHR</span></code>, if successful, the function returned <code class="docutils literal notranslate"><span class="pre">S_OK</span></code> and <code class="docutils literal notranslate"><span class="pre">ID3D12Device</span> <span class="pre">*</span></code> is non-null. Next, we created a simple a <code class="docutils literal notranslate"><span class="pre">ID3D12CommandQueue</span> <span class="pre">*</span></code> of type <code class="docutils literal notranslate"><span class="pre">D3D12_COMMAND_LIST_TYPE_DIRECT</span></code>.</p>
<p>We also queried the maximum number of descriptors and set up <code class="docutils literal notranslate"><span class="pre">ID3D12DescriptorHeap</span> <span class="pre">*</span></code> s for use in rendering. There‚Äôs also commented out code to enable D3D12 debugging and GPU Based Validation.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_D3D12::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_D3D12.cpp</em></p>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingD3D12KHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="opengl docutils container" id="opengl-id-1">
<p class="rubric">OpenGL</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGL.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L103-L121</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: The created OpenGL version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; doesn&#39;t meet the minimum required API version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_OpenGL.cpp</em></p>
<p>Above is the minimum code needed to create a suitable OpenGL context. First, we get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetOpenGLGraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr_platform.h</em></p>
<p>In this tutorial, we are using the ‚Äògfxwrapper‚Äô for the OpenGL API found as a part of the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a> reposity under <code class="docutils literal notranslate"><span class="pre">src/common/</span></code>. Originally developed by Oculus VR, LLC and The Brenwill Workshop Ltd.; this wrapper is written against the <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/gl/glspec43.core.pdf">OpenGL 4.3</a> and <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/es/3.1/es_spec_3.1.withchanges.pdf">OpenGL ES 3.1</a> specifications.</p>
<p>Here, we called <code class="docutils literal notranslate"><span class="pre">ksGpuWindow_Create()</span></code> and passed the required parameters to setup the OpenGL context. Next, we queried the OpenGL version with <code class="docutils literal notranslate"><span class="pre">glGetIntegerv()</span></code> with <code class="docutils literal notranslate"><span class="pre">GL_MAJOR_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">GL_MINOR_VERSION</span></code>. With these values, we constructed an <code class="docutils literal notranslate"><span class="pre">XrVersion</span></code> value to compare with <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLKHR::minApiVersionSupported</span></code>.</p>
<p>We also setup <code class="docutils literal notranslate"><span class="pre">glDebugMessageCallback</span></code> to help with debugging.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_OpenGL::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L123-L144</span>
<span class="cp">#if defined(XR_USE_PLATFORM_WIN32)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_WIN32_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">hDC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">hDC</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">hGLRC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">hGLRC</span><span class="p">;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_XLIB)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_XLIB_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">xDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">xDisplay</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">visualid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">visualid</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxFBConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxFBConfig</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxDrawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxDrawable</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxContext</span><span class="p">;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_XCB)</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_XCB_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// TODO: Still missing the platform adapter, and some items to make this usable.</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">connection</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.screenNumber = window.context.screenNumber;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.fbconfigid = window.context.fbconfigid;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">visualid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">visualid</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">glxDrawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">glxDrawable</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// m_graphicsBinding.glxContext = window.context.glxContext;</span>
<span class="cp">#elif defined(XR_USE_PLATFORM_WAYLAND)</span>
<span class="w">    </span><span class="c1">// TODO: Just need something other than NULL here for now (for validation).  Eventually need</span>
<span class="w">    </span><span class="c1">//       to correctly put in a valid pointer to an wl_display</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_WAYLAND</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">wl_display</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_OpenGL.cpp</em></p>
<p>Because OpenGL is very closely integrated with the platform‚Äôs windowing system. We have different <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGL[...]KHR</span></code> structures - one per platform. At present, there are four: <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLXcbKHR</span></code>, <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLXlibKHR</span></code>, <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLWaylandKHR</span></code> and <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLWin32KHR</span></code>. Depending on the platform, this function will fill out the relevant structure and return a pointer to that class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
<div class="opengles docutils container" id="opengles-id-1">
<p class="rubric">OpenGL ES</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLESGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_ES_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGLES.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengles.cpp#L101-L119</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: The created OpenGL ES version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; doesn&#39;t meet the minimum required API version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_OpenGL_ES.cpp</em></p>
<p>Above is the minimum code needed to create a suitable OpenGL ES context. First, we get the function pointer for <code class="docutils literal notranslate"><span class="pre">xrGetOpenGLESGraphicsRequirementsKHR</span></code>, which went called fills out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLESKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr_platform.h</em></p>
<p>In this tutorial, we are using the ‚Äògfxwrapper‚Äô for the OpenGL ES API found as a part of the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a> reposity under <code class="docutils literal notranslate"><span class="pre">src/common/</span></code>. Originally developed by Oculus VR, LLC and The Brenwill Workshop Ltd.; this wrapper is written against the <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/gl/glspec43.core.pdf">OpenGL 4.3</a> and <a class="reference external" href="https://registry.khronos.org/OpenGL/specs/es/3.1/es_spec_3.1.withchanges.pdf">OpenGL ES 3.1</a> specifications.</p>
<p>Here, we called <code class="docutils literal notranslate"><span class="pre">ksGpuWindow_Create()</span></code> and passed the required parameters to setup the OpenGL ES context. Next, we query the OpenGL ES version with <code class="docutils literal notranslate"><span class="pre">glGetIntegerv()</span></code> with <code class="docutils literal notranslate"><span class="pre">GL_MAJOR_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">GL_MINOR_VERSION</span></code>. With these values, we constructed an <code class="docutils literal notranslate"><span class="pre">XrVersion</span></code> value to compare with <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsOpenGLESKHR::minApiVersionSupported</span></code>.</p>
<p>We also setup <code class="docutils literal notranslate"><span class="pre">glDebugMessageCallback</span></code> to help with debugging.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_OpenGL_ES::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_OPENGL_ES_ANDROID_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">display</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">config</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_OpenGL_ES.cpp</em></p>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingOpenGLESAndroidKHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>. Note: This <code class="docutils literal notranslate"><span class="pre">XrGraphicsBinding...</span></code> structure differs from the others as it specifically tailored to the Android platform.</p>
</div>
<div class="vulkan docutils container" id="vulkan-id-1">
<p class="rubric">Vulkan</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Instance</span>
<span class="w">    </span><span class="n">LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for Vulkan.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkApplicationInfo</span><span class="w"> </span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pApplicationName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pEngineName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan Engine&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_MAKE_API_VERSION</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">),</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">instanceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">instanceExtensionCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrInstanceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrInstanceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pApplicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceLayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceLayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Vulkan Instance.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Physical Device</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">physicalDeviceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkPhysicalDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">physicalDeviceCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkPhysicalDevice</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceFromXR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Device for Vulkan.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">physicalDeviceFromXR_it</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Vulkan: Failed to find PhysicalDevice for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Select the first available device.</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Device</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkQueueFamilyProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">queueFamilyPropertiesCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyPropertiesCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkDeviceQueueCreateInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">;</span>
<span class="w">    </span><span class="n">queuePriorities</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>

<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pQueuePriorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFlags</span><span class="p">,</span><span class="w"> </span><span class="n">VkQueueFlags</span><span class="p">(</span><span class="n">VK_QUEUE_GRAPHICS_BIT</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">deviceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">deviceExtensionCount</span><span class="p">);</span>

<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrDeviceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrDeviceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkPhysicalDeviceFeatures</span><span class="w"> </span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceFeatures</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkDeviceCreateInfo</span><span class="w"> </span><span class="n">deviceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">queueCreateInfoCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pQueueCreateInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pEnabledFeatures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateDevice</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Device.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_Vulkan</span><span class="o">::~</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">vkDestroyDevice</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_Vulkan.cpp</em></p>
<p>Above is the minimum code needed to create a suitable Vulkan Instance and Device. First, we called a helper method that loads in the pointers for the following functions:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsRequirementsKHR</span></code>: Used to fill out an <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR</span></code> structure containing the minimum and maximum supported API version.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR</span></code>: To retrieve a list of required <code class="docutils literal notranslate"><span class="pre">VkInstance</span></code> extensions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanDeviceExtensionsKHR</span></code>: To retrieve a list of required <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code> extensions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsDeviceKHR</span></code>:  To get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> requested by OpenXR.</p></li>
</ul>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GraphicsAPI_Vulkan::LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanInstanceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanDeviceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsDeviceKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_Vulkan.cpp</em></p>
<p>We called <code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsRequirementsKHR()</span></code> and fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR</span></code> structure.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">       </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">    </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">minApiVersionSupported</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVersion</span><span class="w">             </span><span class="n">maxApiVersionSupported</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr_platform.h</em></p>
<p>Then, we filled out a <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo</span></code> where we assigned <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo::apiVersion</span></code> a value using the retured value in <code class="docutils literal notranslate"><span class="pre">XrGraphicsRequirementsVulkanKHR::minApiVersionSupported</span></code>. We enumerated the Instance extensions and filled out an array of structures. We used nested for-loops to find all the requested extensions and pushed them back into a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code> called <code class="docutils literal notranslate"><span class="pre">activeInstanceExtensions</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">GetInstanceExtensionsForOpenXR()</span></code> is another helper method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_Vulkan.cpp</em></p>
<p><code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR()</span></code> is called twice, first to get the size of the <code class="docutils literal notranslate"><span class="pre">char</span></code> buffer and the second to fill in the data. We used <code class="docutils literal notranslate"><span class="pre">std::stringstream</span></code> and <code class="docutils literal notranslate"><span class="pre">std::getline()</span></code> with a deliminator of <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to break up the string and copied that substring to an element in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code>, which we used when setting the instance extensions.</p>
<p>We filled out the <code class="docutils literal notranslate"><span class="pre">VkInstanceCreateInfo</span></code> structure and called <code class="docutils literal notranslate"><span class="pre">vkCreateInstance()</span></code>, which if successful returned <code class="docutils literal notranslate"><span class="pre">VK_SUCCESS</span></code> and the <code class="docutils literal notranslate"><span class="pre">VkInstance</span></code> will be non-null.</p>
<p>Then, we enumerated the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> s. Once we had an array of all the physical devices in the system, we called <code class="docutils literal notranslate"><span class="pre">xrGetVulkanGraphicsDeviceKHR()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> that OpenXR has requested. We checked the requested physical device against the array of physical devices and selected the correct one.</p>
<p>With a <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> selected, we created a <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code>. We got the <code class="docutils literal notranslate"><span class="pre">VkQueueFamilyProperties</span></code> from the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> and filled out an array of <code class="docutils literal notranslate"><span class="pre">VkDeviceQueueCreateInfo</span></code> structures. We found the first queue family that supports graphics operations and selected its index as the <code class="docutils literal notranslate"><span class="pre">queueFamilyIndex</span></code> and we also selected the first queue in that family too. We enumerated the Device extensions and filled out an array of structures. We used nested for-loops to find all the requested extensions and pushed them back into a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code> called <code class="docutils literal notranslate"><span class="pre">activeDeviceExtensions</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">GetDeviceExtensionsForOpenXR()</span></code> is another helper method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_Vulkan.cpp</em></p>
<p>Like with <code class="docutils literal notranslate"><span class="pre">xrGetVulkanInstanceExtensionsKHR()</span></code>, <code class="docutils literal notranslate"><span class="pre">xrGetVulkanDeviceExtensionsKHR()</span></code> is called twice, first to get the size of the <code class="docutils literal notranslate"><span class="pre">char</span></code> buffer and the second to fill in the data. We used <code class="docutils literal notranslate"><span class="pre">std::stringstream</span></code> and <code class="docutils literal notranslate"><span class="pre">std::getline()</span></code> with a deliminator of <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to break up the string and copied that substring into an element in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code>, which we used when setting the device extensions.</p>
<p>Finally, we got the <code class="docutils literal notranslate"><span class="pre">VkPhysicalDeviceFeatures</span></code> by calling <code class="docutils literal notranslate"><span class="pre">vkGetPhysicalDeviceFeatures()</span></code> and we filled in the <code class="docutils literal notranslate"><span class="pre">VkDeviceCreateInfo</span></code>. We called <code class="docutils literal notranslate"><span class="pre">vkCreateDevice()</span></code>, which if successful returned <code class="docutils literal notranslate"><span class="pre">VK_SUCCESS</span></code> and the <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code> will be non-null.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">GraphicsAPI_Vulkan::GetGraphicsBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_BINDING_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevice</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="p">;</span>
<span class="w">    </span><span class="n">graphicsBinding</span><span class="p">.</span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsBinding</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from Common/GraphicsAPI_Vulkan.cpp</em></p>
<p>Here, we simply fill out the <code class="docutils literal notranslate"><span class="pre">XrGraphicsBindingVulkanKHR</span></code> structure and return a pointer to the class member, which will be assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionCreateInfo::next</span></code>.</p>
</div>
</section>
</section>
<section id="polling-the-event-loop">
<h2>2.3 Polling the Event Loop<a class="headerlink" href="#polling-the-event-loop" title="Permalink to this heading">¬∂</a></h2>
<p>OpenXR uses an event based system to describes changes within the XR system. It‚Äôs the application‚Äôs responsibility to poll these events and react to them. The polling of events is done by the function <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code>. The application should continually call this function throughout its lifetime. Within a single XR frame, the application should continuously call <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> until the internal event queue is ‚Äòdrained‚Äô; multiple events can occurs across the XR frame and the application needs to handle and respond to each accordingly.</p>
<p>Firstly, we will update the class. In the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> method add the highlighted code below. Also add the highlighted code for the new methods and members in their separate private sections.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">(</span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">api</span><span class="p">)</span>
<span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="n">apiType</span><span class="p">(</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CheckGraphicsAPI_TypeIsValidForPlatform</span><span class="p">(</span><span class="n">apiType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: The provided Graphics API is not valid for this platform.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">                        </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>
<span class="w">                </span><span class="n">CreateDebugMessenger</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">CreateSession</span><span class="p">();</span>

<span class="hll"><span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">m_applicationRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                        </span><span class="n">PollSystemEvents</span><span class="p">();</span>
</span><span class="hll"><span class="w">                        </span><span class="n">PollEvents</span><span class="p">();</span>
</span><span class="hll"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_sessionRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">                                </span><span class="c1">// Draw Frame.</span>
</span><span class="hll"><span class="w">                        </span><span class="p">}</span>
</span><span class="hll"><span class="w">                </span><span class="p">}</span>
</span>
<span class="w">                </span><span class="n">DestroySession</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyDebugMessenger</span><span class="p">();</span>
<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyDebugMessenger</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateSession</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroySession</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// [...]</span>
<span class="w">        </span><span class="p">}</span>
<span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">PollEvents</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">PollSystemEvents</span><span class="p">()</span>
</span><span class="hll"><span class="w">        </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrDebugUtilsMessengerEXT</span><span class="w"> </span><span class="n">m_debugUtilsMessenger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">XrFormFactor</span><span class="w"> </span><span class="n">m_formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">m_systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">        </span><span class="n">GraphicsAPI_Type</span><span class="w"> </span><span class="n">m_apiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GraphicsAPI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>

<span class="w">        </span><span class="n">XrSession</span><span class="w"> </span><span class="n">m_session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="hll"><span class="w">        </span><span class="n">XrSessionState</span><span class="w"> </span><span class="n">m_sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="n">XrViewConfigurationType</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span><span class="p">;</span>
</span><span class="p">};</span>
</pre></div>
</div>
<section id="xrpollevent">
<h3>2.3.1 xrPollEvent<a class="headerlink" href="#xrpollevent" title="Permalink to this heading">¬∂</a></h3>
<p>Copy the following code into the <code class="docutils literal notranslate"><span class="pre">PollEvents()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">;</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrEventDataBuffer</span><span class="w"> </span><span class="n">eventData</span><span class="p">{</span><span class="n">XR_TYPE_EVENT_DATA_BUFFER</span><span class="p">};</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrPollEvent</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">eventData</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_EVENTS_LOST</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*</span><span class="n">eventsLost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataEventsLost</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OPENXR: Events Lost: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eventsLost</span><span class="o">-&gt;</span><span class="n">lostEventCount</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*</span><span class="n">instanceLossPending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInstanceLossPending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OPENXR: Instance Loss Pending at: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceLossPending</span><span class="o">-&gt;</span><span class="n">lossTime</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*</span><span class="n">interactionProfileChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataInteractionProfileChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OPENXR: Interaction Profile changed for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interactionProfileChanged</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*</span><span class="n">referenceSpaceChangePending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataReferenceSpaceChangePending</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OPENXR: Reference Space Change pending for Session: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">referenceSpaceChangePending</span><span class="o">-&gt;</span><span class="n">session</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*</span><span class="n">sessionStateChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">XrEventDataSessionStateChanged</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventData</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">            </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="p">;</span>
<span class="w">            </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">m_applicationRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">m_sessionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">);</span>
</pre></div>
</div>
<p>Above, we have defined the <code class="docutils literal notranslate"><span class="pre">PollEvents()</span></code> method. Here, we use a do-while loop to the check the result of <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> - whilst that function returns <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code>, there are events for us to process. <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> will fill in the <code class="docutils literal notranslate"><span class="pre">XrEventDataBuffer</span></code> structure that we pass to the function call. <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> will update the member variable <code class="docutils literal notranslate"><span class="pre">type</span></code> and from this we use a switch statement to select the appropriate code path. Depending on the updated type, we use a <code class="docutils literal notranslate"><span class="pre">reinterpret_cast&lt;&gt;()</span></code> to get the actual data that <code class="docutils literal notranslate"><span class="pre">xrPollEvent()</span></code> returned.</p>
<p>The description of the events come from <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#_xrpollevent">2.22.1. Event Polling of the OpenXR specification</a>.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Event Structure Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_EVENTS_LOST</p></td>
<td><p>XrEventDataEventsLost</p></td>
<td><p>The event queue has overflowed and some events were lost.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</p></td>
<td><p>XrEventDataInstanceLossPending</p></td>
<td><p>The application is about to lose the instance.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</p></td>
<td><p>XrEventDataInteractionProfileChanged</p></td>
<td><p>The active input form factor for one or more top level user paths has changed.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</p></td>
<td><p>XrEventDataReferenceSpaceChangePending</p></td>
<td><p>The runtime will begin operating with updated space bounds.</p></td>
</tr>
<tr class="row-even"><td><p>XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</p></td>
<td><p>XrEventDataSessionStateChanged</p></td>
<td><p>The application has changed its lifecycle state.</p></td>
</tr>
</tbody>
</table>
<p>As described in the table above, most events are transparent in their intensions and how the application should react to them. For the <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INSTANCE_LOSS_PENDING</span></code> state, the application may want to try re-creating the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> in a loop, and after the specified <code class="docutils literal notranslate"><span class="pre">lossTime</span></code>, until it can create a new instance successfully. <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_INTERACTION_PROFILE_CHANGED</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_REFERENCE_SPACE_CHANGE_PENDING</span></code> are used for updating how the user interacts with the application and whether a new space change has been detected respectively.</p>
<p>For some platforms, we need additional functionality provided via the <code class="docutils literal notranslate"><span class="pre">PollSystemEvents()</span></code> method, so that our application can react to any relevant updates from the platform correctly.</p>
<div class="windows linux docutils container" id="windows-linux-id-1">
<p>For Windows and Linux, there no relevant system event that we need to be aware of, and thus the <code class="docutils literal notranslate"><span class="pre">PollSystemEvents()</span></code> method definition can be left blank.</p>
</div>
<div class="android docutils container" id="android-id-1">
<p>For Android, we have already provided the code for the <code class="docutils literal notranslate"><span class="pre">PollSystemEvents()</span></code> method in <a class="reference internal" href="1-introduction.html#openxrtutorial-and-main"><span class="std std-ref">Chapter 1.4.3</span></a>. So its duplicate definition must be removed from the class. This function is outside the scope of OpenXR, but in general it polls Android for system events,updates and uses the <code class="docutils literal notranslate"><span class="pre">AndroidAppState</span></code>, <code class="docutils literal notranslate"><span class="pre">m_applicationRunning</span></code> and <code class="docutils literal notranslate"><span class="pre">m_sessionRunning</span></code> members.</p>
</div>
</section>
<section id="xrsessionstate">
<h3>2.3.2 XrSessionState<a class="headerlink" href="#xrsessionstate" title="Permalink to this heading">¬∂</a></h3>
<p>The final event type, <code class="docutils literal notranslate"><span class="pre">XR_TYPE_EVENT_DATA_SESSION_STATE_CHANGED</span></code>, in the above code and table is what we will focus on for the rest of this chapter. There are currently nine valid <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> s described:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrSessionState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_UNKNOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_IDLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_READY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_SYNCHRONIZED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_VISIBLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_FOCUSED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_LOSS_PENDING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_EXITING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_SESSION_STATE_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSessionState</span><span class="p">;</span>
</pre></div>
</div>
<p><em>The above code is an excerpt from openxr/openxr.h</em></p>
<p>Below is a table describing the nine <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> s:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Event Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_UNKNOWN</p></td>
<td><p>This is an unknown, pseudo-default state and should not be returned by the runtime.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_IDLE</p></td>
<td><p>This is an initial state after creating or after ending the session.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_READY</p></td>
<td><p>This state, raised from the runtime, indicates that the session is ready to begin.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_SYNCHRONIZED</p></td>
<td><p>The application has synced its frame loop with the runtime, but isn‚Äôt displaying its contents.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_VISIBLE</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_FOCUSED</p></td>
<td><p>The application has synced its frame loop with the runtime and it is displaying its contents and can receive XR inputs.</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_STOPPING</p></td>
<td><p>The runtime is requesting that the application stop it frame loop rendering and end the session.</p></td>
</tr>
<tr class="row-odd"><td><p>XR_SESSION_STATE_LOSS_PENDING</p></td>
<td><p>The runtime is indicating that current session is no longer valid and should be destroyed. (*)</p></td>
</tr>
<tr class="row-even"><td><p>XR_SESSION_STATE_EXITING</p></td>
<td><p>The runtime is requesting that the application to destroy the session, usually from the user‚Äôs request.</p></td>
</tr>
</tbody>
</table>
<p>(*) Applications may wish to re-create objects like <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> and <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>, if hardware changes were detected.</p>
<p>Developers should also be aware of the lifecycle of an <code class="docutils literal notranslate"><span class="pre">XrSession</span></code>. Certain <code class="docutils literal notranslate"><span class="pre">XrSessionState``s</span> <span class="pre">can</span> <span class="pre">only</span> <span class="pre">lead</span> <span class="pre">to</span> <span class="pre">certain</span> <span class="pre">others</span> <span class="pre">under</span> <span class="pre">the</span> <span class="pre">correct</span> <span class="pre">circumstances.</span> <span class="pre">Below</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">diagram</span> <span class="pre">showing</span> <span class="pre">the</span> <span class="pre">lifecycle</span> <span class="pre">of</span> <span class="pre">an</span> <span class="pre">``XrSession</span></code> within an OpenXR application.</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="_images/openxr-session-life-cycle.svg"><img alt="OpenXR Session Life-Cycle" src="_images/openxr-session-life-cycle.svg" width="99%" /></a>
<figcaption>
<p><span class="caption-text">OpenXR Session Life-Cycle</span><a class="headerlink" href="#id4" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
</section>
<section id="xrbeginsession-and-xrendsession">
<h3>2.3.3 xrBeginSession and xrEndSession<a class="headerlink" href="#xrbeginsession-and-xrendsession" title="Permalink to this heading">¬∂</a></h3>
<p>As the application runs, if the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> changes to <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_READY</span></code>, the application can call <code class="docutils literal notranslate"><span class="pre">xrBeginSession()</span></code> to begin the session and synchronize the application‚Äôs with the runtime‚Äôs frame hook.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_READY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrSessionBeginInfo</span><span class="w"> </span><span class="n">sessionBeginInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_BEGIN_INFO</span><span class="p">};</span>
<span class="w">    </span><span class="n">sessionBeginInfo</span><span class="p">.</span><span class="n">primaryViewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrBeginSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionBeginInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to begin Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>From the code that we copied in Chpater 2.1.3, we‚Äôve assigned to <code class="docutils literal notranslate"><span class="pre">XrSessionBeginInfo::primaryViewConfigurationType</span></code> the <code class="docutils literal notranslate"><span class="pre">m_viewConfiguration</span></code> from the class, which in the case of this tutorial is <code class="docutils literal notranslate"><span class="pre">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span></code>. This specifies the view configuration of the form factor‚Äôs primary display - For Head Mounted Displays, it is two views (one per eye).</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">XrSessionState</span></code> changes to <code class="docutils literal notranslate"><span class="pre">XR_SESSION_STATE_STOPPING</span></code>, the application should call <code class="docutils literal notranslate"><span class="pre">xrEndSession()</span></code>. This means that the runtime has stop the session either from a user‚Äôs input or from some other reason, our application should response by ending the session and freeing any resources. Below is a small excerpt from the code that we copied in Chpater 2.1.3.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionStateChanged</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SESSION_STATE_STOPPING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEndSession</span><span class="p">(</span><span class="n">m_session</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to end Session.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_sessionRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


						</div>
					</div>
					<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1-introduction.html" class="btn btn-neutral float-left" title="üëã 1 Introduction" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3-graphics.html" class="btn btn-neutral float-right" title="üëæ 3 Graphics" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>&#169; Copyright &#34;OpenXR&#34; and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom.</p>
  </div> 

</footer>
				</div>
			</div>
		</div>
	</div>
  <script></script> 

</body>
</html>