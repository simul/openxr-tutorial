<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>üïπ 4 Interactions &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="next" title="‚ú® 5 Extensions" href="5-extensions.html" >
	<link rel="prev" title="üëæ 3 Graphics" href="3-graphics.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	function updatePlatform()
	{
	var platform = Cookies.get("platform");
	console.log("updatePlatform(), platform = " + platform);
	if (typeof platform == 'undefined')
	{
		platform = "linux"; // Set default here.
	}
	$(".linux").hide();
	$(".android").hide();
	$(".windows").hide();
	if (platform == "windows")
	{
		$(".windows").show();
		$(".selectd3d11").disabled = false;
		$(".selectd3d12").disabled = false;
		$(".selectopengles").disabled = true;
		$(".selectvulkan").disabled = false;
		$(".selectopengl").disabled = false;
	}
	if (platform == "linux")
	{
		$(".linux").show();
		$(".selectd3d11").disabled = true;
		$(".selectd3d12").disabled = true;
		$(".selectopengles").disabled = true;
		$(".selectvulkan").disabled = false;
		$(".selectopengl").disabled = false;
	}
	if (platform == "android")
	{
		$(".android").show();
		$(".selectd3d11").disabled = true;
		$(".selectd3d12").disabled = true;
		$(".selectopengles").disabled = false;
		$(".selectvulkan").disabled = false;
		$(".selectopengl").disabled = true;
	}
	var oldelements = document.querySelectorAll(".selected-platform");
	console.log("selected-platform on "+oldelements.length+" elements.");
	while (oldelements.length > 0)
	{
		var el=oldelements.item(0);
		el.classList.remove('selected-platform');
		console.log("Removing selected-platform from "+el.id);
		oldelements = document.querySelectorAll(".selected-platform");
	}
	var element = document.getElementById('select' + platform);
	if(element)
	{
		element.classList.add('selected-platform');
		console.log("Adding selected-platform to "+element.id);
	}
	var element2 = document.getElementById('select' + platform + "-inline");
	if(element2)
	{
		element2.classList.add('selected-platform');
		console.log("Adding selected-platform to "+element2.id);
	}
	else
	{
		console.log('select' + platform + "-inline not found");
	}
	if(limitAPIChoice())
		updateGraphicsAPI();
	window.updatePlatform=updatePlatform;
	}
	
	function limitAPIChoice()
	{
		var platform = Cookies.get("platform");
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("limitAPIChoice(), platform = " + platform+", graphicsApi = "+graphicsApi);
		window.limitAPIChoice=limitAPIChoice;
		var newApi=graphicsApi;
		if (platform == "windows")
		{
			if (graphicsApi == "opengles"||graphicsApi==undefined)
				newApi="vulkan";
		}
		if (platform == "linux")
		{
			if (graphicsApi == "opengles"||graphicsApi=="d3d11"||graphicsApi=="d3d12"||graphicsApi==undefined)
				newApi="vulkan";
		}
		if (platform == "android"||graphicsApi==undefined)
		{
			if (graphicsApi != "opengles"&&graphicsApi!="vulkan")
				newApi="vulkan";
		}
		console.log("newApi = "+newApi);
		if (newApi != graphicsApi)
		{
			console.log("setting graphicsapi = "+newApi);
			Cookies.set('graphicsapi', newApi,{ expires: 365})
			graphicsApi=newApi;
			return true;
		}
		return false;
	}
	function makeLinksOpenInNewWindow()
	{ 
		console.log("makeLinksOpenInNewWindow ");
		var download_hrefs = document.getElementsByClassName('reference download internal');
		[].forEach.call(download_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			console.log("Adding target blank to "+el.id);
		});
		link_hrefs = document.getElementsByClassName('reference external');
		[].forEach.call(link_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			console.log("Adding target blank to "+el.id);
		});
		window.makeLinksOpenInNewWindow=makeLinksOpenInNewWindow;
	}
	function updateGraphicsAPI()
	{
		var graphicsApi = Cookies.get("graphicsapi")
		console.log("graphicsapi = " + graphicsApi);
		if (typeof graphicsApi == 'undefined')
		{
			graphicsApi = "vulkan"; // Set default here.
		}
		// first, hide all the api's
		$(".d3d11").hide();
		$(".d3d12").hide();
		$(".opengl").hide();
		$(".opengles").hide();
		$(".vulkan").hide();
		// Now, show the wanted api's. In this way, divs with more than one will be shown, even if they have one that is hidden.
		if (graphicsApi == "d3d11") {
			$(".d3d11").show();
		}
		if (graphicsApi == "d3d12") {
			$(".d3d12").show();
		}
		if (graphicsApi == "opengl") {
			$(".opengl").show();
		}
		if (graphicsApi == "opengles") {
			$(".opengles").show();
		}
		if (graphicsApi == "vulkan") {
			$(".vulkan").show();
		}
		var oldelements = document.querySelectorAll(".selected-graphics-api");
		console.log("selected-platform on "+oldelements.length+" elements.");
		while (oldelements.length > 0)
		{
			var el=oldelements.item(0);
			el.classList.remove('selected-graphics-api');
			console.log("Removing selected-graphics-api from "+el.id);
			oldelements = document.querySelectorAll(".selected-graphics-api");
		}
		var element = document.getElementById('select' + graphicsApi);
		if(element)
		{
			element.classList.add('selected-graphics-api');
		}
		var element2 = document.getElementById('select' + graphicsApi +"-inline");
		if (element2)
		{
			element2.classList.add('selected-graphics-api');
		}
		window.updateGraphicsAPI=updateGraphicsAPI;
	}</script>
	<script >
	var graphicsApi = Cookies.get("graphicsapi")
	if (graphicsApi==undefined) {
		Cookies.set('graphicsapi', 'vulkan',{ expires: 365})
		graphicsApi='vulkan';
	}
	</script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onload="updatePlatform(); updateGraphicsAPI(); makeLinksOpenInNewWindow();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">üëã 1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-setup.html">‚öôÔ∏è 2 Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">üëæ 3 Graphics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">üïπ 4 Interactions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-spaces">4.1. Using Spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-actions-and-action-sets">4.2 Creating Actions and Action Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interaction-profiles-and-bindings">4.2 Interaction Profiles and Bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#binding-interactions">Binding Interactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#theory-and-best-practices-for-interaction-profiles">Theory and Best Practices for Interaction Profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-actions-in-the-app">Using Actions in the app</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rendering-the-controller-position">4.5 Rendering the Controller position</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-for-connected-controllers">4.6 Checking for Connected Controllers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">‚ú® 5 Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">üïπ 4 Interactions</li>
	  <li class="disclaimer">Disclaimer: Work in Progress. This site is in progress and is not ready for use.</li>
	  <li class="wy-breadcrumbs-aside">
		  <div id='selectplatform'>
	<button class="select-platform" id='selectwindows' onclick="choosePlatform('windows')">
		<img class="platform-tab-img" src="_static/css/windows-colour.svg" alt="Windows" />
	</button>
	<button class="select-platform" id='selectlinux' onclick="choosePlatform('linux')">
		<img class="platform-tab-img" src="https://upload.wikimedia.org/wikipedia/commons/3/35/Tux.svg" alt="Linux" />
	</button>
	<button class="select-platform" id='selectandroid' onclick="choosePlatform('android')">
		<img class="platform-tab-img" src="_static/css/android-colour.svg" alt="Android" />
	</button>
</div>
<script>
	function choosePlatform(platformName)
	{
		var platform = Cookies.get('platform')
		Cookies.set('platform', platformName, { expires: 365 })
		updatePlatform();
	};
</script>

<div id='selectgraphicsapi'>
	<button class="select-graphics-api selectd3d11" id='selectd3d11' onclick="chooseGraphicsAPI('d3d11')">
		<img class="api-tab-img" src="_static/css/d3d11.png" alt="DirectX 11" />
	</button>
	<button class="select-graphics-api selectd3d12" id='selectd3d12' onclick="chooseGraphicsAPI('d3d12')">
		<img class="api-tab-img" src="_static/css/d3d12.png" alt="DirectX 12" />
	</button>
	<button class="select-graphics-api selectopengl" id='selectopengl' onclick="chooseGraphicsAPI('opengl')">
		<img class="api-tab-img" src="_static/css/opengl.png" alt="OpenGL" />
	</button>
	<button class="select-graphics-api selectopengles" id='selectopengles' onclick="chooseGraphicsAPI('opengles')">
		<img class="api-tab-img" src="_static/css/opengles.png" alt="OpenGL ES" />
	</button>
	<button class="select-graphics-api selectvulkan" id='selectvulkan' onclick="chooseGraphicsAPI('vulkan')">
		<img class="api-tab-img" src="_static/css/vulkan.png" alt="Vulkan" />
	</button>
</div>
<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		Cookies.set('graphicsapi', graphicsApiName, { expires: 365 })
		var graphicsApi = Cookies.get('graphicsapi')
		updateGraphicsAPI();
		limitAPIChoice();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
						<div itemprop="articleBody">
							
  <section id="interactions">
<h1>üïπ 4 Interactions<a class="headerlink" href="#interactions" title="Permalink to this heading">¬∂</a></h1>
<p>An OpenXR application has interactions with the user which can be user input to the application, or haptic output back to the user. In this chapter, we will create some interactions and show how this system works. The interaction system uses three core concepts: spaces, actions, and bindings.</p>
<section id="using-spaces">
<h2>4.1. Using Spaces<a class="headerlink" href="#using-spaces" title="Permalink to this heading">¬∂</a></h2>
<p>Key to the interaction system is the concept of a <em>space</em>. A space is a frame of reference
defined not by its instantaneous values, but semantically, by its purpose and relationship to other spaces. For the actual, instantaneous position and orientation of a space, we call this a ‚Äúpose‚Äù.</p>
<p>In Section 3.2, we created a _reference_ space called <code class="docutils literal notranslate"><span class="pre">localOrStageSpace</span></code> which represents the stationary space within which the application runs. We needed this space to call <code class="docutils literal notranslate"><span class="pre">xrLocateViews</span></code> because this function generates a view matrix for each eye. Recall that a view matrix transforms from a ‚Äúglobal‚Äù reference frame into one oriented with the eye or camera.</p>
<p>By using a local space - defined with <code class="docutils literal notranslate"><span class="pre">XR_REFERENCE_SPACE_TYPE_LOCAL</span></code> - we specify that the views are relative to the XR hardware‚Äôs ‚Äúlocal‚Äù space - either the headset‚Äôs starting position or some other world-locked origin.</p>
<p>Some devices support stage space - <code class="docutils literal notranslate"><span class="pre">XR_REFERENCE_SPACE_TYPE_STAGE</span></code> - this implies a roomscale space with its origin on the floor.</p>
<figure class="align-left" id="id1">
<img alt="OpenXR Reference Spaces" src="_images/OpenXRSpaces.png" />
<figcaption>
<p><span class="caption-text">Reference Spaces in OpenXR</span><a class="headerlink" href="#id1" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<p>How these are actually interpreted is a matter for the OpenXR runtime.</p>
<p>When we created the reference space, we specified a pose (<code class="docutils literal notranslate"><span class="pre">poseInReferenceSpace</span></code>) of identity:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">referenceSpaceCI.poseInReferenceSpace</span> <span class="pre">=</span> <span class="pre">{{0.0f,</span> <span class="pre">0.0f,</span> <span class="pre">0.0f,</span> <span class="pre">1.0f},</span> <span class="pre">{0.0f,</span> <span class="pre">0.0f,</span> <span class="pre">0.0f}};</span></code></p>
</div></blockquote>
<p>i.e. an identity quaternion for the orientation, a position at the origin.</p>
<p>Had we specified a different pose, the origin of the reference space would have been offset from the runtime‚Äôs default.</p>
<p>Another kind of reference space is view space (<code class="docutils literal notranslate"><span class="pre">XR_REFERENCE_SPACE_TYPE_VIEW</span></code>).
View space is oriented with the user‚Äôs head, and is useful for user-interface and many
other purposes. We don‚Äôt use it to generate view matrices for rendering, because those are often offset from the view space due to stereo rendering.</p>
<p>See <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrReferenceSpaceType.html">https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrReferenceSpaceType.html</a></p>
</section>
<section id="creating-actions-and-action-sets">
<h2>4.2 Creating Actions and Action Sets<a class="headerlink" href="#creating-actions-and-action-sets" title="Permalink to this heading">¬∂</a></h2>
<p>At the end of your application class, add this code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">XrActionSet</span><span class="w"> </span><span class="n">m_actionSet</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// The action for clicking the &quot;select&quot; button.</span>
<span class="w">    </span><span class="n">XrAction</span><span class="w"> </span><span class="n">m_selectAction</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrActionStateBoolean</span><span class="w"> </span><span class="n">m_selectState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_ACTION_STATE_BOOLEAN</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// The action for squeezing the trigger control.</span>
<span class="w">    </span><span class="n">XrAction</span><span class="w"> </span><span class="n">m_throwAction</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrActionStateFloat</span><span class="w"> </span><span class="n">m_triggerState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_ACTION_STATE_FLOAT</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// The action haptic vibration of the right controller.</span>
<span class="w">    </span><span class="n">XrAction</span><span class="w"> </span><span class="n">m_buzzAction</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// The action for getting the left grip pose.</span>
<span class="w">    </span><span class="n">XrAction</span><span class="w"> </span><span class="n">m_controllerGripPoseAction</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// The XrPaths for left and right hand controllers.</span>
<span class="w">    </span><span class="n">XrPath</span><span class="w"> </span><span class="n">m_handPaths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">}};</span>
<span class="w">    </span><span class="c1">// The space that represents the left grip pose.</span>
<span class="w">    </span><span class="n">XrSpace</span><span class="w"> </span><span class="n">m_controllerGripPoseSpace</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="n">XrActionStatePose</span><span class="w"> </span><span class="n">m_controllerGripPoseState</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="n">XR_TYPE_ACTION_STATE_POSE</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_ACTION_STATE_POSE</span><span class="p">}};</span>
<span class="w">    </span><span class="c1">// The current left grip pose obtained from the XrSpace.</span>
<span class="w">    </span><span class="n">XrPosef</span><span class="w"> </span><span class="n">m_controllerGripPose</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
<p>Here, we have defined an Action Set: a group of related actions that are created together. The individual actions, such as selectAction and triggerAction, will belong to this set. For a pose action, we need an XrSpace, so leftGripPoseSpace has been declared. And we‚Äôll keep a copy of the pose itself, leftGripPose, which will change per-frame.</p>
<p>ActionSets are created before the session is initialized, so in Run(), after the call to GetSystemID(), add this line:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">CreateActionSet</span><span class="p">();</span>
</pre></div>
</div>
<p>After the definition of GetSystemID(), we‚Äôll add these helper functions that convert a string into an XrPath, and vice-versa. Add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">XrPath</span><span class="w"> </span><span class="nf">CreateXrPath</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrPath</span><span class="w"> </span><span class="n">xrPath</span><span class="p">;</span>
<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrStringToPath</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">path_string</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xrPath</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create XrPath from string.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">xrPath</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">FromXrPath</span><span class="p">(</span><span class="n">XrPath</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">strl</span><span class="p">;</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">text</span><span class="p">[</span><span class="n">XR_MAX_PATH_LENGTH</span><span class="p">];</span>
<span class="w">        </span><span class="n">XrResult</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrPathToString</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_PATH_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">strl</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to retrieve path.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Now we will define the <cite>CreateActionSet</cite> function:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateActionSet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrActionSetCreateInfo</span><span class="w"> </span><span class="n">actionSetCI</span><span class="p">{</span><span class="n">XR_TYPE_ACTION_SET_CREATE_INFO</span><span class="p">};</span>
<span class="w">        </span><span class="n">strncpy</span><span class="p">(</span><span class="n">actionSetCI</span><span class="p">.</span><span class="n">actionSetName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;openxr-tutorial-actionset&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_ACTION_SET_NAME_SIZE</span><span class="p">);</span>
<span class="w">        </span><span class="n">strncpy</span><span class="p">(</span><span class="n">actionSetCI</span><span class="p">.</span><span class="n">localizedActionSetName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial ActionSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_LOCALIZED_ACTION_SET_NAME_SIZE</span><span class="p">);</span>
<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateActionSet</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionSetCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_actionSet</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create ActionSet.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>An ActionSet is a group of actions that apply in a specific context. You might have an ActionSet for when your XR game is showing a pause menu or control panel, and a different ActionSet for in-game. There might even be different
ActionSets for different situations in an XR application: rowing in a boat, climbing a cliff, and so on.
So you can create multiple ActionSets, but we only need one for this example. The ActionSet is created with a name, and a localized string for its description. Now add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">CreateAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="n">XrAction</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xrAction</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">XrActionType</span><span class="w"> </span><span class="n">xrActionType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">subaction_paths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XrActionCreateInfo</span><span class="w"> </span><span class="n">actionCI</span><span class="p">{</span><span class="n">XR_TYPE_ACTION_CREATE_INFO</span><span class="p">};</span>
<span class="w">            </span><span class="n">actionCI</span><span class="p">.</span><span class="n">actionType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrActionType</span><span class="p">;</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrPath</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subaction_xrpaths</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">subaction_paths</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">subaction_xrpaths</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CreateXrPath</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">actionCI</span><span class="p">.</span><span class="n">countSubactionPaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">subaction_xrpaths</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">            </span><span class="n">actionCI</span><span class="p">.</span><span class="n">subactionPaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subaction_xrpaths</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">            </span><span class="n">strncpy</span><span class="p">(</span><span class="n">actionCI</span><span class="p">.</span><span class="n">actionName</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_ACTION_NAME_SIZE</span><span class="p">);</span>
<span class="w">            </span><span class="n">strncpy</span><span class="p">(</span><span class="n">actionCI</span><span class="p">.</span><span class="n">localizedActionName</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">XR_MAX_LOCALIZED_ACTION_NAME_SIZE</span><span class="p">);</span>
<span class="w">            </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateAction</span><span class="p">(</span><span class="n">m_actionSet</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xrAction</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Action.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">CreateAction</span><span class="p">(</span><span class="n">m_selectAction</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;select&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_ACTION_TYPE_BOOLEAN_INPUT</span><span class="p">);</span>
<span class="w">        </span><span class="n">CreateAction</span><span class="p">(</span><span class="n">m_throwAction</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;throw&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_ACTION_TYPE_FLOAT_INPUT</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;/user/hand/left&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/user/hand/right&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">CreateAction</span><span class="p">(</span><span class="n">m_controllerGripPoseAction</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controller-grip&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_ACTION_TYPE_POSE_INPUT</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;/user/hand/left&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/user/hand/right&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">CreateAction</span><span class="p">(</span><span class="n">m_buzzAction</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;buzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">XR_ACTION_TYPE_VIBRATION_OUTPUT</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;/user/hand/left&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/user/hand/right&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">m_handPaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/left&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_handPaths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/right&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Here we‚Äôve created each action with a little local lambda function <cite>CreateAction</cite>. Each action has a name, a localized description, and the type of action it is. It also, optionally, has a list of sub-action paths. A sub-action is, essentially the same action on a different control device: left- or right-hand controllers for example.</p>
<p>Each Action and ActionSet has both a name, for internal use, and a localized description to show to the end-user. This is because the user may want to re-map actions from the default controls, so there must be a human-readable name to show them.</p>
</section>
<section id="interaction-profiles-and-bindings">
<h2>4.2 Interaction Profiles and Bindings<a class="headerlink" href="#interaction-profiles-and-bindings" title="Permalink to this heading">¬∂</a></h2>
<p>As OpenXR is an API for many different devices, it needs to provide a way for you as a developer to refer to the various buttons, joysticks, inputs and outputs that a device may have, without needing to know in advance which device or devices the user will have.</p>
<p>To do this, OpenXR defines the concept of <em>interaction profiles</em>. An interaction profile is a collection of interactions supported by a given device and runtime, and defined by means of textual paths.</p>
<p>The first element of the interaction profile is the Profile Path, of the form ‚Äú/interaction_profiles/&lt;vendor_name&gt;/&lt;type_name&gt;‚Äù. Then, each interaction is defined by a
path with three elements: the Profile Path, the User Path, and the Component Path. The User Path is a string identifying the controller device, e.g. ‚Äú/user/hand/left‚Äù, or ‚Äú/user/gamepad‚Äù. The Component Path is a string identifying the specific input or output, e.g. ‚Äú/input/select/click‚Äù or ‚Äú/output/haptic_left_trigger‚Äù.</p>
<p>For example, the Khronos Simple Controller Profile has the path ‚Äú/interaction_profiles/khr/simple_controller‚Äù, and user paths ‚Äú/user/hand/left‚Äù and ‚Äú/user/hand/right‚Äù. The component paths are ‚Äú/input/select/click‚Äù, ‚Äú/input/menu/click‚Äù, ‚Äú/input/grip/pose‚Äù, ‚Äú/input/aim/pose‚Äù, ‚Äú/output/haptic‚Äù. Putting the three parts together, we might identify the select button on the left hand controller as ‚Äú/interaction_profiles/khr/simple_controller/user/hand/left/input/select/click‚Äù.</p>
<p>We will now show how to suggest a these profiles are used in practice.</p>
<section id="binding-interactions">
<h3>Binding Interactions<a class="headerlink" href="#binding-interactions" title="Permalink to this heading">¬∂</a></h3>
<p>We will set up bindings for the actions. A binding is a <em>suggested</em> correspondence between an action (which is app-defined), and the input/output on the
user‚Äôs devices.</p>
<p>XrPath is a 64-bit number that hopefully uniquely identifies any given forward-slash-delimited path string, allowing us to refer to paths without putting cumbersome string-handling in our runtime code. After the call to CreateActionSet() in Run(), add the line:</p>
<p>After the definition of CreateActionSet(), add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SuggestBindings</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">SuggestBindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">profile_path</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrActionSuggestedBinding</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bindings</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// The application can call xrSuggestInteractionProfileBindings once per interaction profile that it supports.</span>
<span class="w">            </span><span class="n">XrInteractionProfileSuggestedBinding</span><span class="w"> </span><span class="n">interactionProfileSuggestedBinding</span><span class="p">{</span><span class="n">XR_TYPE_INTERACTION_PROFILE_SUGGESTED_BINDING</span><span class="p">};</span>
<span class="w">            </span><span class="n">interactionProfileSuggestedBinding</span><span class="p">.</span><span class="n">interactionProfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="n">profile_path</span><span class="p">);</span>
<span class="w">            </span><span class="n">interactionProfileSuggestedBinding</span><span class="p">.</span><span class="n">suggestedBindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bindings</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">            </span><span class="n">interactionProfileSuggestedBinding</span><span class="p">.</span><span class="n">countSuggestedBindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">bindings</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xrSuggestInteractionProfileBindings</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">interactionProfileSuggestedBinding</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XrResult</span><span class="o">::</span><span class="n">XR_SUCCESS</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to suggest bindings with &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">profile_path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
</pre></div>
</div>
<p>By means of a lambda function <cite>SuggestBindings</cite>, we call into OpenXR with a given list of suggestions. Let‚Äôs try this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">any_ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">any_ok</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">SuggestBindings</span><span class="p">(</span><span class="s">&quot;/interaction_profiles/khr/simple_controller&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="n">m_selectAction</span><span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/left/input/select/click&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_selectAction</span><span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/right/input/select/click&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_throwAction</span><span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/left/input/menu/click&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_throwAction</span><span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/right/input/menu/click&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_controllerGripPoseAction</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/left/input/grip/pose&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_controllerGripPoseAction</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/right/input/grip/pose&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_buzzAction</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/left/output/haptic&quot;</span><span class="p">)},</span>
<span class="w">                                                                                  </span><span class="p">{</span><span class="n">m_buzzAction</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">CreateXrPath</span><span class="p">(</span><span class="s">&quot;/user/hand/right/output/haptic&quot;</span><span class="p">)}</span>
<span class="w">        </span><span class="p">});</span>
</pre></div>
</div>
<p>Here, we create a proposed match-up between our app-specific actions, and XrPaths which refer to specific controls as interpreted by the Runtime. We call <cite>xrSuggestInteractionProfileBindings()</cite>. If the user‚Äôs device supports the given profile ( and ‚Äú/interaction_profiles/khr/simple_controller‚Äù should <em>always</em> be supported in an OpenXR-compliant runtime), it will recognize these paths and can map them to its own controls. If the user‚Äôs device does not support a profile, the bindings will be ignored.
The suggested bindings are not guaranteed to be used: that‚Äôs up to the runtime. Some runtimes allow users to override the default bindings, and OpenXR expects this.</p>
</section>
<section id="theory-and-best-practices-for-interaction-profiles">
<h3>Theory and Best Practices for Interaction Profiles<a class="headerlink" href="#theory-and-best-practices-for-interaction-profiles" title="Permalink to this heading">¬∂</a></h3>
<p>To get the best results from your app on the end-user‚Äôs device, it is important to understand the key principles behind the Interaction Profile system. These are laid out in the OpenXR Guide (<a class="reference external" href="https://github.com/KhronosGroup/OpenXR-Guide/blob/main/chapters/goals_design_philosophy.md">https://github.com/KhronosGroup/OpenXR-Guide/blob/main/chapters/goals_design_philosophy.md</a>) but in brief:</p>
<ul class="simple">
<li><p>An app written for OpenXR should work without modification on any device/runtime combination, even those created after the app has been written.</p></li>
<li><p>A device and runtime that are OpenXR-compliant should work with any OpenXR-compatible application, even those written after the device has been built.</p></li>
</ul>
<p>The way this is achieved is as follows: usually, each device will have its own ‚Äúnative‚Äù profile, and should also support ‚Äúkhr/simple_controller‚Äù. As a developer, <em>you should test the devices and runtimes you have</em>, and you should <em>specify profile bindings for each device you have tested</em>. You should <em>not</em> implement profiles you have not tested or try to anticipate profiles or features that have not been implemented. It is the <em>runtime‚Äôs responsibility</em> to support non-native runtimes where possible,</p>
<p>A device can support any number of interaction profiles, either the nine profiles defined in the OpenXR standard, or an extension profile (see <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#_adding_input_sources_via_extensions">https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#_adding_input_sources_via_extensions</a>).</p>
<p>See also <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#semantic-path-interaction-profiles">https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#semantic-path-interaction-profiles</a> and</p>
</section>
<section id="using-actions-in-the-app">
<h3>Using Actions in the app<a class="headerlink" href="#using-actions-in-the-app" title="Permalink to this heading">¬∂</a></h3>
<p>ActionSets and Suggested Bindings are created before the session is initialized. There is session-specific setup to be done for our actions also. After the call to CreateResources(), add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">CreateActionPoses</span><span class="p">();</span>
<span class="w">      </span><span class="n">AttachActionSet</span><span class="p">();</span>
</pre></div>
</div>
<p>Now after the definition of SuggestBindings(), add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateActionPoses</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Create an xrSpace for a pose action.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">CreateActionPoseSpace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="n">XrSession</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">XrAction</span><span class="w"> </span><span class="n">xrAction</span><span class="p">,</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">subaction_path</span><span class="o">=</span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">XrSpace</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrSpace</span><span class="w"> </span><span class="n">xrSpace</span><span class="p">;</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XrPosef</span><span class="w"> </span><span class="n">xrPoseIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">}};</span>
<span class="w">        </span><span class="c1">// Create frame of reference for a pose action</span>
<span class="w">        </span><span class="n">XrActionSpaceCreateInfo</span><span class="w"> </span><span class="n">actionSpaceCI</span><span class="p">{</span><span class="n">XR_TYPE_ACTION_SPACE_CREATE_INFO</span><span class="p">};</span>
<span class="w">        </span><span class="n">actionSpaceCI</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrAction</span><span class="p">;</span>
<span class="w">        </span><span class="n">actionSpaceCI</span><span class="p">.</span><span class="n">poseInActionSpace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrPoseIdentity</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">subaction_path</span><span class="p">)</span>
<span class="w">            </span><span class="n">actionSpaceCI</span><span class="p">.</span><span class="n">subactionPath</span><span class="o">=</span><span class="n">CreateXrPath</span><span class="p">(</span><span class="n">subaction_path</span><span class="p">);</span>
<span class="w">        </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateActionSpace</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionSpaceCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xrSpace</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create ActionSpace.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">xrSpace</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">m_controllerGripPoseSpace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateActionPoseSpace</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="n">m_controllerGripPoseAction</span><span class="p">,</span><span class="s">&quot;/user/hand/left&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_controllerGripPoseSpace</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateActionPoseSpace</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="n">m_controllerGripPoseAction</span><span class="p">,</span><span class="s">&quot;/user/hand/right&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For one pose, this didn‚Äôt need to be a lambda, but it will make it easier to add more poses later. Here, we‚Äôre creating the XrSpace that represents the left grip pose action. As with the reference space, we use an identity XrPosef to indicate that we‚Äôll take the pose as-is, without offsets.</p>
<p>For OpenXR hand controllers, we distinguish between a ‚Äúgrip pose‚Äù, representing the orientation of the handle of the device, and an ‚Äúaim pose‚Äù - which is oriented where the device ‚Äúpoints‚Äù. The relative orientations of these will vary between different controller configurations, so again, it‚Äôs important to test with the devices you have. Let the runtime worry about adaptating to different devices that you haven‚Äôt tested.</p>
<figure class="align-left" id="id2">
<img alt="OpenXR Standard Controller Poses" src="_images/standard-poses.png" />
<figcaption>
<p><span class="caption-text">Standard Grip and Aim poses for OpenXR Controllers.</span><a class="headerlink" href="#id2" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<p>Finally as far as action setup goes, we will attach the ActionSet to the session. Add this function:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">AttachActionSet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Attach the action set we just made to the session. We could attach multiple action sets!</span>
<span class="w">    </span><span class="n">XrSessionActionSetsAttachInfo</span><span class="w"> </span><span class="n">actionSetAttachInfo</span><span class="p">{</span><span class="n">XR_TYPE_SESSION_ACTION_SETS_ATTACH_INFO</span><span class="p">};</span>
<span class="w">    </span><span class="n">actionSetAttachInfo</span><span class="p">.</span><span class="n">countActionSets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">actionSetAttachInfo</span><span class="p">.</span><span class="n">actionSets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_actionSet</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrAttachSessionActionSets</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionSetAttachInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to attach ActionSet to Session.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, it‚Äôs possible here to attach multiple Action Sets. But <cite>xrAttachSessionActionSets</cite> can only be called <em>once</em> per session. You have to know what Action Sets you will be using before the session can start - xrBeginSession() is called from PollEvents() once all setup is complete and the app is ready to proceed.</p>
<p>Now, we must poll the actions, once per-frame. Add this call in RenderFrame() just before the call to RenderLayer():</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">         </span><span class="n">PollActions</span><span class="p">(</span><span class="n">frameState</span><span class="p">.</span><span class="n">predictedDisplayTime</span><span class="p">);</span>
</pre></div>
</div>
<p>And add this function after the definition of PollEvents():</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">PollActions</span><span class="p">(</span><span class="n">XrTime</span><span class="w"> </span><span class="n">predictedTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Update our action set with up-to-date input data!</span>
<span class="w">        </span><span class="n">XrActiveActionSet</span><span class="w"> </span><span class="n">activeActionSet</span><span class="p">{};</span>
<span class="w">        </span><span class="n">activeActionSet</span><span class="p">.</span><span class="n">actionSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_actionSet</span><span class="p">;</span>
<span class="w">        </span><span class="n">activeActionSet</span><span class="p">.</span><span class="n">subactionPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_NULL_PATH</span><span class="p">;</span>

<span class="w">		</span><span class="n">XrActionsSyncInfo</span><span class="w"> </span><span class="n">actionsSyncInfo</span><span class="p">{</span><span class="n">XR_TYPE_ACTIONS_SYNC_INFO</span><span class="p">};</span>
<span class="w">		</span><span class="n">actionsSyncInfo</span><span class="p">.</span><span class="n">countActiveActionSets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">		</span><span class="n">actionsSyncInfo</span><span class="p">.</span><span class="n">activeActionSets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">activeActionSet</span><span class="p">;</span>
<span class="w">		</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrSyncActions</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionsSyncInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to sync Actions.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Here we enable the Action Set we‚Äôre interested in (in our case we have only one), and tell OpenXR to prepare the actions‚Äô per-frame data with xrSyncActions().</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">		</span><span class="n">XrActionStateGetInfo</span><span class="w"> </span><span class="n">actionStateGetInfo</span><span class="p">{</span><span class="n">XR_TYPE_ACTION_STATE_GET_INFO</span><span class="p">};</span>

<span class="w">		</span><span class="n">actionStateGetInfo</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_selectAction</span><span class="p">;</span>
<span class="w">		</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetActionStateBoolean</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionStateGetInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_selectState</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Boolean State.&quot;</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">		</span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">		</span><span class="p">{</span>
<span class="w">			</span><span class="n">actionStateGetInfo</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_throwAction</span><span class="p">;</span>
<span class="w">			</span><span class="n">actionStateGetInfo</span><span class="p">.</span><span class="n">subactionPath</span><span class="o">=</span><span class="n">m_handPaths</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">			</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetActionStateFloat</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionStateGetInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_triggerState</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Float State.&quot;</span><span class="p">);</span>

<span class="w">			</span><span class="k">if</span><span class="p">(</span><span class="n">m_triggerState</span><span class="p">.</span><span class="n">isActive</span><span class="o">&amp;&amp;</span><span class="n">m_triggerState</span><span class="p">.</span><span class="n">currentState</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="w">			</span><span class="p">{</span>
<span class="w">				</span><span class="n">XrHapticVibration</span><span class="w"> </span><span class="n">vibration</span><span class="p">{</span><span class="n">XR_TYPE_HAPTIC_VIBRATION</span><span class="p">};</span>
<span class="w">				</span><span class="n">vibration</span><span class="p">.</span><span class="n">amplitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_triggerState</span><span class="p">.</span><span class="n">currentState</span><span class="p">;</span>
<span class="w">				</span><span class="n">vibration</span><span class="p">.</span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MIN_HAPTIC_DURATION</span><span class="p">;</span>
<span class="w">				</span><span class="n">vibration</span><span class="p">.</span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FREQUENCY_UNSPECIFIED</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">				</span><span class="n">XrHapticActionInfo</span><span class="w"> </span><span class="n">hapticActionInfo</span><span class="p">{</span><span class="n">XR_TYPE_HAPTIC_ACTION_INFO</span><span class="p">};</span>
<span class="w">				</span><span class="n">hapticActionInfo</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_buzzAction</span><span class="p">;</span>
<span class="w">				</span><span class="n">hapticActionInfo</span><span class="p">.</span><span class="n">subactionPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_handPaths</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">				</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrApplyHapticFeedback</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hapticActionInfo</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">XrHapticBaseHeader</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">vibration</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to apply haptic feedback.&quot;</span><span class="p">);</span>
<span class="w">			</span><span class="p">}</span>
<span class="w">		</span><span class="p">}</span>
</pre></div>
</div>
<p>Finally in this function, we‚Äôll poll the left Grip Pose:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">		</span><span class="n">actionStateGetInfo</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_controllerGripPoseAction</span><span class="p">;</span>
<span class="w">		</span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">actionStateGetInfo</span><span class="p">.</span><span class="n">subactionPath</span><span class="o">=</span><span class="n">m_handPaths</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">			</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetActionStatePose</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">actionStateGetInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_controllerGripPoseState</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="w"> </span><span class="s">&quot;Failed to get Pose State.&quot;</span><span class="p">);</span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_controllerGripPoseState</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">				</span><span class="n">XrSpaceLocation</span><span class="w"> </span><span class="n">spaceLocation</span><span class="p">{</span><span class="n">XR_TYPE_SPACE_LOCATION</span><span class="p">};</span>
<span class="w">				</span><span class="n">XrResult</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrLocateSpace</span><span class="p">(</span><span class="n">m_controllerGripPoseSpace</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">m_localOrStageSpace</span><span class="p">,</span><span class="w"> </span><span class="n">predictedTime</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">spaceLocation</span><span class="p">);</span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XR_UNQUALIFIED_SUCCESS</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">					</span><span class="p">(</span><span class="n">spaceLocation</span><span class="p">.</span><span class="n">locationFlags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">XR_SPACE_LOCATION_POSITION_VALID_BIT</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">					</span><span class="p">(</span><span class="n">spaceLocation</span><span class="p">.</span><span class="n">locationFlags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">XR_SPACE_LOCATION_ORIENTATION_VALID_BIT</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">					</span><span class="n">m_controllerGripPose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spaceLocation</span><span class="p">.</span><span class="n">pose</span><span class="p">;</span>
<span class="w">				</span><span class="p">}</span>
<span class="w">			</span><span class="p">}</span>
<span class="w">		</span><span class="p">}</span>
</pre></div>
</div>
<p>If, and only if the action is active, we use <cite>xrLocateSpace</cite> to obtain the current pose of the controller. We specify that we want this relative to our reference space <cite>localOrStageSpace</cite>, because this is the global space we‚Äôre using for rendering. We‚Äôll use <cite>leftGripPose</cite> in the next section to render the
controller‚Äôs position.</p>
</section>
</section>
<section id="rendering-the-controller-position">
<h2>4.5 Rendering the Controller position<a class="headerlink" href="#rendering-the-controller-position" title="Permalink to this heading">¬∂</a></h2>
<p>We will now draw some geometry to represent the controller pose we‚Äôve obtained as <cite>leftGripPose</cite>. Add this function after the definition of RenderLayer():</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xr_linear_algebra.h&quot;</span>
</pre></div>
</div>
<p>This provides a simple matrix and vector library for our render code. Now, after the code for DestroySession(), add the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">CameraConstants</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">viewProj</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">modelViewProj</span><span class="p">;</span>
<span class="w">        </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">CameraConstants</span><span class="w"> </span><span class="n">cameraConstants</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Six colors for the six faces of a cube. Bright for +, Dark is -</span>
<span class="w">    </span><span class="c1">// Red for X faces, green for Y, blue for Z.</span>
<span class="w">    </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">colors</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span><span class="mf">1.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="mf">0.10f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.60f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.20f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">}};</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Vertices for a 1x1x1 meter cube. (Left/Right, Top/Bottom, Front/Back)</span>
<span class="w">        </span><span class="k">constexpr</span><span class="w"> </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">vertexPositions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">{</span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">}};</span>

<span class="cp">#define CUBE_FACE(V1, V2, V3, V4, V5, V6) vertexPositions[V1], vertexPositions[V2], vertexPositions[V3], vertexPositions[V4], vertexPositions[V5], vertexPositions[V6],</span>

<span class="w">        </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">cubeVertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CUBE_FACE</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// -X</span>
<span class="w">            </span><span class="n">CUBE_FACE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w">  </span><span class="c1">// +X</span>
<span class="w">            </span><span class="n">CUBE_FACE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="c1">// -Y</span>
<span class="w">            </span><span class="n">CUBE_FACE</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="c1">// +Y</span>
<span class="w">            </span><span class="n">CUBE_FACE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="c1">// -Z</span>
<span class="w">            </span><span class="n">CUBE_FACE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">  </span><span class="c1">// +Z</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">cubeIndices</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">        </span><span class="c1">// -X</span>
<span class="w">            </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w">      </span><span class="c1">// +X</span>
<span class="w">            </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w">  </span><span class="c1">// -Y</span>
<span class="w">            </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w">  </span><span class="c1">// +Y</span>
<span class="w">            </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w">  </span><span class="c1">// -Z</span>
<span class="w">            </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">  </span><span class="c1">// +Z</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">m_vertexBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateBuffer</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BufferCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cubeVertices</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cubeVertices</span><span class="p">});</span>

<span class="w">        </span><span class="n">m_indexBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateBuffer</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BufferCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">INDEX</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cubeIndices</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cubeIndices</span><span class="p">});</span>

<span class="w">        </span><span class="n">m_uniformBuffer_Frag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateBuffer</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BufferCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">UNIFORM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span><span class="w"> </span><span class="n">colors</span><span class="p">});</span>

<span class="w">        </span><span class="n">m_uniformBuffer_Vert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateBuffer</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BufferCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">UNIFORM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">CameraConstants</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">});</span>
</pre></div>
</div>
<p>We‚Äôve created a struct to represent a small uniform buffer (constant buffer), CameraConstants, and defined an instance to store its values globally. We‚Äôve defined the start of the function CreateResources(), with the vertices and indices for a cube, and we‚Äôve created the corresponding buffers with our choice of graphics API.</p>
<p>We‚Äôve also created a Uniform Buffer object, API-dependent, for CameraConstants.</p>
<div class="opengl docutils container">
<p>For OpenGL, we will use GLSL version 4.5: add this code to define our vertex and pixel shaders, and to create a shader program:</p>
</div>
<div class="vulkan docutils container">
<p>For Vulkan, we will use GLSL version 4.5: add this code to define our vertex and pixel shaders:</p>
</div>
<div class="opengl vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;VertexShader.glsl&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_vertexShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>

<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;PixelShader.glsl&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">VULKAN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(__ANDROID__)</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;shaders/VertexShader.spv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">assetManager</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;VertexShader.spv&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">            </span><span class="n">m_vertexShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>

<span class="cp">#if defined(__ANDROID__)</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;shaders/PixelShader.spv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">assetManager</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;PixelShader.spv&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">            </span><span class="n">m_fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
<span class="w">        </span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="opengles docutils container">
<p>For OpenGL ES, we will use GLSL version 3.1: add this code to define our vertex and pixel shaders:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL_ES</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#if defined(__ANDROID__)</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;shaders/VertexShader_GLES.glsl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">assetManager</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;VertexShader_GLES.glsl&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">            </span><span class="n">m_vertexShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>

<span class="cp">#if defined(__ANDROID__)</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;shaders/PixelShader_GLES.glsl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">androidApp</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">assetManager</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;PixelShader_GLES.glsl&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">            </span><span class="n">m_fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
<span class="w">        </span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="d3d11 d3d12 docutils container">
<p>For Direct 3D, add this code to define our vertex and pixel shaders:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;VertexShader_5_0.cso&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_vertexShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>

<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;PixelShader_5_0.cso&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;VertexShader_5_1.cso&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_vertexShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>

<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadBinaryFile</span><span class="p">(</span><span class="s">&quot;PixelShader_5_1.cso&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">m_fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
<span class="w">        </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now we‚Äôll combine the shaders, the vertex input layout, and the rendering state for drawing a solid cube, into a pipeline object. Add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">PipelineCreateInfo</span><span class="w"> </span><span class="n">pipelineCI</span><span class="p">;</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">shaders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">m_vertexShader</span><span class="p">,</span><span class="w"> </span><span class="n">m_fragmentShader</span><span class="p">};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">vertexInputState</span><span class="p">.</span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">VertexType</span><span class="o">::</span><span class="n">VEC4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TEXCOORD&quot;</span><span class="p">}};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">vertexInputState</span><span class="p">.</span><span class="n">bindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)}};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">inputAssemblyState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">PrimitiveTopology</span><span class="o">::</span><span class="n">TRIANGLE_LIST</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">rasterisationState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">PolygonMode</span><span class="o">::</span><span class="n">FILL</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">CullMode</span><span class="o">::</span><span class="n">BACK</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">FrontFace</span><span class="o">::</span><span class="n">COUNTER_CLOCKWISE</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">multisampleState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">depthStencilState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">CompareOp</span><span class="o">::</span><span class="n">LESS_OR_EQUAL</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">colourBlendState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">LogicOp</span><span class="o">::</span><span class="n">NO_OP</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">SRC_ALPHA</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">ONE_MINUS_SRC_ALPHA</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendOp</span><span class="o">::</span><span class="n">ADD</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">ONE</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendOp</span><span class="o">::</span><span class="n">ADD</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ColourComponentBit</span><span class="p">)</span><span class="mi">15</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">}};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">colorFormats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">m_swapchainAndDepthImages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">swapchainFormat</span><span class="p">};</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">depthFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetDepthFormat</span><span class="p">();</span>
<span class="w">        </span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">}};</span>
<span class="w">        </span><span class="n">m_pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreatePipeline</span><span class="p">(</span><span class="n">pipelineCI</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>To destroy the resources when a session is ended, add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DestroyResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyPipeline</span><span class="p">(</span><span class="n">m_pipeline</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyShader</span><span class="p">(</span><span class="n">m_fragmentShader</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyShader</span><span class="p">(</span><span class="n">m_vertexShader</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyBuffer</span><span class="p">(</span><span class="n">m_uniformBuffer_Vert</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyBuffer</span><span class="p">(</span><span class="n">m_uniformBuffer_Frag</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyBuffer</span><span class="p">(</span><span class="n">m_indexBuffer</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyBuffer</span><span class="p">(</span><span class="n">m_vertexBuffer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>We‚Äôll call this before the call to DestroySession() in the function Run(). So after this, add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="n">DestroyResources</span><span class="p">();</span>
</pre></div>
</div>
<p>Recall that we‚Äôve already inserted a call to PollActions() in the function RenderFrame(), so we‚Äôre ready to render the controller position and input values. In RenderLayer, after the call to ClearDepth(), let‚Äôs set up the rendering state:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">         </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetRenderAttachments</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_swapchainAndDepthImages</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colorImageViews</span><span class="p">[</span><span class="n">imageIndex</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_swapchainAndDepthImages</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">depthImageView</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">m_pipeline</span><span class="p">);</span>
<span class="w">         </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetViewports</span><span class="p">(</span><span class="o">&amp;</span><span class="n">viewport</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">         </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetScissors</span><span class="p">(</span><span class="o">&amp;</span><span class="n">scissor</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">         </span><span class="c1">// Compute the view-projection transform.</span>
<span class="w">         </span><span class="c1">// All matrices (including OpenXR&#39;s) are column-major, right-handed.</span>
<span class="w">         </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">proj</span><span class="p">;</span>
<span class="w">         </span><span class="n">XrMatrix4x4f_CreateProjectionFov</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proj</span><span class="p">,</span><span class="w"> </span><span class="n">m_apiType</span><span class="p">,</span><span class="w"> </span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fov</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">);</span>
<span class="w">         </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">toView</span><span class="p">;</span>
<span class="w">         </span><span class="n">XrVector3f</span><span class="w"> </span><span class="n">scale1m</span><span class="p">{</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="w">         </span><span class="n">XrMatrix4x4f_CreateTranslationRotationScale</span><span class="p">(</span><span class="o">&amp;</span><span class="n">toView</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">scale1m</span><span class="p">);</span>
<span class="w">         </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="w">         </span><span class="n">XrMatrix4x4f_InvertRigidBody</span><span class="p">(</span><span class="o">&amp;</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toView</span><span class="p">);</span>
<span class="w">         </span><span class="n">XrMatrix4x4f_Multiply</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">viewProj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">view</span><span class="p">);</span>
</pre></div>
</div>
<p>We‚Äôve attached the target colour and depth images, and set the viewport and scissors to be the whole renderable area. We‚Äôve created a projection matrix and a view matrix. And we‚Äôve combined these as the matrix viewProj within cameraConstants.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">         </span><span class="c1">// Let&#39;s draw a cuboid at the floor. Scale it by 2 in the X and Z, and 0.1 in the Y,</span>
<span class="w">         </span><span class="n">RenderCuboid</span><span class="p">({{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">m_viewHeightM</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="mf">2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">});</span>

<span class="w">         </span><span class="cm">/*for (int i = 0; i &lt; 2; i++) {</span>
<span class="cm">             if (m_controllerGripPoseState[i].isActive) {</span>
<span class="cm">                 XrVector3f grip_scale{0.02f, 0.04f, 0.10f};</span>
<span class="cm">                 RenderCuboid(m_controllerGripPose[i], grip_scale);</span>
<span class="cm">             }</span>
<span class="cm">         }</span>
<span class="cm">         float scale = 1.0f;</span>
<span class="cm">         if (m_selectState.isActive &amp;&amp; m_selectState.currentState) {</span>
<span class="cm">             scale = 1.5f;</span>
<span class="cm">         }</span>
<span class="cm">         float angleRad = float(predictedDisplayTime) * 0.002f;</span>
<span class="cm">         for (int i = 0; i &lt; 4; i++) {</span>
<span class="cm">             float x = scale * (float(i) - 1.5f);</span>
<span class="cm">             for (int j = 0; j &lt; 4; j++) {</span>
<span class="cm">                 float y = scale * (float(j) - 1.5f);</span>
<span class="cm">                 for (int k = 0; k &lt; 4; k++) {</span>
<span class="cm">                     float z = scale * (float(k) - 1.5f);</span>
<span class="cm">                     XrQuaternionf q;</span>
<span class="cm">                     XrVector3f axis = {0, 0.707f, 0.707f};</span>
<span class="cm">                     XrQuaternionf_CreateFromAxisAngle(&amp;q, &amp;axis, angleRad);</span>
<span class="cm">                     RenderCuboid({q, {x, y, z}}, {0.1f, 0.2f, 0.1f});</span>
<span class="cm">                 }</span>
<span class="cm">             }</span>
<span class="cm">         }*/</span>
</pre></div>
</div>
<p>We draw two cuboids. The first is offset by our (arbitrary) view height, so as to represent a ‚Äúfloor‚Äù. We scale it by 2 metres in the horizontal directions and 0.1m in the vertical, so it‚Äôs flat. Then, if the left grip pose has been obtained, we draw a cuboid at this pose.</p>
<p>Let‚Äôs implement RenderCuboid(). After the definition of DestroySwapchain(), add:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RenderCuboid</span><span class="p">(</span><span class="n">XrPosef</span><span class="w"> </span><span class="n">pose</span><span class="p">,</span><span class="w"> </span><span class="n">XrVector3f</span><span class="w"> </span><span class="n">scale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XrMatrix4x4f_CreateTranslationRotationScale</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">scale</span><span class="p">);</span>

<span class="w">        </span><span class="n">XrMatrix4x4f_Multiply</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">modelViewProj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">viewProj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">model</span><span class="p">);</span>

<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetPipeline</span><span class="p">(</span><span class="n">m_pipeline</span><span class="p">);</span>

<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetBufferData</span><span class="p">(</span><span class="n">m_uniformBuffer_Vert</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">CameraConstants</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetDescriptor</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_uniformBuffer_Vert</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">});</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetBufferData</span><span class="p">(</span><span class="n">m_uniformBuffer_Frag</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">colors</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetDescriptor</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_uniformBuffer_Frag</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">});</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">UpdateDescriptors</span><span class="p">();</span>

<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetVertexBuffers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_vertexBuffer</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetIndexBuffer</span><span class="p">(</span><span class="n">m_indexBuffer</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DrawIndexed</span><span class="p">(</span><span class="mi">36</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>From the passed-in pose and scale, we create the _model_ matrix, and multiply that with cameraConstants.viewProj to obtain cameraConstants.modelViewProj, the matrix that transforms from vertices in our unit cube into positions in projection-space. We apply our ‚Äúpipeline‚Äù - the shader and render states. We update two uniform buffers, one containing cameraConstants for the vertex shader, the other containing our six face colours for the cuboid pixel shader. We assign our vertex and index buffers and draw 36 indices.</p>
</section>
<section id="checking-for-connected-controllers">
<h2>4.6 Checking for Connected Controllers<a class="headerlink" href="#checking-for-connected-controllers" title="Permalink to this heading">¬∂</a></h2>
<p>Look again now at the function PollActions().</p>
<p>We specify which action to look at with the XrActionStateGetInfo struct. Then we use a type-specific call. For our boolean <cite>selectAction</cite>, we call <cite>xrGetActionStateBoolean()</cite> to retrieve an XrActionStateBoolean struct. This specifies whether the value of the boolean is true or false, and we can use this to determine whether the user is pressing the select button on the controller.
However, the struct <cite>XrActionStateBoolean</cite> also has a member called <cite>isActive</cite>, which is true if the state of the action is actually being read. If it‚Äôs false, the value of <cite>currentState</cite> is irrelevant - the polling failed.</p>
<p>Similarly, <cite>XrActionStateFloat</cite> has a floating-point <cite>currentState</cite> value, which is valid if <cite>isActive</cite> is true, it has <cite>lastChangeTime</cite> and <cite>changedSinceLastSync</cite>, and it has <cite>isActive</cite> and <cite>lastChangeTime</cite> and <cite>changedSinceLastSync</cite>.</p>
<p>The struct has <cite>changedSinceLastSync</cite>, which is true if the value changed between the previous and current calls to xrSync(). And it has <cite>lastChangeTime</cite>, which is the time at which the value last changed. This allows us to be very precise about when the user pressed the button, and how long they held it down for. This could be used to detect ‚Äúlong presses‚Äù, or double-clicks.</p>
<p>Careful use of this polling metadata will help you to create apps that are responsive and intuitive to use. Bear in mind as well that multiple physical controls could be bound to the same action, and the user could be using more than one controller at once. See the OpenXR spec for more details:</p>
<p><a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#multiple_inputs">https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#multiple_inputs</a></p>
</section>
</section>


						</div>
					</div>
					<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="3-graphics.html" class="btn btn-neutral float-left" title="üëæ 3 Graphics" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="5-extensions.html" class="btn btn-neutral float-right" title="‚ú® 5 Extensions" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>&#169; Copyright &#34;OpenXR&#34; and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom.</p>
  </div> 

</footer>
				</div>
			</div>
		</div>
	</div>
  <script></script> 

</body>
</html>