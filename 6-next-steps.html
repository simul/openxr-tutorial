<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>6 Next Steps &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="stylesheet" href="_static/copybutton.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="_static/clipboard.min.js"></script>
	<script src="_static/copybutton.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	function updatePlatform()
	{
	var platform = Cookies.get("platform");
	console.log("updatePlatform(), platform = " + platform);
	if (typeof platform == 'undefined')
	{
	platform = "linux"; // Set default here.
	}
	$(".linux").hide();
	$(".android").hide();
	$(".windows").hide();
	if (platform == "windows")
	{
	$(".windows").show();
	$(".selectd3d11").disabled = false;
	$(".selectd3d12").disabled = false;
	$(".selectopengles").disabled = true;
	$(".selectvulkan").disabled = false;
	$(".selectopengl").disabled = false;
	}
	if (platform == "linux")
	{
	$(".linux").show();
	$(".selectd3d11").disabled = true;
	$(".selectd3d12").disabled = true;
	$(".selectopengles").disabled = true;
	$(".selectvulkan").disabled = false;
	$(".selectopengl").disabled = false;
	}
	if (platform == "android")
	{
	$(".android").show();
	$(".selectd3d11").disabled = true;
	$(".selectd3d12").disabled = true;
	$(".selectopengles").disabled = false;
	$(".selectvulkan").disabled = false;
	$(".selectopengl").disabled = true;
	}
	var oldelements = document.querySelectorAll(".selected-platform");
	console.log("selected-platform on "+oldelements.length+" elements.");
	while (oldelements.length > 0)
	{
	var el=oldelements.item(0);
	el.classList.remove('selected-platform');
	console.log("Removing selected-platform from "+el.id);
	oldelements = document.querySelectorAll(".selected-platform");
	}
	var element = document.getElementById('select' + platform);
	if(element)
	{
	element.classList.add('selected-platform');
	console.log("Adding selected-platform to "+element.id);
	}
	var element2 = document.getElementById('select' + platform + "-inline");
	if(element2)
	{
	element2.classList.add('selected-platform');
	console.log("Adding selected-platform to "+element2.id);
	}
	else
	{
	console.log('select' + platform + "-inline not found");
	}
	if(limitAPIChoice())
	updateGraphicsAPI();
	window.updatePlatform=updatePlatform;
	}

	function limitAPIChoice()
	{
	var platform = Cookies.get("platform");
	var graphicsApi = Cookies.get("graphicsapi")
	console.log("limitAPIChoice(), platform = " + platform+", graphicsApi = "+graphicsApi);
	window.limitAPIChoice=limitAPIChoice;
	var newApi=graphicsApi;
	if (platform == "windows")
	{
	if (graphicsApi == "opengles"||graphicsApi==undefined)
	newApi="d3d11";
	}
	if (platform == "linux")
	{
	if (graphicsApi == "opengles"||graphicsApi=="d3d11"||graphicsApi=="d3d12"||graphicsApi==undefined)
	newApi="vulkan";
	}
	if (platform == "android"||graphicsApi==undefined)
	{
	if (graphicsApi != "opengles"&&graphicsApi!="vulkan")
	newApi="vulkan";
	}
	console.log("newApi = "+newApi);
	if (newApi != graphicsApi)
	{
	console.log("setting graphicsapi = "+newApi);
	Cookies.set('graphicsapi', newApi,{ expires: 365})
	graphicsApi=newApi;
	return true;
	}
	return false;
	}
	function makeLinksOpenInNewWindow()
	{
	console.log("makeLinksOpenInNewWindow ");
	var download_hrefs = document.getElementsByClassName('reference download internal');
	[].forEach.call(download_hrefs, function(el) {
	el.setAttribute('target', "_blank");
	console.log("Adding target blank to "+el.id);
	});
	link_hrefs = document.getElementsByClassName('reference external');
	[].forEach.call(link_hrefs, function(el) {
	el.setAttribute('target', "_blank");
	console.log("Adding target blank to "+el.id);
	});
	window.makeLinksOpenInNewWindow=makeLinksOpenInNewWindow;
	}
	function addIconsToToctree()
	{
	var toctreeheadings = document.getElementsByClassName('toctree-l1');
	var i = 0;
	const heading_ids = ["toc_introduction", "toc_setup", "toc_graphics","toc_interactions","toc_extensions","toc_next_steps"];
	const heading_anchors = ["introduction", "openxr-setup", "graphics","interactions","extensions","next_steps"];
	[].forEach.call(toctreeheadings, function(el) {
	el.id =heading_ids[i];
	el.children[0].href=el.children[0].href.replace('#','')+"#"+heading_anchors[i];
	i++;
	console.log("Adding id "+heading_ids[i]+" to toctree heading "+i);
	});
	}
	function updateGraphicsAPI()
	{
	var graphicsApi = Cookies.get("graphicsapi")
	console.log("graphicsapi = " + graphicsApi);
	if (typeof graphicsApi == 'undefined')
	{
	graphicsApi = "vulkan"; // Set default here.
	}
	// first, hide all the api's
	$(".d3d11").hide();
	$(".d3d12").hide();
	$(".opengl").hide();
	$(".opengles").hide();
	$(".vulkan").hide();
	// Now, show the wanted api's. In this way, divs with more than one will be shown, even if they have one that is hidden.
	if (graphicsApi == "d3d11") {
	$(".d3d11").show();
	}
	if (graphicsApi == "d3d12") {
	$(".d3d12").show();
	}
	if (graphicsApi == "opengl") {
	$(".opengl").show();
	}
	if (graphicsApi == "opengles") {
	$(".opengles").show();
	}
	if (graphicsApi == "vulkan") {
	$(".vulkan").show();
	}
	var oldelements = document.querySelectorAll(".selected-graphics-api");
	console.log("selected-platform on "+oldelements.length+" elements.");
	while (oldelements.length > 0)
	{
	var el=oldelements.item(0);
	el.classList.remove('selected-graphics-api');
	console.log("Removing selected-graphics-api from "+el.id);
	oldelements = document.querySelectorAll(".selected-graphics-api");
	}
	var element = document.getElementById('select' + graphicsApi);
	if(element)
	{
	element.classList.add('selected-graphics-api');
	}
	var element2 = document.getElementById('select' + graphicsApi +"-inline");
	if (element2)
	{
	element2.classList.add('selected-graphics-api');
	}
	window.updateGraphicsAPI=updateGraphicsAPI;
	}</script>
	<script >
	var graphicsApi = Cookies.get("graphicsapi")
	if (graphicsApi==undefined) {
	Cookies.set('graphicsapi', 'vulkan',{ expires: 365})
	graphicsApi='vulkan';
	}
	</script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onload="updatePlatform(); updateGraphicsAPI(); makeLinksOpenInNewWindow(); addIconsToToctree();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-setup.html">2 OpenXR Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">3 Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-actions.html">4 Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">5 Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">6 Next Steps</li>
	  <li class="wy-breadcrumbs-aside">
		  <div id='selectplatform'>
	<button class="select-platform" id='selectwindows' onclick="choosePlatform('windows')">
		<img class="platform-tab-img" src="_static/css/windows-mono.svg" alt="Windows" />
	</button>
	<button class="select-platform" id='selectlinux' onclick="choosePlatform('linux')">
		<img class="platform-tab-img" src="_static/css/tux-mono.svg" alt="Linux" />
	</button>
	<button class="select-platform" id='selectandroid' onclick="choosePlatform('android')">
		<img class="platform-tab-img" src="_static/css/android-mono.svg" alt="Android" />
	</button>
</div>
<script>
	function choosePlatform(platformName)
	{
		var platform = Cookies.get('platform')
		Cookies.set('platform', platformName, { expires: 365 })
		updatePlatform();
	};
</script>

<div id='selectgraphicsapi'>
	<button class="select-graphics-api selectd3d11" id='selectd3d11' onclick="chooseGraphicsAPI('d3d11')">
		<img class="api-tab-img" src="_static/css/DirectX11_Black_Aligned.svg" alt="DirectX 11" />
	</button><button class="select-graphics-api selectd3d12" id='selectd3d12' onclick="chooseGraphicsAPI('d3d12')">
		<img class="api-tab-img" src="_static/css/DirectX12_Black_Aligned.svg"" alt="DirectX 12" />
	</button><button class="select-graphics-api selectopengl" id='selectopengl' onclick="chooseGraphicsAPI('opengl')">
		<img class="api-tab-img" src="_static/css/OpenGL_Black_Aligned.svg" alt="OpenGL" />
	</button><button class="select-graphics-api selectopengles" id='selectopengles' onclick="chooseGraphicsAPI('opengles')">
		<img class="api-tab-img" src="_static/css/OpenGL ES_Black_Aligned.svg" alt="OpenGL ES" />
	</button><button class="select-graphics-api selectvulkan" id='selectvulkan' onclick="chooseGraphicsAPI('vulkan')">
		<img class="api-tab-img" src="_static/css/Vulkan_Black_Aligned.svg" alt="Vulkan" />
	</button>
</div>
<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		Cookies.set('graphicsapi', graphicsApiName, { expires: 365 })
		var graphicsApi = Cookies.get('graphicsapi')
		updateGraphicsAPI();
		limitAPIChoice();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
						<div itemprop="articleBody">
							
  <section id="next-steps">
<h1>6 Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">¶</a></h1>
<section id="multiview-rendering">
<h2>6.1 Multiview rendering<a class="headerlink" href="#multiview-rendering" title="Permalink to this heading">¶</a></h2>
<div class="d3d11 docutils container">
<p>D3D11 supports rendering to a Texture2DArray RenderTarget, but requires the use of instanced rendering to render to multiple views in the same draw call.</p>
</div>
<div class="d3d12 docutils container">
<p>D3D12 supports rendering to both eye views with View Instancing, which simplifies the rendering code. <a class="reference external" href="https://microsoft.github.io/DirectX-Specs/d3d/ViewInstancing.html">D3D12 View Instancing</a>.</p>
</div>
<div class="opengl opengles docutils container">
<p>OpenGL and OpenGL ES supports rendering to both eye views with multiview, which simplifies the rendering code. <a class="reference external" href="https://registry.khronos.org/OpenGL/extensions/OVR/OVR_multiview.txt">OpenGL and OpenGL ES Multiview</a>.</p>
</div>
<div class="vulkan docutils container">
<p>Vulkan supports rendering to both eye views with multiview, which simplifies the rendering code. <a class="reference external" href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_multiview.html">Vulkan Multiview</a>.</p>
</div>
<p>Multiview or View Instancing can be used for stereo rendering by creating one <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchain.html">XrSwapchain</a> that contains 2D array images. This is done by setting the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchainCreateInfo.html">XrSwapchainCreateInfo</a> <code class="docutils literal notranslate"><span class="pre">::arraySize</span></code> to <code class="docutils literal notranslate"><span class="pre">2</span></code>; similarly, we also create image views that encompass the two subresources - one layer per eye view.</p>
<p>Remember also to update any uniform/constant buffer data types to support multiple view matrics via the use of arrays. Update any changes to shaders, shader paths and set the <code class="docutils literal notranslate"><span class="pre">PipelineCreateInfo::viewMask</span></code> member to <code class="docutils literal notranslate"><span class="pre">0b11</span></code> for two views. (Only found in Chapter6_1_Multiview).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">viewCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_viewConfigurationViews</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

<span class="n">XrSwapchainCreateInfo</span><span class="w"> </span><span class="n">swapchainCI</span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_CREATE_INFO</span><span class="p">};</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">usageFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SWAPCHAIN_USAGE_SAMPLED_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_SWAPCHAIN_USAGE_COLOR_ATTACHMENT_BIT</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SelectColorSwapchainFormat</span><span class="p">(</span><span class="n">formats</span><span class="p">);</span><span class="w">          </span><span class="c1">// Use GraphicsAPI to select the first compatible format.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">sampleCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedSwapchainSampleCount</span><span class="p">;</span><span class="w">  </span><span class="c1">// Use the recommended values from the XrViewConfigurationView.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectWidth</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectHeight</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">faceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="hll"><span class="n">swapchainCI</span><span class="p">.</span><span class="n">arraySize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span>
</span><span class="n">swapchainCI</span><span class="p">.</span><span class="n">mipCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSwapchain</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">swapchainCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Color Swapchain&quot;</span><span class="p">);</span>

<span class="c1">// Similar for depth swapchain</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">swapchainImageCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="w"> </span><span class="n">imageViewCI</span><span class="p">;</span>
<span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">RTV</span><span class="p">;</span>
<span class="hll"><span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">View</span><span class="o">::</span><span class="n">TYPE_2D_ARRAY</span><span class="p">;</span>
</span><span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="p">;</span>
<span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">Aspect</span><span class="o">::</span><span class="n">COLOR_BIT</span><span class="p">;</span>
<span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">baseMipLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">levelCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">baseArrayLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="hll"><span class="w">        </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">layerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span>
</span><span class="w">        </span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateImageView</span><span class="p">(</span><span class="n">imageViewCI</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Similar for depth image views</span>
</pre></div>
</div>
<p>When setting up the rendering code in <code class="docutils literal notranslate"><span class="pre">RenderLayer()</span></code>, there’s no need to repeat the rendering code per eye view; instead, we call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrAcquireSwapchainImage.html">xrAcquireSwapchainImage</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrWaitSwapchainImage.html">xrWaitSwapchainImage</a> for both the color and depth swapchains to get the next 2D array image from them. We are still required to submit an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrCompositionLayerProjectionView.html">XrCompositionLayerProjectionView</a> structure for each view in the system, but in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchainSubImage.html">XrSwapchainSubImage</a> we can set the <code class="docutils literal notranslate"><span class="pre">imageArrayIndex</span></code> to specify which layer of the swapchain image we wish to associate with that view. So in the case of stereo rendering, it would be <code class="docutils literal notranslate"><span class="pre">0</span></code> for left and <code class="docutils literal notranslate"><span class="pre">1</span></code> for right eye views. We attach our 2D array image as a render target/color attachment for the pixel/fragment shader to write to.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Acquire and wait for an image from the swapchain.</span>
<span class="c1">// Get the image index of an image in the swapchain.</span>
<span class="c1">// The timeout is infinite.</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">colorImageIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">depthImageIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="hll"><span class="n">XrSwapchainImageAcquireInfo</span><span class="w"> </span><span class="n">acquireInfo</span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_IMAGE_ACQUIRE_INFO</span><span class="p">};</span>
</span><span class="hll"><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrAcquireSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">acquireInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">colorImageIndex</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to acquire Image from the Color Swapchian&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrAcquireSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">acquireInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">depthImageIndex</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to acquire Image from the Depth Swapchian&quot;</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll"><span class="n">XrSwapchainImageWaitInfo</span><span class="w"> </span><span class="n">waitInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_IMAGE_WAIT_INFO</span><span class="p">};</span>
</span><span class="hll"><span class="n">waitInfo</span><span class="p">.</span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_INFINITE_DURATION</span><span class="p">;</span>
</span><span class="hll"><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrWaitSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">waitInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to wait for Image from the Color Swapchain&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrWaitSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">waitInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to wait for Image from the Depth Swapchain&quot;</span><span class="p">);</span>
</span>
<span class="c1">// Get the width and height and construct the viewport and scissors.</span>
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">recommendedImageRectWidth</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">recommendedImageRectHeight</span><span class="p">;</span>
<span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">Viewport</span><span class="w"> </span><span class="n">viewport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">Rect2D</span><span class="w"> </span><span class="n">scissor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{(</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">}};</span>

<span class="hll"><span class="c1">// Fill out the XrCompositionLayerProjectionView structure specifying the pose and fov from the view.</span>
</span><span class="hll"><span class="c1">// This also associates the swapchain image with this layer projection view.</span>
</span><span class="hll"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_COMPOSITION_LAYER_PROJECTION_VIEW</span><span class="p">};</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">views</span><span class="p">.</span><span class="n">pose</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">fov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">views</span><span class="p">.</span><span class="n">fov</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">subImage</span><span class="p">.</span><span class="n">swapchain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_swapchainAndDepthImages</span><span class="p">.</span><span class="n">swapchain</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">height</span><span class="p">);</span>
</span><span class="hll"><span class="w">        </span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageArrayIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">  </span><span class="c1">// Select the layer for this view. Left = 0, Right = 1.</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="c1">// Rendering code to clear the color and depth image views.</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">BeginRendering</span><span class="p">();</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_environmentBlendMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_ENVIRONMENT_BLEND_MODE_OPAQUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// VR mode use a background color.</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">ClearColor</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">colorImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mf">0.17f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// In AR mode make the background color black.</span>
<span class="w">        </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">ClearColor</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">colorImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">ClearDepth</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">depthImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>

<span class="hll"><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetRenderAttachments</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_swapchainAndDepthImage</span><span class="p">.</span><span class="n">colorImageViews</span><span class="p">[</span><span class="n">imageIndex</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_swapchainAndDepthImage</span><span class="p">.</span><span class="n">depthImageView</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">eight</span><span class="p">,</span><span class="w"> </span><span class="n">m_pipeline</span><span class="p">);</span>
</span>
<span class="c1">// [...]</span>

<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">EndRendering</span><span class="p">();</span>

<span class="c1">// Give the swapchain image back to OpenXR, allowing the compositor to use the image.</span>
<span class="n">XrSwapchainImageReleaseInfo</span><span class="w"> </span><span class="n">releaseInfo</span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_IMAGE_RELEASE_INFO</span><span class="p">};</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrReleaseSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">releaseInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to release Image back to the Color Swapchain&quot;</span><span class="p">);</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrReleaseSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">releaseInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to release Image back to the Depth Swapchain&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Shaders and Pipelines will need to be modified to support multiview rendering.</p>
<div class="d3d11 docutils container">
<p>Here we use the vertex shader to write to the <code class="docutils literal notranslate"><span class="pre">SV_RenderTargetArrayIndex</span></code> System-Value Semantic, which specifies which index in the array within the render target we should emit the primitives data to. This System-Value Semantic must be matched in the pixel shader input. Note that this is only supported when <code class="docutils literal notranslate"><span class="pre">D3D11_FEATURE_DATA_D3D11_OPTIONS3::VPAndRTArrayIndexFromAnyShaderFeedingRasterizer</span></code> is set to true. Otherwise, you would need to use a geometry shader. <a class="reference external" href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-semantics">HLSL Semantics</a>.
Also see this example from Microsoft’s <a class="reference external" href="https://github.com/microsoft/OpenXR-MixedReality/blob/a46ea22a396a38725043fea91166c6d5b1a49dfc/samples/BasicXrApp/CubeGraphics.cpp">OpenXR-MixedReality GitHub repository</a> and a reference page from Mixed Reality about <a class="reference external" href="https://learn.microsoft.com/en-us/windows/mixed-reality/develop/native/rendering-in-directx">Rendering in DirectX</a>.</p>
<p>When executing draw calls remember to set the instance count parameter to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<p>Vertex Shader:</p>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\VertexShader.hlsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\VertexShader_DX11_MV.hlsl</span>
<span class="gu">@@ -4,8 +4,8 @@</span>
<span class="w"> </span>
<span class="w"> </span>cbuffer CameraConstants : register(b0)
<span class="w"> </span>{
<span class="gd">-    float4x4 viewProj;</span>
<span class="gd">-    float4x4 modelViewProj;</span>
<span class="gi">+    float4x4 viewProj[2];</span>
<span class="gi">+    float4x4 modelViewProj[2];</span>
<span class="w"> </span>    float4x4 model;
<span class="w"> </span>    float4 color;
<span class="w"> </span>    float4 pad1;
<span class="gu">@@ -20,6 +20,7 @@</span>
<span class="w"> </span>struct VS_IN
<span class="w"> </span>{
<span class="w"> </span>    uint vertexId : SV_VertexId;
<span class="gi">+    uint instanceId : SV_InstanceId;</span>
<span class="w"> </span>    float4 a_Positions : TEXCOORD0;
<span class="w"> </span>};
<span class="w"> </span>struct VS_OUT
<span class="gu">@@ -28,12 +29,14 @@</span>
<span class="w"> </span>    nointerpolation float2 o_TexCoord : TEXCOORD0;
<span class="w"> </span>    float3 o_Normal : TEXCOORD1;
<span class="w"> </span>    nointerpolation float3 o_Color : TEXCOORD2;
<span class="gi">+    uint viewId : SV_RenderTargetArrayIndex;</span>
<span class="w"> </span>};
<span class="w"> </span>
<span class="w"> </span>VS_OUT main(VS_IN IN)
<span class="w"> </span>{
<span class="w"> </span>    VS_OUT OUT;
<span class="gd">-    OUT.o_Position = mul(modelViewProj, IN.a_Positions);</span>
<span class="gi">+    OUT.o_Position = mul(modelViewProj[IN.instanceId], IN.a_Positions);</span>
<span class="gi">+    OUT.viewId = IN.instanceId;</span>
<span class="w"> </span>    int face = IN.vertexId / 6;
<span class="w"> </span>    OUT.o_TexCoord = float2(float(face), 0);
<span class="w"> </span>    OUT.o_Normal = (mul(model, normals[face])).xyz;
</pre></div>
</div>
<p>Pixel Shader:</p>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\PixelShader.hlsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\PixelShader_DX11_MV.hlsl</span>
<span class="gu">@@ -8,6 +8,7 @@</span>
<span class="w"> </span>    nointerpolation float2 i_TexCoord : TEXCOORD0;
<span class="w"> </span>    float3 i_Normal : TEXCOORD1;
<span class="w"> </span>    nointerpolation float3 i_Color : TEXCOORD2;
<span class="gi">+    uint viewId : SV_RenderTargetArrayIndex;</span>
<span class="w"> </span>};
<span class="w"> </span>struct PS_OUT
<span class="w"> </span>{
</pre></div>
</div>
</div>
<div class="d3d12 docutils container">
<p>First, you need to check that <code class="docutils literal notranslate"><span class="pre">D3D12_FEATURE_DATA_D3D12_OPTIONS3::ViewInstancingTier</span></code> doesn’t equal <code class="docutils literal notranslate"><span class="pre">D3D12_VIEW_INSTANCING_TIER_NOT_SUPPORTED</span></code>. Next, within the pipeline creation, set up the <code class="docutils literal notranslate"><span class="pre">D3D12_VIEW_INSTANCING_DESC</span></code> and a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;D3D12_VIEW_INSTANCE_LOCATION&gt;</span></code> for pipeline creation. Here, we must use <code class="docutils literal notranslate"><span class="pre">ID3D12Device2::CreatePipelineState()</span></code> for ViewInstancing. Set the <code class="docutils literal notranslate"><span class="pre">D3D12_VIEW_INSTANCE_LOCATION::RenderTargetArrayIndex</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code> for left and <code class="docutils literal notranslate"><span class="pre">1</span></code> for right eye views. This means that we don’t need to write to <code class="docutils literal notranslate"><span class="pre">SV_RenderTargetArrayIndex</span></code> in the shader. We set <code class="docutils literal notranslate"><span class="pre">D3D12_VIEW_INSTANCING_DESC::Flags</span></code> to <code class="docutils literal notranslate"><span class="pre">D3D12_VIEW_INSTANCING_FLAG_NONE</span></code>, though it’s possible to set it to <code class="docutils literal notranslate"><span class="pre">D3D12_VIEW_INSTANCING_FLAG_ENABLE_VIEW_INSTANCE_MASKING</span></code> and use <code class="docutils literal notranslate"><span class="pre">ID3D12CommandList2::SetViewInstanceMask()</span></code> to control further which views will be rendered to.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">viewMask</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//Pipeline Extensions</span>
<span class="w">        </span><span class="n">CD3DX12_PIPELINE_STATE_STREAM1</span><span class="w"> </span><span class="nf">gpss1</span><span class="p">(</span><span class="n">GPSD</span><span class="p">);</span>

<span class="w">        </span><span class="n">D3D12_VIEW_INSTANCING_DESC</span><span class="w"> </span><span class="n">viewInstancingDesc</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">D3D12_VIEW_INSTANCE_LOCATION</span><span class="o">&gt;</span><span class="w"> </span><span class="n">viewInstanceLocations</span><span class="p">;</span>

<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">viewIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">viewIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">viewIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">viewMask</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00000001</span><span class="p">);</span>
<span class="w">            </span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">viewIndex</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">viewInstancingDesc</span><span class="p">.</span><span class="n">ViewInstanceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="p">;</span>
<span class="w">        </span><span class="n">viewInstanceLocations</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">viewInstancingDesc</span><span class="p">.</span><span class="n">ViewInstanceCount</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">viewInstanceLocations</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">viewInstanceLocations</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">RenderTargetArrayIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">UINT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">viewInstanceLocations</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ViewportArrayIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">viewInstancingDesc</span><span class="p">.</span><span class="n">pViewInstanceLocations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewInstanceLocations</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">        </span><span class="n">viewInstancingDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_VIEW_INSTANCING_FLAG_NONE</span><span class="p">;</span>

<span class="w">        </span><span class="n">gpss1</span><span class="p">.</span><span class="n">ViewInstancingDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CD3DX12_VIEW_INSTANCING_DESC</span><span class="p">(</span><span class="n">viewInstancingDesc</span><span class="p">);</span>

<span class="w">        </span><span class="n">D3D12_PIPELINE_STATE_STREAM_DESC</span><span class="w"> </span><span class="n">gpssd</span><span class="p">;</span>
<span class="w">        </span><span class="n">gpssd</span><span class="p">.</span><span class="n">SizeInBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gpss1</span><span class="p">);</span>
<span class="w">        </span><span class="n">gpssd</span><span class="p">.</span><span class="n">pPipelineStateSubobjectStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gpss1</span><span class="p">;</span>

<span class="w">        </span><span class="n">ID3D12Device2</span><span class="o">*</span><span class="w"> </span><span class="n">device2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="o">&lt;</span><span class="n">ID3D12Device2</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device2</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">S_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error in querying for ID3D12Device2.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device2</span><span class="o">-&gt;</span><span class="n">CreatePipelineState</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gpssd</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pipeline</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create Pipeline.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateGraphicsPipelineState</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GPSD</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pipeline</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create Pipeline&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Modify the shader to use <code class="docutils literal notranslate"><span class="pre">SV_ViewID</span></code> and compile with shader model 6.1 to allow the vertex shader to use the new <code class="docutils literal notranslate"><span class="pre">SV_ViewID</span></code> System-Value Semantic. See <a class="reference external" href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-semantics">HLSL Semantics</a> for its usage.</p>
<blockquote>
<div><p>Vertex Shader:</p>
</div></blockquote>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\VertexShader.hlsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\VertexShader_DX12_MV.hlsl</span>
<span class="gu">@@ -4,8 +4,8 @@</span>
<span class="w"> </span>
<span class="w"> </span>cbuffer CameraConstants : register(b0)
<span class="w"> </span>{
<span class="gd">-    float4x4 viewProj;</span>
<span class="gd">-    float4x4 modelViewProj;</span>
<span class="gi">+    float4x4 viewProj[2];</span>
<span class="gi">+    float4x4 modelViewProj[2];</span>
<span class="w"> </span>    float4x4 model;
<span class="w"> </span>    float4 color;
<span class="w"> </span>    float4 pad1;
<span class="gu">@@ -20,6 +20,7 @@</span>
<span class="w"> </span>struct VS_IN
<span class="w"> </span>{
<span class="w"> </span>    uint vertexId : SV_VertexId;
<span class="gi">+    uint viewId : SV_ViewId;</span>
<span class="w"> </span>    float4 a_Positions : TEXCOORD0;
<span class="w"> </span>};
<span class="w"> </span>struct VS_OUT
<span class="gu">@@ -33,7 +34,7 @@</span>
<span class="w"> </span>VS_OUT main(VS_IN IN)
<span class="w"> </span>{
<span class="w"> </span>    VS_OUT OUT;
<span class="gd">-    OUT.o_Position = mul(modelViewProj, IN.a_Positions);</span>
<span class="gi">+    OUT.o_Position = mul(modelViewProj[IN.viewId], IN.a_Positions);</span>
<span class="w"> </span>    int face = IN.vertexId / 6;
<span class="w"> </span>    OUT.o_TexCoord = float2(float(face), 0);
<span class="w"> </span>    OUT.o_Normal = (mul(model, normals[face])).xyz;
</pre></div>
</div>
</div>
<div class="opengl docutils container">
<p>Enusre you have support for <code class="docutils literal notranslate"><span class="pre">GL_OVR_multiview</span></code> by checking the extensions and that you have loaded the <code class="docutils literal notranslate"><span class="pre">glFramebufferTextureMultiviewOVR()</span></code> function pointer, if you need to do so. You will use this to create a framebuffer that supports rendering to multiple layers.
See this example from ARM’s OpenGL ES SDK for Android <a class="reference external" href="https://arm-software.github.io/opengl-es-sdk-for-android/multiview.html">here</a>, which works for OpenGL too.</p>
<p>Modify the shader to use <code class="docutils literal notranslate"><span class="pre">gl_ViewIndex_OVR</span></code> and the GL_OVR_multiview GLSL extension. The line <code class="docutils literal notranslate"><span class="pre">layout(num_views</span> <span class="pre">=</span> <span class="pre">2)</span> <span class="pre">in</span></code> specifies the number of views the vertex shader a will broadcast to.</p>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\VertexShader.glsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\VertexShader_GL_MV.glsl</span>
<span class="gu">@@ -4,9 +4,11 @@</span>
<span class="w"> </span>
<span class="w"> </span>#version 450
<span class="w"> </span>#extension GL_KHR_vulkan_glsl : enable
<span class="gi">+#extension GL_OVR_multiview : enable</span>
<span class="gi">+layout(num_views = 2) in;</span>
<span class="w"> </span>layout(std140, binding = 0) uniform CameraConstants {
<span class="gd">-    mat4 viewProj;</span>
<span class="gd">-    mat4 modelViewProj;</span>
<span class="gi">+    mat4 viewProj[2];</span>
<span class="gi">+    mat4 modelViewProj[2];</span>
<span class="w"> </span>    mat4 model;
<span class="w"> </span>    vec4 color;
<span class="w"> </span>    vec4 pad1;
<span class="gu">@@ -21,7 +23,7 @@</span>
<span class="w"> </span>layout(location = 1) out flat vec3 o_Normal;
<span class="w"> </span>layout(location = 2) out flat vec3 o_Color;
<span class="w"> </span>void main() {
<span class="gd">-    gl_Position = modelViewProj * a_Positions;</span>
<span class="gi">+    gl_Position = modelViewProj[gl_ViewID_OVR] * a_Positions;</span>
<span class="w"> </span>    int face = gl_VertexIndex / 6;
<span class="w"> </span>    o_TexCoord = uvec2(face, 0);
<span class="w"> </span>    o_Normal = (model * normals[face]).xyz;
</pre></div>
</div>
</div>
<div class="opengles docutils container">
<p>Enusre you have support for <code class="docutils literal notranslate"><span class="pre">GL_OVR_multiview</span></code> by checking the extensions and that you have loaded the <code class="docutils literal notranslate"><span class="pre">glFramebufferTextureMultiviewOVR()</span></code> function pointer, if you need to do so. You will use this to create a framebuffer that supports rendering to multiple layers.
See this example from ARM’s OpenGL ES SDK for Android <a class="reference external" href="https://arm-software.github.io/opengl-es-sdk-for-android/multiview.html">here</a>.</p>
<p>Modify the shader to use <code class="docutils literal notranslate"><span class="pre">gl_ViewIndex_OVR</span></code> and the GL_OVR_multiview GLSL extension. The line <code class="docutils literal notranslate"><span class="pre">layout(num_views</span> <span class="pre">=</span> <span class="pre">2)</span> <span class="pre">in</span></code> specifies the number of views the vertex shader a will broadcast to.</p>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\VertexShader.glsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\VertexShader_GL_MV.glsl</span>
<span class="gu">@@ -4,9 +4,11 @@</span>
<span class="w"> </span>
<span class="w"> </span>#version 450
<span class="w"> </span>#extension GL_KHR_vulkan_glsl : enable
<span class="gi">+#extension GL_OVR_multiview : enable</span>
<span class="gi">+layout(num_views = 2) in;</span>
<span class="w"> </span>layout(std140, binding = 0) uniform CameraConstants {
<span class="gd">-    mat4 viewProj;</span>
<span class="gd">-    mat4 modelViewProj;</span>
<span class="gi">+    mat4 viewProj[2];</span>
<span class="gi">+    mat4 modelViewProj[2];</span>
<span class="w"> </span>    mat4 model;
<span class="w"> </span>    vec4 color;
<span class="w"> </span>    vec4 pad1;
<span class="gu">@@ -21,7 +23,7 @@</span>
<span class="w"> </span>layout(location = 1) out flat vec3 o_Normal;
<span class="w"> </span>layout(location = 2) out flat vec3 o_Color;
<span class="w"> </span>void main() {
<span class="gd">-    gl_Position = modelViewProj * a_Positions;</span>
<span class="gi">+    gl_Position = modelViewProj[gl_ViewID_OVR] * a_Positions;</span>
<span class="w"> </span>    int face = gl_VertexIndex / 6;
<span class="w"> </span>    o_TexCoord = uvec2(face, 0);
<span class="w"> </span>    o_Normal = (model * normals[face]).xyz;
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<p>First, add the <code class="docutils literal notranslate"><span class="pre">VK_KHR_MULTIVIEW_EXTENSION_NAME</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;VK_KHR_multiview&quot;</span></code> string to the device extensions list when creating the <code class="docutils literal notranslate"><span class="pre">VkDevice</span></code>.</p>
<p>At pipeline creation, chain via the next pointer a <code class="docutils literal notranslate"><span class="pre">VkRenderPassMultiviewCreateInfo</span></code> structure to the <code class="docutils literal notranslate"><span class="pre">VkRenderPassCreateInfo</span></code> structure when creating the <code class="docutils literal notranslate"><span class="pre">VkRenderPass</span></code>. Note that there is similar functionality for <code class="docutils literal notranslate"><span class="pre">VK_KHR_dynamic_rendering</span></code>. The viewMask specifies the number of views the rasterizer will broadcast to.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">multiview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">VkRenderPassMultiviewCreateInfoKHR</span><span class="w"> </span><span class="n">multiviewCreateInfo</span><span class="p">;</span>
<span class="cp">#if XR_TUTORIAL_ENABLE_MULTIVIEW</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">viewMask</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_RENDER_PASS_MULTIVIEW_CREATE_INFO</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">subpassCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">pViewMasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">viewMask</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">dependencyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">pViewOffsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">correlationMaskCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiviewCreateInfo</span><span class="p">.</span><span class="n">pCorrelationMasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">viewMask</span><span class="p">;</span>
<span class="w">        </span><span class="n">multiview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="n">VkRenderPass</span><span class="w"> </span><span class="n">renderPass</span><span class="p">{};</span>
<span class="w">    </span><span class="n">VkRenderPassCreateInfo</span><span class="w"> </span><span class="n">renderPassCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_RENDER_PASS_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">multiview</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span><span class="n">multiviewCreateInfo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">attachmentCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">attachmentDescriptions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">pAttachments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attachmentDescriptions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">subpassCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">pSubpasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">subpassDescription</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">dependencyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderPassCI</span><span class="p">.</span><span class="n">pDependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">subpassDependency</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateRenderPass</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">renderPassCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">renderPass</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create RenderPass.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Modify the shader to use <code class="docutils literal notranslate"><span class="pre">gl_ViewIndex</span></code> and the GL_EXT_multiview GLSL extension.</p>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\VertexShader.glsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\VertexShader_VK_MV.glsl</span>
<span class="gu">@@ -4,9 +4,10 @@</span>
<span class="w"> </span>
<span class="w"> </span>#version 450
<span class="w"> </span>#extension GL_KHR_vulkan_glsl : enable
<span class="gi">+#extension GL_EXT_multiview : enable</span>
<span class="w"> </span>layout(std140, binding = 0) uniform CameraConstants {
<span class="gd">-    mat4 viewProj;</span>
<span class="gd">-    mat4 modelViewProj;</span>
<span class="gi">+    mat4 viewProj[2];</span>
<span class="gi">+    mat4 modelViewProj[2];</span>
<span class="w"> </span>    mat4 model;
<span class="w"> </span>    vec4 color;
<span class="w"> </span>    vec4 pad1;
<span class="gu">@@ -14,14 +15,14 @@</span>
<span class="w"> </span>    vec4 pad3;
<span class="w"> </span>};
<span class="w"> </span>layout(std140, binding = 1) uniform Normals {
<span class="gd">-    vec4 normals[6];</span>
<span class="gi">+        vec4 normals[6];</span>
<span class="w"> </span>};
<span class="w"> </span>layout(location = 0) in vec4 a_Positions;
<span class="w"> </span>layout(location = 0) out flat uvec2 o_TexCoord;
<span class="w"> </span>layout(location = 1) out flat vec3 o_Normal;
<span class="w"> </span>layout(location = 2) out flat vec3 o_Color;
<span class="w"> </span>void main() {
<span class="gd">-    gl_Position = modelViewProj * a_Positions;</span>
<span class="gi">+    gl_Position = modelViewProj[gl_ViewIndex] * a_Positions;</span>
<span class="w"> </span>    int face = gl_VertexIndex / 6;
<span class="w"> </span>    o_TexCoord = uvec2(face, 0);
<span class="w"> </span>    o_Normal = (model * normals[face]).xyz;
</pre></div>
</div>
</div>
</section>
<section id="graphics-api">
<h2>6.2 Graphics API<a class="headerlink" href="#graphics-api" title="Permalink to this heading">¶</a></h2>
<p class="rubric">GraphicsAPI</p>
<p>Note: <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> is by no means production-ready code or reflective of good practice with specific APIs. It is there solely to provide working samples in this tutorial, and demonstrate some basic rendering and interaction with OpenXR.</p>
<p>This tutorial uses polymorphic classes; <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> derives from the base <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class. The derived class is based on your graphics API selection. Include both the header and cpp files for both <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> and <code class="docutils literal notranslate"><span class="pre">GraphicsAPI...</span></code>. <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code> includes the headers and macros needed to set up your platform and graphics API. Below are code snippets that show how to set up the <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_...</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macros for your platform along with any relevant headers. In the first code block, there’s also a reference to <code class="docutils literal notranslate"><span class="pre">XR_TUTORIAL_USE_...</span></code> which we set up the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> . This tutorial demonstrates all five graphics APIs.</p>
<p>The code below is an example of how you might implement the inclusion and definition of the relevant graphics API header along with the <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_...</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macros.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;HelperFunctions.h&gt;</span>
</pre></div>
</div>
<div class="windows docutils container">
<div class="d3d11 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(_WIN32)</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN</span>
<span class="cp">#define NOMINMAX</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Windows.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unknwn.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_WIN32</span>
</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_D3D11)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_D3D11</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#if defined(XR_TUTORIAL_USE_D3D12)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D12</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>
<span class="cp">#endif  </span><span class="c1">// _WIN32</span>
</pre></div>
</div>
</div>
<div class="d3d12 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(_WIN32)</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN</span>
<span class="cp">#define NOMINMAX</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Windows.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unknwn.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_WIN32</span>
</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D11)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D11</span>
<span class="cp">#endif</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_D3D12)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_D3D12</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>
<span class="cp">#endif  </span><span class="c1">// _WIN32</span>
</pre></div>
</div>
</div>
<div class="opengl docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(_WIN32)</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN</span>
<span class="cp">#define NOMINMAX</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Windows.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unknwn.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_WIN32</span>
</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D11)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D11</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D12)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D12</span>
<span class="cp">#endif</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>
<span class="cp">#endif  </span><span class="c1">// _WIN32</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(_WIN32)</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN</span>
<span class="cp">#define NOMINMAX</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Windows.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unknwn.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_WIN32</span>
</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D11)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D11</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D12)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D12</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="cp">#endif</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#endif  </span><span class="c1">// _WIN32</span>
</pre></div>
</div>
</div>
</div>
<div class="linux docutils container">
<div class="opengl docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__linux__) &amp;&amp; !defined(__ANDROID__)</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_LINUX_XLIB)</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;X11/Xlib.h&gt;</span>
</span><span class="hll"><span class="cp">#define XR_USE_PLATFORM_XLIB</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_LINUX_XCB)</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;xcb/xcb.h&gt;</span>
</span><span class="hll"><span class="cp">#define XR_USE_PLATFORM_XCB</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_LINUX_WAYLAND)</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;wayland-client.h&gt;</span>
</span><span class="hll"><span class="cp">#define XR_USE_PLATFORM_WAYLAND</span>
</span><span class="hll"><span class="cp">#endif</span>
</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>
<span class="cp">#endif  </span><span class="c1">// __linux__</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__linux__) &amp;&amp; !defined(__ANDROID__)</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_LINUX_XLIB)</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;X11/Xlib.h&gt;</span>
</span><span class="hll"><span class="cp">#define XR_USE_PLATFORM_XLIB</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_LINUX_XCB)</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;xcb/xcb.h&gt;</span>
</span><span class="hll"><span class="cp">#define XR_USE_PLATFORM_XCB</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_LINUX_WAYLAND)</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;wayland-client.h&gt;</span>
</span><span class="hll"><span class="cp">#define XR_USE_PLATFORM_WAYLAND</span>
</span><span class="hll"><span class="cp">#endif</span>
</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="cp">#endif</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#endif  </span><span class="c1">// __linux__</span>
</pre></div>
</div>
</div>
</div>
<div class="android docutils container">
<div class="opengles docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__ANDROID__)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;android_native_app_glue.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_ANDROID</span>
</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL_ES)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_OPENGL_ES</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>
<span class="cp">#endif  </span><span class="c1">// __ANDROID__</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__ANDROID__)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;android_native_app_glue.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_ANDROID</span>
</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL_ES)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_OPENGL_ES</span>
<span class="cp">#endif</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#endif  </span><span class="c1">// __ANDROID__</span>
</pre></div>
</div>
</div>
</div>
<div class="d3d11 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D11)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;d3d11_1.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dxgi1_6.h&gt;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="d3d12 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D12)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;d3d12.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dxgi1_6.h&gt;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="opengl docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL)</span>
<span class="cp">#if defined(XR_USE_PLATFORM_XLIB)</span>
<span class="cp">#define OS_LINUX_XLIB 1</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="opengles docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL_ES)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gfxwrapper_opengl.h&gt;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(XR_USE_GRAPHICS_API_VULKAN)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vulkan/vulkan.h&gt;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// OpenXR Helper</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;OpenXRHelper.h&gt;</span>
</pre></div>
</div>
<p>When setting up the graphics API core objects, there are things that we need to know from OpenXR in order to create the objects correctly. These could include the version of the graphics API required, referencing a specific GPU, required instance and/or device extension etc. Below are code examples showing how to set up your graphics for OpenXR.</p>
<div class="d3d11 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D11</span><span class="o">::</span><span class="n">GraphicsAPI_D3D11</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D11GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr xrGetD3D11GraphicsRequirementsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D11KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D11_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D11GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D11.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory1</span><span class="p">(</span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">LUID</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D11_CHECK</span><span class="p">(</span><span class="n">D3D11CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">D3D_DRIVER_TYPE_UNKNOWN</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_CREATE_DEVICE_DEBUG</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">D3D11_SDK_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">immediateContext</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D11 Device.&quot;</span><span class="p">);</span>

<span class="w">	</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="p">(</span><span class="w"> </span><span class="n">__uuidof</span><span class="p">(</span><span class="n">ID3D11Debug</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">d3dDebug</span><span class="w"> </span><span class="p">);</span>
<span class="w">	</span><span class="n">d3dDebug</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="p">(</span><span class="w"> </span><span class="n">__uuidof</span><span class="p">(</span><span class="n">ID3D11InfoQueue</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">infoQueue</span><span class="w"> </span><span class="p">);</span>
<span class="w">	</span><span class="n">infoQueue</span><span class="o">-&gt;</span><span class="n">SetBreakOnSeverity</span><span class="p">(</span><span class="n">D3D11_MESSAGE_SEVERITY_WARNING</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">	</span><span class="n">infoQueue</span><span class="o">-&gt;</span><span class="n">SetBreakOnSeverity</span><span class="p">(</span><span class="n">D3D11_MESSAGE_SEVERITY_ERROR</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D11</span><span class="o">::~</span><span class="n">GraphicsAPI_D3D11</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">immediateContext</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D11_SAFE_RELEASE</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="d3d12 docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_D3D12</span><span class="o">::</span><span class="n">GraphicsAPI_D3D12</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetD3D12GraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetD3D12GraphicsRequirementsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsD3D12KHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_D3D12_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetD3D12GraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for D3D12.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debugAPI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">D3D12GetDebugInterface</span><span class="p">(</span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">debug</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to get DebugInterface.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">debug</span><span class="o">-&gt;</span><span class="n">EnableDebugLayer</span><span class="p">();</span>
<span class="w">        </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">ID3D12Debug1</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">SetEnableGPUBasedValidation</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">CreateDXGIFactory2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create DXGI factory.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">IDXGIAdapter1</span><span class="w"> </span><span class="o">*</span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">DXGI_ADAPTER_DESC</span><span class="w"> </span><span class="n">adapterDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">EnumAdapters1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapter</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DXGI_ERROR_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">GetDesc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">adapterLuid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adapterDesc</span><span class="p">.</span><span class="n">AdapterLuid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">LUID</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// We have the matching adapter that OpenXR wants.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">D3D12CreateDevice</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Device.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_COMMAND_QUEUE_DESC</span><span class="w"> </span><span class="n">commandQueueDesc</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_LIST_TYPE_DIRECT</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_COMMAND_QUEUE_FLAG_NONE</span><span class="p">;</span>
<span class="w">    </span><span class="n">commandQueueDesc</span><span class="p">.</span><span class="n">NodeMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateCommandQueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">commandQueueDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Failed to create D3D12 Command Queue.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">D3D12_FEATURE_DATA_D3D12_OPTIONS</span><span class="w"> </span><span class="n">d3d12Options</span><span class="p">{};</span>
<span class="w">    </span><span class="n">D3D12_CHECK</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CheckFeatureSupport</span><span class="p">(</span><span class="n">D3D12_FEATURE_D3D12_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d3d12Options</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">d3d12Options</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;Unable to CheckFeatureSupport for D3D12_FEATURE_D3D12_OPTIONS.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ResourceBindingCapabilities</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxDescriptorCount</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxCBVsPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxSRVsPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxUAVsPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxSamplersPerStage</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxSamplerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2048</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">resourceBindingCapabilities</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">d3d12Options</span><span class="p">.</span><span class="n">ResourceBindingTier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">D3D12_RESOURCE_BINDING_TIER_3</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resourceBindingCapabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">D3D12_RESOURCE_BINDING_TIER_2</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resourceBindingCapabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">D3D12_RESOURCE_BINDING_TIER_1</span><span class="p">:</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">maxUAVsPerStage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minFeatureLevel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D_FEATURE_LEVEL_11_0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span>
<span class="w">        </span><span class="n">resourceBindingCapabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="n">maxUAVsPerStage</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">D3D12_DESCRIPTOR_HEAP_DESC</span><span class="w"> </span><span class="n">DescriptorHeapDesc</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_DESCRIPTOR_HEAP_TYPE_CBV_SRV_UAV</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">NumDescriptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceBindingCapabilities</span><span class="p">.</span><span class="n">maxDescriptorCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_DESCRIPTOR_HEAP_FLAG_SHADER_VISIBLE</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">NodeMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateDescriptorHeap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DescriptorHeapDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CBV_SRV_UAV_DescriptorHeap</span><span class="p">));</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D3D12_DESCRIPTOR_HEAP_TYPE_SAMPLER</span><span class="p">;</span>
<span class="w">    </span><span class="n">DescriptorHeapDesc</span><span class="p">.</span><span class="n">NumDescriptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceBindingCapabilities</span><span class="p">.</span><span class="n">maxSamplerCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">CreateDescriptorHeap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DescriptorHeapDesc</span><span class="p">,</span><span class="w"> </span><span class="n">IID_PPV_ARGS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SAMPLER_DescriptorHeap</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_D3D12</span><span class="w"> </span><span class="o">::~</span><span class="n">GraphicsAPI_D3D12</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">SAMPLER_DescriptorHeap</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">CBV_SRV_UAV_DescriptorHeap</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span>
<span class="w">    </span><span class="n">D3D12_SAFE_RELEASE</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="opengl docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetOpenGLGraphicsRequirementsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGL.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L103-L121</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: The created OpenGL version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; doesn&#39;t meet the minimum required API version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="opengles docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLESGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetOpenGLESGraphicsRequirementsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLESKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_ES_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLESGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGLES.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengles.cpp#L101-L119</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL ES: The created OpenGL ES version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; doesn&#39;t meet the minimum required API version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL_ES</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL_ES</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="vulkan docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Instance</span>
<span class="w">    </span><span class="n">LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">);</span>

<span class="w">    </span><span class="n">XrGraphicsRequirementsVulkanKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_VULKAN_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for Vulkan.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkApplicationInfo</span><span class="w"> </span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pApplicationName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">pEngineName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial - Vulkan Engine&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">engineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_MAKE_API_VERSION</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">),</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">instanceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">instanceExtensionCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrInstanceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrInstanceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instanceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkInstanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">pApplicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ai</span><span class="p">;</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceLayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceLayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">instanceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Vulkan Instance.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Physical Device</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">physicalDeviceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkPhysicalDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">physicalDeviceCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceCount</span><span class="p">,</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate PhysicalDevices.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkPhysicalDevice</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">physicalDeviceFromXR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Device for Vulkan.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">physicalDeviceFromXR</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">physicalDeviceFromXR_it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">physicalDeviceFromXR_it</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Vulkan: Failed to find PhysicalDevice for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Select the first available device.</span>
<span class="w">        </span><span class="n">physicalDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">physicalDevices</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Device</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkQueueFamilyProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">queueFamilyPropertiesCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyPropertiesCount</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueFamilyPropertiesCount</span><span class="p">,</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkDeviceQueueCreateInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">;</span>
<span class="w">    </span><span class="n">queuePriorities</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>

<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">deviceQueueCIs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pQueuePriorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queuePriorities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="n">queueFamilyProperties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queueFlags</span><span class="p">,</span><span class="w"> </span><span class="n">VkQueueFlags</span><span class="p">(</span><span class="n">VK_QUEUE_GRAPHICS_BIT</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">queueFamilyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">queueIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">deviceExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">deviceExtensionCount</span><span class="p">);</span>

<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceExtensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate DeviceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">openXrDeviceExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">openXrDeviceExtensionNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">VkExtensionProperties</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">deviceExtensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">VkPhysicalDeviceFeatures</span><span class="w"> </span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">vkGetPhysicalDeviceFeatures</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">);</span>

<span class="w">    </span><span class="n">VkDeviceCreateInfo</span><span class="w"> </span><span class="n">deviceCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">queueCreateInfoCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pQueueCreateInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviceQueueCIs</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeDeviceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="w">    </span><span class="n">deviceCI</span><span class="p">.</span><span class="n">pEnabledFeatures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">features</span><span class="p">;</span>
<span class="w">    </span><span class="n">VULKAN_CHECK</span><span class="p">(</span><span class="n">vkCreateDevice</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deviceCI</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Device.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_Vulkan</span><span class="o">::~</span><span class="n">GraphicsAPI_Vulkan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">vkDestroyDevice</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">GraphicsAPI_Vulkan::LoadPFN_XrFunctions</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetVulkanGraphicsRequirementsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanInstanceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetVulkanInstanceExtensionsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanDeviceExtensionsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetVulkanDeviceExtensionsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetVulkanGraphicsDeviceKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetVulkanGraphicsDeviceKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetVulkanGraphicsDeviceKHR.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetInstanceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanInstanceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Instance Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GraphicsAPI_Vulkan</span><span class="o">::</span><span class="n">GetDeviceExtensionsForOpenXR</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">(</span><span class="n">extensionNamesSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetVulkanDeviceExtensionsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionNamesSize</span><span class="p">,</span><span class="w"> </span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to get Vulkan Device Extensions.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="nf">streamData</span><span class="p">(</span><span class="n">extensionNames</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">extension</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">streamData</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">extensions</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="openxr-api-layers">
<h2>6.3 OpenXR API Layers<a class="headerlink" href="#openxr-api-layers" title="Permalink to this heading">¶</a></h2>
<p>The OpenXR loader has a layer system that allows OpenXR API calls to pass through a number of optional layers, that add some functionality for the application. These are extremely useful for debugging.</p>
<p>The OpenXR SDK provides two API layers for us to use:
In the table below are the layer names and their associated libraries and .json files.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>XR_APILAYER_LUNARG_api_dump</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_api_dump.dll</span></code> or <code class="docutils literal notranslate"><span class="pre">.so</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_api_dump.json</span></code></p></td>
</tr>
<tr class="row-even"><td><p>XR_APILAYER_LUNARG_core_validation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_core_validation.dll</span></code> or <code class="docutils literal notranslate"><span class="pre">.so</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_core_validation.json</span></code></p></td>
</tr>
</tbody>
</table>
<p>XR_APILAYER_LUNARG_api_dump simply logs extra/verbose information to <code class="docutils literal notranslate"><span class="pre">std::cout</span></code> describing in more detail what has happened during that API call. XR_APILAYER_LUNARG_core_validation acts similarly to VK_LAYER_KHRONOS_validation in Vulkan, where the layer intercepts the API call and performs validation to ensure conformance with the specification.</p>
<p>Other runtimes and hardware vendors may provide layers that are useful for debugging your XR system and/or application.</p>
<p>To enable API layers, add the <code class="docutils literal notranslate"><span class="pre">XR_API_LAYER_PATH=&lt;path&gt;</span></code> environment variable to your project or your system. Something like this: <code class="docutils literal notranslate"><span class="pre">XR_API_LAYER_PATH=&lt;openxr_base&gt;/&lt;build_folder&gt;/src/api_layers/;&lt;another_path&gt;</span></code>.</p>
<p>The path must point to a folder containing a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file similar to the one for XR_APILAYER_LUNARG_core_validation, shown below:</p>
<p>This file points to the library that the loader should use for this API layer.</p>
<p>Calls to <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateApiLayerProperties.html">xrEnumerateApiLayerProperties</a> should now return a pointer to an array of structs and the count of all API layers available to the application.</p>
<dl class="simple">
<dt>To select which API layers we want to use, there are two ways to do this:</dt><dd><ol class="arabic simple">
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">XR_ENABLE_API_LAYERS=&lt;layer_name&gt;</span></code> environment variable to your project or your system. Something like this: <code class="docutils literal notranslate"><span class="pre">XR_ENABLE_API_LAYERS=XR_APILAYER_LUNARG_test1;XR_APILAYER_LUNARG_test2</span></code>.</p></li>
<li><p>When creating the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a>, specify the requested API layers in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a> structure.</p></li>
</ol>
</dd>
</dl>
<p>For more details, please see <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/main/src/api_layers/README.md">API Layers README</a> and see <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/loader.html#openxr-api-layers">OpenXR API Layers</a>.</p>
</section>
<section id="color-science">
<h2>6.4 Color Science<a class="headerlink" href="#color-science" title="Permalink to this heading">¶</a></h2>
<p>As OpenXR support both linear and sRGB color spaces for compositing. It is helpful to have a deeper knowledge of color science; especially if you are planning to use sRGB formats and have the OpenXR runtime/compositor do automatic conversions for you.</p>
<p>For more information on color spaces and gamma encoding, see J. Guy Davidson’s <a class="reference external" href="https://www.youtube.com/watch?v=_zQ_uBAHA4A">video presentation</a> on the subject.</p>
</section>
</section>


						</div>
					</div>
					<footer>

  <hr>

  <div role="contentinfo">
      <p>&#169; Copyright &#34;OpenXR&#34; and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom.
<p dir="auto">The OpenXR Tutorial is owned and operated by The Khronos Group Inc. Khronos <a href="https://www.khronos.org/legal/" rel="nofollow">Legal Notices</a>, <a href="https://www.khronos.org/legal/privacy" rel="nofollow">Privacy Policy</a>, and <a href="https://www.khronos.org/about/code-of-conduct" rel="nofollow">Code of Conduct</a> apply.</p></p>
  </div> 

</footer>
				</div>
			</div>
		</div>
	</div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>