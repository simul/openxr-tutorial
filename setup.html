<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>2. Setup &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="next" title="3. Graphics" href="graphics.html" >
	<link rel="prev" title="1. Introduction" href="introduction.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	function updatePlatform()
	{
		var platform = Cookies.get("platform")
		console.log("platform = " + platform);
		if (platform == "windows") {
			$(".linux").hide();
			$(".android").hide();
			$(".windows").show();
			$(".windows-linux").show();
		}
		if (platform == "linux") {
			$(".linux").show();
			$(".android").hide();
			$(".windows").hide();
			$(".windows-linux").show();
		}
		if (platform == "android") {
			$(".linux").hide();
			$(".android").show();
			$(".windows").hide();
			$(".windows-linux").hide();
		}
		window.updatePlatform=updatePlatform;
	}</script>
	<script >
	var platform = Cookies.get("platform")
	if (platform==undefined) {
	Cookies.set('platform', 'windows',{ expires: 365})
	platform='windows';
	}
	</script>
	<script defer src="_static/js/updatePlatform.js"></script>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
        @import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onload="updatePlatform();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="index.html"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrinstance-xrgetsystem">2.1. Creating an XrInstance / xrGetSystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xrinstance">2.1.1. XrInstance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrsystemid">2.1.2. XrSystemId</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-xrsession">2.2. Creating an XrSession</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polling-the-event-loop">2.3. Polling the Event Loop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="graphics.html">3. Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="actions.html">4. Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">5. Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenXR Tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Setup</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="setup">
<h1><span class="section-number">2. </span>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h1>
<p>Select your platform, as the instructions are different depending on your selection.</p>
<form>
	<fieldset>
		<div id='selectplatform'>
			<div id='selectwindows'>
				<label for="windows">Windows</label>
				<input type='radio' id='windows' name='type' value='windows' />
			</div>
			<div id='selectlinux'>
				<label for="linux">Linux</label>
				<input type='radio' id='linux' name='type' value='linux' />
			</div>
			<div id='selectandroid'>
				<label for="android">Android</label>
				<input type='radio' id='android' name='type' value='android' />
			</div>
		</div>
	</fieldset>
</form>
<script>
	var platform = Cookies.get('platform')
	var radiobtn = document.getElementById(platform);
	if (radiobtn)
		radiobtn.checked = true;
	$('input:radio').on('change', function ()
	{
		Cookies.set('platform', $(this).val(), { expires: 365 })
		updatePlatform();
	});
</script>
<div class="windows docutils container" id="windows-intro-1">
<p class="rubric">Windows</p>
<p>Showing instructions for Windows.</p>
</div>
<div class="linux docutils container" id="linux-intro-1">
<p class="rubric">Linux</p>
<p>Showing instructions for Linux.</p>
</div>
<div class="android docutils container" id="android-intro-1">
<p class="rubric">Android</p>
<p>Showing instructions for Android.</p>
</div>
<div class="windows docutils container" id="windows-id-1">
<p class="rubric">Windows</p>
<p>For the Windows OpenXR project, we’ll use CMake to create some project files for Visual Studio.
First, create a directory where the code will go, we’ll call this the <em>workspace</em> directory.</p>
</div>
<div class="linux docutils container" id="linux-id-1">
<p class="rubric">Linux</p>
<p>You are free to use any code editor and/or compiler; this tutorial will use Visual Studio Code.
For the Linux OpenXR project, we’ll use CMake alongside Visual Studio Code to build the project.
First, Create a directory where the code will go, we’ll call this the <em>workspace</em> directory. Open Visual Studio Code and from the File menu, select “Open Folder…”</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/linux-vscode-open-folder.png"><img alt="The File menu of Visual Studio Code is shown, with the command &quot;Open Folder...&quot; selected." src="_images/linux-vscode-open-folder.png" style="width: 391.05px; height: 234.3px;" /></a>
</figure>
<p>The File menu of Visual Studio Code, with the command “Open Folder…” selected</p>
<p>Select your <em>workspace</em> folder, which is now empty.
If you haven’t previously done so, install the CMake extension for Visual Studio Code.</p>
</div>
<div class="windows-linux docutils container" id="windows-linux-id-1">
<p class="rubric">Windows and Linux</p>
<p>Now, create a text file in the <em>workspace</em> folder called <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and in it, put the following code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.15</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">openxr-tutorial</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CONFIGURATION_TYPES</span><span class="w"> </span><span class="s2">&quot;Debug;Release&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">OPENXR_DIR</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">PATH</span><span class="w"> </span><span class="s2">&quot;Location of OpenXR-SDK repository.&quot;</span><span class="p">)</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">Chapter_2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let’s create a folder called Chapter_2, and in it create another <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.
This one contains the following code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">file</span><span class="p">(</span><span class="s">GLOB</span><span class="w"> </span><span class="s">SOURCES</span><span class="w"> </span><span class="s2">&quot;main.cpp&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">Chapter_2</span><span class="w"> </span><span class="o">${</span><span class="nv">SOURCES</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="w"> </span><span class="s">Chapter_2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">OPENXR_DIR</span><span class="o">}</span><span class="s">/include</span><span class="w"> </span><span class="p">)</span>
<span class="nb">target_link_directories</span><span class="p">(</span><span class="w"> </span><span class="s">Chapter_2</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">OPENXR_DIR</span><span class="o">}</span><span class="s">/build/src/loader/Debug</span><span class="w"> </span><span class="o">${</span><span class="nv">OPENXR_DIR</span><span class="o">}</span><span class="s">/build/src/loader/Release</span><span class="w"> </span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="w"> </span><span class="s">Chapter_2</span><span class="w"> </span><span class="s">openxr_loader</span><span class="o">$&lt;</span><span class="nv">$&lt;CONFIG:Debug</span><span class="o">&gt;</span><span class="s">:d&gt;</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
<p>That’s all we need for CMake, we need for this project.
Now, we’ll create our source file. Create a new text file called <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> in the Chapter2 directory.</p>
</div>
<div class="android docutils container" id="android-id-1">
<p class="rubric">Android</p>
<p>Here, We’ll show how to hand build an Android Studio project that runs a C++ Native Activity.
Open Android Studio, select New Project and choose an Empty Activity. Set the names and save location. The language can be ignored here as we are using C++, and we can set the Minimum SDK to API 24: Android 7.0(Nougat). Complete set up.</p>
<img alt="Android Studio - New Project - Empty Activity." class="align-right" src="_images/android-studio-newproject.png" />
<p class="rubric">CMake</p>
<p>With the Android Studio project now set up, we need to modify some of the files and folders so as to set up the project to support the C++ Native Activity.
Under the <code class="docutils literal notranslate"><span class="pre">app</span></code> folder, you can delete the <code class="docutils literal notranslate"><span class="pre">libs</span></code> folder, and under the <code class="docutils literal notranslate"><span class="pre">app/src</span></code> you can also delete the <code class="docutils literal notranslate"><span class="pre">androidTest</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> folders. Finally under <code class="docutils literal notranslate"><span class="pre">app/src/main</span></code>, delete the <code class="docutils literal notranslate"><span class="pre">java</span></code> folder and add a <code class="docutils literal notranslate"><span class="pre">cpp</span></code> folder. Under the <code class="docutils literal notranslate"><span class="pre">app/src/main/res</span></code>, delete the <code class="docutils literal notranslate"><span class="pre">values-night</span></code> and <code class="docutils literal notranslate"><span class="pre">xml</span></code> folders. Under the <code class="docutils literal notranslate"><span class="pre">values</span></code> modify <code class="docutils literal notranslate"><span class="pre">colors.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">styles.xml</span></code> as shown.</p>
<p class="rubric">colors.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimary&quot;</span><span class="nt">&gt;</span>#008577<span class="nt">&lt;/color&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimaryDark&quot;</span><span class="nt">&gt;</span>#00574B<span class="nt">&lt;/color&gt;</span>
<span class="w">    </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorAccent&quot;</span><span class="nt">&gt;</span>#D81B60<span class="nt">&lt;/color&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</pre></div>
</div>
<p class="rubric">styles.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;resources&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Base application theme. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;style</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AppTheme&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;Theme.AppCompat.Light.DarkActionBar&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Customize your theme here. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimary&quot;</span><span class="nt">&gt;</span>@color/colorPrimary<span class="nt">&lt;/item&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorPrimaryDark&quot;</span><span class="nt">&gt;</span>@color/colorPrimaryDark<span class="nt">&lt;/item&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;colorAccent&quot;</span><span class="nt">&gt;</span>@color/colorAccent<span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;/resources&gt;</span>
</pre></div>
</div>
<p>Within the <code class="docutils literal notranslate"><span class="pre">app/src/main/cpp</span></code> folder, create a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. We will use this file to specific how our Native C++ code will be built. This CMakeList will be invoked by Android Studio’s Gradle build system.</p>
<p class="rubric">CMakeLists.txt</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># For more information about using CMake with Android Studio, read the</span>
<span class="c"># documentation: https://d.android.com/studio/projects/add-native-code.html</span>

<span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.22.1</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;openxrtutorialch2_1&quot;</span><span class="p">)</span>

<span class="c"># native_app_glue</span>
<span class="nb">add_library</span><span class="p">(</span><span class="s">native_app_glue</span><span class="w"> </span><span class="s">STATIC</span><span class="w"> </span><span class="o">${</span><span class="nv">ANDROID_NDK</span><span class="o">}</span><span class="s">/sources/android/native_app_glue/android_native_app_glue.c</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">native_app_glue</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">ANDROID_NDK</span><span class="o">}</span><span class="s">/sources/android/native_app_glue</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_SHARED_LINKER_FLAGS</span><span class="w"> </span><span class="s2">&quot;${CMAKE_SHARED_LINKER_FLAGS} -u ANativeActivity_onCreate&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># export ANativeActivity_onCreate for java to call.</span>
<span class="nb">add_library</span><span class="p">(</span><span class="s">openxrtutorialch2_1</span><span class="w"> </span><span class="s">SHARED</span><span class="w"> </span><span class="s">../../../../../Chapter2.1/main.cpp</span><span class="p">)</span>

<span class="c"># import openxr_loader</span>
<span class="nb">add_library</span><span class="p">(</span><span class="s">openxr_loader</span><span class="w"> </span><span class="s">SHARED</span><span class="w"> </span><span class="s">IMPORTED</span><span class="p">)</span>
<span class="nb">set_target_properties</span><span class="p">(</span><span class="s">openxr_loader</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">IMPORTED_LOCATION</span><span class="w"> </span><span class="s2">&quot;../../../../../../thirdparty/openxr-sdk/android/libs/android.arm64-v8a/libopenxr_loader.so&quot;</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">openxrtutorialch2_1</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">../../../../../thirdparty/openxr-sdk/include</span><span class="p">)</span>

<span class="c"># vulkan - Found in the NDK</span>
<span class="nb">find_library</span><span class="p">(</span><span class="s">vulkan-lib</span><span class="w"> </span><span class="s">vulkan</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">openxrtutorialch2_1</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">ANDROID_NDK</span><span class="o">}</span><span class="s">/sources/third_party/vulkan/src/include</span><span class="p">)</span>

<span class="c"># log - Found in the NDK</span>
<span class="nb">find_library</span><span class="p">(</span><span class="s">log-lib</span><span class="w"> </span><span class="s">log</span><span class="p">)</span>

<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">openxrtutorialch2_1</span>
<span class="w">        </span><span class="s">android</span>
<span class="w">        </span><span class="s">native_app_glue</span>
<span class="w">        </span><span class="s">openxr_loader</span>
<span class="w">        </span><span class="o">${</span><span class="nv">vulkan-lib</span><span class="o">}</span>
<span class="w">        </span><span class="o">${</span><span class="nv">log-lib</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we set the minimum required cmake version, here we are using 3.22.1 and the project’s name. Next, we need to add a static library called native_app_glue. The native_app_glue library is compiled from a single source file <code class="docutils literal notranslate"><span class="pre">android_native_app_glue.c</span></code>. This interfaces between the Java Virtual Machine and our C++ code. Ultimately, it allows us to use the <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">android_main(struct</span> <span class="pre">android_app*)</span></code> entry point. We also include that directory as we need access to the android_native_app_glue.h header file. Next, we need to set the <code class="docutils literal notranslate"><span class="pre">CMAKE_SHARED_LINKER_FLAGS</span></code> so that <code class="docutils literal notranslate"><span class="pre">ANativeActivity_onCreate()</span></code> is exported for the Java Virtual Machine to call. Next, we add our shared library openxrtutorialch2 that houses our code. Here, I have a relative path to our single C++ file.</p>
<p>Now, we import the openxr_loader library. We need to do this, because it’s external to the NDK library, and won’t be automatically picked up. We call <code class="docutils literal notranslate"><span class="pre">set_target_properties()</span></code> to specific the location of <code class="docutils literal notranslate"><span class="pre">libopenxr_loader.so</span></code>. We also include the directory to the OpenXR headers. Next, we find the Vulkan library in the NDK and include the directory to the Android Vulkan headers. At this time, we also find the log library. Finally we link the android, native_app_glue, openxr_loader, vulkan and log libraries to our openxrtutorialch2 library. Our <code class="docutils literal notranslate"><span class="pre">libopenxrtutorialch2.so</span></code> will packageed inside our .apk along with any shared libraries that we have linked.</p>
<p class="rubric">AndroidManifest.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<span class="w">    </span><span class="na">package=</span><span class="s">&quot;com.simul.openxrtutorialch2_1&quot;</span>
<span class="w">    </span><span class="na">android:versionCode=</span><span class="s">&quot;1&quot;</span>
<span class="w">    </span><span class="na">android:versionName=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:allowBackup=</span><span class="s">&quot;false&quot;</span>
<span class="w">        </span><span class="na">android:fullBackupContent=</span><span class="s">&quot;false&quot;</span>
<span class="w">        </span><span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
<span class="w">        </span><span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
<span class="w">        </span><span class="na">android:hasCode=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;activity</span>
<span class="w">            </span><span class="na">android:name=</span><span class="s">&quot;android.app.NativeActivity&quot;</span>
<span class="w">            </span><span class="na">android:configChanges=</span><span class="s">&quot;orientation|keyboardHidden&quot;</span>
<span class="w">            </span><span class="na">android:debuggable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;meta-data</span>
<span class="w">                </span><span class="na">android:name=</span><span class="s">&quot;android.app.lib_name&quot;</span>
<span class="w">                </span><span class="na">android:value=</span><span class="s">&quot;openxrtutorialch2_1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">            </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;com.oculus.intent.category.VR&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/activity&gt;</span>
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</div>
<p>We now need to modify our <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> file to tell Android to run a Native Activity. We set <code class="docutils literal notranslate"><span class="pre">android:name</span></code> to “android.app.NativeActivity” and update <code class="docutils literal notranslate"><span class="pre">android:configChanges</span></code> to “orientation|keyboardHidden” to not close the activity on those changes. Next under the meta-data section, we set these values: <code class="docutils literal notranslate"><span class="pre">android:name</span></code> to “android.app.lib_name” and <code class="docutils literal notranslate"><span class="pre">android:value</span></code> to “openxrtutorialch2”, where <code class="docutils literal notranslate"><span class="pre">android:value</span></code> is name of the library we created in the CMakeLists, thus pointing our NativeActivity to the correct library.</p>
<p>For Meta devices, we need to set this <code class="docutils literal notranslate"><span class="pre">&lt;category</span> <span class="pre">android:name=&quot;com.oculus.intent.category.VR&quot;</span> <span class="pre">/&gt;</span></code> too.</p>
<p class="rubric">Gradle</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">apply</span><span class="w"> </span><span class="nl">plugin:</span><span class="w"> </span><span class="s1">&#39;com.android.application&#39;</span>

<span class="n">android</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">compileSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ndkVersion</span><span class="w"> </span><span class="s1">&#39;23.1.7779620&#39;</span>

<span class="w">    </span><span class="n">defaultConfig</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">applicationId</span><span class="w"> </span><span class="s2">&quot;com.simul.openxrtutorialch2_1&quot;</span>
<span class="w">        </span><span class="n">minSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="n">targetSdkVersion</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="n">versionCode</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">versionName</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="w">        </span><span class="n">ndk</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">abiFilters</span><span class="w"> </span><span class="s1">&#39;arm64-v8a&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">buildFeatures</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">prefab</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">buildTypes</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">release</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">minifyEnabled</span><span class="w"> </span><span class="kc">false</span>
<span class="w">            </span><span class="n">proguardFiles</span><span class="w"> </span><span class="n">getDefaultProguardFile</span><span class="o">(</span><span class="s1">&#39;proguard-android-optimize.txt&#39;</span><span class="o">),</span><span class="w"> </span><span class="s1">&#39;proguard-rules.pro&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="n">debug</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">jniDebuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">debuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">renderscriptDebuggable</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="n">minifyEnabled</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">externalNativeBuild</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">cmake</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">version</span><span class="w"> </span><span class="s1">&#39;3.22.1&#39;</span>
<span class="w">            </span><span class="n">path</span><span class="w"> </span><span class="s1">&#39;src/main/cpp/CMakeLists.txt&#39;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="n">fileTree</span><span class="o">(</span><span class="nl">dir:</span><span class="w"> </span><span class="s1">&#39;libs&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">include:</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;*.jar&#39;</span><span class="o">])</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;androidx.appcompat:appcompat:1.0.2&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;org.khronos.openxr:openxr_loader_for_android:1.0.27&#39;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, we can config our <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file in the <code class="docutils literal notranslate"><span class="pre">app</span></code> folder. First remove any references to Java, Kotlin and to testing. Next add in the <code class="docutils literal notranslate"><span class="pre">externalNativeBuild</span></code> section specifying CMake, its version and the location of the CMakeLists.txt that we created earlier. Also specify under the <code class="docutils literal notranslate"><span class="pre">ndk</span></code> section the <code class="docutils literal notranslate"><span class="pre">abiFilters</span></code>. We will just be using arm64-v8a in this tutorial. <code class="docutils literal notranslate"><span class="pre">ndkVersion</span></code> should also be specified.</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="c1">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
<span class="n">buildscript</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="o">{</span>
<span class="w">       </span><span class="n">google</span><span class="o">()</span>
<span class="w">       </span><span class="n">mavenCentral</span><span class="o">()</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">classpath</span><span class="w"> </span><span class="s1">&#39;com.android.tools.build:gradle:4.2.2&#39;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">allprojects</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">google</span><span class="o">()</span>
<span class="w">        </span><span class="n">mavenCentral</span><span class="o">()</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span><span class="w"> </span><span class="nf">clean</span><span class="o">(</span><span class="nl">type:</span><span class="w"> </span><span class="n">Delete</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">delete</span><span class="w"> </span><span class="n">rootProject</span><span class="o">.</span><span class="na">buildDir</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, we can config our <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file in the root folder of the project. This is a complete replacement the default one provided by Android Studio. This file stipulates the repositories and gradle version to be used.
The settings.gradle can be reduce to just: <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">':app'</span></code>, and in the <code class="docutils literal notranslate"><span class="pre">gradle.properties</span></code> we need to remove <code class="docutils literal notranslate"><span class="pre">kotlin.code.style=official</span></code> and <code class="docutils literal notranslate"><span class="pre">android.nonTransitiveRClass=true</span></code>.</p>
<p>With that completed, we should now be able to sync the Gradle file and build the project.</p>
<p>Now, we’ll create our source file. Create a new text file called <code class="docutils literal notranslate"><span class="pre">main.cpp</span></code> in the Chapter2 directory.
This file will be referenced in the CMakeLists file we created, so ensure the path is correct.</p>
</div>
<p>Now, that we have set up the project and source file. Open the source file and add the following code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// C Headers</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
</pre></div>
</div>
<p>This is boilerplate for the various platforms. Next, we’ll add the header files related to OpenXR:</p>
<div class="highlight-cpp notranslate" id="xr-headers"><div class="highlight"><pre><span></span><span class="c1">// OpenXR Headers</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;openxr/openxr.h&quot;</span>

<span class="c1">// #define XR_USE_GRAPHICS_API_D3D11</span>
<span class="c1">// #define XR_USE_GRAPHICS_API_D3D12</span>
<span class="c1">// #define XR_USE_GRAPHICS_API_OPENGL</span>
<span class="c1">// #define XR_USE_GRAPHICS_API_OPENGL_ES</span>
<span class="c1">// #define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="hll">
</span><span class="cp">#if defined(__ANDROID__)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;android_native_app_glue.h&quot;</span>
<span class="cp">#define XR_USE_PLATFORM_ANDROID</span>
<span class="cp">#endif</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;openxr/openxr_platform.h&quot;</span>
</pre></div>
</div>
<p>Here, we include the main OpenXR header file <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code> and the OpenXR platform header file <code class="docutils literal notranslate"><span class="pre">openxr_platform.h</span></code>.
For the OpenXR platform header file, note the preceding XR_USE_ macros. When enabled, we gain access to functionality that interact with the chosen graphics API and/or platform. We will enable one of these graphics ones later in the tutorial.
For Android, we include our <code class="docutils literal notranslate"><span class="pre">&quot;android_native_app_glue.h&quot;</span></code> header file as well as defining the <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_ANDROID</span></code> macro, which we will need to initialise the load the OpenXR loader.</p>
<p>Next, we’ll add the DEBUG_BREAK macro:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Debugbreak</span>
<span class="cp">#if defined(_MSC_VER)</span>
<span class="cp">#define DEBUG_BREAK __debugbreak()</span>
<span class="cp">#else</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="cp">#define DEBUG_BREAK raise(SIGTRAP)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>This defines the macro <code class="docutils literal notranslate"><span class="pre">DEBUG_BREAK</span></code>, according to which platform we’re building for. This macro will
stop execution of your program when an error occurs, so you can see where it happened and fix it.
We use this macro in the <code class="docutils literal notranslate"><span class="pre">OpenXRMessageCallbackFunction()</span></code> function, which we will discuss in <a class="reference internal" href="extensions.html"><span class="doc">Chapter 5.2.</span></a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define OPENXR_CHECK(x, y)                              \</span>
<span class="cp">  {                                                     \</span>
<span class="cp">    if (!XR_SUCCEEDED(x)) {                             \</span>
<span class="cp">      std::cout &lt;&lt; &quot;ERROR: OPENXR: &quot; &lt;&lt; y &lt;&lt; std::endl; \</span>
<span class="cp">    }                                                   \</span>
<span class="cp">  }</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">GetXRErrorString</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">xr_instance</span><span class="p">,</span><span class="w"> </span><span class="n">XrResult</span><span class="w"> </span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">XR_MAX_RESULT_STRING_SIZE</span><span class="p">];</span>
<span class="w">  </span><span class="n">xrResultToString</span><span class="p">(</span><span class="n">xr_instance</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsStringInVector</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">item</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">found</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">BitwiseCheck</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">checkValue</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">checkValue</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">checkValue</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This defines the macro <code class="docutils literal notranslate"><span class="pre">OPENXR_CHECK</span></code>. Many OpenXR functions return a <code class="docutils literal notranslate"><span class="pre">XrResult</span></code>. This macro will check if the call has failed and logs a message to stdout. This can be modified to suit your needs. There are three additional functions <code class="docutils literal notranslate"><span class="pre">GetXRErrorString()</span></code>, <code class="docutils literal notranslate"><span class="pre">IsStringInVector()</span></code> and <code class="docutils literal notranslate"><span class="pre">BitwiseCheck()</span></code>, which are just simple wrappers over commonly used code.</p>
<p>Now we will define the main class of the application. It’s just a stub for now, with an empty <code class="docutils literal notranslate"><span class="pre">Run()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial_Ch2_1</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial_Ch2_1</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial_Ch2_1</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Finally, let’s add the main function for the application. It will look slightly different, depending on your
chosen platform. We first create a ‘pseudo-main function’ called <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Main()</span></code>, in which we create an instance of our <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Ch2_1</span></code> class, and call the <a href="#id1"><span class="problematic" id="id2">``</span></a>Run()``method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">OpenXRTutorial_Main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2.1.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="n">OpenXRTutorial_Ch2_1</span><span class="w"> </span><span class="n">app</span><span class="p">;</span>
<span class="w">  </span><span class="n">app</span><span class="p">.</span><span class="n">Run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, we create the actual platform specific main function (our entry point to the application), which will call <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial_Main()</span></code>:</p>
<div class="windows-linux docutils container" id="id3">
<p class="rubric">Windows and Linux</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">OpenXRTutorial_Main</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="android docutils container" id="id4">
<p class="rubric">Android</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">android_main</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">android_app</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PFN_xrInitializeLoaderKHR</span><span class="w"> </span><span class="n">xrInitializeLoaderKHR</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">XR_NULL_HANDLE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrInitializeLoaderKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrInitializeLoaderKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">xrInitializeLoaderKHR</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="n">XrLoaderInitInfoAndroidKHR</span><span class="w"> </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">;</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_LOADER_INIT_INFO_ANDROID_KHR</span><span class="p">;</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">applicationVM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">vm</span><span class="p">;</span>
<span class="w">    </span><span class="n">loaderInitializeInfoAndroid</span><span class="p">.</span><span class="n">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="o">-&gt;</span><span class="n">activity</span><span class="o">-&gt;</span><span class="n">clazz</span><span class="p">;</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrInitializeLoaderKHR</span><span class="p">((</span><span class="n">XrLoaderInitInfoBaseHeaderKHR</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">loaderInitializeInfoAndroid</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to initialise Loader for Android.&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">OpenXRTutorial_Main</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Before we can use OpenXR for Android, we need to initialise the loader based the application’s context and virtual machine. We retrieve the function pointer to <code class="docutils literal notranslate"><span class="pre">xrInitializeLoaderKHR</span></code>, and with the <code class="docutils literal notranslate"><span class="pre">XrLoaderInitInfoAndroidKHR</span></code> filled out call that function to initialise OpenXR for our use.</p>
</div>
<div class="windows docutils container" id="id5">
<p class="rubric">Windows</p>
<p>Now launch CMake GUI, and point the “Where is the source code” box to the root of your solution <em>workspace</em> directory,
where your original <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> is located. Point the “Where to build the binaries” box to a subdirectory called <code class="docutils literal notranslate"><span class="pre">build</span></code>,
click Configure, “Yes” to create the build folder, and “OK” to accept the default Generator.</p>
<img alt="Select" class="align-right" src="_images/cmake-tutorial2-1.png" />
<p>Now, we must tell the tutorial project where to find the OpenXR-SDK, which we built in Section 1.
Click on the variable <code class="docutils literal notranslate"><span class="pre">OPENXR_DIR</span></code> and type in or browse to the location of the OpenXR-SDK repository you downloaded
previously, the click “Generate”. When the projects have been generated, open your new project, by clicking
“Open Project”, or by finding the file Tutorial.sln in your build folder and open it.</p>
</div>
<div class="linux docutils container" id="id6">
<p class="rubric">Linux</p>
<p>You now have three files, laid out as follow:</p>
<img alt="Select" class="align-right" src="_images/linux-vscode-initial-files.png" />
<p>Having installed the CMake extension for Visual Studio Code, you can now right-click on the main <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file (the one in the root <em>workspace</em> folder) and select “Configure All Projects”:</p>
<img alt="Select" class="align-right" src="_images/linux-vscode-cmake-configure.png" />
<p>Now the CMake panel will be available by clicking its icon on the leftmost panel. Hover your mouse over the “Project Outline”
and click the three dots at the right. An option to “Edit CMake Cache” will appear, click this and you’ll see the Cache Editor
page.</p>
<img alt="Select" class="align-right" src="_images/linux-vscode-cmake-more-actions.png" />
<img alt="Select" class="align-right" src="_images/linux-vscode-cmake-cache.png" />
<p>NOTE: It’s possible to use CMake GUI in Linux, but using Visual Studio Code’s integrated tools works better with Visual Studio Code.</p>
<p>In the CMake Cache editor, find <code class="docutils literal notranslate"><span class="pre">OPENXR_DIR</span></code> and enter the directory where you downloaded OpenXR-SDK in Chapter 1.
We can now select “Configure and Build All” from the right-click menu of the main <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
</div>
<div class="windows docutils container" id="id7">
<p class="rubric">Windows</p>
<p>You can now build and run your program. It should compile and link with no errors or warnings.</p>
</div>
<div class="linux docutils container" id="id8">
<p class="rubric">Linux</p>
<p>To enable debugging, select the Run/Debug panel in Visual Studio Code. You will now need to create a debugging configuration.
Click the “Gear” icon to edit the file launch.json, and enter the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cppdbg&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chapter_2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}/build/Chapter_2/Chapter_2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="s2">&quot;${workspaceFolder}/Chapter_2&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;externalConsole&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="android docutils container" id="id9">
<p>With all the source and build systems set up, we can now build the Android project. In upper right of Android Studio, you should find the toolbar below. Click the green hammer icon to build the project, if all is successful you should see “BUILD SUCCESSFUL in […]s” in the Build Output window.</p>
<p>Next to the green hammer icon is the Run/Debug configuration dropdown menu. If that isn’t populated, create a configuration called app.</p>
<p>Turn on and connect your Android device. Set up any requirments for USB debugging and adb. You device should appear in the dropdown. Here, I am using a Oculus Quest 2.</p>
<img alt="Build/Run Toolbar" class="align-center" src="android-studio-build-run-toolbar.png" />
<p>To debug/run the application click the green bug icon.</p>
</div>
<p>Now that we have a basic application up and running with the OpenXR header files and libraries, we can start to set up the core aspects of OpenXR. As a modern Khronos API, the OpenXR is heavily influcencd by the Vulkan API. So those who are familiar with the style of the Vulkan API will find OpenXR easy to follow.</p>
<section id="creating-an-xrinstance-xrgetsystem">
<h2><span class="section-number">2.1. </span>Creating an XrInstance / xrGetSystem<a class="headerlink" href="#creating-an-xrinstance-xrgetsystem" title="Permalink to this heading">¶</a></h2>
<section id="xrinstance">
<h3><span class="section-number">2.1.1. </span>XrInstance<a class="headerlink" href="#xrinstance" title="Permalink to this heading">¶</a></h3>
<p>Firstly, add to the <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial</span></code> class the methods: <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetInstanceProperties()</span></code>, <code class="docutils literal notranslate"><span class="pre">GetSystemID()</span></code> and <code class="docutils literal notranslate"><span class="pre">DestroyInstance()</span></code>. Update <code class="docutils literal notranslate"><span class="pre">OpenXRTutorial::Run()</span></code> to call those methods in that order and add to the class in a private section the following members.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OpenXRTutorial_Ch2_1</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">        </span><span class="o">~</span><span class="n">OpenXRTutorial</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">        </span><span class="n">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="n">CreateInstance</span><span class="p">();</span>

<span class="w">                </span><span class="n">GetInstanceProperties</span><span class="p">();</span>
<span class="w">                </span><span class="n">GetSystemID</span><span class="p">();</span>

<span class="w">                </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateInstance</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetInstanceProperties</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">GetSystemID</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">XrInstance</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">activeAPILayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instanceExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> is the foundational object that we need to create first. The <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> encompasses the application setup state, OpenXR API version and any layers and extensions. So inside the <code class="docutils literal notranslate"><span class="pre">CreateInstance()</span></code> method, we will first look at the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">plicationInfo</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">py</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">applicationName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Tutorial Chapter 2.1&quot;</span><span class="p">);</span>
<span class="n">pplicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">py</span><span class="p">(</span><span class="n">AI</span><span class="p">.</span><span class="n">engineName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OpenXR Engine&quot;</span><span class="p">);</span>
<span class="n">ngineVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">piVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_CURRENT_API_VERSION</span><span class="p">;</span>
</pre></div>
</div>
<p>This structure allows you specify both the name and the version for your application and engine. These members are solely for your use as the application developer. The main member here is the <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::apiVersion</span></code>. Here we use the <code class="docutils literal notranslate"><span class="pre">XR_CURRENT_API_VERSION</span></code> macro to specific the OpenXR version that we want to run. Also note here the use of <code class="docutils literal notranslate"><span class="pre">strcpy()</span></code> to set the applicationName and engineName. If you look at <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::applicationName</span></code> and <code class="docutils literal notranslate"><span class="pre">XrApplicationInfo::engineName</span></code> members, they are of type <code class="docutils literal notranslate"><span class="pre">char[]</span></code>, hence you must copy your string into that <code class="docutils literal notranslate"><span class="pre">char[]</span></code> and you must also by aware of the allowable length.</p>
<p>Similar to Vulkan, OpenXR allows applications to extend functionality past what is provided by the core specification. The functionality could be hardware/vendor specific. Most vital of course is which Graphics API to use with OpenXR. OpenXR supports D3D11, D3D12, Vulkan, OpenGL and OpenGL ES. Due the extensible nature of specification, it allows newer Graphics APIs and hardware functionality to be added with ease.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span><span class="p">);</span>

<span class="cp">#if defined(XR_USE_GRAPHICS_API_D3D11)</span>
<span class="w">      </span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_KHR_D3D11_ENABLE_EXTENSION_NAME</span><span class="p">);</span>
<span class="cp">#elif defined(XR_USE_GRAPHICS_API_D3D12)</span>
<span class="w">      </span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_KHR_D3D12_ENABLE_EXTENSION_NAME</span><span class="p">);</span>
<span class="cp">#elif defined(XR_USE_GRAPHICS_API_OPENGL)</span>
<span class="w">      </span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_KHR_OPENGL_ENABLE_EXTENSION_NAME</span><span class="p">);</span>
<span class="cp">#elif defined(XR_USE_GRAPHICS_API_OPENGL_ES)</span>
<span class="w">      </span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_KHR_OPENGL_ES_ENABLE_EXTENSION_NAME</span><span class="p">);</span>
<span class="cp">#elif defined(XR_USE_GRAPHICS_API_VULKAN)</span>
<span class="w">      </span><span class="n">instanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">XR_KHR_VULKAN_ENABLE_EXTENSION_NAME</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Here, we store in a <code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code> the extension names that we would like to use. <code class="docutils literal notranslate"><span class="pre">XR_EXT_DEBUG_UTILS_EXTENSION_NAME</span></code> is a macro of a string defined in <code class="docutils literal notranslate"><span class="pre">openxr.h</span></code>. The XR_EXT_debug_utils is extension that checks the validity of calls made to OpenXR, and can use a call back function to handle any raised errors. We will explore this extension more in <a class="reference internal" href="extensions.html"><span class="doc">Chapter 5.2.</span></a> Depending on which <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macro that you have defined, this code will add the relevant extension.</p>
<p>Not all API layers and extensions are available to use, so we much check which ones can use. We will use <code class="docutils literal notranslate"><span class="pre">xrEnumerateApiLayerProperties()</span></code> and <code class="docutils literal notranslate"><span class="pre">xrEnumerateInstanceExtensionProperties()</span></code> to check which ones the runtime can provide.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="mi">32</span><span class="n">_t</span><span class="w"> </span><span class="n">apiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrApiLayerProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">;</span>
<span class="n">XR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="n">ayerProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">);</span>
<span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">)</span>
<span class="n">iLayerProperty</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_API_LAYER_PROPERTIES</span><span class="p">;</span>
<span class="n">XR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateApiLayerProperties</span><span class="p">(</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apiLayerCount</span><span class="p">,</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate ApiLayerProperties.&quot;</span><span class="p">);</span>
<span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestLayer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="n">r</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">layerProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">apiLayerProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">layerProperty</span><span class="p">.</span><span class="n">layerName</span><span class="p">))</span>
<span class="w">  </span><span class="k">continue</span><span class="p">;</span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">activeAPILayers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestLayer</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">  </span><span class="k">break</span><span class="p">;</span>
<span class="p">}</span>


<span class="mi">32</span><span class="n">_t</span><span class="w"> </span><span class="n">extensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrExtensionProperties</span><span class="o">&gt;</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">;</span>
<span class="n">XR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="n">nsionProperties</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">extensionCount</span><span class="p">);</span>
<span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">)</span>
<span class="n">tensionProperty</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_EXTENSION_PROPERTIES</span><span class="p">;</span>
<span class="n">XR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate InstanceExtensionProperties.&quot;</span><span class="p">);</span>
<span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requestExtension</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instanceExtensions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="n">r</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">extensionProperty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">extensionProperties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">extensionProperty</span><span class="p">.</span><span class="n">extensionName</span><span class="p">))</span>
<span class="w">  </span><span class="k">continue</span><span class="p">;</span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">requestExtension</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">  </span><span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These functions are called twice. The first time is to get the count of the API layers or extensions and the second is to fill out the array of structures. Before the second call, we need set <code class="docutils literal notranslate"><span class="pre">XrApiLayerProperties::type</span></code> or <code class="docutils literal notranslate"><span class="pre">XrExtensionProperties::type</span></code> to the correct value, so that the second call can correctly fill out the data. After we have enumerated the API layers and extensions, we use a nested loop to check to see whether an API layers or extensions is availble and add it to the activeAPILayers and/or activeInstanceExtensions respectively. Note the activeAPILayers and activeInstanceExtensions are of type <code class="docutils literal notranslate"><span class="pre">std::vector&lt;const</span> <span class="pre">char</span> <span class="pre">*&gt;</span></code>. This will help us when fill out the next structure <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">stanceCreateInfo</span><span class="w"> </span><span class="n">instanceCI</span><span class="p">;</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_INSTANCE_CREATE_INFO</span><span class="p">;</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">applicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AI</span><span class="p">;</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">enabledApiLayerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeAPILayers</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">enabledApiLayerNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeAPILayers</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">enabledExtensionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">anceCI</span><span class="p">.</span><span class="n">enabledExtensionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeInstanceExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="n">XR_CHECK</span><span class="p">(</span><span class="n">xrCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This section is fairly simple, as we now just collect data from before and assign them to members in the <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> structure. Finally, we get to call <code class="docutils literal notranslate"><span class="pre">xrCreateInstance()</span></code> where we take pointers to the stack <code class="docutils literal notranslate"><span class="pre">XrInstanceCreateInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> objects. If the function succeeded, the result will be <code class="docutils literal notranslate"><span class="pre">XR_SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> will be non-null.</p>
<p>At the end of the application, we should destroy the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>. This is simple done with the function <code class="docutils literal notranslate"><span class="pre">xrDestroyInstance()</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">id</span><span class="w"> </span><span class="n">DestroyInstance</span><span class="p">()</span>

<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroyInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Instance.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Whilst we have an <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code>, let’s check its properties. We fill out the type and next members of the structure <code class="docutils literal notranslate"><span class="pre">XrInstanceProperties</span></code> and pass it along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetInstanceProperties()</span></code>. This function will fill out the rest of that structure for us to use. Here, we simply log to stdout the runtime’s name, and with the use of the <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MAJOR</span></code>, <code class="docutils literal notranslate"><span class="pre">XR_VERSION_MINOR</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_VERSION_PATCH</span></code> macros, we parse and log the runtime version.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">id</span><span class="w"> </span><span class="nf">GetInstanceProperties</span><span class="p">()</span>

<span class="n">XrInstanceProperties</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">;</span>
<span class="n">instanceProperties</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_INSTANCE_PROPERTIES</span><span class="p">;</span>
<span class="n">instanceProperties</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProperties</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instanceProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProperties.&quot;</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;OpenXR Runtime: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">XR_VERSION_PATCH</span><span class="p">(</span><span class="n">instanceProperties</span><span class="p">.</span><span class="n">runtimeVersion</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="xrsystemid">
<h3><span class="section-number">2.1.2. </span>XrSystemId<a class="headerlink" href="#xrsystemid" title="Permalink to this heading">¶</a></h3>
<p>The next object that we want to get is the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>. OpenXR ‘separates the concept of physical systems of XR devices from the logical objects that applications interact with directly. A system represents a collection of related devices in the runtime, often made up of several individual hardware components working together to enable XR experiences’.
<a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/html/xrspec.html#system">OpenXR Specification 5. System</a>.</p>
<p>So, a <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> could represent VR headset and a pair of contollers, or perhaps mobile device with video pass-through for AR. So we need to decide what type of <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code> we are wanting to use, as some runtimes support multiple form factors. Here, we are selecting <code class="docutils literal notranslate"><span class="pre">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span></code> for a Meta Quest or Pico Neo. OpenXR currently offers two option for the <code class="docutils literal notranslate"><span class="pre">XrFormFactor</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">XrFormFactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_HANDHELD_DISPLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">XR_FORM_FACTOR_MAX_ENUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrFormFactor</span><span class="p">;</span>
</pre></div>
</div>
<p>We fill out the <code class="docutils literal notranslate"><span class="pre">XrSystemGetInfo</span></code> structure as desired and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and a pointer to the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetSystem()</span></code>. If successful, we should now have a non-null <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">id</span><span class="w"> </span><span class="nf">GetSystemID</span><span class="p">()</span>

<span class="n">XrSystemGetInfo</span><span class="w"> </span><span class="n">systemGI</span><span class="p">;</span>
<span class="n">systemGI</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_SYSTEM_GET_INFO</span><span class="p">;</span>
<span class="n">systemGI</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">systemGI</span><span class="p">.</span><span class="n">formFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_FORM_FACTOR_HEAD_MOUNTED_DISPLAY</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystem</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemGI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemID</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemID.&quot;</span><span class="p">);</span>

<span class="n">XrSystemProperties</span><span class="w"> </span><span class="n">systemProperties</span><span class="p">;</span>
<span class="n">systemProperties</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_TYPE_SYSTEM_PROPERTIES</span><span class="p">;</span>
<span class="n">systemProperties</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetSystemProperties</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">systemID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">systemProperties</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get SystemProperties.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>We can now also get the system’s properties. We partially fill out a <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure and pass it as a pointer along with the <code class="docutils literal notranslate"><span class="pre">XrInstance</span></code> and the <code class="docutils literal notranslate"><span class="pre">XrSystemId</span></code> to <code class="docutils literal notranslate"><span class="pre">xrGetSystemProperties()</span></code>. This function will fill out the rest of the <code class="docutils literal notranslate"><span class="pre">XrSystemProperties</span></code> structure; detailing the vendor’s ID, system’s name and the system’s graphics and tracking properties.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemGraphicsProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageHeight</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxSwapchainImageWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">maxLayerCount</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemGraphicsProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemTrackingProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">orientationTracking</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrBool32</span><span class="w">    </span><span class="n">positionTracking</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemTrackingProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">XrSystemProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XrStructureType</span><span class="w">               </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">XR_MAY_ALIAS</span><span class="w">            </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemId</span><span class="w">                    </span><span class="n">systemId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">                      </span><span class="n">vendorId</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w">                          </span><span class="n">systemName</span><span class="p">[</span><span class="n">XR_MAX_SYSTEM_NAME_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XrSystemGraphicsProperties</span><span class="w">    </span><span class="n">graphicsProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrSystemTrackingProperties</span><span class="w">    </span><span class="n">trackingProperties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">XrSystemProperties</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-an-xrsession">
<h2><span class="section-number">2.2. </span>Creating an XrSession<a class="headerlink" href="#creating-an-xrsession" title="Permalink to this heading">¶</a></h2>
<p>2.2. Creating an XrSession (xrCreateSession, OpenGL based for code brevity)</p>
</section>
<section id="polling-the-event-loop">
<h2><span class="section-number">2.3. </span>Polling the Event Loop<a class="headerlink" href="#polling-the-event-loop" title="Permalink to this heading">¶</a></h2>
<p>2.3. Polling the Event Loop (xrPollEvent and Session States)</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="1. Introduction" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="graphics.html" class="btn btn-neutral float-right" title="3. Graphics" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>&#169; Copyright &#34;OpenXR&#34; and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom.</p>
  </div> 

</footer>
        </div>
      </div>
    </div>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>