<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
	<meta charset="utf-8"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="OpenXR Tutorial: Next Steps" name="description" />
<meta content="khronos, openxr, tutorial, multithreading, multiview, xr" name="keywords" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>6 Next Steps &mdash; OpenXR Tutorial  documentation</title>
	<link rel="stylesheet" href="_static/pygments.css" type="text/css">
	<link rel="stylesheet" href="_static/css/theme.css" type="text/css">
	<link rel="stylesheet" href="_static/copybutton.css" type="text/css">
	<link rel="shortcut icon" href="_static/favicon.ico">
	<link rel="canonical" href="https://openxr-tutorial.simul.co/6-next-steps.html" >
	<!--[if lt IE 9]>
	  <script src="_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
	<script src="_static/jquery.js"></script>
	<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
	<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
	<script src="_static/doctools.js"></script>
	<script src="_static/sphinx_highlight.js"></script>
	<script src="_static/clipboard.min.js"></script>
	<script src="_static/copybutton.js"></script>
	<script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
	<script src="_static/js/theme.js"></script>
	<link rel="index" title="Index" href="genindex.html" >
	<link rel="search" title="Search" href="search.html" >
	<link rel="prev" title="5 Extensions" href="5-extensions.html" > 
	<script  src="_static/js/js.cookie.min.js"></script>
	<script >
	var currentPlatform="all";
	var currentAPI="all";
	function setPlatform(pl)
	{
		currentPlatform=pl;
		if(navigator.cookieEnabled)
			Cookies.set('platform', pl, { expires: 365,sameSite: "strict"});
	}
	function setGraphicsAPI(a)
	{
		currentAPI=a;
		if(navigator.cookieEnabled)
			Cookies.set('graphicsapi', a, { expires: 365,sameSite: "strict"});
	}
	function getPlatform()
	{
		if(currentPlatform=="all"&&navigator.cookieEnabled)
		{
			currentPlatform=Cookies.get("platform");
			if (typeof currentPlatform == 'undefined')
			{
				currentPlatform = "windows"; // Default if cookies are enabled.
			//	console.log("getPlatform() defaulted to: "+currentPlatform);
			}
			//else
			//	console.log("getPlatform() from cookie: "+currentPlatform);
		}
		//console.log("getPlatform() returned: "+currentPlatform);
		return currentPlatform;
	}
	function getGraphicsAPI()
	{
		if(currentAPI=="all"&&navigator.cookieEnabled)
		{
			currentAPI=Cookies.get("graphicsapi");
			if (typeof currentAPI == 'undefined')
			{
				currentAPI = "vulkan"; // Default if cookies are enabled.
				//console.log("getGraphicsAPI() defaulted to: "+currentAPI);
			}
			//else
			//	console.log("getGraphicsAPI() from cookie: "+currentAPI);
		}
		//console.log("getGraphicsAPI() returned: "+currentAPI);
		return currentAPI;
	}


	//https://stackoverflow.com/questions/8562613/how-to-add-url-parameter-to-the-current-url
	function addUrlParameter(addr,name, value)
	{
		//console.log("add url parameter to : "+addr)
		url=new URL(addr);
		url.searchParams.set(name,value);
		return url.toString();
	}

	function getUrlParameter(name)
	{
		const urlParams = new URLSearchParams(window.location.search);
		return urlParams.get(name);
	}

	function getUrlParameterWithCheck(name, checkValues, defaultValue)
	{
		const urlParameter = getUrlParameter(name);
		ok = false;
		for (i = 0; i < checkValues.length; i++)
		{
			ok |= (urlParameter == checkValues[i]);
		}
		return ok ? urlParameter : defaultValue;
	}

	function updatePlatformFromURL()
	{
		var platform = getUrlParameterWithCheck('platform', ['windows', 'linux', 'android'], getPlatform());
		if (typeof platform == 'undefined')
		{
			platform = "linux"; // Set default here.
		}
		setPlatform(platform);
		updatePlatform();
	}

	function updatePlatformFromTab()
	{
		var platform = getPlatform();
		if (typeof platform == 'undefined')
		{
			platform = "linux"; // Set default here.
		}
		setPlatform(platform);
		updatePlatform();
	}

	function updatePlatform()
	{
		var platform = getPlatform();
		console.log('updatePlatform() = ' + platform);
		$(".linux").hide();
		$(".android").hide();
		$(".windows").hide();
		if (platform == "windows"||platform == "all")
		{
		$(".windows").show();
			$(".selectd3d11").removeAttr("disabled");
			$(".selectd3d12").removeAttr("disabled");
			$(".selectopengles").attr("disabled", true);
			$(".selectvulkan").removeAttr("disabled");
			$(".selectopengl").removeAttr("disabled");
		}
		if (platform == "linux"||platform == "all")
		{
			$(".linux").show();
			$(".selectd3d11").attr("disabled", true);
			$(".selectd3d12").attr("disabled", true);
			$(".selectopengles").attr("disabled", true);
			$(".selectvulkan").removeAttr("disabled");
			$(".selectopengl").removeAttr("disabled");
		}
		if (platform == "android"||platform == "all")
		{
			//console.log("platform  " + platform + ".");
			$(".android").show();
			$(".selectd3d11").attr("disabled", true);
			$(".selectd3d12").attr("disabled", true);
			$(".selectopengles").removeAttr("disabled");
			$(".selectvulkan").removeAttr("disabled");
			$(".selectopengl").attr("disabled", true);
		}
		var oldelements = document.querySelectorAll(".selected-platform");
		while (oldelements.length > 0)
		{
			var el=oldelements.item(0);
			el.classList.remove('selected-platform');
			////console.log("Removing selected-platform from "+el.id);
			oldelements = document.querySelectorAll(".selected-platform");
		}
		var element = document.getElementById('select' + platform);
		if(element)
		{
			element.classList.add('selected-platform');
		////console.log("Adding selected-platform to "+element.id);
		}
		var element2 = document.getElementById('select' + platform + "-inline");
		if(element2)
		{
			element2.classList.add('selected-platform');
		////console.log("Adding selected-platform to "+element2.id);
		}
		if(limitAPIChoice())
			updateGraphicsAPI();
		window.updatePlatform=updatePlatform;
	}

	function limitAPIChoice()
	{
		var platform = getPlatform();
		var graphicsApi = getGraphicsAPI();
		////console.log("limitAPIChoice(), platform = " + platform+", graphicsApi = "+graphicsApi);
		window.limitAPIChoice=limitAPIChoice;
		var newApi=graphicsApi;
		if (platform == "windows")
		{
			if (graphicsApi == "opengles"||graphicsApi==undefined)
			newApi="d3d11";
		}
		if (platform == "linux")
		{
			if (graphicsApi == "opengles"||graphicsApi=="d3d11"||graphicsApi=="d3d12"||graphicsApi==undefined)
			newApi="vulkan";
		}
		if (platform == "android"||graphicsApi==undefined)
		{
			if (graphicsApi != "opengles"&&graphicsApi!="vulkan")
			newApi="vulkan";
		}
		////console.log("newApi = "+newApi);
		if (newApi != graphicsApi)
		{
			////console.log("setting graphicsapi = "+newApi);
			setGraphicsAPI(newApi);
			graphicsApi=newApi;
			return true;
		}
		return false;
	}
	function makeLinksOpenInNewWindow()
	{
		////console.log("makeLinksOpenInNewWindow ");
		var download_hrefs = document.getElementsByClassName('reference download internal');
		[].forEach.call(download_hrefs, function(el) {
			el.setAttribute('target', "_blank");
			////console.log("Adding target blank to "+el.id);
		});
		link_hrefs = document.getElementsByClassName('reference external');
		[].forEach.call(link_hrefs, function(el) {
			// ONLY if it's really an external link, i.e. it contains "http:" or "https:"
			if(el.getAttribute('href').includes("://")) {
				console.log(el.getAttribute('href')+" includes ://");
				el.setAttribute('target', "_blank");
			}
			else {
			}
			////console.log("Adding target blank to "+el.id);
		});
		window.makeLinksOpenInNewWindow=makeLinksOpenInNewWindow;
	}
	function initDropdownLinks()
	{
		//console.log("initDropdownLinks ");
		var platform_api_links = document.getElementsByClassName('dropdown-platform-api');
		//let pattern = new RegExp("\/[windows|linux|android]\/[d3d11|d3d12|vulkan|opengl|opengles]\/","gm");
		let pattern = new RegExp("(windows|linux|android)\/(d3d11|d3d12|vulkan|opengles|opengl)","gm");
		let root_pattern = new RegExp("(.*)\/([a-z0-9A-Z_]+\.html)","gm");
		[].forEach.call(platform_api_links, function(el) {
			href=window.location.href;
			//console.log("href "+href);
			platform_api=el.id.replace('-','/');
			//console.log("platform_api "+platform_api);
			if(href.match(pattern)==null)
			{
				href=href.replace(root_pattern,"$1/"+platform_api+"/$2");
			}
			else
			{
				href=href.replace(pattern, platform_api);
			}
			//console.log("-> href "+href);
			el.href=href;
			////console.log("Adding target blank to "+el.id);
		});
		window.initDropdownLinks=initDropdownLinks;
	}
	function addIconsToToctree()
	{
		var toctreeheadings = document.getElementsByClassName('toctree-l1');
		var i = 0;
		const heading_ids = ["toc_introduction", "toc_setup", "toc_graphics","toc_interactions","toc_extensions","toc_nextsteps"];
		const heading_anchors = ["introduction", "openxr-setup", "graphics","interactions","extensions","nextsteps"];
		[].forEach.call(toctreeheadings, function(el) {
			if(i<6) {
				el.id =heading_ids[i];
				el.classList.add('toctree-sidepanel');
				el.children[0].href=el.children[0].href.replace('#','')+"#"+heading_anchors[i];
			}
			i++;
		});
	}
	function updatedToctreeURLs()
	{
		var toctreeheadings = document.getElementsByClassName('toctree-l1');
		[].forEach.call(toctreeheadings, function(el)
		{
			el.children[0].href = "/windows/opengl/" + el.children[0].href;
		});
	}
	function copyLinkToThisPage()
	{
		var graphicsapi =getGraphicsAPI();
		var platform	=getPlatform();
		var url			=window.location.href;
		url				=addUrlParameter(url,"platform",platform);
		url				=addUrlParameter(url,"graphicsapi",graphicsapi);
		navigator.clipboard.writeText(url);
		var dlg = document.getElementById("copied-link-dialog");
		document.getElementById("copied-link-text").innerHTML  = "Copied:<br>" + url + "<br>to the clipboard.";
		dlg.style.visibility = 'visible';
		var sharepagetooltip = document.getElementById('share-page-tooltiptext');
		//sharepagetooltip.style.opacity = 0;
		setTimeout(() =>
		{
		const dlg = document.getElementById("copied-link-dialog");
		dlg.style.visibility = 'hidden';
		}, 2500);

	// Alert the copied text
	//alert("Copied the link: " + url+" to the clipboard.");
	}
	function updateGraphicsAPIFromURL()
	{
		var graphicsApi = getUrlParameterWithCheck('graphicsapi', ['d3d11', 'd3d12', 'opengl', 'opengles', 'vulkan'], getGraphicsAPI());
		setGraphicsAPI(graphicsApi);
		updateGraphicsAPI();
	}

	function updateGraphicsAPIFromTab()
	{
		var graphicsApi = getGraphicsAPI();
		if (typeof graphicsApi == 'undefined')
		{
			graphicsApi = "vulkan"; // Set default here.
		}
		setGraphicsAPI(graphicsApi);
		updateGraphicsAPI();
	}

	function updateGraphicsAPI()
	{
		var graphicsApi = getGraphicsAPI();
		//console.log('updateGraphicsAPI() = ' + graphicsApi);

		// first, hide all the api's
		$(".d3d11").hide();
		$(".d3d12").hide();
		$(".opengl").hide();
		$(".opengles").hide();
		$(".vulkan").hide();
		// Now, show the wanted api's. In this way, divs with more than one will be shown, even if they have one that is hidden.
		if (graphicsApi == "d3d11"||graphicsApi == "all") {
		$(".d3d11").show();
		}
		if (graphicsApi == "d3d12"||graphicsApi == "all") {
		$(".d3d12").show();
		}
		if (graphicsApi == "opengl"||graphicsApi == "all") {
		$(".opengl").show();
		}
		if (graphicsApi == "opengles"||graphicsApi == "all") {
		$(".opengles").show();
		}
		if (graphicsApi == "vulkan"||graphicsApi == "all") {
		$(".vulkan").show();
		}
			var oldelements = document.querySelectorAll(".selected-graphics-api");
			////console.log("selected-platform on "+oldelements.length+" elements.");
			while (oldelements.length > 0)
			{
				var el=oldelements.item(0);
				el.classList.remove('selected-graphics-api');
				////console.log("Removing selected-graphics-api from "+el.id);
				oldelements = document.querySelectorAll(".selected-graphics-api");
			}
			var element = document.getElementById('select' + graphicsApi);
			if(element)
			{
				element.classList.add('selected-graphics-api');
			}
			var element2 = document.getElementById('select' + graphicsApi +"-inline");
			if (element2)
			{
				element2.classList.add('selected-graphics-api');
			}
			window.updateGraphicsAPI=updateGraphicsAPI;
		}</script>
		<script >
		var graphicsApi = getGraphicsAPI();
		if (graphicsApi==undefined) {
			setGraphicsAPI(a);
			graphicsApi='vulkan';
		}
	</script>
	<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
	@import url('https://fonts.cdnfonts.com/css/menlo');
	</style>
</head>

<body class="wy-body-for-nav" onpageshow="updatePlatformFromURL(); updateGraphicsAPIFromURL();initDropdownLinks()" onload="makeLinksOpenInNewWindow(); addIconsToToctree(); updatedToctreeURLs();"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
			<a href="/"  class="" >
				<img src="_static/OpenXR_170px_Feb17.png" class="logo" alt="The OpenXR logo" >
				
				<span class="sidebartitle">
					Tutorial
				</span>
				
			</a>
<div role="search">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
        <label class="search-label" for="q">Search the tutorial</label>
        <input type="text" name="q" id="q" placeholder="Search..." aria-label="Search docs">
        <input type="hidden" name="check_keywords" value="yes">
        <input type="hidden" name="area" value="default">
    </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-setup.html">2 OpenXR Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-graphics.html">3 Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-actions.html">4 Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-extensions.html">5 Extensions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6 Next Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#multiview-rendering">6.1 Multiview rendering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cmake-and-downloads">6.1.1 CMake and Downloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-main-cpp">6.1.2 Update Main.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphicsapi-and-multiview">6.1.3 GraphicsAPI and Multiview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#graphics-api">6.2 Graphics API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openxr-api-layers">6.3 OpenXR API Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#color-science">6.4 Color Science</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multithreaded-rendering">6.5 Multithreaded Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">6.6 Conclusion</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

	<div data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
			<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
			<a href="index.html">OpenXR Tutorial</a>
		</nav>

		<div class="sticky-breadcrumb-ribbon" role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">6 Next Steps</li>
	  <li class="wy-breadcrumbs-aside">
		  ﻿

<div class="platform-api-dropdown">
  <span>Windows/OpenGL</span>
  <div class="platform-api-dropdown-content">
    <ul>
      <li><a class="dropdown-platform-api" id="android-opengles" href="#">Android OpenGL ES</a></li>
      <li><a class="dropdown-platform-api" id="android-vulkan" href="#">Android Vulkan</a></li>
      <li><a class="dropdown-platform-api" id="linux-opengl" href="#">Linux OpenGL</a></li>
      <li><a class="dropdown-platform-api" id="linux-vulkan" href="#">Linux Vulkan</a></li>
      <li><a class="dropdown-platform-api" id="windows-d3d11" href="#">Windows D3D11</a></li>
      <li><a class="dropdown-platform-api" id="windows-d3d12" href="#">Windows D3D12</a></li>
      <li><a class="dropdown-platform-api" id="windows-opengl" href="#">Windows OpenGL</a></li>
      <li><a class="dropdown-platform-api" id="windows-vulkan" href="#">Windows Vulkan</a></li>
    </ul>
  </div>
</div>



<script>
	function choosePlatform(platformName)
	{
		setPlatform(platformName);
		updatePlatformFromTab();
	};
</script>

<script>
	function chooseGraphicsAPI(graphicsApiName)
	{
		setGraphicsAPI(graphicsApiName);
		updateGraphicsAPIFromTab();
		limitAPIChoice();
	};
</script>
	  </li>
  </ul>
</div>
		<div class="wy-nav-content">
				<div class="rst-content">
					<div class="share-page-container">
						<button class="share-this-page" id='share-this-page' onclick="copyLinkToThisPage()">
							<img class="api-tab-img" src="_static/css/icons/share_FILL0_wght400_GRAD0_opsz24.svg" alt="Copy link to this page" />
						</button>
						<div id="copied-link-dialog">
							<p id="copied-link-text"></p>
						</div>
						<div id="share-page-tooltiptext">Copy link to this page</div>
</div>
				<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
					<div itemprop="articleBody">
						
  <section id="next-steps">
<h1>6 Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">¶</a></h1>
<p>So far, you’ve learned how to create a basic OpenXR application: how to initialize and shut down an OpenXR instance and session, how to connect a graphics API to receive rendering events, and how to poll your runtime for interactions. The next steps are up to you but in these chapter you’ll find a few suggestions.</p>
<section id="multiview-rendering">
<h2>6.1 Multiview rendering<a class="headerlink" href="#multiview-rendering" title="Permalink to this heading">¶</a></h2>
<p>Stereoscopic rendering usually involves drawing two very similar views of the same scene, with only a slight difference in perspective due to the separation of the left and right eye positions. Multiview rendering provides a great saving, particularly of CPU time, as we can use just one set of draw calls to render both views. The benefits can also extend to the GPU, depending on the implementation. In certain cases, it’s possible that the Input Assembler only needs to be invoked once for all views, instead of repeating non-view dependent work redundantly.</p>
<p>OpenGL and OpenGL ES support rendering to both eye views with multiview - see <a class="reference external" href="https://registry.khronos.org/OpenGL/extensions/OVR/OVR_multiview.txt">OpenGL and OpenGL ES Multiview</a>.</p>
<p>Multiview or View Instancing can be used for stereo rendering by creating one <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchain.html">XrSwapchain</a> that contains two array images.</p>
<section id="cmake-and-downloads">
<h3>6.1.1 CMake and Downloads<a class="headerlink" href="#cmake-and-downloads" title="Permalink to this heading">¶</a></h3>
<p>This chapter is based on the code from chapter 4. So, Create a <code class="docutils literal notranslate"><span class="pre">Chapter6</span></code> folder in the <em>workspace</em> directory and copy across the contents of your <code class="docutils literal notranslate"><span class="pre">Chapter4</span></code> folder.</p>
<p>In the <em>workspace</em> directory, update the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> by adding the following CMake code to the end of the file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">Chapter6</span><span class="p">)</span>
</pre></div>
</div>
<p>There are some changes in Chapter 6 to the implementation of <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code>. Update the <code class="docutils literal notranslate"><span class="pre">Common</span></code> folder with the zip archive below.</p>
<p><a class="reference external" href="https://github.com/KhronosGroup/OpenXR-Tutorials/releases/download/v0.0.0/Chapter6_1_Multiview_Common_OpenGL.zip">Chapter6_1_Multiview_Common_OpenGL.zip</a></p>
<p>For multiview there are some changes to the shaders. Create a new <code class="docutils literal notranslate"><span class="pre">ShaderMultiview</span></code> folder in the <em>workspace</em> directory and download the new shaders.</p>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="_downloads/520083d5ac5d8af51e6b6f7cc36d0b7e/VertexShader_GL_MV.glsl"><code class="xref download docutils literal notranslate"><span class="pre">ShadersMultiview/VertexShader_GL_MV.glsl</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="_downloads/4e1db663b7b5346bc017ed65189054da/PixelShader_GL_MV.glsl"><code class="xref download docutils literal notranslate"><span class="pre">ShadersMultiview/PixelShader_GL_MV.glsl</span></code></a></p></li>
</ul>
<p>Update the <code class="docutils literal notranslate"><span class="pre">Chapter6/CMakeLists.txt</span></code> as follows. First, we update the project name:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.22.1</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">PROJECT_NAME</span><span class="w"> </span><span class="s">OpenXRTutorialChapter6</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;${PROJECT_NAME}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we update the shaders file paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">GL_SHADERS</span>
<span class="w">    </span><span class="s2">&quot;../ShadersMultiview/VertexShader_GL_MV.glsl&quot;</span>
<span class="w">    </span><span class="s2">&quot;../ShadersMultiview/PixelShader_GL_MV.glsl&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Just after where we link the <code class="docutils literal notranslate"><span class="pre">openxr_loader</span></code>, we add in the <code class="docutils literal notranslate"><span class="pre">XR_TUTORIAL_ENABLE_MULTIVIEW</span></code> definition to enable multiview in <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_compile_definitions</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">XR_TUTORIAL_ENABLE_MULTIVIEW</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we update the CMake section where we compile the shaders:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># OpenGL GLSL</span>
<span class="nb">set</span><span class="p">(</span><span class="s">SHADER_DEST</span><span class="w"> </span><span class="s2">&quot;${CMAKE_CURRENT_BINARY_DIR}&quot;</span><span class="p">)</span>
<span class="nb">foreach</span><span class="p">(</span><span class="s">FILE</span><span class="w"> </span><span class="o">${</span><span class="nv">GL_SHADERS</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">get_filename_component</span><span class="p">(</span><span class="s">FILE_WE</span><span class="w"> </span><span class="o">${</span><span class="nv">FILE</span><span class="o">}</span><span class="w"> </span><span class="s">NAME_WE</span><span class="p">)</span>
<span class="w">    </span><span class="nb">add_custom_command</span><span class="p">(</span>
<span class="w">        </span><span class="s">OUTPUT</span><span class="w"> </span><span class="s2">&quot;${SHADER_DEST}/${FILE_WE}.glsl&quot;</span>
<span class="w">        </span><span class="s">COMMAND</span><span class="w"> </span>
<span class="w">            </span><span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span><span class="w"> </span><span class="s">-E</span><span class="w"> </span><span class="s">copy</span><span class="w"> </span>
<span class="w">            </span><span class="s2">&quot;${CMAKE_CURRENT_SOURCE_DIR}/${FILE}&quot;</span>
<span class="w">            </span><span class="s2">&quot;${SHADER_DEST}/${FILE_WE}.glsl&quot;</span>
<span class="w">        </span><span class="s">COMMENT</span><span class="w"> </span><span class="s2">&quot;GLSL ${FILE}&quot;</span>
<span class="w">        </span><span class="s">MAIN_DEPENDENCY</span><span class="w"> </span><span class="s2">&quot;${FILE}&quot;</span>
<span class="w">        </span><span class="s">DEPEND</span><span class="w"> </span><span class="s2">&quot;${FILE}&quot;</span>
<span class="w">        </span><span class="s">WORKING_DIRECTORY</span><span class="w"> </span><span class="s2">&quot;${CMAKE_CURRENT_SOURCE_DIR}&quot;</span>
<span class="w">        </span><span class="s">VERBATIM</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="c"># Make our project depend on these files</span>
<span class="w">    </span><span class="nb">target_sources</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s2">&quot;${SHADER_DEST}/${FILE_WE}.glsl&quot;</span><span class="p">)</span>
<span class="nb">endforeach</span><span class="p">(</span><span class="s">FILE</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="update-main-cpp">
<h3>6.1.2 Update Main.cpp<a class="headerlink" href="#update-main-cpp" title="Permalink to this heading">¶</a></h3>
<p>First, we update the type of members for the color and depth swapchains to be just a single <code class="docutils literal notranslate"><span class="pre">SwapchainInfo</span></code> struct containing a single <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchain.html">XrSwapchain</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SwapchainInfo</span><span class="w"> </span><span class="n">m_colorSwapchainInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="n">SwapchainInfo</span><span class="w"> </span><span class="n">m_depthSwapchainInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
</div>
<p>Now in the <code class="docutils literal notranslate"><span class="pre">CreateSwapchains()</span></code> method after enumerating the swapchain formats, we check that the two views for stereo rendering are coherent in size. This is vital as the swapchain image layer for each view must match. We also set up the <code class="docutils literal notranslate"><span class="pre">viewCount</span></code> variable, which just the number of view in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrViewConfigurationType.html">XrViewConfigurationType</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="n">coherentViews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_VIEW_CONFIGURATION_TYPE_PRIMARY_STEREO</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">XrViewConfigurationView</span><span class="w"> </span><span class="o">&amp;</span><span class="n">viewConfigurationView</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check the current view size against the first view.</span>
<span class="w">    </span><span class="n">coherentViews</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">recommendedImageRectWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectWidth</span><span class="p">;</span>
<span class="w">    </span><span class="n">coherentViews</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">recommendedImageRectHeight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectHeight</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">coherentViews</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">XR_TUT_LOG_ERROR</span><span class="p">(</span><span class="s">&quot;The views are not coherent. Unable to create a single Swapchain.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">DEBUG_BREAK</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">XrViewConfigurationView</span><span class="w"> </span><span class="o">&amp;</span><span class="n">viewConfigurationView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">viewCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_viewConfigurationViews</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</pre></div>
</div>
<p>Next, we remove the <code class="docutils literal notranslate"><span class="pre">std::vector&lt;&gt;</span></code> resizes and the loop and create a single color and single depth <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchain.html">XrSwapchain</a> for all the views. This is done by setting the <code class="docutils literal notranslate"><span class="pre">arraySize</span></code> of our <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchainCreateInfo.html">XrSwapchainCreateInfo</a> to <code class="docutils literal notranslate"><span class="pre">viewCount</span></code>, which for stereo will be <code class="docutils literal notranslate"><span class="pre">2</span></code>. Update your swapchain creation code.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a color and depth swapchain, and their associated image views.</span>
<span class="c1">// Fill out an XrSwapchainCreateInfo structure and create an XrSwapchain.</span>
<span class="c1">// Color.</span>
<span class="n">XrSwapchainCreateInfo</span><span class="w"> </span><span class="n">swapchainCI</span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_CREATE_INFO</span><span class="p">};</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">usageFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SWAPCHAIN_USAGE_SAMPLED_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_SWAPCHAIN_USAGE_COLOR_ATTACHMENT_BIT</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SelectColorSwapchainFormat</span><span class="p">(</span><span class="n">formats</span><span class="p">);</span><span class="w">          </span><span class="c1">// Use GraphicsAPI to select the first compatible format.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">sampleCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedSwapchainSampleCount</span><span class="p">;</span><span class="w">  </span><span class="c1">// Use the recommended values from the XrViewConfigurationView.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectWidth</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectHeight</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">faceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="hll"><span class="n">swapchainCI</span><span class="p">.</span><span class="n">arraySize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span>
</span><span class="n">swapchainCI</span><span class="p">.</span><span class="n">mipCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSwapchain</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">swapchainCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Color Swapchain&quot;</span><span class="p">);</span>
<span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swapchainCI</span><span class="p">.</span><span class="n">format</span><span class="p">;</span><span class="w">  </span><span class="c1">// Save the swapchain format for later use.</span>

<span class="c1">// Depth.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">createFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">usageFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_SWAPCHAIN_USAGE_SAMPLED_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_SWAPCHAIN_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SelectDepthSwapchainFormat</span><span class="p">(</span><span class="n">formats</span><span class="p">);</span><span class="w">          </span><span class="c1">// Use GraphicsAPI to select the first compatible format.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">sampleCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedSwapchainSampleCount</span><span class="p">;</span><span class="w">  </span><span class="c1">// Use the recommended values from the XrViewConfigurationView.</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectWidth</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewConfigurationView</span><span class="p">.</span><span class="n">recommendedImageRectHeight</span><span class="p">;</span>
<span class="n">swapchainCI</span><span class="p">.</span><span class="n">faceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="hll"><span class="n">swapchainCI</span><span class="p">.</span><span class="n">arraySize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span>
</span><span class="n">swapchainCI</span><span class="p">.</span><span class="n">mipCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrCreateSwapchain</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">swapchainCI</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to create Depth Swapchain&quot;</span><span class="p">);</span>
<span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swapchainCI</span><span class="p">.</span><span class="n">format</span><span class="p">;</span><span class="w">  </span><span class="c1">// Save the swapchain format for later use.</span>
</pre></div>
</div>
<p>Update the calls to <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEnumerateSwapchainImages.html">xrEnumerateSwapchainImages</a> with new member names.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get the number of images in the color/depth swapchain and allocate Swapchain image data via GraphicsAPI to store the returned array.</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">colorSwapchainImageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateSwapchainImages</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">colorSwapchainImageCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate Color Swapchain Images.&quot;</span><span class="p">);</span>
<span class="n">XrSwapchainImageBaseHeader</span><span class="w"> </span><span class="o">*</span><span class="n">colorSwapchainImages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">AllocateSwapchainImageData</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">SwapchainType</span><span class="o">::</span><span class="n">COLOR</span><span class="p">,</span><span class="w"> </span><span class="n">colorSwapchainImageCount</span><span class="p">);</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateSwapchainImages</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">colorSwapchainImageCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">colorSwapchainImageCount</span><span class="p">,</span><span class="w"> </span><span class="n">colorSwapchainImages</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate Color Swapchain Images.&quot;</span><span class="p">);</span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="n">depthSwapchainImageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateSwapchainImages</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">depthSwapchainImageCount</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate Depth Swapchain Images.&quot;</span><span class="p">);</span>
<span class="n">XrSwapchainImageBaseHeader</span><span class="w"> </span><span class="o">*</span><span class="n">depthSwapchainImages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">AllocateSwapchainImageData</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">SwapchainType</span><span class="o">::</span><span class="n">DEPTH</span><span class="p">,</span><span class="w"> </span><span class="n">depthSwapchainImageCount</span><span class="p">);</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrEnumerateSwapchainImages</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">depthSwapchainImageCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">depthSwapchainImageCount</span><span class="p">,</span><span class="w"> </span><span class="n">depthSwapchainImages</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to enumerate Depth Swapchain Images.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>We will now create image views that encompass the two subresources - one layer per eye view. We update the <code class="docutils literal notranslate"><span class="pre">ImageViewCreateInfo::view</span></code> to <code class="docutils literal notranslate"><span class="pre">TYPE_2D_ARRAY</span></code> and set the <code class="docutils literal notranslate"><span class="pre">ImageViewCreateInfo::layerCount</span></code> to <code class="docutils literal notranslate"><span class="pre">viewCount</span></code>. Update your swapchain image view creation code.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Per image in the swapchains, fill out a GraphicsAPI::ImageViewCreateInfo structure and create a color/depth image view.</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">colorSwapchainImageCount</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="w"> </span><span class="n">imageViewCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">RTV</span><span class="p">;</span>
<span class="hll"><span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">View</span><span class="o">::</span><span class="n">TYPE_2D_ARRAY</span><span class="p">;</span>
</span><span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">Aspect</span><span class="o">::</span><span class="n">COLOR_BIT</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">baseMipLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">levelCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">baseArrayLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="hll"><span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">layerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span>
</span><span class="w">    </span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateImageView</span><span class="p">(</span><span class="n">imageViewCI</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">depthSwapchainImageCount</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="w"> </span><span class="n">imageViewCI</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">GetSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">DSV</span><span class="p">;</span>
<span class="hll"><span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">View</span><span class="o">::</span><span class="n">TYPE_2D_ARRAY</span><span class="p">;</span>
</span><span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ImageViewCreateInfo</span><span class="o">::</span><span class="n">Aspect</span><span class="o">::</span><span class="n">DEPTH_BIT</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">baseMipLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">levelCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">baseArrayLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="hll"><span class="w">    </span><span class="n">imageViewCI</span><span class="p">.</span><span class="n">layerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span>
</span><span class="w">    </span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateImageView</span><span class="p">(</span><span class="n">imageViewCI</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">DestroySwapchains()</span></code>, we again remove the loop and update the member names used.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Destroy the color and depth image views from GraphicsAPI.</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*&amp;</span><span class="w"> </span><span class="n">imageView</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyImageView</span><span class="p">(</span><span class="n">imageView</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*&amp;</span><span class="w"> </span><span class="n">imageView</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DestroyImageView</span><span class="p">(</span><span class="n">imageView</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Free the Swapchain Image Data.</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">FreeSwapchainImageData</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">);</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">FreeSwapchainImageData</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">);</span>

<span class="c1">// Destroy the swapchains.</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroySwapchain</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Color Swapchain&quot;</span><span class="p">);</span>
<span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrDestroySwapchain</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to destroy Depth Swapchain&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>With the swapchains correctly set up, we now need to update our resources for rendering. First, we update our <code class="docutils literal notranslate"><span class="pre">CameraConstants</span></code> struct to contain two <code class="docutils literal notranslate"><span class="pre">viewProj</span></code> and two <code class="docutils literal notranslate"><span class="pre">modelViewProj</span></code> matrices as arrays. The two matrices are unique to each eye view.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">CameraConstants</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">viewProj</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class="hll"><span class="w">    </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">modelViewProj</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class="w">    </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">pad1</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">pad2</span><span class="p">;</span>
<span class="w">    </span><span class="n">XrVector4f</span><span class="w"> </span><span class="n">pad3</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">CameraConstants</span><span class="w"> </span><span class="n">cameraConstants</span><span class="p">;</span>
<span class="n">XrVector4f</span><span class="w"> </span><span class="n">normals</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="mf">1.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mf">-1.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.00f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}};</span>
</pre></div>
</div>
<p>Because of the larger size of the camera constant/uniform buffer, we need to align the size of the structure, so that it’s compatibile with the graphics API. We use <code class="docutils literal notranslate"><span class="pre">GraphicsAPI::AlignSizeForUniformBuffer()</span></code> to align up the size when creating the buffer.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="w">    </span><span class="n">m_uniformBuffer_Camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateBuffer</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BufferCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">UNIFORM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">AlignSizeForUniformBuffer</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">CameraConstants</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">numberOfCuboids</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">});</span>
</span><span class="w">    </span><span class="n">m_uniformBuffer_Normals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateBuffer</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BufferCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">UNIFORM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">normals</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">normals</span><span class="p">});</span>
</pre></div>
</div>
<p>Next, we update the shader filepaths:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OPENGL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">vertexSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;VertexShader_GL_MV.glsl&quot;</span><span class="p">);</span>
</span><span class="w">    </span><span class="n">m_vertexShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">vertexSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>

<span class="hll"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fragmentSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadTextFile</span><span class="p">(</span><span class="s">&quot;PixelShader_GL_MV.glsl&quot;</span><span class="p">);</span>
</span><span class="w">    </span><span class="n">m_fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreateShader</span><span class="p">({</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ShaderCreateInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fragmentSource</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, we update the <code class="docutils literal notranslate"><span class="pre">PipelineCreateInfo</span></code> struct with the updated member names and assign a new member <code class="docutils literal notranslate"><span class="pre">PipelineCreateInfo::viewMask</span></code> the value <code class="docutils literal notranslate"><span class="pre">0b11</span></code>, which is binary <code class="docutils literal notranslate"><span class="pre">3</span></code>. This last member is used by some graphics APIs to set up the pipeline correctly. Each set bit refers to a single view that the shaders should write to. It’s possible to mask off certain views for rendering i.e. <code class="docutils literal notranslate"><span class="pre">0b0101</span></code> would only render to the first and third views of a possible four view configuration.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">PipelineCreateInfo</span><span class="w"> </span><span class="n">pipelineCI</span><span class="p">;</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">shaders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">m_vertexShader</span><span class="p">,</span><span class="w"> </span><span class="n">m_fragmentShader</span><span class="p">};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">vertexInputState</span><span class="p">.</span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">VertexType</span><span class="o">::</span><span class="n">VEC4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TEXCOORD&quot;</span><span class="p">}};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">vertexInputState</span><span class="p">.</span><span class="n">bindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)}};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">inputAssemblyState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">PrimitiveTopology</span><span class="o">::</span><span class="n">TRIANGLE_LIST</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">rasterisationState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">PolygonMode</span><span class="o">::</span><span class="n">FILL</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">CullMode</span><span class="o">::</span><span class="n">BACK</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">FrontFace</span><span class="o">::</span><span class="n">COUNTER_CLOCKWISE</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">multisampleState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">depthStencilState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">CompareOp</span><span class="o">::</span><span class="n">LESS_OR_EQUAL</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="n">pipelineCI</span><span class="p">.</span><span class="n">colorBlendState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">LogicOp</span><span class="o">::</span><span class="n">NO_OP</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">SRC_ALPHA</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">ONE_MINUS_SRC_ALPHA</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendOp</span><span class="o">::</span><span class="n">ADD</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">ONE</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendFactor</span><span class="o">::</span><span class="n">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">BlendOp</span><span class="o">::</span><span class="n">ADD</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">ColorComponentBit</span><span class="p">)</span><span class="mi">15</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">}};</span>
<span class="hll"><span class="n">pipelineCI</span><span class="p">.</span><span class="n">colorFormats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="p">};</span>
</span><span class="hll"><span class="n">pipelineCI</span><span class="p">.</span><span class="n">depthFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchainFormat</span><span class="p">;</span>
</span><span class="n">pipelineCI</span><span class="p">.</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">},</span>
<span class="w">                     </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">},</span>
<span class="w">                     </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">FRAGMENT</span><span class="p">}};</span>
<span class="hll"><span class="n">pipelineCI</span><span class="p">.</span><span class="n">viewMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b11</span><span class="p">;</span>
</span><span class="n">m_pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">CreatePipeline</span><span class="p">(</span><span class="n">pipelineCI</span><span class="p">);</span>
</pre></div>
</div>
<p>After the swapchain and resource creation, we need to update our rendering code. In <code class="docutils literal notranslate"><span class="pre">RenderCuboid()</span></code>, we do the same matrix multiplication for both eye views, and use <code class="docutils literal notranslate"><span class="pre">GraphicsAPI::AlignSizeForUniformBuffer()</span></code> to calculate the correct offset in to buffer containing the constant/uniform buffers. The <code class="docutils literal notranslate"><span class="pre">DrawIndexed()</span></code> call is modified so that for D3D11 only we do instance rendering.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">XrMatrix4x4f_CreateTranslationRotationScale</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">scale</span><span class="p">);</span>

<span class="hll"><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">viewCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// This will only work for stereo rendering.</span>
</span><span class="hll"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="n">XrMatrix4x4f_Multiply</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">modelViewProj</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">viewProj</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">color</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">};</span>
<span class="hll"><span class="kt">size_t</span><span class="w"> </span><span class="n">offsetCameraUB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">AlignSizeForUniformBuffer</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">CameraConstants</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">renderCuboidIndex</span><span class="p">;</span>
</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetPipeline</span><span class="p">(</span><span class="n">m_pipeline</span><span class="p">);</span>

<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetBufferData</span><span class="p">(</span><span class="n">m_uniformBuffer_Camera</span><span class="p">,</span><span class="w"> </span><span class="n">offsetCameraUB</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">CameraConstants</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">);</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetDescriptor</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_uniformBuffer_Camera</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">offsetCameraUB</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">CameraConstants</span><span class="p">)});</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetDescriptor</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_uniformBuffer_Normals</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">DescriptorInfo</span><span class="o">::</span><span class="n">Stage</span><span class="o">::</span><span class="n">VERTEX</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">normals</span><span class="p">)});</span>

<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">UpdateDescriptors</span><span class="p">();</span>

<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetVertexBuffers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_vertexBuffer</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetIndexBuffer</span><span class="p">(</span><span class="n">m_indexBuffer</span><span class="p">);</span>
<span class="hll"><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">DrawIndexed</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="n">m_apiType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">D3D11</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// For D3D11, use instanced rendering for multiview.</span>
</span>
<span class="n">renderCuboidIndex</span><span class="o">++</span><span class="p">;</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">RenderLayer()</span></code>, there’s no need to repeat the rendering code per eye view; instead, we call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrAcquireSwapchainImage.html">xrAcquireSwapchainImage</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrWaitSwapchainImage.html">xrWaitSwapchainImage</a> for both the color and depth swapchains to get the next 2D array image from them. We call <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrReleaseSwapchainImage.html">xrReleaseSwapchainImage</a> at the end of the XR frame for both the color and depth swapchains. These single color and depth swapchains neatly encapsulate the two eye views and simplified the rendering code by removing the ‘per eye’ loop.</p>
<p>We are still required to submit an <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrCompositionLayerProjectionView.html">XrCompositionLayerProjectionView</a> structure for each view in the system, but in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrSwapchainSubImage.html">XrSwapchainSubImage</a> we can set the <code class="docutils literal notranslate"><span class="pre">imageArrayIndex</span></code> to specify which layer of the swapchain image we wish to associate with that view. So in the case of stereo rendering, it would be <code class="docutils literal notranslate"><span class="pre">0</span></code> for left and <code class="docutils literal notranslate"><span class="pre">1</span></code> for right eye views. We attach our 2D array image as a render target/color attachment for the pixel/fragment shader to write to. In a for loop, we iterate through each <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrView.html">XrView</a> and create unique view and projection matrices. Update the rendering code in <code class="docutils literal notranslate"><span class="pre">RenderLayer()</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">// Locate the views from the view configuration within the (reference) space at the display time.</span>
<span class="linenos">  2</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">XrView</span><span class="o">&gt;</span><span class="w"> </span><span class="n">views</span><span class="p">(</span><span class="n">m_viewConfigurationViews</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_VIEW</span><span class="p">});</span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="n">XrViewState</span><span class="w"> </span><span class="n">viewState</span><span class="p">{</span><span class="n">XR_TYPE_VIEW_STATE</span><span class="p">};</span><span class="w">  </span><span class="c1">// Will contain information on whether the position and/or orientation is valid and/or tracked.</span>
<span class="linenos">  5</span><span class="n">XrViewLocateInfo</span><span class="w"> </span><span class="n">viewLocateInfo</span><span class="p">{</span><span class="n">XR_TYPE_VIEW_LOCATE_INFO</span><span class="p">};</span>
<span class="linenos">  6</span><span class="n">viewLocateInfo</span><span class="p">.</span><span class="n">viewConfigurationType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfiguration</span><span class="p">;</span>
<span class="linenos">  7</span><span class="n">viewLocateInfo</span><span class="p">.</span><span class="n">displayTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">predictedDisplayTime</span><span class="p">;</span>
<span class="linenos">  8</span><span class="n">viewLocateInfo</span><span class="p">.</span><span class="n">space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_localSpace</span><span class="p">;</span>
<span class="linenos">  9</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">viewCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 10</span><span class="n">XrResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xrLocateViews</span><span class="p">(</span><span class="n">m_session</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">viewLocateInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">viewState</span><span class="p">,</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">views</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">viewCount</span><span class="p">,</span><span class="w"> </span><span class="n">views</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
<span class="linenos"> 11</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">XR_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 12</span><span class="w">    </span><span class="n">XR_TUT_LOG</span><span class="p">(</span><span class="s">&quot;Failed to locate Views.&quot;</span><span class="p">);</span>
<span class="linenos"> 13</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="linenos"> 14</span><span class="p">}</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="c1">// Resize the layer projection views to match the view count. The layer projection views are used in the layer projection.</span>
<span class="linenos"> 17</span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">viewCount</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_COMPOSITION_LAYER_PROJECTION_VIEW</span><span class="p">});</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1">// Acquire and wait for an image from the swapchains.</span>
<span class="linenos"> 20</span><span class="c1">// Get the image index of an image in the swapchains.</span>
<span class="linenos"> 21</span><span class="c1">// The timeout is infinite.</span>
<span class="hll"><span class="linenos"> 22</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">colorImageIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 23</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">depthImageIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 24</span><span class="n">XrSwapchainImageAcquireInfo</span><span class="w"> </span><span class="n">acquireInfo</span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_IMAGE_ACQUIRE_INFO</span><span class="p">};</span>
</span><span class="hll"><span class="linenos"> 25</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrAcquireSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">acquireInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">colorImageIndex</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to acquire Image from the Color Swapchian&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 26</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrAcquireSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">acquireInfo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">depthImageIndex</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to acquire Image from the Depth Swapchian&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 27</span>
</span><span class="hll"><span class="linenos"> 28</span><span class="n">XrSwapchainImageWaitInfo</span><span class="w"> </span><span class="n">waitInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_IMAGE_WAIT_INFO</span><span class="p">};</span>
</span><span class="hll"><span class="linenos"> 29</span><span class="n">waitInfo</span><span class="p">.</span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_INFINITE_DURATION</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 30</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrWaitSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">waitInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to wait for Image from the Color Swapchain&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 31</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrWaitSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">waitInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to wait for Image from the Depth Swapchain&quot;</span><span class="p">);</span>
</span><span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="c1">// Get the width and height and construct the viewport and scissors.</span>
<span class="linenos"> 34</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">recommendedImageRectWidth</span><span class="p">;</span>
<span class="linenos"> 35</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_viewConfigurationViews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">recommendedImageRectHeight</span><span class="p">;</span>
<span class="linenos"> 36</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">Viewport</span><span class="w"> </span><span class="n">viewport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">};</span>
<span class="linenos"> 37</span><span class="n">GraphicsAPI</span><span class="o">::</span><span class="n">Rect2D</span><span class="w"> </span><span class="n">scissor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{(</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">}};</span>
<span class="linenos"> 38</span><span class="kt">float</span><span class="w"> </span><span class="n">nearZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">;</span>
<span class="linenos"> 39</span><span class="kt">float</span><span class="w"> </span><span class="n">farZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">;</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="c1">// Fill out the XrCompositionLayerProjectionView structure specifying the pose and fov from the view.</span>
<span class="linenos"> 42</span><span class="c1">// This also associates the swapchain image with this layer projection view.</span>
<span class="linenos"> 43</span><span class="c1">// Per view in the view configuration:</span>
<span class="hll"><span class="linenos"> 44</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos"> 45</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">XR_TYPE_COMPOSITION_LAYER_PROJECTION_VIEW</span><span class="w"> </span><span class="p">};</span>
</span><span class="hll"><span class="linenos"> 46</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pose</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 47</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fov</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 48</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subImage</span><span class="p">.</span><span class="n">swapchain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 49</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 50</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 51</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 52</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageRect</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">height</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 53</span><span class="w">    </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subImage</span><span class="p">.</span><span class="n">imageArrayIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">  </span><span class="c1">// Useful for multiview rendering.</span>
</span><span class="hll"><span class="linenos"> 54</span><span class="p">}</span>
</span><span class="linenos"> 55</span>
<span class="linenos"> 56</span><span class="c1">// Rendering code to clear the color and depth image views.</span>
<span class="linenos"> 57</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">BeginRendering</span><span class="p">();</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_environmentBlendMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XR_ENVIRONMENT_BLEND_MODE_OPAQUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 60</span><span class="w">    </span><span class="c1">// VR mode use a background color.</span>
<span class="linenos"> 61</span><span class="w">    </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">ClearColor</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">colorImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mf">0.17f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">);</span>
<span class="linenos"> 62</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="c1">// In AR mode make the background color black.</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">ClearColor</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">colorImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.00f</span><span class="p">);</span>
<span class="linenos"> 65</span><span class="p">}</span>
<span class="linenos"> 66</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">ClearDepth</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">depthImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
<span class="linenos"> 67</span><span class="c1">// XR_DOCS_TAG_END_RenderLayer1</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="c1">// XR_DOCS_TAG_BEGIN_SetupFrameRendering</span>
<span class="linenos"> 70</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetRenderAttachments</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">colorImageIndex</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">imageViews</span><span class="p">[</span><span class="n">depthImageIndex</span><span class="p">],</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">m_pipeline</span><span class="p">);</span>
<span class="linenos"> 71</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetViewports</span><span class="p">(</span><span class="o">&amp;</span><span class="n">viewport</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 72</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">SetScissors</span><span class="p">(</span><span class="o">&amp;</span><span class="n">scissor</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="c1">// Compute the view-projection transforms.</span>
<span class="linenos"> 75</span><span class="c1">// All matrices (including OpenXR&#39;s) are column-major, right-handed.</span>
<span class="hll"><span class="linenos"> 76</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">viewCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos"> 77</span><span class="w">    </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">proj</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 78</span><span class="w">    </span><span class="n">XrMatrix4x4f_CreateProjectionFov</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proj</span><span class="p">,</span><span class="w"> </span><span class="n">m_apiType</span><span class="p">,</span><span class="w"> </span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fov</span><span class="p">,</span><span class="w"> </span><span class="n">nearZ</span><span class="p">,</span><span class="w"> </span><span class="n">farZ</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 79</span><span class="w">    </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">toView</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 80</span><span class="w">    </span><span class="n">XrVector3f</span><span class="w"> </span><span class="n">scale1m</span><span class="p">{</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="w"> </span><span class="p">};</span>
</span><span class="hll"><span class="linenos"> 81</span><span class="w">    </span><span class="n">XrMatrix4x4f_CreateTranslationRotationScale</span><span class="p">(</span><span class="o">&amp;</span><span class="n">toView</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">views</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">scale1m</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 82</span><span class="w">    </span><span class="n">XrMatrix4x4f</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
</span><span class="hll"><span class="linenos"> 83</span><span class="w">    </span><span class="n">XrMatrix4x4f_InvertRigidBody</span><span class="p">(</span><span class="o">&amp;</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toView</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 84</span><span class="w">    </span><span class="n">XrMatrix4x4f_Multiply</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cameraConstants</span><span class="p">.</span><span class="n">viewProj</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">view</span><span class="p">);</span>
</span><span class="hll"><span class="linenos"> 85</span><span class="p">}</span>
</span><span class="linenos"> 86</span><span class="c1">// XR_DOCS_TAG_END_SetupFrameRendering</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="c1">// XR_DOCS_TAG_BEGIN_CallRenderCuboid</span>
<span class="linenos"> 89</span><span class="n">renderCuboidIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 90</span><span class="c1">// Draw a floor. Scale it by 2 in the X and Z, and 0.1 in the Y,</span>
<span class="linenos"> 91</span><span class="n">RenderCuboid</span><span class="p">({{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">m_viewHeightM</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="mf">2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">});</span>
<span class="linenos"> 92</span><span class="c1">// Draw a &quot;table&quot;.</span>
<span class="linenos"> 93</span><span class="n">RenderCuboid</span><span class="p">({{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">m_viewHeightM</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.9f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.7f</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">0.6f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4f</span><span class="p">});</span>
<span class="linenos"> 94</span><span class="c1">// XR_DOCS_TAG_END_CallRenderCuboid</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span><span class="c1">// XR_DOCS_TAG_BEGIN_CallRenderCuboid2</span>
<span class="linenos"> 97</span><span class="c1">// Draw some blocks at the controller positions:</span>
<span class="linenos"> 98</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_handPoseState</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">100</span><span class="w">        </span><span class="n">RenderCuboid</span><span class="p">(</span><span class="n">m_handPose</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="mf">0.02f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.04f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10f</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">});</span>
<span class="linenos">101</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">102</span><span class="p">}</span>
<span class="linenos">103</span><span class="c1">// XR_DOCS_TAG_END_CallRenderCuboid2</span>
<span class="linenos">104</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">105</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">thisBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos">106</span><span class="w">    </span><span class="n">XrVector3f</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thisBlock</span><span class="p">.</span><span class="n">scale</span><span class="p">;</span>
<span class="linenos">107</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m_nearBlock</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m_nearBlock</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">108</span><span class="w">        </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thisBlock</span><span class="p">.</span><span class="n">scale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.05f</span><span class="p">;</span>
<span class="linenos">109</span><span class="w">    </span><span class="n">RenderCuboid</span><span class="p">(</span><span class="n">thisBlock</span><span class="p">.</span><span class="n">pose</span><span class="p">,</span><span class="w"> </span><span class="n">sc</span><span class="p">,</span><span class="w"> </span><span class="n">thisBlock</span><span class="p">.</span><span class="n">color</span><span class="p">);</span>
<span class="linenos">110</span><span class="p">}</span>
<span class="linenos">111</span><span class="c1">// XR_DOCS_TAG_BEGIN_RenderLayer2</span>
<span class="linenos">112</span><span class="n">m_graphicsAPI</span><span class="o">-&gt;</span><span class="n">EndRendering</span><span class="p">();</span>
<span class="linenos">113</span>
<span class="linenos">114</span><span class="c1">// Give the swapchain image back to OpenXR, allowing the compositor to use the image.</span>
<span class="hll"><span class="linenos">115</span><span class="n">XrSwapchainImageReleaseInfo</span><span class="w"> </span><span class="n">releaseInfo</span><span class="p">{</span><span class="n">XR_TYPE_SWAPCHAIN_IMAGE_RELEASE_INFO</span><span class="p">};</span>
</span><span class="hll"><span class="linenos">116</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrReleaseSwapchainImage</span><span class="p">(</span><span class="n">m_colorSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">releaseInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to release Image back to the Color Swapchain&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">117</span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrReleaseSwapchainImage</span><span class="p">(</span><span class="n">m_depthSwapchainInfo</span><span class="p">.</span><span class="n">swapchain</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">releaseInfo</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to release Image back to the Depth Swapchain&quot;</span><span class="p">);</span>
</span><span class="linenos">118</span>
<span class="linenos">119</span><span class="c1">// Fill out the XrCompositionLayerProjection structure for usage with xrEndFrame().</span>
<span class="linenos">120</span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjection</span><span class="p">.</span><span class="n">layerFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">XR_COMPOSITION_LAYER_CORRECT_CHROMATIC_ABERRATION_BIT</span><span class="p">;</span>
<span class="linenos">121</span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjection</span><span class="p">.</span><span class="n">space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_localSpace</span><span class="p">;</span>
<span class="linenos">122</span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjection</span><span class="p">.</span><span class="n">viewCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="linenos">123</span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjection</span><span class="p">.</span><span class="n">views</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">renderLayerInfo</span><span class="p">.</span><span class="n">layerProjectionViews</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
<span class="linenos">124</span>
<span class="linenos">125</span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</pre></div>
</div>
<p>You can now debug and run your application using Multiview rendering.</p>
</section>
<section id="graphicsapi-and-multiview">
<h3>6.1.3 GraphicsAPI and Multiview<a class="headerlink" href="#graphicsapi-and-multiview" title="Permalink to this heading">¶</a></h3>
<p>In this section, we describe some of the background changes to the shaders and <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> needed to support multiview rendering.</p>
<p>Enusre you have support for <code class="docutils literal notranslate"><span class="pre">GL_OVR_multiview</span></code> by checking the extensions and that you have loaded the <code class="docutils literal notranslate"><span class="pre">glFramebufferTextureMultiviewOVR()</span></code> function pointer, if you need to do so. You will use this to create a framebuffer that supports rendering to multiple layers.
See this example from ARM’s OpenGL ES SDK for Android <a class="reference external" href="https://arm-software.github.io/opengl-es-sdk-for-android/multiview.html">here</a>, which works for OpenGL too.</p>
<p>Modify the shader to use <code class="docutils literal notranslate"><span class="pre">gl_ViewIndex_OVR</span></code> and the GL_OVR_multiview GLSL extension. The line <code class="docutils literal notranslate"><span class="pre">layout(num_views</span> <span class="pre">=</span> <span class="pre">2)</span> <span class="pre">in</span></code> specifies the number of views the vertex shader a will broadcast to.</p>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Shaders\VertexShader.glsl</span>
<span class="gi">+++ G:\Jarvis\workspace\openxr-tutorial\openxr-tutorial-src\Chapter6_1_Multiview\ShadersMultiview\VertexShader_GL_MV.glsl</span>
<span class="gu">@@ -4,9 +4,11 @@</span>
<span class="w"> </span>
<span class="w"> </span>#version 450
<span class="w"> </span>#extension GL_KHR_vulkan_glsl : enable
<span class="gi">+#extension GL_OVR_multiview : enable</span>
<span class="gi">+layout(num_views = 2) in;</span>
<span class="w"> </span>layout(std140, binding = 0) uniform CameraConstants {
<span class="gd">-    mat4 viewProj;</span>
<span class="gd">-    mat4 modelViewProj;</span>
<span class="gi">+    mat4 viewProj[2];</span>
<span class="gi">+    mat4 modelViewProj[2];</span>
<span class="w"> </span>    mat4 model;
<span class="w"> </span>    vec4 color;
<span class="w"> </span>    vec4 pad1;
<span class="gu">@@ -21,7 +23,7 @@</span>
<span class="w"> </span>layout(location = 1) out flat vec3 o_Normal;
<span class="w"> </span>layout(location = 2) out flat vec3 o_Color;
<span class="w"> </span>void main() {
<span class="gd">-    gl_Position = modelViewProj * a_Positions;</span>
<span class="gi">+    gl_Position = modelViewProj[gl_ViewID_OVR] * a_Positions;</span>
<span class="w"> </span>    int face = gl_VertexIndex / 6;
<span class="w"> </span>    o_TexCoord = uvec2(face, 0);
<span class="w"> </span>    o_Normal = (model * normals[face]).xyz;
</pre></div>
</div>
</section>
</section>
<section id="graphics-api">
<h2>6.2 Graphics API<a class="headerlink" href="#graphics-api" title="Permalink to this heading">¶</a></h2>
<p class="rubric">GraphicsAPI</p>
<p>Note: <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> is by no means production-ready code or reflective of good practice with specific APIs. It is there solely to provide working samples in this tutorial, and demonstrate some basic rendering and interaction with OpenXR.</p>
<p>This tutorial uses polymorphic classes; <code class="docutils literal notranslate"><span class="pre">GraphicsAPI_...</span></code> derives from the base <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> class. The derived class is based on your graphics API selection. Include both the header and cpp files for both <code class="docutils literal notranslate"><span class="pre">GraphicsAPI</span></code> and <code class="docutils literal notranslate"><span class="pre">GraphicsAPI...</span></code>. <code class="docutils literal notranslate"><span class="pre">GraphicsAPI.h</span></code> includes the headers and macros needed to set up your platform and graphics API. Below are code snippets that show how to set up the <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_...</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macros for your platform along with any relevant headers. In the first code block, there’s also a reference to <code class="docutils literal notranslate"><span class="pre">XR_TUTORIAL_USE_...</span></code> which we set up the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> . This tutorial demonstrates all five graphics APIs.</p>
<p>The code below is an example of how you might implement the inclusion and definition of the relevant graphics API header along with the <code class="docutils literal notranslate"><span class="pre">XR_USE_PLATFORM_...</span></code> and <code class="docutils literal notranslate"><span class="pre">XR_USE_GRAPHICS_API_...</span></code> macros.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;HelperFunctions.h&gt;</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(_WIN32)</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN</span>
<span class="cp">#define NOMINMAX</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Windows.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unknwn.h&gt;</span>
<span class="hll"><span class="cp">#define XR_USE_PLATFORM_WIN32</span>
</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D11)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D11</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(XR_TUTORIAL_USE_D3D12)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_D3D12</span>
<span class="cp">#endif</span>
<span class="hll"><span class="cp">#if defined(XR_TUTORIAL_USE_OPENGL)</span>
</span><span class="hll"><span class="cp">#define XR_USE_GRAPHICS_API_OPENGL</span>
</span><span class="hll"><span class="cp">#endif</span>
</span><span class="cp">#if defined(XR_TUTORIAL_USE_VULKAN)</span>
<span class="cp">#define XR_USE_GRAPHICS_API_VULKAN</span>
<span class="cp">#endif</span>
<span class="cp">#endif  </span><span class="c1">// _WIN32</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(XR_USE_GRAPHICS_API_OPENGL)</span>
<span class="cp">#if defined(XR_USE_PLATFORM_XLIB)</span>
<span class="cp">#define OS_LINUX_XLIB 1</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// OpenXR Helper</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;OpenXRHelper.h&gt;</span>
</pre></div>
</div>
<p>When setting up the graphics API core objects, there are things that we need to know from OpenXR in order to create the objects correctly. These could include the version of the graphics API required, referencing a specific GPU, required instance and/or device extension etc. Below are code examples showing how to set up your graphics for OpenXR.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GraphicsAPI_OpenGL</span><span class="o">::</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">(</span><span class="n">XrInstance</span><span class="w"> </span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">XrSystemId</span><span class="w"> </span><span class="n">systemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetInstanceProcAddr</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xrGetOpenGLGraphicsRequirementsKHR&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PFN_xrVoidFunction</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get InstanceProcAddr for xrGetOpenGLGraphicsRequirementsKHR.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">XrGraphicsRequirementsOpenGLKHR</span><span class="w"> </span><span class="n">graphicsRequirements</span><span class="p">{</span><span class="n">XR_TYPE_GRAPHICS_REQUIREMENTS_OPENGL_KHR</span><span class="p">};</span>
<span class="w">    </span><span class="n">OPENXR_CHECK</span><span class="p">(</span><span class="n">xrGetOpenGLGraphicsRequirementsKHR</span><span class="p">(</span><span class="n">m_xrInstance</span><span class="p">,</span><span class="w"> </span><span class="n">systemId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graphicsRequirements</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Failed to get Graphics Requirements for OpenGL.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/f122f9f1fc729e2dc82e12c3ce73efa875182854/src/tests/hello_xr/graphicsplugin_opengl.cpp#L103-L121</span>
<span class="w">    </span><span class="c1">// Initialize the gl extensions. Note we have to open a window.</span>
<span class="w">    </span><span class="n">ksDriverInstance</span><span class="w"> </span><span class="n">driverInstance</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuQueueInfo</span><span class="w"> </span><span class="n">queueInfo</span><span class="p">{};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceColorFormat</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_COLOR_FORMAT_B8G8R8A8</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSurfaceDepthFormat</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">{</span><span class="n">KS_GPU_SURFACE_DEPTH_FORMAT_D24</span><span class="p">};</span>
<span class="w">    </span><span class="n">ksGpuSampleCount</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">{</span><span class="n">KS_GPU_SAMPLE_COUNT_1</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ksGpuWindow_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driverInstance</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">queueInfo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">colorFormat</span><span class="p">,</span><span class="w"> </span><span class="n">depthFormat</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCount</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: Failed to create Context.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">GLint</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MAJOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMajorVersion</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">GL_MINOR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">glMinorVersion</span><span class="p">);</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XrVersion</span><span class="w"> </span><span class="n">glApiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_MAKE_VERSION</span><span class="p">(</span><span class="n">glMajorVersion</span><span class="p">,</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glApiVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MAJOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XR_VERSION_MINOR</span><span class="p">(</span><span class="n">graphicsRequirements</span><span class="p">.</span><span class="n">minApiVersionSupported</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: OPENGL: The created OpenGL version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">glMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; doesn&#39;t meet the minimum required API version &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMajorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">requiredMinorVersion</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; for OpenXR.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEBUG_OUTPUT_SYNCHRONOUS</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageCallback</span><span class="p">(</span><span class="n">GLDebugCallback</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDebugMessageControl</span><span class="p">(</span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DEBUG_TYPE_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DONT_CARE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">GraphicsAPI_OpenGL</span><span class="o">::~</span><span class="n">GraphicsAPI_OpenGL</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ksGpuWindow_Destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="openxr-api-layers">
<h2>6.3 OpenXR API Layers<a class="headerlink" href="#openxr-api-layers" title="Permalink to this heading">¶</a></h2>
<p>The OpenXR loader has a layer system that allows OpenXR API calls to pass through a number of optional layers, that add some functionality for the application. These are extremely useful for debugging.</p>
<p>The OpenXR SDK provides two API layers for us to use:
In the table below are the layer names and their associated libraries and .json files.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>XR_APILAYER_LUNARG_api_dump</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_api_dump.dll</span></code> or <code class="docutils literal notranslate"><span class="pre">.so</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_api_dump.json</span></code></p></td>
</tr>
<tr class="row-even"><td><p>XR_APILAYER_LUNARG_core_validation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_core_validation.dll</span></code> or <code class="docutils literal notranslate"><span class="pre">.so</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">XrApiLayer_core_validation.json</span></code></p></td>
</tr>
</tbody>
</table>
<p>XR_APILAYER_LUNARG_api_dump simply logs extra/verbose information to the output describing in more detail what has happened during that API call. XR_APILAYER_LUNARG_core_validation acts similarly to VK_LAYER_KHRONOS_validation in Vulkan, where the layer intercepts the API call and performs validation to ensure conformance with the specification.</p>
<p>Other runtimes and hardware vendors may provide layers that are useful for debugging your XR system and/or application.</p>
<p>Firstly, ensure that you are building the OpenXR provided API layers from the <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source">OpenXR-SDK-Source</a>.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># For FetchContent_Declare() and FetchContent_MakeAvailable()</span>
<span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span>

<span class="c"># openxr_loader - From github.com/KhronosGroup</span>
<span class="nb">set</span><span class="p">(</span><span class="s">BUILD_TESTS</span>
<span class="w">    </span><span class="s">OFF</span>
<span class="w">    </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Build tests&quot;</span>
<span class="p">)</span>
<span class="hll"><span class="nb">set</span><span class="p">(</span><span class="s">BUILD_API_LAYERS</span>
</span><span class="hll"><span class="w">    </span><span class="s">ON</span>
</span><span class="hll"><span class="w">    </span><span class="s">CACHE</span><span class="w"> </span><span class="s">INTERNAL</span><span class="w"> </span><span class="s2">&quot;Use OpenXR layers&quot;</span>
</span><span class="hll"><span class="p">)</span>
</span><span class="nb">FetchContent_Declare</span><span class="p">(</span>
<span class="w">    </span><span class="s">OpenXR</span>
<span class="w">    </span><span class="s">URL_HASH</span><span class="w"> </span><span class="s">MD5=81930f0ccecdca852906e1a22aee4a45</span>
<span class="w">    </span><span class="s">URL</span><span class="w"> </span><span class="s">https://github.com/KhronosGroup/OpenXR-SDK-Source/archive/refs/tags/release-1.0.28.zip</span>
<span class="w">        </span><span class="s">SOURCE_DIR</span>
<span class="w">        </span><span class="s">openxr</span>
<span class="p">)</span>
<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">OpenXR</span><span class="p">)</span>
</pre></div>
</div>
<p>To enable API layers, add the <code class="docutils literal notranslate"><span class="pre">XR_API_LAYER_PATH=&lt;path&gt;</span></code> environment variable to your project or your system. Something like this: <code class="docutils literal notranslate"><span class="pre">XR_API_LAYER_PATH=&lt;openxr_base&gt;/&lt;build_folder&gt;/src/api_layers/;&lt;another_path&gt;</span></code>. In this tutorial, the API layer files are found in <code class="docutils literal notranslate"><span class="pre">&lt;cmake_source_folder&gt;/build/_deps/openxr-build/src/api_layers/</span></code>.</p>
<p>The method described above sets the <code class="docutils literal notranslate"><span class="pre">XR_API_LAYER_PATH</span></code> environment variable, which overrrides the Operating System’s default API Layers Paths. See <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/main/specification/loader/api_layer.adoc#overriding-the-default-api-layer-paths">OpenXR API Layers - Overriding the Default API Layer Paths</a>. For more information on the default Desktop API Layer Discovery, see <a class="reference external" href="https://github.com/KhronosGroup/OpenXR-SDK-Source/blob/main/specification/loader/api_layer.adoc#desktop-api-layer-discovery">OpenXR API Layers - Desktop API Layer Discovery</a>.</p>
<p>The path must point to a folder containing a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file similar to the one for XR_APILAYER_LUNARG_core_validation, shown below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;file_format_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;api_layer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;XR_APILAYER_LUNARG_core_validation&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;library_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./XrApiLayer_core_validation.dll&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;api_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;implementation_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;API Layer to perform validation of api calls and parameters as they occur&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This file points to the library that the loader should use for this API layer.</p>
<dl class="simple">
<dt>To select which API layers we want to use, there are two ways to do this:</dt><dd><ol class="arabic simple">
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">XR_ENABLE_API_LAYERS=&lt;layer_name&gt;</span></code> environment variable to your project or your system. Something like this: <code class="docutils literal notranslate"><span class="pre">XR_ENABLE_API_LAYERS=XR_APILAYER_LUNARG_test1;XR_APILAYER_LUNARG_test2</span></code>.</p></li>
<li><p>When creating the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstance.html">XrInstance</a>, specify the requested API layers in the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/XrInstanceCreateInfo.html">XrInstanceCreateInfo</a> structure.</p></li>
</ol>
</dd>
</dl>
</section>
<section id="color-science">
<h2>6.4 Color Science<a class="headerlink" href="#color-science" title="Permalink to this heading">¶</a></h2>
<p>As OpenXR support both linear and sRGB color spaces for compositing. It is helpful to have a deeper knowledge of color science; especially if you are planning to use sRGB formats and have the OpenXR runtime/compositor do automatic conversions for you.</p>
<p>For more information on color spaces and gamma encoding, see J. Guy Davidson’s <a class="reference external" href="https://www.youtube.com/watch?v=_zQ_uBAHA4A">video presentation</a> on the subject.</p>
</section>
<section id="multithreaded-rendering">
<h2>6.5 Multithreaded Rendering<a class="headerlink" href="#multithreaded-rendering" title="Permalink to this heading">¶</a></h2>
<p>Multithreaded rendering with OpenXR is supported and it allows for simple and complex cases ranging from stand-alone application to game/rendering engines. In this tutorial, we have used a single thread to simulate and render our XR application, but modern desktops and mobile devices have multiple cores and thus threads for us to use. Effective use of multiple CPU threads in combination with parallel GPU work can deliver higher performance for the application.</p>
<p>The way to allow OpenXR to interact with multiple threads is to split up the three <code class="docutils literal notranslate"><span class="pre">xr...Frame</span></code> calls. Currently, <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrWaitFrame.html">xrWaitFrame</a>, <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrBeginFrame.html">xrBeginFrame</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEndFrame.html">xrEndFrame</a> are all called on a single thread. In the multithreaded case, <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrWaitFrame.html">xrWaitFrame</a> stays on the ‘simulation’ thread, whilst <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrBeginFrame.html">xrBeginFrame</a> and <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0/man/html/xrEndFrame.html">xrEndFrame</a> move to a ‘render’ thread. Below are examples of how thread interact with the three <code class="docutils literal notranslate"><span class="pre">xr...Frame</span></code> calls and the XR compositor frame hook.</p>
<p>Simple:</p>
<figure class="align-left">
<a class="reference internal image-reference" href="_images/multithreaded_simple.png"><img alt="OpenXR Simple Multithreaded Example" src="_images/multithreaded_simple.png" style="width: 99%;" /></a>
</figure>
<p>Complex:</p>
<figure class="align-left">
<a class="reference internal image-reference" href="_images/multithreaded_complex.png"><img alt="OpenXR Deeply Pipelined Multithreaded Example" src="_images/multithreaded_complex.png" style="width: 99%;" /></a>
</figure>
<p>Here’s a link to the PDF to download and a link to the video recording of the presentation.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.khronos.org/assets/uploads/developers/library/2018-siggraph/04-OpenXR-SIGGRAPH_Aug2018.pdf">Standardizing All the Realities: A Look at OpenXR by Kaye Mason for SIGGRAPH, August 2018 pp.37-38</a>.</p></li>
<li><p><a class="reference external" href="https://www.youtube.com/live/FCAM-3aAzXg?si=wK9yaPTocxS6quOh&amp;t=16409">SIGGRAPH 2018 Khronos BOF Sessions</a>.</p></li>
</ul>
<p>Note: This talk was given before the release of the OpenXR 1.0 Specification; therefore details may vary or be inaccurate.</p>
</section>
<section id="conclusion">
<h2>6.6 Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>In this chapter, we discussed a few of the possible next steps in your OpenXR journey. Be sure to refer back to the <a class="reference external" href="https://registry.khronos.org/OpenXR/specs/1.0">OpenXR Specification</a> and look out for updates, both there and here, as the specification develops.</p>
<p>The text of the OpenXR Tutorial is by Roderick Kennedy and Andrew Richards of Simul Software Ltd. The design of the site is by Calland Creative Ltd. The site is overseen by the Khronos OpenXR Working Group. Thanks to all volunteers who tested the site through its development.</p>
<p>Version: v0.0.0</p>
</section>
</section>


					</div>
				</div>
				<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="5-extensions.html" class="btn btn-neutral float-left" title="5 Extensions" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr>

  <div role="contentinfo">
      <div class="legal-notice">
      <h3>Legal Notice</h3>
      <p>
      </p>
      <p>
        &#169; 2023, The Khronos Group. <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons International 4.0 BY Attribution</a>. Code is licensed as <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>.
      </p>
      <p>
        "OpenXR" and the OpenXR logo are trademarks owned by The Khronos Group Inc. and are registered as a trademark in China, the European Union, Japan and the United Kingdom. Vulkan and the Vulkan logo are registered trademarks of the Khronos Group Inc.
      </p>
      <p>
        OpenGL&reg; and the oval logo are trademarks or registered trademarks of Hewlett Packard Enterprise in the United States and/or other countries worldwide. OpenGL is a registered trademark and the OpenGL ES logo is a trademark of Hewlett Packard Enterprise used by permission by Khronos.
      </p>
      <p>
        Microsoft DirectX, Microsoft DirectX11, and Microsoft DirectX12 are trademarks owned by Microsoft.
      </p>
        
      <p>
        The OpenXR Tutorial is owned and operated by The Khronos Group Inc. Khronos <a href="https://www.khronos.org/legal/" rel="nofollow">Legal Notices</a>, <a href="https://www.khronos.org/legal/privacy" rel="nofollow">Privacy Policy</a>, and <a href="https://www.khronos.org/about/code-of-conduct" rel="nofollow">Code of Conduct</a> apply.
      </p>
      <p></p>
      </div>
  </div> 

</footer>
			</div>
			</div>
		</div>
	</div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>